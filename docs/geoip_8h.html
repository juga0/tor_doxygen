<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tor: /home/user/_my/code/bwauth-related/tor/src/or/geoip.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tor
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97b64286d42c5ef1697cb5f17129db19.html">tor</a></li><li class="navelem"><a class="el" href="dir_3cb0ba3f4b82dbe34a1a06276e96bc8d.html">src</a></li><li class="navelem"><a class="el" href="dir_386635fabd7f6c74e9d9c7a8604514a0.html">or</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">geoip.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Header file for <a class="el" href="geoip_8c.html" title="Functions related to maintaining an IP-to-country database; to summarizing client connections by coun...">geoip.c</a>.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;testsupport.h&quot;</code><br />
<code>#include &quot;dos.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for geoip.h:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8h__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2geoip_8h" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2geoip_8h" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2geoip_8h">
<area shape="rect" id="node2" href="testsupport_8h_source.html" title="testsupport.h" alt="" coords="5,109,104,136"/>
<area shape="rect" id="node3" href="dos_8h_source.html" title="dos.h" alt="" coords="129,109,183,136"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8h__dep__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2geoip_8hdep" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2geoip_8hdep" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2geoip_8hdep">
<area shape="rect" id="node2" href="channel_8c.html" title="OR/OP&#45;to&#45;OR channel abstraction layer. A channel&#39;s job is to transfer cells from Tor instance to Tor ..." alt="" coords="5,109,153,165"/>
<area shape="rect" id="node3" href="config_8c.html" title="Code to interpret the user&#39;s configuration of Tor. " alt="" coords="177,109,325,165"/>
<area shape="rect" id="node4" href="connection_8c.html" title="General high&#45;level functions to handle reading and writing on connections. " alt="" coords="349,109,497,165"/>
<area shape="rect" id="node5" href="connection__or_8c.html" title="Functions to handle OR connections, TLS handshaking, and cells on the network. " alt="" coords="522,109,677,165"/>
<area shape="rect" id="node6" href="control_8c.html" title="Implementation for Tor&#39;s control&#45;socket interface. " alt="" coords="701,109,849,165"/>
<area shape="rect" id="node7" href="directory_8c.html" title="Code to send and fetch information from directory authorities and caches via HTTP. " alt="" coords="873,109,1021,165"/>
<area shape="rect" id="node8" href="geoip_8c.html" title="Functions related to maintaining an IP&#45;to&#45;country database; to summarizing client connections by coun..." alt="" coords="1045,109,1193,165"/>
<area shape="rect" id="node9" href="main_8c.html" title="Toplevel module. Handles signals, multiplexes between connections, implements main loop..." alt="" coords="1217,109,1365,165"/>
<area shape="rect" id="node10" href="nodelist_8c.html" title="Structures and functions for tracking what we know about the routers on the Tor network, and correlating information from networkstatus, routerinfo, and microdescs. " alt="" coords="1389,109,1537,165"/>
<area shape="rect" id="node11" href="policies_8c.html" title="Code to parse and use address policies and exit policies. " alt="" coords="1561,109,1709,165"/>
<area shape="rect" id="node12" href="relay_8c.html" title="Handle relay cell encryption/decryption, plus packaging and receiving from circuits, plus queuing on circuits. " alt="" coords="1733,109,1881,165"/>
<area shape="rect" id="node13" href="router_8c.html" title="Miscellaneous relay functionality, including RSA key maintenance, generating and uploading server des..." alt="" coords="1905,109,2053,165"/>
<area shape="rect" id="node14" href="routerlist_8c.html" title="Code to maintain and access the global list of routerinfos for known servers. " alt="" coords="2077,109,2225,165"/>
<area shape="rect" id="node15" href="routerset_8c.html" title="Functions and structures to handle set&#45;type selection of routers by name, ID, address, etc. " alt="" coords="2249,109,2397,165"/>
<area shape="rect" id="node16" href="status_8c.html" title="Collect status information and log heartbeat messages. " alt="" coords="2421,109,2569,165"/>
</map>
</div>
</div>
<p><a href="geoip_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structclientmap__entry__t.html">clientmap_entry_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a247859f393ab04447697972fa043690e"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structclientmap__entry__t.html">clientmap_entry_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a247859f393ab04447697972fa043690e">clientmap_entry_t</a></td></tr>
<tr class="separator:a247859f393ab04447697972fa043690e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aecc961d6ac7cd75ec8593321d51d909a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#aecc961d6ac7cd75ec8593321d51d909a">should_record_bridge_info</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:aecc961d6ac7cd75ec8593321d51d909a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99613dd6eb7666bd2e5fe481f15ec301"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a99613dd6eb7666bd2e5fe481f15ec301">geoip_load_file</a> (sa_family_t family, const char *filename)</td></tr>
<tr class="separator:a99613dd6eb7666bd2e5fe481f15ec301"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18cfe6c33f5256a2e4bd07c8f2c69dd2"><td class="memItemLeft" align="right" valign="top"><a id="a18cfe6c33f5256a2e4bd07c8f2c69dd2"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>MOCK_DECL</b> (int, geoip_get_country_by_addr,(const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *addr))</td></tr>
<tr class="separator:a18cfe6c33f5256a2e4bd07c8f2c69dd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef5c546c8c2cd61a1bf0846ba9d53985"><td class="memItemLeft" align="right" valign="top"><a id="aef5c546c8c2cd61a1bf0846ba9d53985"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>MOCK_DECL</b> (int, geoip_get_n_countries,(void))</td></tr>
<tr class="separator:aef5c546c8c2cd61a1bf0846ba9d53985"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b4edbf9595712e436768afa457abfcc"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a6b4edbf9595712e436768afa457abfcc">geoip_get_country_name</a> (<a class="el" href="or_8h.html#a1b74a0e9c6772fcfcc7facf26a11a213">country_t</a> num)</td></tr>
<tr class="separator:a6b4edbf9595712e436768afa457abfcc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a470776fd091f5bae0f2ebbf909f8e777"><td class="memItemLeft" align="right" valign="top"><a id="a470776fd091f5bae0f2ebbf909f8e777"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>MOCK_DECL</b> (int, geoip_is_loaded,(sa_family_t family))</td></tr>
<tr class="separator:a470776fd091f5bae0f2ebbf909f8e777"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2facbb330d6f7714db2fd5293ed00477"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a2facbb330d6f7714db2fd5293ed00477">geoip_db_digest</a> (sa_family_t family)</td></tr>
<tr class="separator:a2facbb330d6f7714db2fd5293ed00477"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6527a8e468033ffe072ef40572ead789"><td class="memItemLeft" align="right" valign="top"><a id="a6527a8e468033ffe072ef40572ead789"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>MOCK_DECL</b> (<a class="el" href="or_8h.html#a1b74a0e9c6772fcfcc7facf26a11a213">country_t</a>, geoip_get_country,(const char *countrycode))</td></tr>
<tr class="separator:a6527a8e468033ffe072ef40572ead789"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89c00fefaf2f19a1097e93e3116cd30f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a89c00fefaf2f19a1097e93e3116cd30f">geoip_note_client_seen</a> (<a class="el" href="or_8h.html#a583c7385547b5d02255fa8a8bd5d41dd">geoip_client_action_t</a> action, const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *addr, const char *transport_name, time_t now)</td></tr>
<tr class="separator:a89c00fefaf2f19a1097e93e3116cd30f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44567c1ed4bddb830f39ccdc3a48b45e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a44567c1ed4bddb830f39ccdc3a48b45e">geoip_remove_old_clients</a> (time_t cutoff)</td></tr>
<tr class="separator:a44567c1ed4bddb830f39ccdc3a48b45e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81694e23a1b491980710ce4fee696573"><td class="memItemLeft" align="right" valign="top"><a id="a81694e23a1b491980710ce4fee696573"></a>
<a class="el" href="structclientmap__entry__t.html">clientmap_entry_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>geoip_lookup_client</b> (const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *addr, const char *transport_name, <a class="el" href="or_8h.html#a583c7385547b5d02255fa8a8bd5d41dd">geoip_client_action_t</a> action)</td></tr>
<tr class="separator:a81694e23a1b491980710ce4fee696573"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cbb6210291effe28c16054d7aaa3ae8"><td class="memItemLeft" align="right" valign="top"><a id="a3cbb6210291effe28c16054d7aaa3ae8"></a>
size_t&#160;</td><td class="memItemRight" valign="bottom"><b>geoip_client_cache_total_allocation</b> (void)</td></tr>
<tr class="separator:a3cbb6210291effe28c16054d7aaa3ae8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add7c5cc110714231e1f34da7e95d9007"><td class="memItemLeft" align="right" valign="top"><a id="add7c5cc110714231e1f34da7e95d9007"></a>
size_t&#160;</td><td class="memItemRight" valign="bottom"><b>geoip_client_cache_handle_oom</b> (time_t now, size_t min_remove_bytes)</td></tr>
<tr class="separator:add7c5cc110714231e1f34da7e95d9007"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d6b5b368e2d9fd4f87a19161c17ea1d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a3d6b5b368e2d9fd4f87a19161c17ea1d">geoip_note_ns_response</a> (<a class="el" href="or_8h.html#afdb6254fb58e226a267558a966bc4749">geoip_ns_response_t</a> response)</td></tr>
<tr class="separator:a3d6b5b368e2d9fd4f87a19161c17ea1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9680658d466013c2edcd9872397d7df4"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a9680658d466013c2edcd9872397d7df4">geoip_get_transport_history</a> (void)</td></tr>
<tr class="separator:a9680658d466013c2edcd9872397d7df4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e369d89e0ee84d0898bfa6ce1b90331"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a0e369d89e0ee84d0898bfa6ce1b90331">geoip_get_client_history</a> (<a class="el" href="or_8h.html#a583c7385547b5d02255fa8a8bd5d41dd">geoip_client_action_t</a> action, char **country_str, char **ipver_str)</td></tr>
<tr class="separator:a0e369d89e0ee84d0898bfa6ce1b90331"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2499466518ad5e26022a844ca05e5ed9"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a2499466518ad5e26022a844ca05e5ed9">geoip_get_request_history</a> (void)</td></tr>
<tr class="separator:a2499466518ad5e26022a844ca05e5ed9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a921840886e0a3d9ba57b014e6629cf1b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a921840886e0a3d9ba57b014e6629cf1b">getinfo_helper_geoip</a> (<a class="el" href="structcontrol__connection__t.html">control_connection_t</a> *control_conn, const char *question, char **answer, const char **errmsg)</td></tr>
<tr class="separator:a921840886e0a3d9ba57b014e6629cf1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a1572de278165ce157dc7e1c94db26e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a6a1572de278165ce157dc7e1c94db26e">geoip_free_all</a> (void)</td></tr>
<tr class="separator:a6a1572de278165ce157dc7e1c94db26e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a642404b6a23907878bdbd5459ec356df"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a642404b6a23907878bdbd5459ec356df">geoip_start_dirreq</a> (uint64_t dirreq_id, size_t response_size, <a class="el" href="or_8h.html#a118711f7f25509a02d10bba02f484333">dirreq_type_t</a> type)</td></tr>
<tr class="separator:a642404b6a23907878bdbd5459ec356df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a34cf4b056ecac0418dcc5927b03bb6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a2a34cf4b056ecac0418dcc5927b03bb6">geoip_change_dirreq_state</a> (uint64_t dirreq_id, <a class="el" href="or_8h.html#a118711f7f25509a02d10bba02f484333">dirreq_type_t</a> type, <a class="el" href="or_8h.html#a15ebe7a7ef485980df539b5632fd7f13">dirreq_state_t</a> new_state)</td></tr>
<tr class="separator:a2a34cf4b056ecac0418dcc5927b03bb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d212344518dcf63b2fb63778f9fca4b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a1d212344518dcf63b2fb63778f9fca4b">geoip_dirreq_stats_init</a> (time_t now)</td></tr>
<tr class="separator:a1d212344518dcf63b2fb63778f9fca4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9776e0395b9b7397a1dd1b81130af81b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a9776e0395b9b7397a1dd1b81130af81b">geoip_reset_dirreq_stats</a> (time_t now)</td></tr>
<tr class="separator:a9776e0395b9b7397a1dd1b81130af81b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a1fa321acc074ffda98813bcf91ead4"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a5a1fa321acc074ffda98813bcf91ead4">geoip_format_dirreq_stats</a> (time_t now)</td></tr>
<tr class="separator:a5a1fa321acc074ffda98813bcf91ead4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1493d3d72b91af0a630a3ea7f88dacb5"><td class="memItemLeft" align="right" valign="top">time_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a1493d3d72b91af0a630a3ea7f88dacb5">geoip_dirreq_stats_write</a> (time_t now)</td></tr>
<tr class="separator:a1493d3d72b91af0a630a3ea7f88dacb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5728ac9307e2a055f2ca525473b32aee"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a5728ac9307e2a055f2ca525473b32aee">geoip_dirreq_stats_term</a> (void)</td></tr>
<tr class="separator:a5728ac9307e2a055f2ca525473b32aee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ed8ca121b3ea6b3ee4caf69724b826c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a4ed8ca121b3ea6b3ee4caf69724b826c">geoip_entry_stats_init</a> (time_t now)</td></tr>
<tr class="separator:a4ed8ca121b3ea6b3ee4caf69724b826c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03b8a3ff5c44a9e5a6b9e503187cc541"><td class="memItemLeft" align="right" valign="top">time_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a03b8a3ff5c44a9e5a6b9e503187cc541">geoip_entry_stats_write</a> (time_t now)</td></tr>
<tr class="separator:a03b8a3ff5c44a9e5a6b9e503187cc541"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4ca20951b3b9a4a251e8ae83ba0ec2f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#ad4ca20951b3b9a4a251e8ae83ba0ec2f">geoip_entry_stats_term</a> (void)</td></tr>
<tr class="separator:ad4ca20951b3b9a4a251e8ae83ba0ec2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e8ee9964ff62e5009f1b49231e52d1f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a0e8ee9964ff62e5009f1b49231e52d1f">geoip_reset_entry_stats</a> (time_t now)</td></tr>
<tr class="separator:a0e8ee9964ff62e5009f1b49231e52d1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa723566e12d91030bb8569a06efa947f"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#aa723566e12d91030bb8569a06efa947f">geoip_format_entry_stats</a> (time_t now)</td></tr>
<tr class="separator:aa723566e12d91030bb8569a06efa947f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2135ad34b878a10f3063c8923d882315"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a2135ad34b878a10f3063c8923d882315">geoip_bridge_stats_init</a> (time_t now)</td></tr>
<tr class="separator:a2135ad34b878a10f3063c8923d882315"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a106d5e279ceaf3dfd1585d87ac7c4bd4"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a106d5e279ceaf3dfd1585d87ac7c4bd4">geoip_format_bridge_stats</a> (time_t now)</td></tr>
<tr class="separator:a106d5e279ceaf3dfd1585d87ac7c4bd4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afaac00872c7f8e4d6f81aa3c32ad46a2"><td class="memItemLeft" align="right" valign="top">time_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#afaac00872c7f8e4d6f81aa3c32ad46a2">geoip_bridge_stats_write</a> (time_t now)</td></tr>
<tr class="separator:afaac00872c7f8e4d6f81aa3c32ad46a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4dd2b854ffac145221cfad211925dc90"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a4dd2b854ffac145221cfad211925dc90">geoip_bridge_stats_term</a> (void)</td></tr>
<tr class="separator:a4dd2b854ffac145221cfad211925dc90"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abcc5d2c3b7a0a65e8d4cd51a87963240"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#abcc5d2c3b7a0a65e8d4cd51a87963240">geoip_get_bridge_stats_extrainfo</a> (time_t)</td></tr>
<tr class="separator:abcc5d2c3b7a0a65e8d4cd51a87963240"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5cee00c3f5f965c0fe9eee66ce48bb74"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a5cee00c3f5f965c0fe9eee66ce48bb74">geoip_get_bridge_stats_controller</a> (time_t)</td></tr>
<tr class="separator:a5cee00c3f5f965c0fe9eee66ce48bb74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b5c99d168aba5cb0223650cd2989054"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8h.html#a8b5c99d168aba5cb0223650cd2989054">format_client_stats_heartbeat</a> (time_t now)</td></tr>
<tr class="separator:a8b5c99d168aba5cb0223650cd2989054"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Header file for <a class="el" href="geoip_8c.html" title="Functions related to maintaining an IP-to-country database; to summarizing client connections by coun...">geoip.c</a>. </p>
</div><h2 class="groupheader">Typedef Documentation</h2>
<a id="a247859f393ab04447697972fa043690e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a247859f393ab04447697972fa043690e">&#9670;&nbsp;</a></span>clientmap_entry_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structclientmap__entry__t.html">clientmap_entry_t</a>  <a class="el" href="structclientmap__entry__t.html">clientmap_entry_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Entry in a map from IP address to the last time we've seen an incoming connection from that IP address. Used by bridges only to track which countries have them blocked, or the DoS mitigation subsystem if enabled. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a8b5c99d168aba5cb0223650cd2989054"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b5c99d168aba5cb0223650cd2989054">&#9670;&nbsp;</a></span>format_client_stats_heartbeat()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* format_client_stats_heartbeat </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a newly allocated string holding our bridge usage stats by country in a format suitable for inclusion in our heartbeat message. Return NULL on failure. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8h_a8b5c99d168aba5cb0223650cd2989054_cgraph.png" border="0" usemap="#geoip_8h_a8b5c99d168aba5cb0223650cd2989054_cgraph" alt=""/></div>
<map name="geoip_8h_a8b5c99d168aba5cb0223650cd2989054_cgraph" id="geoip_8h_a8b5c99d168aba5cb0223650cd2989054_cgraph">
<area shape="rect" id="node2" href="compat_8c.html#ade97970c1d8a691241adac739c4f9b12" title="tor_asprintf" alt="" coords="187,13,273,39"/>
<area shape="rect" id="node3" href="compat_8c.html#a5ef7a08e8b543c0d61f9ef1081d4c1ea" title="tor_vasprintf" alt="" coords="321,13,416,39"/>
</map>
</div>

</div>
</div>
<a id="a2135ad34b878a10f3063c8923d882315"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2135ad34b878a10f3063c8923d882315">&#9670;&nbsp;</a></span>geoip_bridge_stats_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_bridge_stats_init </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize bridge stats. </p>

</div>
</div>
<a id="a4dd2b854ffac145221cfad211925dc90"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4dd2b854ffac145221cfad211925dc90">&#9670;&nbsp;</a></span>geoip_bridge_stats_term()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_bridge_stats_term </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Stop collecting bridge stats in a way that we can re-start doing so in <a class="el" href="geoip_8c.html#a2135ad34b878a10f3063c8923d882315">geoip_bridge_stats_init()</a>. </p>

</div>
</div>
<a id="afaac00872c7f8e4d6f81aa3c32ad46a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afaac00872c7f8e4d6f81aa3c32ad46a2">&#9670;&nbsp;</a></span>geoip_bridge_stats_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">time_t geoip_bridge_stats_write </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write bridge statistics to $DATADIR/stats/bridge-stats and return when we should next try to write statistics. </p>

</div>
</div>
<a id="a2a34cf4b056ecac0418dcc5927b03bb6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a34cf4b056ecac0418dcc5927b03bb6">&#9670;&nbsp;</a></span>geoip_change_dirreq_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_change_dirreq_state </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>dirreq_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="or_8h.html#a118711f7f25509a02d10bba02f484333">dirreq_type_t</a>&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="or_8h.html#a15ebe7a7ef485980df539b5632fd7f13">dirreq_state_t</a>&#160;</td>
          <td class="paramname"><em>new_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Change the state of the either direct or tunneled (see <b>type</b>) directory request with <b>dirreq_id</b> to <b>new_state</b> and possibly mark it as completed. If no entry can be found for the given key parts (e.g., if this is a directory request that we are not measuring, or one that was started in the previous measurement period), or if the state cannot be advanced to <b>new_state</b>, do nothing. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8h_a2a34cf4b056ecac0418dcc5927b03bb6_icgraph.png" border="0" usemap="#geoip_8h_a2a34cf4b056ecac0418dcc5927b03bb6_icgraph" alt=""/></div>
<map name="geoip_8h_a2a34cf4b056ecac0418dcc5927b03bb6_icgraph" id="geoip_8h_a2a34cf4b056ecac0418dcc5927b03bb6_icgraph">
<area shape="rect" id="node2" href="channel_8c.html#abc5a904f9dc44b21911ceed8d18fd218" title="channel_notify_flushed" alt="" coords="197,5,351,32"/>
<area shape="rect" id="node3" href="directory_8h.html#a1bcf7851094badfe17ac6f027f70ce2f" title="connection_dir_finished\l_flushing" alt="" coords="195,57,353,98"/>
</map>
</div>

</div>
</div>
<a id="a2facbb330d6f7714db2fd5293ed00477"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2facbb330d6f7714db2fd5293ed00477">&#9670;&nbsp;</a></span>geoip_db_digest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* geoip_db_digest </td>
          <td>(</td>
          <td class="paramtype">sa_family_t&#160;</td>
          <td class="paramname"><em>family</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the hex-encoded SHA1 digest of the loaded GeoIP file. The result does not need to be deallocated, but will be overwritten by the next call of <a class="el" href="util_8c.html#a17effd59ed2f9bf4cfebb12e423ded7f">hex_str()</a>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8h_a2facbb330d6f7714db2fd5293ed00477_cgraph.png" border="0" usemap="#geoip_8h_a2facbb330d6f7714db2fd5293ed00477_cgraph" alt=""/></div>
<map name="geoip_8h_a2facbb330d6f7714db2fd5293ed00477_cgraph" id="geoip_8h_a2facbb330d6f7714db2fd5293ed00477_cgraph">
<area shape="rect" id="node2" href="util_8c.html#a17effd59ed2f9bf4cfebb12e423ded7f" title="hex_str" alt="" coords="169,5,235,32"/>
<area shape="rect" id="node3" href="util__format_8c.html#a8b8940b2ef607928eb3dca4850567ea5" title="base16_encode" alt="" coords="283,5,396,32"/>
</map>
</div>

</div>
</div>
<a id="a1d212344518dcf63b2fb63778f9fca4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d212344518dcf63b2fb63778f9fca4b">&#9670;&nbsp;</a></span>geoip_dirreq_stats_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_dirreq_stats_init </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize directory request stats. </p>

</div>
</div>
<a id="a5728ac9307e2a055f2ca525473b32aee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5728ac9307e2a055f2ca525473b32aee">&#9670;&nbsp;</a></span>geoip_dirreq_stats_term()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_dirreq_stats_term </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Stop collecting directory request stats in a way that we can re-start doing so in <a class="el" href="geoip_8c.html#a1d212344518dcf63b2fb63778f9fca4b">geoip_dirreq_stats_init()</a>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8h_a5728ac9307e2a055f2ca525473b32aee_cgraph.png" border="0" usemap="#geoip_8h_a5728ac9307e2a055f2ca525473b32aee_cgraph" alt=""/></div>
<map name="geoip_8h_a5728ac9307e2a055f2ca525473b32aee_cgraph" id="geoip_8h_a5728ac9307e2a055f2ca525473b32aee_cgraph">
<area shape="rect" id="node2" href="geoip_8c.html#a9776e0395b9b7397a1dd1b81130af81b" title="geoip_reset_dirreq\l_stats" alt="" coords="215,5,343,47"/>
</map>
</div>

</div>
</div>
<a id="a1493d3d72b91af0a630a3ea7f88dacb5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1493d3d72b91af0a630a3ea7f88dacb5">&#9670;&nbsp;</a></span>geoip_dirreq_stats_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">time_t geoip_dirreq_stats_write </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If 24 hours have passed since the beginning of the current dirreq stats period, write dirreq stats to $DATADIR/stats/dirreq-stats (possibly overwriting an existing file) and reset counters. Return when we would next want to write dirreq stats or 0 if we never want to write. </p>

</div>
</div>
<a id="a4ed8ca121b3ea6b3ee4caf69724b826c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ed8ca121b3ea6b3ee4caf69724b826c">&#9670;&nbsp;</a></span>geoip_entry_stats_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_entry_stats_init </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize entry stats. </p>

</div>
</div>
<a id="ad4ca20951b3b9a4a251e8ae83ba0ec2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4ca20951b3b9a4a251e8ae83ba0ec2f">&#9670;&nbsp;</a></span>geoip_entry_stats_term()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_entry_stats_term </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Stop collecting entry stats in a way that we can re-start doing so in <a class="el" href="geoip_8c.html#a4ed8ca121b3ea6b3ee4caf69724b826c">geoip_entry_stats_init()</a>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8h_ad4ca20951b3b9a4a251e8ae83ba0ec2f_cgraph.png" border="0" usemap="#geoip_8h_ad4ca20951b3b9a4a251e8ae83ba0ec2f_cgraph" alt=""/></div>
<map name="geoip_8h_ad4ca20951b3b9a4a251e8ae83ba0ec2f_cgraph" id="geoip_8h_ad4ca20951b3b9a4a251e8ae83ba0ec2f_cgraph">
<area shape="rect" id="node2" href="geoip_8c.html#a0e8ee9964ff62e5009f1b49231e52d1f" title="geoip_reset_entry_stats" alt="" coords="212,5,373,32"/>
</map>
</div>

</div>
</div>
<a id="a03b8a3ff5c44a9e5a6b9e503187cc541"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03b8a3ff5c44a9e5a6b9e503187cc541">&#9670;&nbsp;</a></span>geoip_entry_stats_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">time_t geoip_entry_stats_write </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If 24 hours have passed since the beginning of the current entry stats period, write entry stats to $DATADIR/stats/entry-stats (possibly overwriting an existing file) and reset counters. Return when we would next want to write entry stats or 0 if we never want to write. </p>

</div>
</div>
<a id="a106d5e279ceaf3dfd1585d87ac7c4bd4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a106d5e279ceaf3dfd1585d87ac7c4bd4">&#9670;&nbsp;</a></span>geoip_format_bridge_stats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* geoip_format_bridge_stats </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a newly allocated string holding our bridge usage stats by country in a format suitable for inclusion in an extrainfo document. Return NULL on failure. </p>

</div>
</div>
<a id="a5a1fa321acc074ffda98813bcf91ead4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a1fa321acc074ffda98813bcf91ead4">&#9670;&nbsp;</a></span>geoip_format_dirreq_stats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* geoip_format_dirreq_stats </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a newly allocated string containing the dirreq statistics until <b>now</b>, or NULL if we're not collecting dirreq stats. Caller must ensure start_of_dirreq_stats_interval is in the past. </p>

</div>
</div>
<a id="aa723566e12d91030bb8569a06efa947f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa723566e12d91030bb8569a06efa947f">&#9670;&nbsp;</a></span>geoip_format_entry_stats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* geoip_format_entry_stats </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a newly allocated string containing the entry statistics until <b>now</b>, or NULL if we're not collecting entry stats. Caller must ensure start_of_entry_stats_interval lies in the past. </p>

</div>
</div>
<a id="a6a1572de278165ce157dc7e1c94db26e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a1572de278165ce157dc7e1c94db26e">&#9670;&nbsp;</a></span>geoip_free_all()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_free_all </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Release all storage held in this file. </p>

</div>
</div>
<a id="a5cee00c3f5f965c0fe9eee66ce48bb74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5cee00c3f5f965c0fe9eee66ce48bb74">&#9670;&nbsp;</a></span>geoip_get_bridge_stats_controller()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* geoip_get_bridge_stats_controller </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a new string containing the recent bridge statistics to be returned to controller clients, or NULL if we don't have any bridge statistics. </p>

</div>
</div>
<a id="abcc5d2c3b7a0a65e8d4cd51a87963240"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abcc5d2c3b7a0a65e8d4cd51a87963240">&#9670;&nbsp;</a></span>geoip_get_bridge_stats_extrainfo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* geoip_get_bridge_stats_extrainfo </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return most recent bridge statistics for inclusion in extra-info descriptors, or NULL if we don't have recent bridge statistics. </p>

</div>
</div>
<a id="a0e369d89e0ee84d0898bfa6ce1b90331"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e369d89e0ee84d0898bfa6ce1b90331">&#9670;&nbsp;</a></span>geoip_get_client_history()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int geoip_get_client_history </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="or_8h.html#a583c7385547b5d02255fa8a8bd5d41dd">geoip_client_action_t</a>&#160;</td>
          <td class="paramname"><em>action</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>country_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>ipver_str</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Store a newly allocated comma-separated string in *country_str containing entries for all the countries from which we've seen enough clients connect as a bridge, directory server, or entry guard. The entry format is cc=num where num is the number of IPs we've seen connecting from that country, and cc is a lowercased country code. *country_str is set to NULL if we're not ready to export per country data yet.</p>
<p>Store a newly allocated comma-separated string in ipver_str containing entries for clients connecting over IPv4 and IPv6. The format is family=num where num is the nubmer of IPs we've seen connecting over that protocol family, and family is 'v4' or 'v6'.</p>
<p>Return 0 on success and -1 if we're missing geoip data. </p>
<p>unresolved requests are stored at index 0. </p>

</div>
</div>
<a id="a6b4edbf9595712e436768afa457abfcc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b4edbf9595712e436768afa457abfcc">&#9670;&nbsp;</a></span>geoip_get_country_name()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* geoip_get_country_name </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="or_8h.html#a1b74a0e9c6772fcfcc7facf26a11a213">country_t</a>&#160;</td>
          <td class="paramname"><em>num</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the two-letter country code associated with the number <b>num</b>, or "??" for an unknown value. </p>

</div>
</div>
<a id="a2499466518ad5e26022a844ca05e5ed9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2499466518ad5e26022a844ca05e5ed9">&#9670;&nbsp;</a></span>geoip_get_request_history()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* geoip_get_request_history </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a newly allocated string holding the per-country request history for v3 network statuses in a format suitable for an extra-info document, or NULL on failure. </p>

</div>
</div>
<a id="a9680658d466013c2edcd9872397d7df4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9680658d466013c2edcd9872397d7df4">&#9670;&nbsp;</a></span>geoip_get_transport_history()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* geoip_get_transport_history </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the bridge-ip-transports string that should be inserted in our extra-info descriptor. Return NULL if the bridge-ip-transports line should be empty. </p>
<p>String hash table (name of transport) -&gt; (number of users).</p>
<p>Smartlist that contains copies of the names of the transports that have been used.</p>
<p>We do the following steps to form the transport history string: a) Foreach client that uses a pluggable transport, we increase the times that transport was used by one. If the client did not use a transport, we increase the number of times someone connected without obfuscation. b) Foreach transport we observed, we write its transport history string and push it to string_chunks. So, for example, if we've seen 665 obfs2 clients, we write "obfs2=665". c) We concatenate string_chunks to form the final string.</p>

</div>
</div>
<a id="a99613dd6eb7666bd2e5fe481f15ec301"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99613dd6eb7666bd2e5fe481f15ec301">&#9670;&nbsp;</a></span>geoip_load_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int geoip_load_file </td>
          <td>(</td>
          <td class="paramtype">sa_family_t&#160;</td>
          <td class="paramname"><em>family</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>filename</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Clear appropriate GeoIP database, based on <b>family</b>, and reload it from the file <b>filename</b>. Return 0 on success, -1 on failure.</p>
<p>Recognized line formats for IPv4 are: INTIPLOW,INTIPHIGH,CC and "INTIPLOW","INTIPHIGH","CC","CC3","COUNTRY NAME" where INTIPLOW and INTIPHIGH are IPv4 addresses encoded as 4-byte unsigned integers, and CC is a country code.</p>
<p>Recognized line format for IPv6 is: IPV6LOW,IPV6HIGH,CC where IPV6LOW and IPV6HIGH are IPv6 addresses and CC is a country code.</p>
<p>It also recognizes, and skips over, blank lines and lines that start with '#' (comments). </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8h_a99613dd6eb7666bd2e5fe481f15ec301_cgraph.png" border="0" usemap="#geoip_8h_a99613dd6eb7666bd2e5fe481f15ec301_cgraph" alt=""/></div>
<map name="geoip_8h_a99613dd6eb7666bd2e5fe481f15ec301_cgraph" id="geoip_8h_a99613dd6eb7666bd2e5fe481f15ec301_cgraph">
<area shape="rect" id="node2" href="config_8c.html#ad09b1993fdca508d228a7585813efcac" title="options_need_geoip_info" alt="" coords="161,31,327,57"/>
<area shape="rect" id="node5" href="compat_8c.html#a99ee17f8317be48a2391c20e31e8a7b8" title="tor_fopen_cloexec" alt="" coords="180,81,308,108"/>
<area shape="rect" id="node3" href="geoip_8c.html#aecc961d6ac7cd75ec8593321d51d909a" title="should_record_bridge_info" alt="" coords="375,5,548,32"/>
<area shape="rect" id="node4" href="routerset_8c.html#a06782dad9f20dd3a3da80d9df1d4c3b3" title="routerset_needs_geoip" alt="" coords="385,56,538,83"/>
</map>
</div>

</div>
</div>
<a id="a89c00fefaf2f19a1097e93e3116cd30f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a89c00fefaf2f19a1097e93e3116cd30f">&#9670;&nbsp;</a></span>geoip_note_client_seen()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_note_client_seen </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="or_8h.html#a583c7385547b5d02255fa8a8bd5d41dd">geoip_client_action_t</a>&#160;</td>
          <td class="paramname"><em>action</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>transport_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Note that we've seen a client connect from the IP <b>addr</b> at time <b>now</b>. Ignored by all but bridges and directories if configured accordingly. </p>
<p>unresolved requests are stored at index 0. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8h_a89c00fefaf2f19a1097e93e3116cd30f_cgraph.png" border="0" usemap="#geoip_8h_a89c00fefaf2f19a1097e93e3116cd30f_cgraph" alt=""/></div>
<map name="geoip_8h_a89c00fefaf2f19a1097e93e3116cd30f_cgraph" id="geoip_8h_a89c00fefaf2f19a1097e93e3116cd30f_cgraph">
<area shape="rect" id="node2" href="geoip_8c.html#aecc961d6ac7cd75ec8593321d51d909a" title="should_record_bridge_info" alt="" coords="212,5,385,32"/>
</map>
</div>

</div>
</div>
<a id="a3d6b5b368e2d9fd4f87a19161c17ea1d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d6b5b368e2d9fd4f87a19161c17ea1d">&#9670;&nbsp;</a></span>geoip_note_ns_response()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_note_ns_response </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="or_8h.html#afdb6254fb58e226a267558a966bc4749">geoip_ns_response_t</a>&#160;</td>
          <td class="paramname"><em>response</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Note that we've rejected a client's request for a v3 network status for reason <b>reason</b> at time <b>now</b>. </p>

</div>
</div>
<a id="a44567c1ed4bddb830f39ccdc3a48b45e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44567c1ed4bddb830f39ccdc3a48b45e">&#9670;&nbsp;</a></span>geoip_remove_old_clients()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_remove_old_clients </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>cutoff</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Forget about all clients that haven't connected since <b>cutoff</b>. </p>

</div>
</div>
<a id="a9776e0395b9b7397a1dd1b81130af81b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9776e0395b9b7397a1dd1b81130af81b">&#9670;&nbsp;</a></span>geoip_reset_dirreq_stats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_reset_dirreq_stats </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reset counters for dirreq stats. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8h_a9776e0395b9b7397a1dd1b81130af81b_icgraph.png" border="0" usemap="#geoip_8h_a9776e0395b9b7397a1dd1b81130af81b_icgraph" alt=""/></div>
<map name="geoip_8h_a9776e0395b9b7397a1dd1b81130af81b_icgraph" id="geoip_8h_a9776e0395b9b7397a1dd1b81130af81b_icgraph">
<area shape="rect" id="node2" href="geoip_8h.html#a5728ac9307e2a055f2ca525473b32aee" title="geoip_dirreq_stats_term" alt="" coords="181,13,343,39"/>
</map>
</div>

</div>
</div>
<a id="a0e8ee9964ff62e5009f1b49231e52d1f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e8ee9964ff62e5009f1b49231e52d1f">&#9670;&nbsp;</a></span>geoip_reset_entry_stats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_reset_entry_stats </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reset counters for entry stats. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8h_a0e8ee9964ff62e5009f1b49231e52d1f_icgraph.png" border="0" usemap="#geoip_8h_a0e8ee9964ff62e5009f1b49231e52d1f_icgraph" alt=""/></div>
<map name="geoip_8h_a0e8ee9964ff62e5009f1b49231e52d1f_icgraph" id="geoip_8h_a0e8ee9964ff62e5009f1b49231e52d1f_icgraph">
<area shape="rect" id="node2" href="geoip_8h.html#ad4ca20951b3b9a4a251e8ae83ba0ec2f" title="geoip_entry_stats_term" alt="" coords="215,5,373,32"/>
</map>
</div>

</div>
</div>
<a id="a642404b6a23907878bdbd5459ec356df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a642404b6a23907878bdbd5459ec356df">&#9670;&nbsp;</a></span>geoip_start_dirreq()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_start_dirreq </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>dirreq_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>response_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="or_8h.html#a118711f7f25509a02d10bba02f484333">dirreq_type_t</a>&#160;</td>
          <td class="paramname"><em>type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Note that an either direct or tunneled (see <b>type</b>) directory request for a v3 network status with unique ID <b>dirreq_id</b> of size <b>response_size</b> has started. </p>

</div>
</div>
<a id="a921840886e0a3d9ba57b014e6629cf1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a921840886e0a3d9ba57b014e6629cf1b">&#9670;&nbsp;</a></span>getinfo_helper_geoip()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int getinfo_helper_geoip </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structcontrol__connection__t.html">control_connection_t</a> *&#160;</td>
          <td class="paramname"><em>control_conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>question</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>answer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>errmsg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Helper used to implement GETINFO ip-to-country/... controller command. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8h_a921840886e0a3d9ba57b014e6629cf1b_cgraph.png" border="0" usemap="#geoip_8h_a921840886e0a3d9ba57b014e6629cf1b_cgraph" alt=""/></div>
<map name="geoip_8h_a921840886e0a3d9ba57b014e6629cf1b_cgraph" id="geoip_8h_a921840886e0a3d9ba57b014e6629cf1b_cgraph">
<area shape="rect" id="node2" href="util_8c.html#a245aaefd9d8715af06ce0f7b7355fd0d" title="strcmpstart" alt="" coords="241,5,329,32"/>
<area shape="rect" id="node3" href="compat_8c.html#ade97970c1d8a691241adac739c4f9b12" title="tor_asprintf" alt="" coords="241,56,328,83"/>
<area shape="rect" id="node5" href="address_8c.html#a3cd537bd8104a89a5996793ee3f1d0dc" title="tor_addr_parse" alt="" coords="231,107,339,133"/>
<area shape="rect" id="node6" href="geoip_8c.html#a8db18a0728871a50a20c43d1ebef6be0" title="geoip_get_country_by_ipv4" alt="" coords="195,157,375,184"/>
<area shape="rect" id="node4" href="compat_8c.html#a5ef7a08e8b543c0d61f9ef1081d4c1ea" title="tor_vasprintf" alt="" coords="438,56,533,83"/>
<area shape="rect" id="node7" href="container_8c.html#a6722b8c6ca501b524958b3cdac2bc70c" title="smartlist_bsearch" alt="" coords="423,157,548,184"/>
<area shape="rect" id="node8" href="container_8c.html#af0f195f396d7f97e7f2f2367453da119" title="smartlist_bsearch_idx" alt="" coords="596,157,745,184"/>
</map>
</div>

</div>
</div>
<a id="aecc961d6ac7cd75ec8593321d51d909a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aecc961d6ac7cd75ec8593321d51d909a">&#9670;&nbsp;</a></span>should_record_bridge_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int should_record_bridge_info </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if we should collect geoip stats on bridge users, and include them in our extrainfo descriptor. Else return 0. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8h_aecc961d6ac7cd75ec8593321d51d909a_icgraph.png" border="0" usemap="#geoip_8h_aecc961d6ac7cd75ec8593321d51d909a_icgraph" alt=""/></div>
<map name="geoip_8h_aecc961d6ac7cd75ec8593321d51d909a_icgraph" id="geoip_8h_aecc961d6ac7cd75ec8593321d51d909a_icgraph">
<area shape="rect" id="node2" href="config_8h.html#ad09b1993fdca508d228a7585813efcac" title="options_need_geoip_info" alt="" coords="227,5,392,32"/>
<area shape="rect" id="node4" href="geoip_8h.html#a89c00fefaf2f19a1097e93e3116cd30f" title="geoip_note_client_seen" alt="" coords="230,56,389,83"/>
<area shape="rect" id="node3" href="geoip_8h.html#a99613dd6eb7666bd2e5fe481f15ec301" title="geoip_load_file" alt="" coords="440,5,548,32"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
