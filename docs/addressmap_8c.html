<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tor: /home/user/_my/code/bwauth-related/tor/src/or/addressmap.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tor
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97b64286d42c5ef1697cb5f17129db19.html">tor</a></li><li class="navelem"><a class="el" href="dir_3cb0ba3f4b82dbe34a1a06276e96bc8d.html">src</a></li><li class="navelem"><a class="el" href="dir_386635fabd7f6c74e9d9c7a8604514a0.html">or</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">addressmap.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>The addressmap module manages the processes by which we rewrite addresses in client requess. It handles the MapAddress controller and torrc commands, and the TrackHostExits feature, and the client-side DNS cache (deprecated).  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="or_8h_source.html">or.h</a>&quot;</code><br />
<code>#include &quot;addressmap.h&quot;</code><br />
<code>#include &quot;<a class="el" href="circuituse_8h_source.html">circuituse.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="config_8h_source.html">config.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="connection__edge_8h_source.html">connection_edge.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="control_8h_source.html">control.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="crypto__rand_8h_source.html">crypto_rand.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="dns_8h_source.html">dns.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="nodelist_8h_source.html">nodelist.h</a>&quot;</code><br />
<code>#include &quot;routerset.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for addressmap.c:</div>
<div class="dyncontent">
<div class="center"><img src="addressmap_8c__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2addressmap_8c" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2addressmap_8c" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2addressmap_8c">
<area shape="rect" id="node2" href="or_8h.html" title="Master header file for Tor&#45;specific functionality. " alt="" coords="1091,109,1135,136"/>
<area shape="rect" id="node41" href="addressmap_8h_source.html" title="addressmap.h" alt="" coords="5,707,109,733"/>
<area shape="rect" id="node42" href="circuituse_8h.html" title="Header file for circuituse.c. " alt="" coords="182,109,271,136"/>
<area shape="rect" id="node43" href="config_8h.html" title="Header file for config.c. " alt="" coords="111,632,179,659"/>
<area shape="rect" id="node44" href="connection__edge_8h.html" title="Header file for connection_edge.c. " alt="" coords="285,707,416,733"/>
<area shape="rect" id="node45" href="control_8h.html" title="Header file for control.c. " alt="" coords="1160,109,1232,136"/>
<area shape="rect" id="node46" href="crypto__rand_8h.html" title="Common functions for using (pseudo&#45;)random number generators. " alt="" coords="2476,483,2577,509"/>
<area shape="rect" id="node47" href="dns_8h.html" title="Header file for dns.c. " alt="" coords="1917,109,1971,136"/>
<area shape="rect" id="node48" href="nodelist_8h.html" title="Header file for nodelist.c. " alt="" coords="1995,109,2074,136"/>
<area shape="rect" id="node49" href="routerset_8h_source.html" title="routerset.h" alt="" coords="2098,109,2182,136"/>
<area shape="rect" id="node3" href="orconfig_8h_source.html" title="orconfig.h" alt="" coords="1371,931,1450,957"/>
<area shape="rect" id="node4" href="torint_8h.html" title="Header file to define uint32_t and friends. " alt="" coords="2035,856,2098,883"/>
<area shape="rect" id="node6" href="crypto_8h.html" title="Headers for crypto.c. " alt="" coords="1364,259,1433,285"/>
<area shape="rect" id="node20" href="container_8h_source.html" title="container.h" alt="" coords="829,483,915,509"/>
<area shape="rect" id="node22" href="torlog_8h.html" title="Headers for log.c. " alt="" coords="745,557,810,584"/>
<area shape="rect" id="node23" href="crypto__format_8h_source.html" title="crypto_format.h" alt="" coords="1366,184,1479,211"/>
<area shape="rect" id="node24" href="crypto__ed25519_8h_source.html" title="crypto_ed25519.h" alt="" coords="1479,259,1604,285"/>
<area shape="rect" id="node25" href="crypto__curve25519_8h_source.html" title="crypto_curve25519.h" alt="" coords="1945,333,2087,360"/>
<area shape="rect" id="node28" href="tortls_8h.html" title="Headers for tortls.c. " alt="" coords="1149,259,1211,285"/>
<area shape="rect" id="node31" href="compress_8h.html" title="Headers for compress.c. " alt="" coords="2260,184,2351,211"/>
<area shape="rect" id="node32" href="address_8h.html" title="Headers for address.h. " alt="" coords="911,408,990,435"/>
<area shape="rect" id="node33" href="compat__libevent_8h_source.html" title="compat_libevent.h" alt="" coords="187,781,315,808"/>
<area shape="rect" id="node34" href="ht_8h_source.html" title="ht.h" alt="" coords="397,184,441,211"/>
<area shape="rect" id="node35" href="confline_8h_source.html" title="confline.h" alt="" coords="745,259,823,285"/>
<area shape="rect" id="node36" href="replaycache_8h.html" title="Header file for replaycache.c. " alt="" coords="567,184,670,211"/>
<area shape="rect" id="node37" href="tor__queue_8h_source.html" title="tor_queue.h" alt="" coords="695,184,785,211"/>
<area shape="rect" id="node38" href="token__bucket_8h_source.html" title="token_bucket.h" alt="" coords="1551,781,1662,808"/>
<area shape="rect" id="node39" href="util__format_8h_source.html" title="util_format.h" alt="" coords="1433,781,1527,808"/>
<area shape="rect" id="node40" href="hs__circuitmap_8h.html" title="Header file for hs_circuitmap.c. " alt="" coords="911,184,1025,211"/>
<area shape="rect" id="node8" href="compat_8h_source.html" title="compat.h" alt="" coords="1118,707,1194,733"/>
<area shape="rect" id="node14" href="util_8h.html" title="Headers for util.c. " alt="" coords="1563,557,1613,584"/>
<area shape="rect" id="node18" href="crypto__rsa_8h.html" title="Headers for crypto_rsa.c. " alt="" coords="1351,333,1446,360"/>
<area shape="rect" id="node9" href="testsupport_8h_source.html" title="testsupport.h" alt="" coords="632,856,731,883"/>
<area shape="rect" id="node11" href="compat__time_8h.html" title="Functions and types for monotonic times. " alt="" coords="1311,856,1419,883"/>
<area shape="rect" id="node13" href="compat__threads_8h_source.html" title="compat_threads.h" alt="" coords="947,781,1074,808"/>
<area shape="rect" id="node15" href="di__ops_8h.html" title="Headers for di_ops.c. " alt="" coords="1839,781,1910,808"/>
<area shape="rect" id="node17" href="util__bug_8h.html" title="Macros to manage assertions, fatal and non&#45;fatal. " alt="" coords="1194,632,1273,659"/>
<area shape="rect" id="node19" href="crypto__digest_8h.html" title="Headers for crypto_digest.c. " alt="" coords="1810,408,1921,435"/>
<area shape="rect" id="node21" href="siphash_8h_source.html" title="siphash.h" alt="" coords="834,557,913,584"/>
<area shape="rect" id="node26" href="crypto__openssl__mgt_8h_source.html" title="crypto_openssl_mgt.h" alt="" coords="1997,408,2147,435"/>
<area shape="rect" id="node29" href="compat__openssl_8h.html" title="compatibility definitions for working with different openssl forks " alt="" coords="1603,333,1731,360"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structaddressmap__entry__t.html">addressmap_entry_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structvirtaddress__entry__t.html">virtaddress_entry_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a3e45e4ac8282565ef81250543cfe18b4"><td class="memItemLeft" align="right" valign="top"><a id="a3e45e4ac8282565ef81250543cfe18b4"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ADDRESSMAP_PRIVATE</b></td></tr>
<tr class="separator:a3e45e4ac8282565ef81250543cfe18b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad59569a7150a704d258575a184314a60"><td class="memItemLeft" align="right" valign="top"><a id="ad59569a7150a704d258575a184314a60"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>addressmap_ent_free</b>(ent)&#160;&#160;&#160;FREE_AND_NULL(<a class="el" href="structaddressmap__entry__t.html">addressmap_entry_t</a>, addressmap_ent_free_, (ent))</td></tr>
<tr class="separator:ad59569a7150a704d258575a184314a60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7597015d8fa85cc6beb6a8f4c098061a"><td class="memItemLeft" align="right" valign="top"><a id="a7597015d8fa85cc6beb6a8f4c098061a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>addressmap_virtaddress_ent_free</b>(ent)&#160;&#160;&#160;FREE_AND_NULL(<a class="el" href="structvirtaddress__entry__t.html">virtaddress_entry_t</a>, addressmap_virtaddress_ent_free_, (ent))</td></tr>
<tr class="separator:a7597015d8fa85cc6beb6a8f4c098061a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a05df04cc259e096a86d7f96a19f2413c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#a05df04cc259e096a86d7f96a19f2413c">addressmap_init</a> (void)</td></tr>
<tr class="separator:a05df04cc259e096a86d7f96a19f2413c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a245d830576df16b7638e05e9ae2939b8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#a245d830576df16b7638e05e9ae2939b8">clear_trackexithost_mappings</a> (const char *exitname)</td></tr>
<tr class="separator:a245d830576df16b7638e05e9ae2939b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae683df8703468deb5dfa48a1e8b24aee"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#ae683df8703468deb5dfa48a1e8b24aee">addressmap_clear_excluded_trackexithosts</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:ae683df8703468deb5dfa48a1e8b24aee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8116fcd70f6e238aadd682e990997fe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#ab8116fcd70f6e238aadd682e990997fe">addressmap_address_should_automap</a> (const char *address, const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:ab8116fcd70f6e238aadd682e990997fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d3f3aa2fceee8d16bfe136afe6bec82"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#a5d3f3aa2fceee8d16bfe136afe6bec82">addressmap_clear_invalid_automaps</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:a5d3f3aa2fceee8d16bfe136afe6bec82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acbcc7bdbbcc4229319d5d9f7a7a0d93b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#acbcc7bdbbcc4229319d5d9f7a7a0d93b">addressmap_clear_configured</a> (void)</td></tr>
<tr class="separator:acbcc7bdbbcc4229319d5d9f7a7a0d93b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9e80dacf0762df08c1e97f8caa61d2c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#ad9e80dacf0762df08c1e97f8caa61d2c">addressmap_clear_transient</a> (void)</td></tr>
<tr class="separator:ad9e80dacf0762df08c1e97f8caa61d2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72c5cdc19a414853d92897aefdc95b66"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#a72c5cdc19a414853d92897aefdc95b66">addressmap_clean</a> (time_t now)</td></tr>
<tr class="separator:a72c5cdc19a414853d92897aefdc95b66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa81fb0e59437b509927835554cc08a91"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#aa81fb0e59437b509927835554cc08a91">addressmap_free_all</a> (void)</td></tr>
<tr class="separator:aa81fb0e59437b509927835554cc08a91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c921361cb65475ae09da40b1223d424"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#a9c921361cb65475ae09da40b1223d424">addressmap_rewrite</a> (char *address, size_t maxlen, unsigned flags, time_t *expires_out, <a class="el" href="or_8h.html#a0e9fdce0c31c7eeaae43aadf4ff6644b">addressmap_entry_source_t</a> *exit_source_out)</td></tr>
<tr class="separator:a9c921361cb65475ae09da40b1223d424"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb820c2da000dbdab619cb6c8f487169"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#afb820c2da000dbdab619cb6c8f487169">addressmap_rewrite_reverse</a> (char *address, size_t maxlen, unsigned flags, time_t *expires_out)</td></tr>
<tr class="separator:afb820c2da000dbdab619cb6c8f487169"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c605f99b2ad734f4f6ad7612ee64b11"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#a4c605f99b2ad734f4f6ad7612ee64b11">addressmap_have_mapping</a> (const char *address, int update_expiry)</td></tr>
<tr class="separator:a4c605f99b2ad734f4f6ad7612ee64b11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ee30e81c24db0f24bcbadf982b585bf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#a9ee30e81c24db0f24bcbadf982b585bf">addressmap_register</a> (const char *address, char *new_address, time_t expires, <a class="el" href="or_8h.html#a0e9fdce0c31c7eeaae43aadf4ff6644b">addressmap_entry_source_t</a> source, const int wildcard_addr, const int wildcard_new_addr)</td></tr>
<tr class="separator:a9ee30e81c24db0f24bcbadf982b585bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c73594a0e67f03e6b6b705d8a9ee699"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#a8c73594a0e67f03e6b6b705d8a9ee699">client_dns_incr_failures</a> (const char *address)</td></tr>
<tr class="separator:a8c73594a0e67f03e6b6b705d8a9ee699"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8b69158388861409bb8899edbbcb305"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#ab8b69158388861409bb8899edbbcb305">client_dns_clear_failures</a> (const char *address)</td></tr>
<tr class="separator:ab8b69158388861409bb8899edbbcb305"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a2f56df91a8c5f8f4513c8648bfc37f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#a9a2f56df91a8c5f8f4513c8648bfc37f">client_dns_set_addressmap</a> (<a class="el" href="structentry__connection__t.html">entry_connection_t</a> *for_conn, const char *address, const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *val, const char *exitname, int ttl)</td></tr>
<tr class="separator:a9a2f56df91a8c5f8f4513c8648bfc37f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1aec8b38f4126d096d6009696f9fc52b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#a1aec8b38f4126d096d6009696f9fc52b">client_dns_set_reverse_addressmap</a> (<a class="el" href="structentry__connection__t.html">entry_connection_t</a> *for_conn, const char *address, const char *v, const char *exitname, int ttl)</td></tr>
<tr class="separator:a1aec8b38f4126d096d6009696f9fc52b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3f8290e979fb522b6f51cc771958483"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#af3f8290e979fb522b6f51cc771958483">parse_virtual_addr_network</a> (const char *val, sa_family_t family, int validate_only, char **msg)</td></tr>
<tr class="separator:af3f8290e979fb522b6f51cc771958483"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34bcfa3ad7ee0372635c33ad4fc59598"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#a34bcfa3ad7ee0372635c33ad4fc59598">address_is_in_virtual_range</a> (const char *address)</td></tr>
<tr class="separator:a34bcfa3ad7ee0372635c33ad4fc59598"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ecb8ca5f270b548d958f3867cdf66e9"><td class="memItemLeft" align="right" valign="top">STATIC void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#a3ecb8ca5f270b548d958f3867cdf66e9">get_random_virtual_addr</a> (const virtual_addr_conf_t *conf, <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *addr_out)</td></tr>
<tr class="separator:a3ecb8ca5f270b548d958f3867cdf66e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5aaa31e318c50e3c7b95ef52a7e60c2"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#ac5aaa31e318c50e3c7b95ef52a7e60c2">addressmap_register_virtual_address</a> (int type, char *new_address)</td></tr>
<tr class="separator:ac5aaa31e318c50e3c7b95ef52a7e60c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4dcc44ad1e8bee4747d1f5b1e34c9f88"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#a4dcc44ad1e8bee4747d1f5b1e34c9f88">address_is_invalid_destination</a> (const char *address, int client)</td></tr>
<tr class="separator:a4dcc44ad1e8bee4747d1f5b1e34c9f88"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a578c622b1ec403e3029606d35a80b261"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="addressmap_8c.html#a578c622b1ec403e3029606d35a80b261">addressmap_get_mappings</a> (<a class="el" href="structsmartlist__t.html">smartlist_t</a> *sl, time_t min_expires, time_t max_expires, int want_expiry)</td></tr>
<tr class="separator:a578c622b1ec403e3029606d35a80b261"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The addressmap module manages the processes by which we rewrite addresses in client requess. It handles the MapAddress controller and torrc commands, and the TrackHostExits feature, and the client-side DNS cache (deprecated). </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a34bcfa3ad7ee0372635c33ad4fc59598"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34bcfa3ad7ee0372635c33ad4fc59598">&#9670;&nbsp;</a></span>address_is_in_virtual_range()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int address_is_in_virtual_range </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff <b>addr</b> is likely to have been returned by client_dns_get_unused_address. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="addressmap_8c_a34bcfa3ad7ee0372635c33ad4fc59598_cgraph.png" border="0" usemap="#addressmap_8c_a34bcfa3ad7ee0372635c33ad4fc59598_cgraph" alt=""/></div>
<map name="addressmap_8c_a34bcfa3ad7ee0372635c33ad4fc59598_cgraph" id="addressmap_8c_a34bcfa3ad7ee0372635c33ad4fc59598_cgraph">
<area shape="rect" id="node2" href="util_8c.html#a595e5e722adc3f46c2d27bced61a8a18" title="strcasecmpend" alt="" coords="197,5,308,32"/>
<area shape="rect" id="node3" href="address_8c.html#a3cd537bd8104a89a5996793ee3f1d0dc" title="tor_addr_parse" alt="" coords="199,56,307,83"/>
</map>
</div>

</div>
</div>
<a id="a4dcc44ad1e8bee4747d1f5b1e34c9f88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4dcc44ad1e8bee4747d1f5b1e34c9f88">&#9670;&nbsp;</a></span>address_is_invalid_destination()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int address_is_invalid_destination </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>client</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if <b>address</b> has funny characters in it like colons. Return 0 if it's fine, or if we're configured to allow it anyway. <b>client</b> should be true if we're using this address as a client; false if we're using it as a server. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="addressmap_8c_a4dcc44ad1e8bee4747d1f5b1e34c9f88_cgraph.png" border="0" usemap="#addressmap_8c_a4dcc44ad1e8bee4747d1f5b1e34c9f88_cgraph" alt=""/></div>
<map name="addressmap_8c_a4dcc44ad1e8bee4747d1f5b1e34c9f88_cgraph" id="addressmap_8c_a4dcc44ad1e8bee4747d1f5b1e34c9f88_cgraph">
<area shape="rect" id="node2" href="address_8c.html#a3cd537bd8104a89a5996793ee3f1d0dc" title="tor_addr_parse" alt="" coords="183,13,291,39"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="addressmap_8c_a4dcc44ad1e8bee4747d1f5b1e34c9f88_icgraph.png" border="0" usemap="#addressmap_8c_a4dcc44ad1e8bee4747d1f5b1e34c9f88_icgraph" alt=""/></div>
<map name="addressmap_8c_a4dcc44ad1e8bee4747d1f5b1e34c9f88_icgraph" id="addressmap_8c_a4dcc44ad1e8bee4747d1f5b1e34c9f88_icgraph">
<area shape="rect" id="node2" href="config_8h.html#ad0680dcf72ca4379b07f06e83f2c2a21" title="addressmap_register_auto" alt="" coords="183,13,357,39"/>
</map>
</div>

</div>
</div>
<a id="ab8116fcd70f6e238aadd682e990997fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8116fcd70f6e238aadd682e990997fe">&#9670;&nbsp;</a></span>addressmap_address_should_automap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int addressmap_address_should_automap </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff <b>address</b> is one that we are configured to automap on resolve according to <b>options</b>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="addressmap_8c_ab8116fcd70f6e238aadd682e990997fe_cgraph.png" border="0" usemap="#addressmap_8c_ab8116fcd70f6e238aadd682e990997fe_cgraph" alt=""/></div>
<map name="addressmap_8c_ab8116fcd70f6e238aadd682e990997fe_cgraph" id="addressmap_8c_ab8116fcd70f6e238aadd682e990997fe_cgraph">
<area shape="rect" id="node2" href="util_8c.html#a595e5e722adc3f46c2d27bced61a8a18" title="strcasecmpend" alt="" coords="200,13,311,39"/>
</map>
</div>

</div>
</div>
<a id="a72c5cdc19a414853d92897aefdc95b66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72c5cdc19a414853d92897aefdc95b66">&#9670;&nbsp;</a></span>addressmap_clean()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void addressmap_clean </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Clean out entries from the addressmap cache that were added long enough ago that they are no longer valid. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="addressmap_8c_a72c5cdc19a414853d92897aefdc95b66_cgraph.png" border="0" usemap="#addressmap_8c_a72c5cdc19a414853d92897aefdc95b66_cgraph" alt=""/></div>
<map name="addressmap_8c_a72c5cdc19a414853d92897aefdc95b66_cgraph" id="addressmap_8c_a72c5cdc19a414853d92897aefdc95b66_cgraph">
<area shape="rect" id="node2" href="addressmap_8c.html#a578c622b1ec403e3029606d35a80b261" title="addressmap_get_mappings" alt="" coords="184,5,365,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="addressmap_8c_a72c5cdc19a414853d92897aefdc95b66_icgraph.png" border="0" usemap="#addressmap_8c_a72c5cdc19a414853d92897aefdc95b66_icgraph" alt=""/></div>
<map name="addressmap_8c_a72c5cdc19a414853d92897aefdc95b66_icgraph" id="addressmap_8c_a72c5cdc19a414853d92897aefdc95b66_icgraph">
<area shape="rect" id="node2" href="circuituse_8h.html#a5474432e0dd7549eb766af37bebb37ed" title="circuit_expire_old\l_circs_as_needed" alt="" coords="184,5,311,47"/>
</map>
</div>

</div>
</div>
<a id="acbcc7bdbbcc4229319d5d9f7a7a0d93b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acbcc7bdbbcc4229319d5d9f7a7a0d93b">&#9670;&nbsp;</a></span>addressmap_clear_configured()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void addressmap_clear_configured </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove all entries from the addressmap that were set via the configuration file or the command line. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="addressmap_8c_acbcc7bdbbcc4229319d5d9f7a7a0d93b_cgraph.png" border="0" usemap="#addressmap_8c_acbcc7bdbbcc4229319d5d9f7a7a0d93b_cgraph" alt=""/></div>
<map name="addressmap_8c_acbcc7bdbbcc4229319d5d9f7a7a0d93b_cgraph" id="addressmap_8c_acbcc7bdbbcc4229319d5d9f7a7a0d93b_cgraph">
<area shape="rect" id="node2" href="addressmap_8c.html#a578c622b1ec403e3029606d35a80b261" title="addressmap_get_mappings" alt="" coords="248,5,429,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="addressmap_8c_acbcc7bdbbcc4229319d5d9f7a7a0d93b_icgraph.png" border="0" usemap="#addressmap_8c_acbcc7bdbbcc4229319d5d9f7a7a0d93b_icgraph" alt=""/></div>
<map name="addressmap_8c_acbcc7bdbbcc4229319d5d9f7a7a0d93b_icgraph" id="addressmap_8c_acbcc7bdbbcc4229319d5d9f7a7a0d93b_icgraph">
<area shape="rect" id="node2" href="config_8h.html#ad5b1441c46e173be812f5739141e1a4b" title="config_register_addressmaps" alt="" coords="248,5,440,32"/>
</map>
</div>

</div>
</div>
<a id="ae683df8703468deb5dfa48a1e8b24aee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae683df8703468deb5dfa48a1e8b24aee">&#9670;&nbsp;</a></span>addressmap_clear_excluded_trackexithosts()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void addressmap_clear_excluded_trackexithosts </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove all TRACKEXIT mappings from the addressmap for which the target host is unknown or no longer allowed, or for which the source address is no longer in trackexithosts. </p>

</div>
</div>
<a id="a5d3f3aa2fceee8d16bfe136afe6bec82"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d3f3aa2fceee8d16bfe136afe6bec82">&#9670;&nbsp;</a></span>addressmap_clear_invalid_automaps()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void addressmap_clear_invalid_automaps </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove all AUTOMAP mappings from the addressmap for which the source address no longer matches AutomapHostsSuffixes, which is no longer allowed by AutomapHostsOnResolve, or for which the target address is no longer in the virtual network. </p>

</div>
</div>
<a id="ad9e80dacf0762df08c1e97f8caa61d2c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad9e80dacf0762df08c1e97f8caa61d2c">&#9670;&nbsp;</a></span>addressmap_clear_transient()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void addressmap_clear_transient </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove all entries from the addressmap that are set to expire, ever. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="addressmap_8c_ad9e80dacf0762df08c1e97f8caa61d2c_cgraph.png" border="0" usemap="#addressmap_8c_ad9e80dacf0762df08c1e97f8caa61d2c_cgraph" alt=""/></div>
<map name="addressmap_8c_ad9e80dacf0762df08c1e97f8caa61d2c_cgraph" id="addressmap_8c_ad9e80dacf0762df08c1e97f8caa61d2c_cgraph">
<area shape="rect" id="node2" href="addressmap_8c.html#a578c622b1ec403e3029606d35a80b261" title="addressmap_get_mappings" alt="" coords="239,5,420,32"/>
</map>
</div>

</div>
</div>
<a id="aa81fb0e59437b509927835554cc08a91"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa81fb0e59437b509927835554cc08a91">&#9670;&nbsp;</a></span>addressmap_free_all()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void addressmap_free_all </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Free all the elements in the addressmap, and free the addressmap itself. </p>

</div>
</div>
<a id="a578c622b1ec403e3029606d35a80b261"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a578c622b1ec403e3029606d35a80b261">&#9670;&nbsp;</a></span>addressmap_get_mappings()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void addressmap_get_mappings </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>sl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>min_expires</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>max_expires</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>want_expiry</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Iterate over all address mappings which have expiry times between min_expires and max_expires, inclusive. If sl is provided, add an "old-addr new-addr expiry" string to sl for each mapping, omitting the expiry time if want_expiry is false. If sl is NULL, remove the mappings. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="addressmap_8c_a578c622b1ec403e3029606d35a80b261_icgraph.png" border="0" usemap="#addressmap_8c_a578c622b1ec403e3029606d35a80b261_icgraph" alt=""/></div>
<map name="addressmap_8c_a578c622b1ec403e3029606d35a80b261_icgraph" id="addressmap_8c_a578c622b1ec403e3029606d35a80b261_icgraph">
<area shape="rect" id="node2" href="addressmap_8c.html#acbcc7bdbbcc4229319d5d9f7a7a0d93b" title="addressmap_clear_configured" alt="" coords="235,5,429,32"/>
<area shape="rect" id="node4" href="addressmap_8c.html#ad9e80dacf0762df08c1e97f8caa61d2c" title="addressmap_clear_transient" alt="" coords="239,56,425,83"/>
<area shape="rect" id="node5" href="addressmap_8c.html#a72c5cdc19a414853d92897aefdc95b66" title="addressmap_clean" alt="" coords="267,107,397,133"/>
<area shape="rect" id="node3" href="config_8h.html#ad5b1441c46e173be812f5739141e1a4b" title="config_register_addressmaps" alt="" coords="477,5,669,32"/>
<area shape="rect" id="node6" href="circuituse_8h.html#a5474432e0dd7549eb766af37bebb37ed" title="circuit_expire_old\l_circs_as_needed" alt="" coords="510,99,637,141"/>
</map>
</div>

</div>
</div>
<a id="a4c605f99b2ad734f4f6ad7612ee64b11"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c605f99b2ad734f4f6ad7612ee64b11">&#9670;&nbsp;</a></span>addressmap_have_mapping()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int addressmap_have_mapping </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>update_expiry</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if <b>address</b> is already registered, else return 0. If address is already registered, and <b>update_expires</b> is non-zero, then update the expiry time on the mapping with update_expires if it is a mapping created by TrackHostExits. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="addressmap_8c_a4c605f99b2ad734f4f6ad7612ee64b11_cgraph.png" border="0" usemap="#addressmap_8c_a4c605f99b2ad734f4f6ad7612ee64b11_cgraph" alt=""/></div>
<map name="addressmap_8c_a4c605f99b2ad734f4f6ad7612ee64b11_cgraph" id="addressmap_8c_a4c605f99b2ad734f4f6ad7612ee64b11_cgraph">
<area shape="rect" id="node2" href="container_8c.html#a1406b823cb6088df755f1b81153d137e" title="strmap_get_lc" alt="" coords="237,5,341,32"/>
</map>
</div>

</div>
</div>
<a id="a05df04cc259e096a86d7f96a19f2413c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a05df04cc259e096a86d7f96a19f2413c">&#9670;&nbsp;</a></span>addressmap_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void addressmap_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize addressmap. </p>

</div>
</div>
<a id="a9ee30e81c24db0f24bcbadf982b585bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ee30e81c24db0f24bcbadf982b585bf">&#9670;&nbsp;</a></span>addressmap_register()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void addressmap_register </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>new_address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>expires</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="or_8h.html#a0e9fdce0c31c7eeaae43aadf4ff6644b">addressmap_entry_source_t</a>&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>wildcard_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>wildcard_new_addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Register a request to map <b>address</b> to <b>new_address</b>, which will expire on <b>expires</b> (or 0 if never expires from config file, 1 if never expires from controller, 2 if never expires (virtual address mapping) from the controller.)</p>
<p><b>new_address</b> should be a newly dup'ed string, which we'll use or free as appropriate. We will leave <b>address</b> alone.</p>
<p>If <b>wildcard_addr</b> is true, then the mapping will match any address equal to <b>address</b>, or any address ending with a period followed by <b>address</b>. If <b>wildcard_addr</b> and <b>wildcard_new_addr</b> are both true, the mapping will rewrite addresses that end with ".&lt;b&gt;address&lt;/b&gt;" into ones that end with ".&lt;b&gt;new_address&lt;/b&gt;".</p>
<p>If <b>new_address</b> is NULL, or <b>new_address</b> is equal to <b>address</b> and <b>wildcard_addr</b> is equal to <b>wildcard_new_addr</b>, remove any mappings that exist from <b>address</b>.</p>
<p>It is an error to set <b>wildcard_new_addr</b> if <b>wildcard_addr</b> is not set. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="addressmap_8c_a9ee30e81c24db0f24bcbadf982b585bf_icgraph.png" border="0" usemap="#addressmap_8c_a9ee30e81c24db0f24bcbadf982b585bf_icgraph" alt=""/></div>
<map name="addressmap_8c_a9ee30e81c24db0f24bcbadf982b585bf_icgraph" id="addressmap_8c_a9ee30e81c24db0f24bcbadf982b585bf_icgraph">
<area shape="rect" id="node2" href="config_8h.html#ad0680dcf72ca4379b07f06e83f2c2a21" title="addressmap_register_auto" alt="" coords="196,5,371,32"/>
</map>
</div>

</div>
</div>
<a id="ac5aaa31e318c50e3c7b95ef52a7e60c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac5aaa31e318c50e3c7b95ef52a7e60c2">&#9670;&nbsp;</a></span>addressmap_register_virtual_address()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* addressmap_register_virtual_address </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>new_address</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A controller has requested that we map some address of type <b>type</b> to the address <b>new_address</b>. Choose an address that is unlikely to be used, and map it, and return it in a newly allocated string. If another address of the same type is already mapped to <b>new_address</b>, try to return a copy of that address.</p>
<p>The string in <b>new_address</b> may be freed or inserted into a map as appropriate. May return NULL if are out of virtual addresses. </p>

</div>
</div>
<a id="a9c921361cb65475ae09da40b1223d424"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c921361cb65475ae09da40b1223d424">&#9670;&nbsp;</a></span>addressmap_rewrite()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int addressmap_rewrite </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>maxlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t *&#160;</td>
          <td class="paramname"><em>expires_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="or_8h.html#a0e9fdce0c31c7eeaae43aadf4ff6644b">addressmap_entry_source_t</a> *&#160;</td>
          <td class="paramname"><em>exit_source_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Look at address, and rewrite it until it doesn't want any more rewrites; but don't get into an infinite loop. Don't write more than maxlen chars into address. Return true if the address changed; false otherwise. Set *<b>expires_out</b> to the expiry time of the result, or to <b>time_max</b> if the result does not expire.</p>
<p>If <b>exit_source_out</b> is non-null, we set it as follows. If we the address starts out as a non-exit address, and we remap it to an .exit address at any point, then set *<b>exit_source_out</b> to the address_entry_source_t of the first such rule. Set *<b>exit_source_out</b> to ADDRMAPSRC_NONE if there is no such rewrite, or if the original address was a .exit. </p>

</div>
</div>
<a id="afb820c2da000dbdab619cb6c8f487169"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb820c2da000dbdab619cb6c8f487169">&#9670;&nbsp;</a></span>addressmap_rewrite_reverse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int addressmap_rewrite_reverse </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>maxlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t *&#160;</td>
          <td class="paramname"><em>expires_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If we have a cached reverse DNS entry for the address stored in the <b>maxlen</b>-byte buffer <b>address</b> (typically, a dotted quad) then rewrite to the cached value and return 1. Otherwise return 0. Set *<b>expires_out</b> to the expiry time of the result, or to <b>time_max</b> if the result does not expire. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="addressmap_8c_afb820c2da000dbdab619cb6c8f487169_cgraph.png" border="0" usemap="#addressmap_8c_afb820c2da000dbdab619cb6c8f487169_cgraph" alt=""/></div>
<map name="addressmap_8c_afb820c2da000dbdab619cb6c8f487169_cgraph" id="addressmap_8c_afb820c2da000dbdab619cb6c8f487169_cgraph">
<area shape="rect" id="node2" href="address_8c.html#a3cd537bd8104a89a5996793ee3f1d0dc" title="tor_addr_parse" alt="" coords="192,5,300,32"/>
<area shape="rect" id="node3" href="compat_8c.html#ade97970c1d8a691241adac739c4f9b12" title="tor_asprintf" alt="" coords="203,56,289,83"/>
<area shape="rect" id="node4" href="compat_8c.html#a5ef7a08e8b543c0d61f9ef1081d4c1ea" title="tor_vasprintf" alt="" coords="348,56,443,83"/>
</map>
</div>

</div>
</div>
<a id="a245d830576df16b7638e05e9ae2939b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a245d830576df16b7638e05e9ae2939b8">&#9670;&nbsp;</a></span>clear_trackexithost_mappings()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void clear_trackexithost_mappings </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>exitname</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unregister all TrackHostExits mappings from any address to *.exitname.exit. </p>

</div>
</div>
<a id="ab8b69158388861409bb8899edbbcb305"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8b69158388861409bb8899edbbcb305">&#9670;&nbsp;</a></span>client_dns_clear_failures()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void client_dns_clear_failures </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If <b>address</b> is in the client DNS addressmap, reset the number of resolve failures we have on record for it. This is used when we fail a stream because it won't resolve: otherwise future attempts on that address will only try once. </p>

</div>
</div>
<a id="a8c73594a0e67f03e6b6b705d8a9ee699"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c73594a0e67f03e6b6b705d8a9ee699">&#9670;&nbsp;</a></span>client_dns_incr_failures()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int client_dns_incr_failures </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>An attempt to resolve <b>address</b> failed at some OR. Increment the number of resolve failures we have on record for it, and then return that number. </p>

</div>
</div>
<a id="a9a2f56df91a8c5f8f4513c8648bfc37f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a2f56df91a8c5f8f4513c8648bfc37f">&#9670;&nbsp;</a></span>client_dns_set_addressmap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void client_dns_set_addressmap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structentry__connection__t.html">entry_connection_t</a> *&#160;</td>
          <td class="paramname"><em>for_conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *&#160;</td>
          <td class="paramname"><em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>exitname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ttl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Record the fact that <b>address</b> resolved to <b>val</b>. We can now use this in subsequent streams via <a class="el" href="addressmap_8c.html#a9c921361cb65475ae09da40b1223d424">addressmap_rewrite()</a> so we can more correctly choose an exit that will allow <b>address</b>.</p>
<p>If <b>exitname</b> is defined, then append the addresses with ".exitname.exit" before registering the mapping.</p>
<p>If <b>ttl</b> is nonnegative, the mapping will be valid for <b>ttl</b>seconds; otherwise, we use the default. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="addressmap_8c_a9a2f56df91a8c5f8f4513c8648bfc37f_cgraph.png" border="0" usemap="#addressmap_8c_a9a2f56df91a8c5f8f4513c8648bfc37f_cgraph" alt=""/></div>
<map name="addressmap_8c_a9a2f56df91a8c5f8f4513c8648bfc37f_cgraph" id="addressmap_8c_a9a2f56df91a8c5f8f4513c8648bfc37f_cgraph">
<area shape="rect" id="node2" href="address_8c.html#a3cd537bd8104a89a5996793ee3f1d0dc" title="tor_addr_parse" alt="" coords="237,5,345,32"/>
</map>
</div>

</div>
</div>
<a id="a1aec8b38f4126d096d6009696f9fc52b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1aec8b38f4126d096d6009696f9fc52b">&#9670;&nbsp;</a></span>client_dns_set_reverse_addressmap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void client_dns_set_reverse_addressmap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structentry__connection__t.html">entry_connection_t</a> *&#160;</td>
          <td class="paramname"><em>for_conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>exitname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ttl</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add a cache entry noting that <b>address</b> (ordinarily a dotted quad) resolved via a RESOLVE_PTR request to the hostname <b>v</b>.</p>
<p>If <b>exitname</b> is defined, then append the addresses with ".exitname.exit" before registering the mapping.</p>
<p>If <b>ttl</b> is nonnegative, the mapping will be valid for <b>ttl</b>seconds; otherwise, we use the default. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="addressmap_8c_a1aec8b38f4126d096d6009696f9fc52b_cgraph.png" border="0" usemap="#addressmap_8c_a1aec8b38f4126d096d6009696f9fc52b_cgraph" alt=""/></div>
<map name="addressmap_8c_a1aec8b38f4126d096d6009696f9fc52b_cgraph" id="addressmap_8c_a1aec8b38f4126d096d6009696f9fc52b_cgraph">
<area shape="rect" id="node2" href="address_8c.html#a3cd537bd8104a89a5996793ee3f1d0dc" title="tor_addr_parse" alt="" coords="209,5,317,32"/>
<area shape="rect" id="node3" href="compat_8c.html#ade97970c1d8a691241adac739c4f9b12" title="tor_asprintf" alt="" coords="220,56,307,83"/>
<area shape="rect" id="node4" href="compat_8c.html#a5ef7a08e8b543c0d61f9ef1081d4c1ea" title="tor_vasprintf" alt="" coords="365,56,460,83"/>
</map>
</div>

</div>
</div>
<a id="a3ecb8ca5f270b548d958f3867cdf66e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ecb8ca5f270b548d958f3867cdf66e9">&#9670;&nbsp;</a></span>get_random_virtual_addr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC void get_random_virtual_addr </td>
          <td>(</td>
          <td class="paramtype">const virtual_addr_conf_t *&#160;</td>
          <td class="paramname"><em>conf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structtor__addr__t.html">tor_addr_t</a> *&#160;</td>
          <td class="paramname"><em>addr_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a random address conforming to the virtual address configuration in <b>conf</b>. </p>

</div>
</div>
<a id="af3f8290e979fb522b6f51cc771958483"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af3f8290e979fb522b6f51cc771958483">&#9670;&nbsp;</a></span>parse_virtual_addr_network()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int parse_virtual_addr_network </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">sa_family_t&#160;</td>
          <td class="paramname"><em>family</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>validate_only</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read a netmask of the form 127.192.0.0/10 from "val", and check whether it's a valid set of virtual addresses to hand out in response to MAPADDRESS requests. Return 0 on success; set *msg (if provided) to a newly allocated string and return -1 on failure. If validate_only is false, sets the actual virtual address range to the parsed value. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
