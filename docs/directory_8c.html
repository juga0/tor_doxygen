<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tor: /home/user/_my/code/bwauth-related/tor/src/or/directory.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tor
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97b64286d42c5ef1697cb5f17129db19.html">tor</a></li><li class="navelem"><a class="el" href="dir_3cb0ba3f4b82dbe34a1a06276e96bc8d.html">src</a></li><li class="navelem"><a class="el" href="dir_386635fabd7f6c74e9d9c7a8604514a0.html">or</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">directory.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Code to send and fetch directories and router descriptors via HTTP. Directories use <a class="el" href="dirserv_8c.html" title="Directory server core implementation. Manages directory contents and generates directories. ">dirserv.c</a> to generate the results; clients use routers.c to parse them.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="or_8h_source.html">or.h</a>&quot;</code><br />
<code>#include &quot;backtrace.h&quot;</code><br />
<code>#include &quot;<a class="el" href="buffers_8h_source.html">buffers.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="circuitbuild_8h_source.html">circuitbuild.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="config_8h_source.html">config.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="connection_8h_source.html">connection.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="connection__edge_8h_source.html">connection_edge.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="control_8h_source.html">control.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="directory_8h_source.html">directory.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="dirserv_8h_source.html">dirserv.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="dirvote_8h_source.html">dirvote.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="entrynodes_8h_source.html">entrynodes.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="geoip_8h_source.html">geoip.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="main_8h_source.html">main.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="microdesc_8h_source.html">microdesc.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="networkstatus_8h_source.html">networkstatus.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="nodelist_8h_source.html">nodelist.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="policies_8h_source.html">policies.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="relay_8h_source.html">relay.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rendclient_8h_source.html">rendclient.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rendcommon_8h_source.html">rendcommon.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rendservice_8h_source.html">rendservice.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rephist_8h_source.html">rephist.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="router_8h_source.html">router.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="routerlist_8h_source.html">routerlist.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="routerparse_8h_source.html">routerparse.h</a>&quot;</code><br />
<code>#include &quot;routerset.h&quot;</code><br />
<code>#include &quot;shared_random.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for directory.c:</div>
<div class="dyncontent">
<div class="center"><img src="directory_8c__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2directory_8c" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2directory_8c" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2directory_8c">
<area shape="rect" id="node2" href="or_8h.html" title="Master header file for Tor&#45;specific functionality. " alt="" coords="708,259,752,285"/>
<area shape="rect" id="node22" href="backtrace_8h_source.html" title="backtrace.h" alt="" coords="1660,557,1751,584"/>
<area shape="rect" id="node23" href="buffers_8h.html" title="Header file for buffers.c. " alt="" coords="1158,184,1232,211"/>
<area shape="rect" id="node24" href="circuitbuild_8h.html" title="Header file for circuitbuild.c. " alt="" coords="1942,109,2037,136"/>
<area shape="rect" id="node25" href="config_8h.html" title="Header file for config.c. " alt="" coords="1314,259,1382,285"/>
<area shape="rect" id="node26" href="connection_8h.html" title="Header file for connection.c. " alt="" coords="1152,109,1248,136"/>
<area shape="rect" id="node27" href="connection__edge_8h.html" title="Header file for connection_edge.c. " alt="" coords="1307,184,1438,211"/>
<area shape="rect" id="node28" href="control_8h.html" title="Header file for control.c. " alt="" coords="2062,109,2134,136"/>
<area shape="rect" id="node29" href="directory_8h.html" title="Header file for directory.c. " alt="" coords="2158,109,2240,136"/>
<area shape="rect" id="node30" href="dirserv_8h.html" title="Header file for dirserv.c. " alt="" coords="1458,259,1530,285"/>
<area shape="rect" id="node31" href="dirvote_8h.html" title="Header file for dirvote.c. " alt="" coords="1512,184,1584,211"/>
<area shape="rect" id="node32" href="entrynodes_8h.html" title="Header file for circuitbuild.c. " alt="" coords="2265,109,2362,136"/>
<area shape="rect" id="node33" href="geoip_8h.html" title="Header file for geoip.c. " alt="" coords="1651,109,1715,136"/>
<area shape="rect" id="node35" href="main_8h.html" title="Header file for main.c. " alt="" coords="2387,109,2448,136"/>
<area shape="rect" id="node36" href="microdesc_8h.html" title="Header file for microdesc.c. " alt="" coords="2472,109,2566,136"/>
<area shape="rect" id="node37" href="networkstatus_8h.html" title="Header file for networkstatus.c. " alt="" coords="1655,259,1770,285"/>
<area shape="rect" id="node38" href="nodelist_8h.html" title="Header file for nodelist.c. " alt="" coords="2590,109,2669,136"/>
<area shape="rect" id="node39" href="policies_8h.html" title="Header file for policies.c. " alt="" coords="2694,109,2771,136"/>
<area shape="rect" id="node40" href="relay_8h.html" title="Header file for relay.c. " alt="" coords="2795,109,2856,136"/>
<area shape="rect" id="node41" href="rendclient_8h.html" title="Header file for rendclient.c. " alt="" coords="988,109,1077,136"/>
<area shape="rect" id="node43" href="rendcommon_8h.html" title="Header file for rendcommon.c. " alt="" coords="1018,259,1126,285"/>
<area shape="rect" id="node44" href="rendservice_8h.html" title="Header file for rendservice.c. " alt="" coords="662,184,762,211"/>
<area shape="rect" id="node45" href="rephist_8h.html" title="Header file for rephist.c. " alt="" coords="2880,109,2952,136"/>
<area shape="rect" id="node46" href="router_8h.html" title="Header file for router.c. " alt="" coords="1735,408,1802,435"/>
<area shape="rect" id="node47" href="routerlist_8h.html" title="Header file for routerlist.c. " alt="" coords="1840,184,1923,211"/>
<area shape="rect" id="node48" href="routerparse_8h.html" title="Header file for routerparse.c. " alt="" coords="2976,109,3075,136"/>
<area shape="rect" id="node49" href="routerset_8h_source.html" title="routerset.h" alt="" coords="3100,109,3184,136"/>
<area shape="rect" id="node50" href="shared__random_8h_source.html" title="shared_random.h" alt="" coords="787,184,910,211"/>
<area shape="rect" id="node3" href="orconfig_8h_source.html" title="orconfig.h" alt="" coords="358,632,437,659"/>
<area shape="rect" id="node4" href="torint_8h.html" title="Header file to define uint32_t and friends. " alt="" coords="366,557,429,584"/>
<area shape="rect" id="node5" href="crypto_8h.html" title="Headers for crypto.c. " alt="" coords="67,408,136,435"/>
<area shape="rect" id="node9" href="crypto__format_8h_source.html" title="crypto_format.h" alt="" coords="1021,333,1134,360"/>
<area shape="rect" id="node10" href="crypto__ed25519_8h_source.html" title="crypto_ed25519.h" alt="" coords="1015,408,1140,435"/>
<area shape="rect" id="node11" href="crypto__curve25519_8h_source.html" title="crypto_curve25519.h" alt="" coords="898,483,1041,509"/>
<area shape="rect" id="node12" href="tortls_8h.html" title="Headers for tortls.c. " alt="" coords="142,333,205,360"/>
<area shape="rect" id="node13" href="torlog_8h.html" title="Headers for log.c. " alt="" coords="436,408,501,435"/>
<area shape="rect" id="node14" href="container_8h_source.html" title="container.h" alt="" coords="364,483,450,509"/>
<area shape="rect" id="node15" href="torgzip_8h.html" title="Headers for torgzip.h. " alt="" coords="614,333,686,360"/>
<area shape="rect" id="node16" href="address_8h.html" title="Headers for address.h. " alt="" coords="281,408,360,435"/>
<area shape="rect" id="node17" href="compat__libevent_8h_source.html" title="compat_libevent.h" alt="" coords="1066,483,1194,509"/>
<area shape="rect" id="node18" href="ht_8h_source.html" title="ht.h" alt="" coords="710,333,754,360"/>
<area shape="rect" id="node19" href="replaycache_8h.html" title="Header file for replaycache.c. " alt="" coords="778,333,881,360"/>
<area shape="rect" id="node20" href="tor__queue_8h_source.html" title="tor_queue.h" alt="" coords="906,333,996,360"/>
<area shape="rect" id="node21" href="util__format_8h_source.html" title="util_format.h" alt="" coords="780,483,874,509"/>
<area shape="rect" id="node7" href="testsupport_8h_source.html" title="testsupport.h" alt="" coords="1258,557,1356,584"/>
<area shape="rect" id="node8" href="compat_8h_source.html" title="compat.h" alt="" coords="110,483,186,509"/>
<area shape="rect" id="node34" href="dos_8h_source.html" title="dos.h" alt="" coords="1660,184,1714,211"/>
<area shape="rect" id="node42" href="rendcache_8h.html" title="Header file for rendcache.c. " alt="" coords="984,184,1078,211"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structget__handler__args__t.html">get_handler_args_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structurl__table__ent__s.html">url_table_ent_s</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a23c309e66997f959d52791af058b27d8"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#a23c309e66997f959d52791af058b27d8">ALLOW_DIRECTORY_TIME_SKEW</a>&#160;&#160;&#160;(30*60)</td></tr>
<tr class="separator:a23c309e66997f959d52791af058b27d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17971f446d7885cc2d88c7a834ac616d"><td class="memItemLeft" align="right" valign="top"><a id="a17971f446d7885cc2d88c7a834ac616d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>X_ADDRESS_HEADER</b>&#160;&#160;&#160;&quot;X-Your-Address-Is: &quot;</td></tr>
<tr class="separator:a17971f446d7885cc2d88c7a834ac616d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeae5dbd4c3ad12f7bc3ac494ea30ac3b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#aeae5dbd4c3ad12f7bc3ac494ea30ac3b">FULL_DIR_CACHE_LIFETIME</a>&#160;&#160;&#160;(60*60)</td></tr>
<tr class="separator:aeae5dbd4c3ad12f7bc3ac494ea30ac3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b3229cc1fd7e16dae40d649d70de7e0"><td class="memItemLeft" align="right" valign="top"><a id="a2b3229cc1fd7e16dae40d649d70de7e0"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>RUNNINGROUTERS_CACHE_LIFETIME</b>&#160;&#160;&#160;(20*60)</td></tr>
<tr class="separator:a2b3229cc1fd7e16dae40d649d70de7e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a626a8cbb47641633c597e043f030f4d9"><td class="memItemLeft" align="right" valign="top"><a id="a626a8cbb47641633c597e043f030f4d9"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DIRPORTFRONTPAGE_CACHE_LIFETIME</b>&#160;&#160;&#160;(20*60)</td></tr>
<tr class="separator:a626a8cbb47641633c597e043f030f4d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a238608e7fa84b3e282c30f074a949134"><td class="memItemLeft" align="right" valign="top"><a id="a238608e7fa84b3e282c30f074a949134"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>NETWORKSTATUS_CACHE_LIFETIME</b>&#160;&#160;&#160;(5*60)</td></tr>
<tr class="separator:a238608e7fa84b3e282c30f074a949134"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad533b42097da3f4718c790d47610477d"><td class="memItemLeft" align="right" valign="top"><a id="ad533b42097da3f4718c790d47610477d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ROUTERDESC_CACHE_LIFETIME</b>&#160;&#160;&#160;(30*60)</td></tr>
<tr class="separator:ad533b42097da3f4718c790d47610477d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f17cbc728dcb65279a82be83ea5d374"><td class="memItemLeft" align="right" valign="top"><a id="a3f17cbc728dcb65279a82be83ea5d374"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ROUTERDESC_BY_DIGEST_CACHE_LIFETIME</b>&#160;&#160;&#160;(48*60*60)</td></tr>
<tr class="separator:a3f17cbc728dcb65279a82be83ea5d374"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0a5e213edecd9fd27add7465a8d71d4"><td class="memItemLeft" align="right" valign="top"><a id="ab0a5e213edecd9fd27add7465a8d71d4"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ROBOTS_CACHE_LIFETIME</b>&#160;&#160;&#160;(24*60*60)</td></tr>
<tr class="separator:ab0a5e213edecd9fd27add7465a8d71d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d3d4e25cc96cd2aebc573cffe52cff6"><td class="memItemLeft" align="right" valign="top"><a id="a4d3d4e25cc96cd2aebc573cffe52cff6"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MICRODESC_CACHE_LIFETIME</b>&#160;&#160;&#160;(48*60*60)</td></tr>
<tr class="separator:a4d3d4e25cc96cd2aebc573cffe52cff6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38d5af5c3f5952be8b5ffe073026ae69"><td class="memItemLeft" align="right" valign="top"><a id="a38d5af5c3f5952be8b5ffe073026ae69"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DEFAULT_IF_MODIFIED_SINCE_DELAY</b>&#160;&#160;&#160;(180)</td></tr>
<tr class="separator:a38d5af5c3f5952be8b5ffe073026ae69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6369cfb669b2e78c124b461bda147f45"><td class="memItemLeft" align="right" valign="top"><a id="a6369cfb669b2e78c124b461bda147f45"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CONDITIONAL_CONSENSUS_FPR_LEN</b>&#160;&#160;&#160;3</td></tr>
<tr class="separator:a6369cfb669b2e78c124b461bda147f45"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a698bec7a6cd6eccf990a74309fa20453"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>SEND_HS_DESC_FAILED_EVENT</b>(reason)</td></tr>
<tr class="separator:a698bec7a6cd6eccf990a74309fa20453"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae94cefe68ab1ccb9a884f52955582b9a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>SEND_HS_DESC_FAILED_CONTENT</b>()</td></tr>
<tr class="separator:ae94cefe68ab1ccb9a884f52955582b9a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44f58716bb3b4c1365a6047c9e0e2b6d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>SEND_HS_DESC_UPLOAD_FAILED_EVENT</b>(reason)</td></tr>
<tr class="separator:a44f58716bb3b4c1365a6047c9e0e2b6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af12592e94d1a765dfbc59cef089ce947"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#af12592e94d1a765dfbc59cef089ce947">MAX_DIRECTORY_OBJECT_SIZE</a>&#160;&#160;&#160;(10*(1&lt;&lt;20))</td></tr>
<tr class="separator:af12592e94d1a765dfbc59cef089ce947"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b0a64b0ec601d74e61dc9fc7c8e4103"><td class="memItemLeft" align="right" valign="top"><a id="a7b0a64b0ec601d74e61dc9fc7c8e4103"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MAX_VOTE_DL_SIZE</b>&#160;&#160;&#160;(<a class="el" href="directory_8c.html#af12592e94d1a765dfbc59cef089ce947">MAX_DIRECTORY_OBJECT_SIZE</a> * 5)</td></tr>
<tr class="separator:a7b0a64b0ec601d74e61dc9fc7c8e4103"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af661bdb611b057b4638f87289f4068a3"><td class="memItemLeft" align="right" valign="top"><a id="af661bdb611b057b4638f87289f4068a3"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CONSENSUS_URL_PREFIX</b>&#160;&#160;&#160;&quot;/tor/status-vote/current/consensus/&quot;</td></tr>
<tr class="separator:af661bdb611b057b4638f87289f4068a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a279ba706f3d3038f787e8e8aad007554"><td class="memItemLeft" align="right" valign="top"><a id="a279ba706f3d3038f787e8e8aad007554"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CONSENSUS_FLAVORED_PREFIX</b>&#160;&#160;&#160;&quot;/tor/status-vote/current/consensus-&quot;</td></tr>
<tr class="separator:a279ba706f3d3038f787e8e8aad007554"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ad24e8866486cbc6cb9e986c747d5f0b4"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structget__handler__args__t.html">get_handler_args_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#ad24e8866486cbc6cb9e986c747d5f0b4">get_handler_args_t</a></td></tr>
<tr class="separator:ad24e8866486cbc6cb9e986c747d5f0b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a696a8ba1f088d30327bf3f2ded94a66e"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structurl__table__ent__s.html">url_table_ent_s</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#a696a8ba1f088d30327bf3f2ded94a66e">url_table_ent_t</a></td></tr>
<tr class="separator:a696a8ba1f088d30327bf3f2ded94a66e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a9295a0181da0aabb17bd451f4b24f9bb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#a9295a0181da0aabb17bd451f4b24f9bb">purpose_needs_anonymity</a> (uint8_t dir_purpose, uint8_t router_purpose)</td></tr>
<tr class="separator:a9295a0181da0aabb17bd451f4b24f9bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6845d69b14a9dc6d04ee5c8b333f8ece"><td class="memItemLeft" align="right" valign="top">STATIC char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#a6845d69b14a9dc6d04ee5c8b333f8ece">authdir_type_to_string</a> (<a class="el" href="or_8h.html#ae733ffc8e2cde85d0705d947f8f86ada">dirinfo_type_t</a> auth)</td></tr>
<tr class="separator:a6845d69b14a9dc6d04ee5c8b333f8ece"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8aabd75f035464ab0450ff60098e97d4"><td class="memItemLeft" align="right" valign="top">STATIC const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#a8aabd75f035464ab0450ff60098e97d4">dir_conn_purpose_to_string</a> (int purpose)</td></tr>
<tr class="separator:a8aabd75f035464ab0450ff60098e97d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad69764afab6303ccc89d0571264db191"><td class="memItemLeft" align="right" valign="top">STATIC <a class="el" href="or_8h.html#ae733ffc8e2cde85d0705d947f8f86ada">dirinfo_type_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#ad69764afab6303ccc89d0571264db191">dir_fetch_type</a> (int dir_purpose, int router_purpose, const char *resource)</td></tr>
<tr class="separator:ad69764afab6303ccc89d0571264db191"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae222b3f260cc42ea120a438c2d4efc4a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#ae222b3f260cc42ea120a438c2d4efc4a">router_supports_extrainfo</a> (const char *identity_digest, int is_authority)</td></tr>
<tr class="separator:ae222b3f260cc42ea120a438c2d4efc4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4524a59d1b721804ba0cb5c0b7cf53a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#ae4524a59d1b721804ba0cb5c0b7cf53a">directories_have_accepted_server_descriptor</a> (void)</td></tr>
<tr class="separator:ae4524a59d1b721804ba0cb5c0b7cf53a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aace63698f64d26bc7a14531381e2fa57"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#aace63698f64d26bc7a14531381e2fa57">directory_post_to_dirservers</a> (uint8_t dir_purpose, uint8_t router_purpose, <a class="el" href="or_8h.html#ae733ffc8e2cde85d0705d947f8f86ada">dirinfo_type_t</a> type, const char *payload, size_t payload_len, size_t extrainfo_len)</td></tr>
<tr class="separator:aace63698f64d26bc7a14531381e2fa57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e70476c39b897c87ee7623617f43e78"><td class="memItemLeft" align="right" valign="top">STATIC int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#a4e70476c39b897c87ee7623617f43e78">should_use_directory_guards</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:a4e70476c39b897c87ee7623617f43e78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2dcb34e25124200a8694ef07275a50b2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#a2dcb34e25124200a8694ef07275a50b2">MOCK_IMPL</a> (void, directory_get_from_dirserver,(uint8_t dir_purpose, uint8_t router_purpose, const char *resource, int pds_flags, <a class="el" href="or_8h.html#a97b0a50b63539850700352c6de8a16c5">download_want_authority_t</a> want_authority))</td></tr>
<tr class="separator:a2dcb34e25124200a8694ef07275a50b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13483821c102fb862ab0d27091d7ffc7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#a13483821c102fb862ab0d27091d7ffc7">directory_get_from_all_authorities</a> (uint8_t dir_purpose, uint8_t router_purpose, const char *resource)</td></tr>
<tr class="separator:a13483821c102fb862ab0d27091d7ffc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57800839006f921803cc3087b9ba59c9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#a57800839006f921803cc3087b9ba59c9">directory_initiate_command_routerstatus_rend</a> (const <a class="el" href="structrouterstatus__t.html">routerstatus_t</a> *status, uint8_t dir_purpose, uint8_t router_purpose, <a class="el" href="directory_8h.html#a1c9628f500a2efb8bacf72a85faf121b">dir_indirection_t</a> indirection, const char *resource, const char *payload, size_t payload_len, time_t if_modified_since, const <a class="el" href="structrend__data__t.html">rend_data_t</a> *rend_query)</td></tr>
<tr class="separator:a57800839006f921803cc3087b9ba59c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73ef1e03e77e562991ea7237f61f7c36"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#a73ef1e03e77e562991ea7237f61f7c36">MOCK_IMPL</a> (void, directory_initiate_command_routerstatus,(const <a class="el" href="structrouterstatus__t.html">routerstatus_t</a> *status, uint8_t dir_purpose, uint8_t router_purpose, <a class="el" href="directory_8h.html#a1c9628f500a2efb8bacf72a85faf121b">dir_indirection_t</a> indirection, const char *resource, const char *payload, size_t payload_len, time_t if_modified_since))</td></tr>
<tr class="separator:a73ef1e03e77e562991ea7237f61f7c36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5230127838f35e68b6a9ee6ded4ad8ca"><td class="memItemLeft" align="right" valign="top"><a id="a5230127838f35e68b6a9ee6ded4ad8ca"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>directory_must_use_begindir</b> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:a5230127838f35e68b6a9ee6ded4ad8ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae333cd0dfde56a83ff29aef322a182c4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#ae333cd0dfde56a83ff29aef322a182c4">directory_initiate_command</a> (const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *or_addr, uint16_t or_port, const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *dir_addr, uint16_t dir_port, const char *digest, uint8_t dir_purpose, uint8_t router_purpose, <a class="el" href="directory_8h.html#a1c9628f500a2efb8bacf72a85faf121b">dir_indirection_t</a> indirection, const char *resource, const char *payload, size_t payload_len, time_t if_modified_since)</td></tr>
<tr class="separator:ae333cd0dfde56a83ff29aef322a182c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af70528e82e9fdd7992b169feeda182ee"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#af70528e82e9fdd7992b169feeda182ee">is_sensitive_dir_purpose</a> (uint8_t dir_purpose)</td></tr>
<tr class="separator:af70528e82e9fdd7992b169feeda182ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac275636256d237d3858ddd9c9f008cc0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#ac275636256d237d3858ddd9c9f008cc0">connection_dir_is_encrypted</a> (<a class="el" href="structdir__connection__t.html">dir_connection_t</a> *conn)</td></tr>
<tr class="separator:ac275636256d237d3858ddd9c9f008cc0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ab1c7dcfde852c520eb496643fdc865"><td class="memItemLeft" align="right" valign="top">STATIC int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#a2ab1c7dcfde852c520eb496643fdc865">parse_http_url</a> (const char *headers, char **url)</td></tr>
<tr class="separator:a2ab1c7dcfde852c520eb496643fdc865"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4786f539a53422cb5ce22c6036766c15"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#a4786f539a53422cb5ce22c6036766c15">parse_http_response</a> (const char *headers, int *code, time_t *date, <a class="el" href="torgzip_8h.html#a97a284cf1b98eccbe7964617ed797eee">compress_method_t</a> *compression, char **reason)</td></tr>
<tr class="separator:a4786f539a53422cb5ce22c6036766c15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0f61e005774a8b52467b2dea7528d2a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#ad0f61e005774a8b52467b2dea7528d2a">connection_dir_reached_eof</a> (<a class="el" href="structdir__connection__t.html">dir_connection_t</a> *conn)</td></tr>
<tr class="separator:ad0f61e005774a8b52467b2dea7528d2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2bfa4b827d711bd2ed6bdeb506c8b6d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#af2bfa4b827d711bd2ed6bdeb506c8b6d">connection_dir_process_inbuf</a> (<a class="el" href="structdir__connection__t.html">dir_connection_t</a> *conn)</td></tr>
<tr class="separator:af2bfa4b827d711bd2ed6bdeb506c8b6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae225c64a35559d7a6e7b06d8fd5c121c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#ae225c64a35559d7a6e7b06d8fd5c121c">connection_dir_about_to_close</a> (<a class="el" href="structdir__connection__t.html">dir_connection_t</a> *dir_conn)</td></tr>
<tr class="separator:ae225c64a35559d7a6e7b06d8fd5c121c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79465f9ed982843ae74cf72c01073309"><td class="memItemLeft" align="right" valign="top">STATIC <a class="el" href="torgzip_8h.html#a7bb1094cdcac1e575e01509f7a87e148">zlib_compression_level_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#a79465f9ed982843ae74cf72c01073309">choose_compression_level</a> (ssize_t n_bytes)</td></tr>
<tr class="separator:a79465f9ed982843ae74cf72c01073309"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada931951a748ed6f95dc5f69bba31364"><td class="memItemLeft" align="right" valign="top">STATIC int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#ada931951a748ed6f95dc5f69bba31364">directory_handle_command_get</a> (<a class="el" href="structdir__connection__t.html">dir_connection_t</a> *conn, const char *headers, const char *req_body, size_t req_body_len)</td></tr>
<tr class="separator:ada931951a748ed6f95dc5f69bba31364"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bcf7851094badfe17ac6f027f70ce2f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#a1bcf7851094badfe17ac6f027f70ce2f">connection_dir_finished_flushing</a> (<a class="el" href="structdir__connection__t.html">dir_connection_t</a> *conn)</td></tr>
<tr class="separator:a1bcf7851094badfe17ac6f027f70ce2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a226f54e5ed405ed992c6a8e79c63a59e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#a226f54e5ed405ed992c6a8e79c63a59e">connection_dir_finished_connecting</a> (<a class="el" href="structdir__connection__t.html">dir_connection_t</a> *conn)</td></tr>
<tr class="separator:a226f54e5ed405ed992c6a8e79c63a59e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6977c51923b32ba38e29dcf72163d1d"><td class="memItemLeft" align="right" valign="top">STATIC const <a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#af6977c51923b32ba38e29dcf72163d1d">find_dl_schedule</a> (<a class="el" href="structdownload__status__t.html">download_status_t</a> *dls, const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:af6977c51923b32ba38e29dcf72163d1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65e22ba9f7920ec24c60d3a4ee67a175"><td class="memItemLeft" align="right" valign="top">STATIC void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#a65e22ba9f7920ec24c60d3a4ee67a175">find_dl_min_and_max_delay</a> (<a class="el" href="structdownload__status__t.html">download_status_t</a> *dls, const <a class="el" href="structor__options__t.html">or_options_t</a> *options, int *min, int *max)</td></tr>
<tr class="separator:a65e22ba9f7920ec24c60d3a4ee67a175"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4dc34a1e327bdae7977864ddab34b66e"><td class="memItemLeft" align="right" valign="top">STATIC int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#a4dc34a1e327bdae7977864ddab34b66e">next_random_exponential_delay</a> (int delay, int max_delay)</td></tr>
<tr class="separator:a4dc34a1e327bdae7977864ddab34b66e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1fb73884e5ae3df6dea7d1bbb85634d"><td class="memItemLeft" align="right" valign="top">STATIC int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#ad1fb73884e5ae3df6dea7d1bbb85634d">download_status_schedule_get_delay</a> (<a class="el" href="structdownload__status__t.html">download_status_t</a> *dls, const <a class="el" href="structsmartlist__t.html">smartlist_t</a> *schedule, int min_delay, int max_delay, time_t now)</td></tr>
<tr class="separator:ad1fb73884e5ae3df6dea7d1bbb85634d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad030aefd2edb06cac0a0477457631fab"><td class="memItemLeft" align="right" valign="top">time_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#ad030aefd2edb06cac0a0477457631fab">download_status_increment_failure</a> (<a class="el" href="structdownload__status__t.html">download_status_t</a> *dls, int status_code, const char *item, int server, time_t now)</td></tr>
<tr class="separator:ad030aefd2edb06cac0a0477457631fab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abfbbd8729f4c0f94b6080020a729bc70"><td class="memItemLeft" align="right" valign="top">time_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#abfbbd8729f4c0f94b6080020a729bc70">download_status_increment_attempt</a> (<a class="el" href="structdownload__status__t.html">download_status_t</a> *dls, const char *item, time_t now)</td></tr>
<tr class="separator:abfbbd8729f4c0f94b6080020a729bc70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0c46dd4ad90ff8350a03414a4d79307"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#ae0c46dd4ad90ff8350a03414a4d79307">download_status_reset</a> (<a class="el" href="structdownload__status__t.html">download_status_t</a> *dls)</td></tr>
<tr class="separator:ae0c46dd4ad90ff8350a03414a4d79307"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59a315ee3b1551a73aceac163faecd85"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#a59a315ee3b1551a73aceac163faecd85">download_status_get_n_failures</a> (const <a class="el" href="structdownload__status__t.html">download_status_t</a> *dls)</td></tr>
<tr class="separator:a59a315ee3b1551a73aceac163faecd85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a465b447ad179780a88ffb88f1aeae12e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#a465b447ad179780a88ffb88f1aeae12e">download_status_get_n_attempts</a> (const <a class="el" href="structdownload__status__t.html">download_status_t</a> *dls)</td></tr>
<tr class="separator:a465b447ad179780a88ffb88f1aeae12e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acfdb8594e1a676e38ca79913320dea3e"><td class="memItemLeft" align="right" valign="top">time_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#acfdb8594e1a676e38ca79913320dea3e">download_status_get_next_attempt_at</a> (const <a class="el" href="structdownload__status__t.html">download_status_t</a> *dls)</td></tr>
<tr class="separator:acfdb8594e1a676e38ca79913320dea3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37450cb94cd7190d5030b4429ba408c2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#a37450cb94cd7190d5030b4429ba408c2">dir_split_resource_into_fingerprint_pairs</a> (const char *res, <a class="el" href="structsmartlist__t.html">smartlist_t</a> *pairs_out)</td></tr>
<tr class="separator:a37450cb94cd7190d5030b4429ba408c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3cd3a5081cf507805b4b01c907dd168"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="directory_8c.html#ab3cd3a5081cf507805b4b01c907dd168">dir_split_resource_into_fingerprints</a> (const char *resource, <a class="el" href="structsmartlist__t.html">smartlist_t</a> *fp_out, int *compressed_out, int flags)</td></tr>
<tr class="separator:ab3cd3a5081cf507805b4b01c907dd168"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Code to send and fetch directories and router descriptors via HTTP. Directories use <a class="el" href="dirserv_8c.html" title="Directory server core implementation. Manages directory contents and generates directories. ">dirserv.c</a> to generate the results; clients use routers.c to parse them. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a23c309e66997f959d52791af058b27d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23c309e66997f959d52791af058b27d8">&#9670;&nbsp;</a></span>ALLOW_DIRECTORY_TIME_SKEW</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ALLOW_DIRECTORY_TIME_SKEW&#160;&#160;&#160;(30*60)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>How far in the future do we allow a directory server to tell us it is before deciding that one of us has the wrong time? </p>

</div>
</div>
<a id="aeae5dbd4c3ad12f7bc3ac494ea30ac3b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeae5dbd4c3ad12f7bc3ac494ea30ac3b">&#9670;&nbsp;</a></span>FULL_DIR_CACHE_LIFETIME</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FULL_DIR_CACHE_LIFETIME&#160;&#160;&#160;(60*60)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>HTTP cache control: how long do we tell proxies they can cache each kind of document we serve? </p>

</div>
</div>
<a id="af12592e94d1a765dfbc59cef089ce947"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af12592e94d1a765dfbc59cef089ce947">&#9670;&nbsp;</a></span>MAX_DIRECTORY_OBJECT_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_DIRECTORY_OBJECT_SIZE&#160;&#160;&#160;(10*(1&lt;&lt;20))</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If any directory object is arriving, and it's over 10MB large, we're getting DoS'd. (As of 0.1.2.x, raw directories are about 1MB, and we never ask for more than 96 router descriptors at a time.) </p>

</div>
</div>
<a id="ae94cefe68ab1ccb9a884f52955582b9a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae94cefe68ab1ccb9a884f52955582b9a">&#9670;&nbsp;</a></span>SEND_HS_DESC_FAILED_CONTENT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SEND_HS_DESC_FAILED_CONTENT</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">( \</div><div class="line">      control_event_hs_descriptor_content(conn-&gt;rend_data-&gt;onion_address, \</div><div class="line">                                          conn-&gt;requested_resource, \</div><div class="line">                                          conn-&gt;identity_digest, \</div><div class="line">                                          NULL) )</div></div><!-- fragment -->
</div>
</div>
<a id="a698bec7a6cd6eccf990a74309fa20453"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a698bec7a6cd6eccf990a74309fa20453">&#9670;&nbsp;</a></span>SEND_HS_DESC_FAILED_EVENT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SEND_HS_DESC_FAILED_EVENT</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">reason</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">( \</div><div class="line">      control_event_hs_descriptor_failed(conn-&gt;rend_data, \</div><div class="line">                                         conn-&gt;identity_digest, \</div><div class="line">                                         reason) )</div></div><!-- fragment -->
</div>
</div>
<a id="a44f58716bb3b4c1365a6047c9e0e2b6d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44f58716bb3b4c1365a6047c9e0e2b6d">&#9670;&nbsp;</a></span>SEND_HS_DESC_UPLOAD_FAILED_EVENT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SEND_HS_DESC_UPLOAD_FAILED_EVENT</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">reason</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">( \</div><div class="line">      control_event_hs_descriptor_upload_failed( \</div><div class="line">        conn-&gt;identity_digest, \</div><div class="line">        conn-&gt;rend_data-&gt;onion_address, \</div><div class="line">        reason) )</div></div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="ad24e8866486cbc6cb9e986c747d5f0b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad24e8866486cbc6cb9e986c747d5f0b4">&#9670;&nbsp;</a></span>get_handler_args_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structget__handler__args__t.html">get_handler_args_t</a>  <a class="el" href="structget__handler__args__t.html">get_handler_args_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Information passed to handle a GET request. </p>

</div>
</div>
<a id="a696a8ba1f088d30327bf3f2ded94a66e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a696a8ba1f088d30327bf3f2ded94a66e">&#9670;&nbsp;</a></span>url_table_ent_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structurl__table__ent__s.html">url_table_ent_s</a>  <a class="el" href="directory_8c.html#a696a8ba1f088d30327bf3f2ded94a66e">url_table_ent_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Entry for handling an HTTP GET request.</p>
<p>This entry matches a request if "string" is equal to the requested resource, or if "is_prefix" is true and "string" is a prefix of the requested resource.</p>
<p>The 'handler' function is called to handle the request. It receives an arguments structure, and must return 0 on success or -1 if we should close the connection. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a6845d69b14a9dc6d04ee5c8b333f8ece"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6845d69b14a9dc6d04ee5c8b333f8ece">&#9670;&nbsp;</a></span>authdir_type_to_string()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC char* authdir_type_to_string </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="or_8h.html#ae733ffc8e2cde85d0705d947f8f86ada">dirinfo_type_t</a>&#160;</td>
          <td class="paramname"><em>auth</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a newly allocated string describing <b>auth</b>. Only describes authority features. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="directory_8c_a6845d69b14a9dc6d04ee5c8b333f8ece_cgraph.png" border="0" usemap="#directory_8c_a6845d69b14a9dc6d04ee5c8b333f8ece_cgraph" alt=""/></div>
<map name="directory_8c_a6845d69b14a9dc6d04ee5c8b333f8ece_cgraph" id="directory_8c_a6845d69b14a9dc6d04ee5c8b333f8ece_cgraph">
<area shape="rect" id="node2" href="container_8c.html#accf59a8b7d39a4286ff99653b6878006" title="smartlist_add" alt="" coords="227,5,327,32"/>
<area shape="rect" id="node3" href="container_8c.html#ab865391a8cac688c51809c33dad0bfe2" title="smartlist_join_strings" alt="" coords="204,56,349,83"/>
<area shape="rect" id="node4" href="container_8c.html#aac69a4c0d462859a1a13a6eb35ab3c0a" title="smartlist_join_strings2" alt="" coords="397,56,549,83"/>
</map>
</div>

</div>
</div>
<a id="a79465f9ed982843ae74cf72c01073309"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79465f9ed982843ae74cf72c01073309">&#9670;&nbsp;</a></span>choose_compression_level()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC <a class="el" href="torgzip_8h.html#a7bb1094cdcac1e575e01509f7a87e148">zlib_compression_level_t</a> choose_compression_level </td>
          <td>(</td>
          <td class="paramtype">ssize_t&#160;</td>
          <td class="paramname"><em>n_bytes</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the compression level we should use for sending a compressed response of size <b>n_bytes</b>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="directory_8c_a79465f9ed982843ae74cf72c01073309_cgraph.png" border="0" usemap="#directory_8c_a79465f9ed982843ae74cf72c01073309_cgraph" alt=""/></div>
<map name="directory_8c_a79465f9ed982843ae74cf72c01073309_cgraph" id="directory_8c_a79465f9ed982843ae74cf72c01073309_cgraph">
<area shape="rect" id="node2" href="relay_8c.html#a7cdcc52f9a06a285c55d5e18220325a9" title="have_been_under_memory\l_pressure" alt="" coords="199,5,377,47"/>
</map>
</div>

</div>
</div>
<a id="ae225c64a35559d7a6e7b06d8fd5c121c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae225c64a35559d7a6e7b06d8fd5c121c">&#9670;&nbsp;</a></span>connection_dir_about_to_close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_dir_about_to_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdir__connection__t.html">dir_connection_t</a> *&#160;</td>
          <td class="paramname"><em>dir_conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Called when we're about to finally unlink and free a directory connection: perform necessary accounting and cleanup </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="directory_8c_ae225c64a35559d7a6e7b06d8fd5c121c_icgraph.png" border="0" usemap="#directory_8c_ae225c64a35559d7a6e7b06d8fd5c121c_icgraph" alt=""/></div>
<map name="directory_8c_ae225c64a35559d7a6e7b06d8fd5c121c_icgraph" id="directory_8c_ae225c64a35559d7a6e7b06d8fd5c121c_icgraph">
<area shape="rect" id="node2" href="connection_8h.html#ade7f55aa182a3f727d25a510566351fd" title="connection_about_to\l_close_connection" alt="" coords="199,5,341,47"/>
</map>
</div>

</div>
</div>
<a id="a226f54e5ed405ed992c6a8e79c63a59e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a226f54e5ed405ed992c6a8e79c63a59e">&#9670;&nbsp;</a></span>connection_dir_finished_connecting()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_dir_finished_connecting </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdir__connection__t.html">dir_connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Connected handler for directory connections: begin sending data to the server, and return 0. Only used when connections don't immediately connect. </p>

</div>
</div>
<a id="a1bcf7851094badfe17ac6f027f70ce2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1bcf7851094badfe17ac6f027f70ce2f">&#9670;&nbsp;</a></span>connection_dir_finished_flushing()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_dir_finished_flushing </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdir__connection__t.html">dir_connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write handler for directory connections; called when all data has been flushed. Close the connection or wait for a response as appropriate. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="directory_8c_a1bcf7851094badfe17ac6f027f70ce2f_cgraph.png" border="0" usemap="#directory_8c_a1bcf7851094badfe17ac6f027f70ce2f_cgraph" alt=""/></div>
<map name="directory_8c_a1bcf7851094badfe17ac6f027f70ce2f_cgraph" id="directory_8c_a1bcf7851094badfe17ac6f027f70ce2f_cgraph">
<area shape="rect" id="node2" href="geoip_8c.html#a2a34cf4b056ecac0418dcc5927b03bb6" title="geoip_change_dirreq\l_state" alt="" coords="212,5,353,47"/>
</map>
</div>

</div>
</div>
<a id="ac275636256d237d3858ddd9c9f008cc0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac275636256d237d3858ddd9c9f008cc0">&#9670;&nbsp;</a></span>connection_dir_is_encrypted()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_dir_is_encrypted </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdir__connection__t.html">dir_connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff anything we say on <b>conn</b> is being encrypted before we send it to the client/server. </p>

</div>
</div>
<a id="af2bfa4b827d711bd2ed6bdeb506c8b6d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2bfa4b827d711bd2ed6bdeb506c8b6d">&#9670;&nbsp;</a></span>connection_dir_process_inbuf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_dir_process_inbuf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdir__connection__t.html">dir_connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read handler for directory connections. (That's connections <em>to</em> directory servers and connections <em>at</em> directory servers.) </p>

</div>
</div>
<a id="ad0f61e005774a8b52467b2dea7528d2a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad0f61e005774a8b52467b2dea7528d2a">&#9670;&nbsp;</a></span>connection_dir_reached_eof()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_dir_reached_eof </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdir__connection__t.html">dir_connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Called when a directory connection reaches EOF. </p>

</div>
</div>
<a id="a8aabd75f035464ab0450ff60098e97d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8aabd75f035464ab0450ff60098e97d4">&#9670;&nbsp;</a></span>dir_conn_purpose_to_string()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC const char* dir_conn_purpose_to_string </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>purpose</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a string describing a given directory connection purpose. </p>

</div>
</div>
<a id="ad69764afab6303ccc89d0571264db191"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad69764afab6303ccc89d0571264db191">&#9670;&nbsp;</a></span>dir_fetch_type()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC <a class="el" href="or_8h.html#ae733ffc8e2cde85d0705d947f8f86ada">dirinfo_type_t</a> dir_fetch_type </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dir_purpose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>router_purpose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>resource</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the requisite directory information types. </p>

</div>
</div>
<a id="a37450cb94cd7190d5030b4429ba408c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a37450cb94cd7190d5030b4429ba408c2">&#9670;&nbsp;</a></span>dir_split_resource_into_fingerprint_pairs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dir_split_resource_into_fingerprint_pairs </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>res</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>pairs_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Divide a string <b>res</b> of the form FP1-FP2+FP3-FP4...[.z], where each FP is a hex-encoded fingerprint, into a sequence of distinct sorted <a class="el" href="structfp__pair__t.html">fp_pair_t</a>. Skip malformed pairs. On success, return 0 and add those <a class="el" href="structfp__pair__t.html">fp_pair_t</a> into <b>pairs_out</b>. On failure, return -1. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="directory_8c_a37450cb94cd7190d5030b4429ba408c2_cgraph.png" border="0" usemap="#directory_8c_a37450cb94cd7190d5030b4429ba408c2_cgraph" alt=""/></div>
<map name="directory_8c_a37450cb94cd7190d5030b4429ba408c2_cgraph" id="directory_8c_a37450cb94cd7190d5030b4429ba408c2_cgraph">
<area shape="rect" id="node2" href="container_8c.html#a1d75cac5583c66900c032ba972ffabc8" title="smartlist_split_string" alt="" coords="203,13,345,39"/>
</map>
</div>

</div>
</div>
<a id="ab3cd3a5081cf507805b4b01c907dd168"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3cd3a5081cf507805b4b01c907dd168">&#9670;&nbsp;</a></span>dir_split_resource_into_fingerprints()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dir_split_resource_into_fingerprints </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>resource</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>fp_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>compressed_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given a directory <b>resource</b> request, containing zero or more strings separated by plus signs, followed optionally by ".z", store the strings, in order, into <b>fp_out</b>. If <b>compressed_out</b> is non-NULL, set it to 1 if the resource ends in ".z", else set it to 0.</p>
<p>If (flags &amp; DSR_HEX), then delete all elements that aren't hex digests, and decode the rest. If (flags &amp; DSR_BASE64), then use "-" rather than "+" as a separator, delete all the elements that aren't base64-encoded digests, and decode the rest. If (flags &amp; DSR_DIGEST256), these digests should be 256 bits long; else they should be 160.</p>
<p>If (flags &amp; DSR_SORT_UNIQ), then sort the list and remove all duplicates. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="directory_8c_ab3cd3a5081cf507805b4b01c907dd168_icgraph.png" border="0" usemap="#directory_8c_ab3cd3a5081cf507805b4b01c907dd168_icgraph" alt=""/></div>
<map name="directory_8c_ab3cd3a5081cf507805b4b01c907dd168_icgraph" id="directory_8c_ab3cd3a5081cf507805b4b01c907dd168_icgraph">
<area shape="rect" id="node2" href="dirserv_8h.html#a8fca5a38cd000d8ccabe5bc73e296bb2" title="dirserv_get_routerdescs" alt="" coords="177,13,339,39"/>
</map>
</div>

</div>
</div>
<a id="ae4524a59d1b721804ba0cb5c0b7cf53a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae4524a59d1b721804ba0cb5c0b7cf53a">&#9670;&nbsp;</a></span>directories_have_accepted_server_descriptor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int directories_have_accepted_server_descriptor </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff any trusted directory authority has accepted our server descriptor.</p>
<p>We consider any authority sufficient because waiting for all of them means it never happens while any authority is down; we don't go for something more complex in the middle (like &gt;1/3 or &gt;1/2 or &gt;=1/2) because that doesn't seem necessary yet. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="directory_8c_ae4524a59d1b721804ba0cb5c0b7cf53a_cgraph.png" border="0" usemap="#directory_8c_ae4524a59d1b721804ba0cb5c0b7cf53a_cgraph" alt=""/></div>
<map name="directory_8c_ae4524a59d1b721804ba0cb5c0b7cf53a_cgraph" id="directory_8c_ae4524a59d1b721804ba0cb5c0b7cf53a_cgraph">
<area shape="rect" id="node2" href="routerlist_8c.html#aa9b36f7b87463dc114065ea058660ac4" title="router_get_trusted\l_dir_servers" alt="" coords="231,5,357,47"/>
</map>
</div>

</div>
</div>
<a id="a13483821c102fb862ab0d27091d7ffc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13483821c102fb862ab0d27091d7ffc7">&#9670;&nbsp;</a></span>directory_get_from_all_authorities()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void directory_get_from_all_authorities </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>dir_purpose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>router_purpose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>resource</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>As directory_get_from_dirserver, but initiates a request to <em>every</em> directory authority other than ourself. Only for use by authorities when searching for missing information while voting. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="directory_8c_a13483821c102fb862ab0d27091d7ffc7_cgraph.png" border="0" usemap="#directory_8c_a13483821c102fb862ab0d27091d7ffc7_cgraph" alt=""/></div>
<map name="directory_8c_a13483821c102fb862ab0d27091d7ffc7_cgraph" id="directory_8c_a13483821c102fb862ab0d27091d7ffc7_cgraph">
<area shape="rect" id="node2" href="routerlist_8c.html#aa9b36f7b87463dc114065ea058660ac4" title="router_get_trusted\l_dir_servers" alt="" coords="190,5,317,47"/>
<area shape="rect" id="node3" href="router_8c.html#abeb0f38915a46f77352900604075d82f" title="router_digest_is_me" alt="" coords="184,71,323,98"/>
<area shape="rect" id="node4" href="di__ops_8c.html#a473334ee93cca0aea10523321a444ea3" title="tor_memeq" alt="" coords="371,71,457,98"/>
</map>
</div>

</div>
</div>
<a id="ada931951a748ed6f95dc5f69bba31364"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada931951a748ed6f95dc5f69bba31364">&#9670;&nbsp;</a></span>directory_handle_command_get()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC int directory_handle_command_get </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdir__connection__t.html">dir_connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>headers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>req_body</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>req_body_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Helper function: called when a dirserver gets a complete HTTP GET request. Look for a request for a directory or for a rendezvous service descriptor. On finding one, write a response into conn-&gt;outbuf. If the request is unrecognized, send a 404. Return 0 if we handled this successfully, or -1 if we need to close the connection. </p>

</div>
</div>
<a id="ae333cd0dfde56a83ff29aef322a182c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae333cd0dfde56a83ff29aef322a182c4">&#9670;&nbsp;</a></span>directory_initiate_command()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void directory_initiate_command </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *&#160;</td>
          <td class="paramname"><em>or_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>or_port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *&#160;</td>
          <td class="paramname"><em>dir_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>dir_port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>digest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>dir_purpose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>router_purpose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="directory_8h.html#a1c9628f500a2efb8bacf72a85faf121b">dir_indirection_t</a>&#160;</td>
          <td class="paramname"><em>indirection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>resource</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>payload_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>if_modified_since</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Helper for directory_initiate_command_rend: send the command to a server whose OR address/port is <b>or_addr</b>/<b>or_port</b>, whose directory address/port is <b>dir_addr</b>/<b>dir_port</b>, whose identity key digest is <b>digest</b>, with purposes <b>dir_purpose</b> and <b>router_purpose</b>, making an (in)direct connection as specified in <b>indirection</b>, with command <b>resource</b>, <b>payload</b> of <b>payload_len</b>, and asking for a result only <b>if_modified_since</b>. </p>

</div>
</div>
<a id="a57800839006f921803cc3087b9ba59c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57800839006f921803cc3087b9ba59c9">&#9670;&nbsp;</a></span>directory_initiate_command_routerstatus_rend()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void directory_initiate_command_routerstatus_rend </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structrouterstatus__t.html">routerstatus_t</a> *&#160;</td>
          <td class="paramname"><em>status</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>dir_purpose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>router_purpose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="directory_8h.html#a1c9628f500a2efb8bacf72a85faf121b">dir_indirection_t</a>&#160;</td>
          <td class="paramname"><em>indirection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>resource</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>payload_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>if_modified_since</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structrend__data__t.html">rend_data_t</a> *&#160;</td>
          <td class="paramname"><em>rend_query</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Same as directory_initiate_command_routerstatus(), but accepts rendezvous data to fetch a hidden service descriptor. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="directory_8c_a57800839006f921803cc3087b9ba59c9_icgraph.png" border="0" usemap="#directory_8c_a57800839006f921803cc3087b9ba59c9_icgraph" alt=""/></div>
<map name="directory_8c_a57800839006f921803cc3087b9ba59c9_icgraph" id="directory_8c_a57800839006f921803cc3087b9ba59c9_icgraph">
<area shape="rect" id="node2" href="directory_8c.html#a73ef1e03e77e562991ea7237f61f7c36" title="MOCK_IMPL" alt="" coords="248,13,348,39"/>
</map>
</div>

</div>
</div>
<a id="aace63698f64d26bc7a14531381e2fa57"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aace63698f64d26bc7a14531381e2fa57">&#9670;&nbsp;</a></span>directory_post_to_dirservers()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void directory_post_to_dirservers </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>dir_purpose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>router_purpose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="or_8h.html#ae733ffc8e2cde85d0705d947f8f86ada">dirinfo_type_t</a>&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>payload_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>extrainfo_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Start a connection to every suitable directory authority, using connection purpose <b>dir_purpose</b> and uploading <b>payload</b> (of length <b>payload_len</b>). The dir_purpose should be one of 'DIR_PURPOSE_UPLOAD_{DIR|VOTE|SIGNATURES}'.</p>
<p><b>router_purpose</b> describes the type of descriptor we're publishing, if we're publishing a descriptor &ndash; e.g. general or bridge.</p>
<p><b>type</b> specifies what sort of dir authorities (V3, BRIDGE, etc) we should upload to.</p>
<p>If <b>extrainfo_len</b> is nonzero, the first <b>payload_len</b> bytes of <b>payload</b> hold a router descriptor, and the next <b>extrainfo_len</b> bytes of <b>payload</b> hold an extra-info document. Upload the descriptor to all authorities, and the extra-info document to all authorities that support it. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="directory_8c_aace63698f64d26bc7a14531381e2fa57_cgraph.png" border="0" usemap="#directory_8c_aace63698f64d26bc7a14531381e2fa57_cgraph" alt=""/></div>
<map name="directory_8c_aace63698f64d26bc7a14531381e2fa57_cgraph" id="directory_8c_aace63698f64d26bc7a14531381e2fa57_cgraph">
<area shape="rect" id="node2" href="routerlist_8c.html#aa9b36f7b87463dc114065ea058660ac4" title="router_get_trusted\l_dir_servers" alt="" coords="246,5,373,47"/>
<area shape="rect" id="node3" href="router_8c.html#abeb0f38915a46f77352900604075d82f" title="router_digest_is_me" alt="" coords="240,71,379,98"/>
<area shape="rect" id="node5" href="routerset_8c.html#a46e8468ce37722ff71b91efd9d2f7ff0" title="routerset_contains\l_routerstatus" alt="" coords="245,123,374,164"/>
<area shape="rect" id="node4" href="di__ops_8c.html#a473334ee93cca0aea10523321a444ea3" title="tor_memeq" alt="" coords="448,71,535,98"/>
<area shape="rect" id="node6" href="routerset_8c.html#a1eda4526d656d042e5143ec79ee66be2" title="routerset_contains" alt="" coords="427,130,556,157"/>
<area shape="rect" id="node7" href="container_8c.html#a1406b823cb6088df755f1b81153d137e" title="strmap_get_lc" alt="" coords="604,130,708,157"/>
</map>
</div>

</div>
</div>
<a id="a465b447ad179780a88ffb88f1aeae12e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a465b447ad179780a88ffb88f1aeae12e">&#9670;&nbsp;</a></span>download_status_get_n_attempts()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int download_status_get_n_attempts </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdownload__status__t.html">download_status_t</a> *&#160;</td>
          <td class="paramname"><em>dls</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the number of attempts to download <b>dls</b> since the last success (if any). This can differ from <a class="el" href="directory_8c.html#a59a315ee3b1551a73aceac163faecd85">download_status_get_n_failures()</a> due to outstanding concurrent attempts. </p>

</div>
</div>
<a id="a59a315ee3b1551a73aceac163faecd85"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59a315ee3b1551a73aceac163faecd85">&#9670;&nbsp;</a></span>download_status_get_n_failures()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int download_status_get_n_failures </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdownload__status__t.html">download_status_t</a> *&#160;</td>
          <td class="paramname"><em>dls</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the number of failures on <b>dls</b> since the last success (if any). </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="directory_8c_a59a315ee3b1551a73aceac163faecd85_icgraph.png" border="0" usemap="#directory_8c_a59a315ee3b1551a73aceac163faecd85_icgraph" alt=""/></div>
<map name="directory_8c_a59a315ee3b1551a73aceac163faecd85_icgraph" id="directory_8c_a59a315ee3b1551a73aceac163faecd85_icgraph">
<area shape="rect" id="node2" href="routerlist_8h.html#af0674d915ac20d064542496c8a8c2c26" title="authority_cert_dl_looks\l_uncertain" alt="" coords="199,5,355,47"/>
</map>
</div>

</div>
</div>
<a id="acfdb8594e1a676e38ca79913320dea3e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acfdb8594e1a676e38ca79913320dea3e">&#9670;&nbsp;</a></span>download_status_get_next_attempt_at()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">time_t download_status_get_next_attempt_at </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdownload__status__t.html">download_status_t</a> *&#160;</td>
          <td class="paramname"><em>dls</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the next time to attempt to download <b>dls</b>. </p>

</div>
</div>
<a id="abfbbd8729f4c0f94b6080020a729bc70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abfbbd8729f4c0f94b6080020a729bc70">&#9670;&nbsp;</a></span>download_status_increment_attempt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">time_t download_status_increment_attempt </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdownload__status__t.html">download_status_t</a> *&#160;</td>
          <td class="paramname"><em>dls</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>item</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Determine when the next download attempt should be made when using an attempt-based (potentially concurrent) download schedule. Called when an attempt to download <b>dls</b> is being initiated. Increment the attempt count and set <b>dls</b>-&gt;next_attempt_at to an appropriate time in the future and return it. If <b>dls-&gt;increment_on</b> is DL_SCHED_INCREMENT_FAILURE, don't increment the attempts, and return a time in the far future (to avoid launching a concurrent attempt). </p>

</div>
</div>
<a id="ad030aefd2edb06cac0a0477457631fab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad030aefd2edb06cac0a0477457631fab">&#9670;&nbsp;</a></span>download_status_increment_failure()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">time_t download_status_increment_failure </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdownload__status__t.html">download_status_t</a> *&#160;</td>
          <td class="paramname"><em>dls</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>status_code</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>item</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Determine when a failed download attempt should be retried. Called when an attempt to download <b>dls</b> has failed with HTTP status <b>status_code</b>. Increment the failure count (if the code indicates a real failure, or if we're a server) and set <b>dls</b>-&gt;next_attempt_at to an appropriate time in the future and return it. If <b>dls-&gt;increment_on</b> is DL_SCHED_INCREMENT_ATTEMPT, increment the failure count, and return a time in the far future for the next attempt (to avoid an immediate retry). </p>

</div>
</div>
<a id="ae0c46dd4ad90ff8350a03414a4d79307"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0c46dd4ad90ff8350a03414a4d79307">&#9670;&nbsp;</a></span>download_status_reset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void download_status_reset </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdownload__status__t.html">download_status_t</a> *&#160;</td>
          <td class="paramname"><em>dls</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reset <b>dls</b> so that it will be considered downloadable immediately, and/or to show that we don't need it anymore.</p>
<p>Must be called to initialise a download schedule, otherwise the zeroth item in the schedule will never be used.</p>
<p>(We find the zeroth element of the download schedule, and set next_attempt_at to be the appropriate offset from 'now'. In most cases this means setting it to 'now', so the item will be immediately downloadable; in the case of bridge descriptors, the zeroth element is an hour from now.) </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="directory_8c_ae0c46dd4ad90ff8350a03414a4d79307_cgraph.png" border="0" usemap="#directory_8c_ae0c46dd4ad90ff8350a03414a4d79307_cgraph" alt=""/></div>
<map name="directory_8c_ae0c46dd4ad90ff8350a03414a4d79307_cgraph" id="directory_8c_ae0c46dd4ad90ff8350a03414a4d79307_cgraph">
<area shape="rect" id="node2" href="directory_8c.html#af6977c51923b32ba38e29dcf72163d1d" title="find_dl_schedule" alt="" coords="209,5,328,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="directory_8c_ae0c46dd4ad90ff8350a03414a4d79307_icgraph.png" border="0" usemap="#directory_8c_ae0c46dd4ad90ff8350a03414a4d79307_icgraph" alt=""/></div>
<map name="directory_8c_ae0c46dd4ad90ff8350a03414a4d79307_icgraph" id="directory_8c_ae0c46dd4ad90ff8350a03414a4d79307_icgraph">
<area shape="rect" id="node2" href="networkstatus_8h.html#afcfacad25b94db6f21e0df2f7897a3cf" title="routers_update_status\l_from_consensus_networkstatus" alt="" coords="209,5,424,47"/>
<area shape="rect" id="node3" href="routerlist_8h.html#ae08c5697c58be20a7bb11b34ca9aba5e" title="router_load_routers\l_from_string" alt="" coords="472,5,605,47"/>
</map>
</div>

</div>
</div>
<a id="ad1fb73884e5ae3df6dea7d1bbb85634d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad1fb73884e5ae3df6dea7d1bbb85634d">&#9670;&nbsp;</a></span>download_status_schedule_get_delay()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC int download_status_schedule_get_delay </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdownload__status__t.html">download_status_t</a> *&#160;</td>
          <td class="paramname"><em>dls</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>schedule</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>min_delay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>max_delay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Find the current delay for dls based on schedule or min_delay/ max_delay if we're using exponential backoff. If dls-&gt;backoff is DL_SCHED_RANDOM_EXPONENTIAL, we must have 0 &lt;= min_delay &lt;= max_delay &lt;= INT_MAX, but schedule may be set to NULL; otherwise schedule is required. This function sets dls-&gt;next_attempt_at based on now, and returns the delay. Helper for download_status_increment_failure and download_status_increment_attempt. </p>

</div>
</div>
<a id="a65e22ba9f7920ec24c60d3a4ee67a175"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a65e22ba9f7920ec24c60d3a4ee67a175">&#9670;&nbsp;</a></span>find_dl_min_and_max_delay()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC void find_dl_min_and_max_delay </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdownload__status__t.html">download_status_t</a> *&#160;</td>
          <td class="paramname"><em>dls</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>min</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>max</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Decide which minimum and maximum delay step we want to use based on descriptor type in <b>dls</b> and <b>options</b>. Helper function for <a class="el" href="directory_8c.html#ad1fb73884e5ae3df6dea7d1bbb85634d">download_status_schedule_get_delay()</a>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="directory_8c_a65e22ba9f7920ec24c60d3a4ee67a175_cgraph.png" border="0" usemap="#directory_8c_a65e22ba9f7920ec24c60d3a4ee67a175_cgraph" alt=""/></div>
<map name="directory_8c_a65e22ba9f7920ec24c60d3a4ee67a175_cgraph" id="directory_8c_a65e22ba9f7920ec24c60d3a4ee67a175_cgraph">
<area shape="rect" id="node2" href="directory_8c.html#af6977c51923b32ba38e29dcf72163d1d" title="find_dl_schedule" alt="" coords="201,13,320,39"/>
</map>
</div>

</div>
</div>
<a id="af6977c51923b32ba38e29dcf72163d1d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af6977c51923b32ba38e29dcf72163d1d">&#9670;&nbsp;</a></span>find_dl_schedule()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC const <a class="el" href="structsmartlist__t.html">smartlist_t</a>* find_dl_schedule </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdownload__status__t.html">download_status_t</a> *&#160;</td>
          <td class="paramname"><em>dls</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Decide which download schedule we want to use based on descriptor type in <b>dls</b> and <b>options</b>. Then return a list of int pointers defining download delays in seconds. Helper function for <a class="el" href="directory_8c.html#ad030aefd2edb06cac0a0477457631fab">download_status_increment_failure()</a>, <a class="el" href="directory_8c.html#ae0c46dd4ad90ff8350a03414a4d79307">download_status_reset()</a>, and <a class="el" href="directory_8c.html#abfbbd8729f4c0f94b6080020a729bc70">download_status_increment_attempt()</a>. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="directory_8c_af6977c51923b32ba38e29dcf72163d1d_icgraph.png" border="0" usemap="#directory_8c_af6977c51923b32ba38e29dcf72163d1d_icgraph" alt=""/></div>
<map name="directory_8c_af6977c51923b32ba38e29dcf72163d1d_icgraph" id="directory_8c_af6977c51923b32ba38e29dcf72163d1d_icgraph">
<area shape="rect" id="node2" href="directory_8c.html#a65e22ba9f7920ec24c60d3a4ee67a175" title="find_dl_min_and_max\l_delay" alt="" coords="176,5,324,47"/>
<area shape="rect" id="node3" href="directory_8h.html#ae0c46dd4ad90ff8350a03414a4d79307" title="download_status_reset" alt="" coords="172,71,328,98"/>
<area shape="rect" id="node4" href="networkstatus_8h.html#afcfacad25b94db6f21e0df2f7897a3cf" title="routers_update_status\l_from_consensus_networkstatus" alt="" coords="376,64,591,105"/>
<area shape="rect" id="node5" href="routerlist_8h.html#ae08c5697c58be20a7bb11b34ca9aba5e" title="router_load_routers\l_from_string" alt="" coords="639,64,772,105"/>
</map>
</div>

</div>
</div>
<a id="af70528e82e9fdd7992b169feeda182ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af70528e82e9fdd7992b169feeda182ee">&#9670;&nbsp;</a></span>is_sensitive_dir_purpose()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int is_sensitive_dir_purpose </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>dir_purpose</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return non-zero iff a directory connection with purpose <b>dir_purpose</b> reveals sensitive information about a Tor instance's client activities. (Such connections must be performed through normal three-hop Tor circuits.) </p>

</div>
</div>
<a id="a2dcb34e25124200a8694ef07275a50b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2dcb34e25124200a8694ef07275a50b2">&#9670;&nbsp;</a></span>MOCK_IMPL() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MOCK_IMPL </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">directory_get_from_dirserver&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">( uint8_t dir_purpose, uint8_t router_purpose, const char *resource, int pds_flags, <a class="el" href="or_8h.html#a97b0a50b63539850700352c6de8a16c5">download_want_authority_t</a> want_authority)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Start a connection to a random running directory server, using connection purpose <b>dir_purpose</b>, intending to fetch descriptors of purpose <b>router_purpose</b>, and requesting <b>resource</b>. Use <b>pds_flags</b> as arguments to <a class="el" href="routerlist_8c.html#ace83aa582c6836e9a172a8cafa1d4047">router_pick_directory_server()</a> or <a class="el" href="routerlist_8c.html#ad96c8d565baf8a82010f5adfacb99060">router_pick_trusteddirserver()</a>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="directory_8c_a2dcb34e25124200a8694ef07275a50b2_cgraph.png" border="0" usemap="#directory_8c_a2dcb34e25124200a8694ef07275a50b2_cgraph" alt=""/></div>
<map name="directory_8c_a2dcb34e25124200a8694ef07275a50b2_cgraph" id="directory_8c_a2dcb34e25124200a8694ef07275a50b2_cgraph">
<area shape="rect" id="node2" href="dirserv_8c.html#a0b84786e17352524036694baf1955167" title="directory_fetches_from\l_authorities" alt="" coords="153,35,308,76"/>
<area shape="rect" id="node3" href="router_8c.html#afa75de94186fffc8f373de610ae4cab3" title="should_refuse_unknown\l_exits" alt="" coords="356,5,519,47"/>
<area shape="rect" id="node5" href="router_8c.html#ab23297b12b098da9eac98126a587aa3b" title="dir_server_mode" alt="" coords="378,71,497,98"/>
<area shape="rect" id="node4" href="networkstatus_8c.html#aba1790be4b1cea243c3dac989ad1b05c" title="networkstatus_get_param" alt="" coords="567,13,739,39"/>
</map>
</div>

</div>
</div>
<a id="a73ef1e03e77e562991ea7237f61f7c36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73ef1e03e77e562991ea7237f61f7c36">&#9670;&nbsp;</a></span>MOCK_IMPL() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MOCK_IMPL </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">directory_initiate_command_routerstatus&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">(const <a class="el" href="structrouterstatus__t.html">routerstatus_t</a> *status, uint8_t dir_purpose, uint8_t router_purpose, <a class="el" href="directory_8h.html#a1c9628f500a2efb8bacf72a85faf121b">dir_indirection_t</a> indirection, const char *resource, const char *payload, size_t payload_len, time_t if_modified_since)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Launch a new connection to the directory server <b>status</b> to upload or download a server or rendezvous descriptor. <b>dir_purpose</b> determines what kind of directory connection we're launching, and must be one of DIR_PURPOSE_{FETCH|UPLOAD}_{DIR|RENDDESC_V2}. <b>router_purpose</b> specifies the descriptor purposes we have in mind (currently only used for FETCH_DIR).</p>
<p>When uploading, <b>payload</b> and <b>payload_len</b> determine the content of the HTTP post. Otherwise, <b>payload</b> should be NULL.</p>
<p>When fetching a rendezvous descriptor, <b>resource</b> is the service ID we want to fetch. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="directory_8c_a73ef1e03e77e562991ea7237f61f7c36_cgraph.png" border="0" usemap="#directory_8c_a73ef1e03e77e562991ea7237f61f7c36_cgraph" alt=""/></div>
<map name="directory_8c_a73ef1e03e77e562991ea7237f61f7c36_cgraph" id="directory_8c_a73ef1e03e77e562991ea7237f61f7c36_cgraph">
<area shape="rect" id="node2" href="directory_8c.html#a57800839006f921803cc3087b9ba59c9" title="directory_initiate\l_command_routerstatus_rend" alt="" coords="153,5,348,47"/>
</map>
</div>

</div>
</div>
<a id="a4dc34a1e327bdae7977864ddab34b66e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4dc34a1e327bdae7977864ddab34b66e">&#9670;&nbsp;</a></span>next_random_exponential_delay()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC int next_random_exponential_delay </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>delay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>max_delay</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Advance one delay step. The algorithm is to use the previous delay to compute an increment, we construct a value uniformly at random between delay and MAX(delay*2,delay+1). We then clamp that value to be no larger than max_delay, and return it.</p>
<p>Requires that delay is less than INT_MAX, and delay is in [0,max_delay]. </p>

</div>
</div>
<a id="a4786f539a53422cb5ce22c6036766c15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4786f539a53422cb5ce22c6036766c15">&#9670;&nbsp;</a></span>parse_http_response()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int parse_http_response </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>headers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>code</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t *&#160;</td>
          <td class="paramname"><em>date</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="torgzip_8h.html#a97a284cf1b98eccbe7964617ed797eee">compress_method_t</a> *&#160;</td>
          <td class="paramname"><em>compression</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>reason</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Parse an HTTP response string <b>headers</b> of the form </p><pre class="fragment">* "HTTP/1.\%d \%d\%s\r\n...".
* </pre><p>If it's well-formed, assign the status code to *<b>code</b> and return 0. Otherwise, return -1.</p>
<p>On success: If <b>date</b> is provided, set *date to the Date header in the http headers, or 0 if no such header is found. If <b>compression</b> is provided, set *<b>compression</b> to the compression method given in the Content-Encoding header, or 0 if no such header is found, or -1 if the value of the header is not recognized. If <b>reason</b> is provided, strdup the reason string into it. </p>

</div>
</div>
<a id="a2ab1c7dcfde852c520eb496643fdc865"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ab1c7dcfde852c520eb496643fdc865">&#9670;&nbsp;</a></span>parse_http_url()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC int parse_http_url </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>headers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>url</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Parse an HTTP request string <b>headers</b> of the form </p><pre class="fragment">* "\%s [http[s]://]\%s HTTP/1..."
* </pre><p> If it's well-formed, strdup the second %s into *<b>url</b>, and nul-terminate it. If the url doesn't start with "/tor/", rewrite it so it does. Return 0. Otherwise, return -1. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="directory_8c_a2ab1c7dcfde852c520eb496643fdc865_cgraph.png" border="0" usemap="#directory_8c_a2ab1c7dcfde852c520eb496643fdc865_cgraph" alt=""/></div>
<map name="directory_8c_a2ab1c7dcfde852c520eb496643fdc865_cgraph" id="directory_8c_a2ab1c7dcfde852c520eb496643fdc865_cgraph">
<area shape="rect" id="node2" href="util_8c.html#ab838c820246f358bc0b99884154b2704" title="eat_whitespace_no_nl" alt="" coords="157,5,308,32"/>
<area shape="rect" id="node3" href="util_8c.html#a34984f08eb3eef95438b8e65226dff8e" title="find_whitespace" alt="" coords="175,56,291,83"/>
<area shape="rect" id="node4" href="util_8c.html#a245aaefd9d8715af06ce0f7b7355fd0d" title="strcmpstart" alt="" coords="189,107,277,133"/>
</map>
</div>

</div>
</div>
<a id="a9295a0181da0aabb17bd451f4b24f9bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9295a0181da0aabb17bd451f4b24f9bb">&#9670;&nbsp;</a></span>purpose_needs_anonymity()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int purpose_needs_anonymity </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>dir_purpose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>router_purpose</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff the directory purpose <b>dir_purpose</b> (and if it's fetching descriptors, it's fetching them for <b>router_purpose</b>) must use an anonymous connection to a directory. </p>

</div>
</div>
<a id="ae222b3f260cc42ea120a438c2d4efc4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae222b3f260cc42ea120a438c2d4efc4a">&#9670;&nbsp;</a></span>router_supports_extrainfo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int router_supports_extrainfo </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>identity_digest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>is_authority</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff <b>identity_digest</b> is the digest of a router which says that it caches extrainfos. (If <b>is_authority</b> we always believe that to be true.) </p>

</div>
</div>
<a id="a4e70476c39b897c87ee7623617f43e78"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e70476c39b897c87ee7623617f43e78">&#9670;&nbsp;</a></span>should_use_directory_guards()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC int should_use_directory_guards </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff, according to the values in <b>options</b>, we should be using directory guards for direct downloads of directory information. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
