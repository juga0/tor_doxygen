<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tor: /home/user/_my/code/bwauth-related/tor/src/or/dirserv.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tor
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97b64286d42c5ef1697cb5f17129db19.html">tor</a></li><li class="navelem"><a class="el" href="dir_3cb0ba3f4b82dbe34a1a06276e96bc8d.html">src</a></li><li class="navelem"><a class="el" href="dir_386635fabd7f6c74e9d9c7a8604514a0.html">or</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">dirserv.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Header file for <a class="el" href="dirserv_8c.html" title="Directory server core implementation. Manages directory contents and generates directories. ">dirserv.c</a>.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;testsupport.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for dirserv.h:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2dirserv_8h" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2dirserv_8h" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2dirserv_8h">
<area shape="rect" id="node2" href="testsupport_8h_source.html" title="testsupport.h" alt="" coords="30,109,129,136"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h__dep__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2dirserv_8hdep" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2dirserv_8hdep" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2dirserv_8hdep">
<area shape="rect" id="node2" href="config_8c.html" title="Code to interpret the user&#39;s configuration of Tor. " alt="" coords="5,109,153,165"/>
<area shape="rect" id="node3" href="connection_8c.html" title="General high&#45;level functions to handle reading and writing on connections. " alt="" coords="177,109,325,165"/>
<area shape="rect" id="node4" href="connection__edge_8c.html" title="Handle edge streams. " alt="" coords="349,109,521,165"/>
<area shape="rect" id="node5" href="connection__or_8c.html" title="Functions to handle OR connections, TLS handshaking, and cells on the network. " alt="" coords="546,109,701,165"/>
<area shape="rect" id="node6" href="control_8c.html" title="Implementation for Tor&#39;s control&#45;socket interface. " alt="" coords="725,109,873,165"/>
<area shape="rect" id="node7" href="dirvote_8c.html" title="Functions to compute directory consensus, and schedule voting. " alt="" coords="897,109,1053,165"/>
<area shape="rect" id="node8" href="directory_8c.html" title="Code to send and fetch information from directory authorities and caches via HTTP. " alt="" coords="1077,109,1225,165"/>
<area shape="rect" id="node9" href="dirserv_8c.html" title="Directory server core implementation. Manages directory contents and generates directories. " alt="" coords="1249,109,1397,165"/>
<area shape="rect" id="node10" href="main_8c.html" title="Toplevel module. Handles signals, multiplexes between connections, implements main loop..." alt="" coords="1421,109,1569,165"/>
<area shape="rect" id="node11" href="microdesc_8c.html" title="Implements microdescriptors â€“ an abbreviated description of less&#45;frequently&#45;changing router informat..." alt="" coords="1593,109,1741,165"/>
<area shape="rect" id="node12" href="networkstatus_8c.html" title="Functions and structures for handling networkstatus documents as a client or as a directory cache..." alt="" coords="1765,109,1921,165"/>
<area shape="rect" id="node13" href="nodelist_8c.html" title="Structures and functions for tracking what we know about the routers on the Tor network, and correlating information from networkstatus, routerinfo, and microdescs. " alt="" coords="1945,109,2093,165"/>
<area shape="rect" id="node14" href="policies_8c.html" title="Code to parse and use address policies and exit policies. " alt="" coords="2117,109,2265,165"/>
<area shape="rect" id="node15" href="router_8c.html" title="Miscellaneous relay functionality, including RSA key maintenance, generating and uploading server des..." alt="" coords="2289,109,2437,165"/>
<area shape="rect" id="node16" href="routerlist_8c.html" title="Code to maintain and access the global list of routerinfos for known servers. " alt="" coords="2461,109,2609,165"/>
<area shape="rect" id="node17" href="routerparse_8c.html" title="Code to parse and validate router descriptors, consenus directories, and similar objects. " alt="" coords="2633,109,2781,165"/>
</map>
</div>
</div>
<p><a href="dirserv_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structspooled__resource__t.html">spooled_resource_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a460bca98a2dc94ec6f28a6ec8b9d91a7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a460bca98a2dc94ec6f28a6ec8b9d91a7">REACHABILITY_MODULO_PER_TEST</a>&#160;&#160;&#160;128</td></tr>
<tr class="separator:a460bca98a2dc94ec6f28a6ec8b9d91a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa826f853ba4b903aae3f16cbed80af92"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#aa826f853ba4b903aae3f16cbed80af92">REACHABILITY_TEST_INTERVAL</a>&#160;&#160;&#160;10</td></tr>
<tr class="separator:aa826f853ba4b903aae3f16cbed80af92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b38eb1a359c1bf06d5715d5e4afadb1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a8b38eb1a359c1bf06d5715d5e4afadb1">REACHABILITY_TEST_CYCLE_PERIOD</a>&#160;&#160;&#160;(<a class="el" href="dirserv_8h.html#aa826f853ba4b903aae3f16cbed80af92">REACHABILITY_TEST_INTERVAL</a>*<a class="el" href="dirserv_8h.html#a460bca98a2dc94ec6f28a6ec8b9d91a7">REACHABILITY_MODULO_PER_TEST</a>)</td></tr>
<tr class="separator:a8b38eb1a359c1bf06d5715d5e4afadb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14d9fd5cb272eb723bd44ae2561cc8e0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a14d9fd5cb272eb723bd44ae2561cc8e0">MAX_EXITPOLICY_SUMMARY_LEN</a>&#160;&#160;&#160;1000</td></tr>
<tr class="separator:a14d9fd5cb272eb723bd44ae2561cc8e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a54c4e418a55ed8ad31091843e7f171"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a4a54c4e418a55ed8ad31091843e7f171">MAX_V_LINE_LEN</a>&#160;&#160;&#160;128</td></tr>
<tr class="separator:a4a54c4e418a55ed8ad31091843e7f171"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2af1b33086deef68bcd0d93c72f6ea35"><td class="memItemLeft" align="right" valign="top"><a id="a2af1b33086deef68bcd0d93c72f6ea35"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>dir_spool_source_bitfield_t</b>&#160;&#160;&#160;ENUM_BF(<a class="el" href="dirserv_8h.html#aac355320fd3daf8319b7fb1839c976d3">dir_spool_source_t</a>)</td></tr>
<tr class="separator:a2af1b33086deef68bcd0d93c72f6ea35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31f7b13e60edc7de9fe9fbc651ea5708"><td class="memItemLeft" align="right" valign="top"><a id="a31f7b13e60edc7de9fe9fbc651ea5708"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>spooled_resource_free</b>(sp)&#160;&#160;&#160;FREE_AND_NULL(<a class="el" href="structspooled__resource__t.html">spooled_resource_t</a>, <a class="el" href="dirserv_8h.html#a63449de198177a1fbd1f1365bab914a2">spooled_resource_free_</a>, (sp))</td></tr>
<tr class="separator:a31f7b13e60edc7de9fe9fbc651ea5708"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a3f6d564551372078d175179e883db693"><td class="memItemLeft" align="right" valign="top">typedef enum <a class="el" href="dirserv_8h.html#aac355320fd3daf8319b7fb1839c976d3">dir_spool_source_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a3f6d564551372078d175179e883db693">dir_spool_source_t</a></td></tr>
<tr class="separator:a3f6d564551372078d175179e883db693"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf27c2014f1f1b30b7da7194945055f8"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structspooled__resource__t.html">spooled_resource_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#abf27c2014f1f1b30b7da7194945055f8">spooled_resource_t</a></td></tr>
<tr class="separator:abf27c2014f1f1b30b7da7194945055f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:aac355320fd3daf8319b7fb1839c976d3"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#aac355320fd3daf8319b7fb1839c976d3">dir_spool_source_t</a> { <br />
&#160;&#160;<b>DIR_SPOOL_SERVER_BY_DIGEST</b> =1, 
<b>DIR_SPOOL_SERVER_BY_FP</b>, 
<b>DIR_SPOOL_EXTRA_BY_DIGEST</b>, 
<b>DIR_SPOOL_EXTRA_BY_FP</b>, 
<br />
&#160;&#160;<b>DIR_SPOOL_MICRODESC</b>, 
<b>DIR_SPOOL_NETWORKSTATUS</b>, 
<b>DIR_SPOOL_CONSENSUS_CACHE_ENTRY</b>
<br />
 }</td></tr>
<tr class="separator:aac355320fd3daf8319b7fb1839c976d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:acb9b2ed7234ed40438a3a5406c823c36"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#acb9b2ed7234ed40438a3a5406c823c36">connection_dirserv_flushed_some</a> (<a class="el" href="structdir__connection__t.html">dir_connection_t</a> *conn)</td></tr>
<tr class="separator:acb9b2ed7234ed40438a3a5406c823c36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95deb3d9d5367525bb51127b82269c87"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a95deb3d9d5367525bb51127b82269c87">dirserv_add_own_fingerprint</a> (<a class="el" href="structcrypto__pk__t.html">crypto_pk_t</a> *pk)</td></tr>
<tr class="separator:a95deb3d9d5367525bb51127b82269c87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a258a245ff1505a9ea50b06de2b3e490f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a258a245ff1505a9ea50b06de2b3e490f">dirserv_load_fingerprint_file</a> (void)</td></tr>
<tr class="separator:a258a245ff1505a9ea50b06de2b3e490f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a952a2a3f8acd42cdebbae8631123cf1c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a952a2a3f8acd42cdebbae8631123cf1c">dirserv_free_fingerprint_list</a> (void)</td></tr>
<tr class="separator:a952a2a3f8acd42cdebbae8631123cf1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a917ddd9c8bf085d8742afdf78d2a578c"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="or_8h.html#a7c96814e647f1b5b99e501ea5763842f">was_router_added_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a917ddd9c8bf085d8742afdf78d2a578c">dirserv_add_multiple_descriptors</a> (const char *desc, uint8_t purpose, const char *source, const char **msg)</td></tr>
<tr class="separator:a917ddd9c8bf085d8742afdf78d2a578c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a1e4335b7ab9518991addf3876fb0f0"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="or_8h.html#a7c96814e647f1b5b99e501ea5763842f">was_router_added_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a7a1e4335b7ab9518991addf3876fb0f0">dirserv_add_descriptor</a> (<a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *ri, const char **msg, const char *source)</td></tr>
<tr class="separator:a7a1e4335b7ab9518991addf3876fb0f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1772dc2a4a12cc0eb181d1f52c5a54a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#ad1772dc2a4a12cc0eb181d1f52c5a54a">dirserv_set_router_is_running</a> (<a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *router, time_t now)</td></tr>
<tr class="separator:ad1772dc2a4a12cc0eb181d1f52c5a54a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c7009f040e0a812c40a6ae0fa6efd79"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a6c7009f040e0a812c40a6ae0fa6efd79">list_server_status_v1</a> (<a class="el" href="structsmartlist__t.html">smartlist_t</a> *routers, char **router_status_out, int for_controller)</td></tr>
<tr class="separator:a6c7009f040e0a812c40a6ae0fa6efd79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5be126c4926e7257fa5fbe5463ff4a6a"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a5be126c4926e7257fa5fbe5463ff4a6a">dirserv_get_flag_thresholds_line</a> (void)</td></tr>
<tr class="separator:a5be126c4926e7257fa5fbe5463ff4a6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78aaa46964aad7d9769b54157d9814e1"><td class="memItemLeft" align="right" valign="top"><a id="a78aaa46964aad7d9769b54157d9814e1"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>dirserv_compute_bridge_flag_thresholds</b> (void)</td></tr>
<tr class="separator:a78aaa46964aad7d9769b54157d9814e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b84786e17352524036694baf1955167"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a0b84786e17352524036694baf1955167">directory_fetches_from_authorities</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:a0b84786e17352524036694baf1955167"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab38d643312052d4bfdb7d49dcba344a6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#ab38d643312052d4bfdb7d49dcba344a6">directory_fetches_dir_info_early</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:ab38d643312052d4bfdb7d49dcba344a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6172633152c7a88c49556085a2538f6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#ab6172633152c7a88c49556085a2538f6">directory_fetches_dir_info_later</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:ab6172633152c7a88c49556085a2538f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a9cf7f465217dbc8142aaf11384abbf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a5a9cf7f465217dbc8142aaf11384abbf">directory_caches_unknown_auth_certs</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:a5a9cf7f465217dbc8142aaf11384abbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57e2ff1ad2ea65abe9b969ad3d76a418"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a57e2ff1ad2ea65abe9b969ad3d76a418">directory_caches_dir_info</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:a57e2ff1ad2ea65abe9b969ad3d76a418"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7923860b3a8c27fa48c4dcec6ef6939f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a7923860b3a8c27fa48c4dcec6ef6939f">directory_permits_begindir_requests</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:a7923860b3a8c27fa48c4dcec6ef6939f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c5edbbd6883a33af3d72bfead4033db"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a2c5edbbd6883a33af3d72bfead4033db">directory_too_idle_to_fetch_descriptors</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options, time_t now)</td></tr>
<tr class="separator:a2c5edbbd6883a33af3d72bfead4033db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f07c36cfc3121034f466d7cb6d27630"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structcached__dir__t.html">cached_dir_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a0f07c36cfc3121034f466d7cb6d27630">dirserv_get_consensus</a> (const char *flavor_name)</td></tr>
<tr class="separator:a0f07c36cfc3121034f466d7cb6d27630"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ae8f9b0f02056a69bd8c92adda96579"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a4ae8f9b0f02056a69bd8c92adda96579">dirserv_set_cached_consensus_networkstatus</a> (const char *consensus, const char *flavor_name, const <a class="el" href="structcommon__digests__t.html">common_digests_t</a> *digests, const uint8_t *sha3_as_signed, time_t published)</td></tr>
<tr class="separator:a4ae8f9b0f02056a69bd8c92adda96579"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad28d0f05f20806afdff9990eb3ee1f22"><td class="memItemLeft" align="right" valign="top"><a id="ad28d0f05f20806afdff9990eb3ee1f22"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>dirserv_clear_old_networkstatuses</b> (time_t cutoff)</td></tr>
<tr class="separator:ad28d0f05f20806afdff9990eb3ee1f22"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e2cb1b422b5391b4b128813aac0971c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a2e2cb1b422b5391b4b128813aac0971c">dirserv_get_routerdesc_spool</a> (<a class="el" href="structsmartlist__t.html">smartlist_t</a> *spools_out, const char *key, <a class="el" href="dirserv_8h.html#aac355320fd3daf8319b7fb1839c976d3">dir_spool_source_t</a> source, int conn_is_encrypted, const char **msg_out)</td></tr>
<tr class="separator:a2e2cb1b422b5391b4b128813aac0971c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8fca5a38cd000d8ccabe5bc73e296bb2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a8fca5a38cd000d8ccabe5bc73e296bb2">dirserv_get_routerdescs</a> (<a class="el" href="structsmartlist__t.html">smartlist_t</a> *descs_out, const char *key, const char **msg)</td></tr>
<tr class="separator:a8fca5a38cd000d8ccabe5bc73e296bb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b981b610d4a3344b17a55300072ef66"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a2b981b610d4a3344b17a55300072ef66">dirserv_orconn_tls_done</a> (const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *addr, uint16_t or_port, const char *digest_rcvd, const <a class="el" href="structed25519__public__key__t.html">ed25519_public_key_t</a> *ed_id_rcvd)</td></tr>
<tr class="separator:a2b981b610d4a3344b17a55300072ef66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c97fbc43a4398a45feb2fafa3d42fc1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a0c97fbc43a4398a45feb2fafa3d42fc1">dirserv_should_launch_reachability_test</a> (const <a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *ri, const <a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *ri_old)</td></tr>
<tr class="separator:a0c97fbc43a4398a45feb2fafa3d42fc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87235a887afe2a5f796bd9a88b474909"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a87235a887afe2a5f796bd9a88b474909">dirserv_single_reachability_test</a> (time_t now, <a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *router)</td></tr>
<tr class="separator:a87235a887afe2a5f796bd9a88b474909"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac91a65fca7d877c033a594a96203ad7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#aac91a65fca7d877c033a594a96203ad7">dirserv_test_reachability</a> (time_t now)</td></tr>
<tr class="separator:aac91a65fca7d877c033a594a96203ad7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adaceacf408562b95dd1169799995bd6c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#adaceacf408562b95dd1169799995bd6c">authdir_wants_to_reject_router</a> (<a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *ri, const char **msg, int complain, int *valid_out)</td></tr>
<tr class="separator:adaceacf408562b95dd1169799995bd6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95906070553304c94a590affb671223e"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a95906070553304c94a590affb671223e">dirserv_router_get_status</a> (const <a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *router, const char **msg, int severity)</td></tr>
<tr class="separator:a95906070553304c94a590affb671223e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f2508c28e6b8a1d7b9ae921598a9860"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a5f2508c28e6b8a1d7b9ae921598a9860">dirserv_set_node_flags_from_authoritative_status</a> (<a class="el" href="structnode__t.html">node_t</a> *node, uint32_t authstatus)</td></tr>
<tr class="separator:a5f2508c28e6b8a1d7b9ae921598a9860"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abbb851f560879781b07f4b99762f45b3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#abbb851f560879781b07f4b99762f45b3">dirserv_would_reject_router</a> (const <a class="el" href="structrouterstatus__t.html">routerstatus_t</a> *rs)</td></tr>
<tr class="separator:abbb851f560879781b07f4b99762f45b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a462a8ae7270a4bea92c8d6269e7489db"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a462a8ae7270a4bea92c8d6269e7489db">routerstatus_format_entry</a> (const <a class="el" href="structrouterstatus__t.html">routerstatus_t</a> *rs, const char *version, const char *protocols, <a class="el" href="or_8h.html#a46368555a0446803c7acfd3b8230adef">routerstatus_format_type_t</a> format, int consensus_method, const <a class="el" href="structvote__routerstatus__t.html">vote_routerstatus_t</a> *vrs)</td></tr>
<tr class="separator:a462a8ae7270a4bea92c8d6269e7489db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa86c752d8d8f446eba40db2d0c2269a7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#aa86c752d8d8f446eba40db2d0c2269a7">dirserv_free_all</a> (void)</td></tr>
<tr class="separator:aa86c752d8d8f446eba40db2d0c2269a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a079db5d58a49010fe8b2944ecb3189bd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a079db5d58a49010fe8b2944ecb3189bd">cached_dir_decref</a> (<a class="el" href="structcached__dir__t.html">cached_dir_t</a> *d)</td></tr>
<tr class="separator:a079db5d58a49010fe8b2944ecb3189bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f9b702470f577e3b47d852f664e7d2b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structcached__dir__t.html">cached_dir_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a1f9b702470f577e3b47d852f664e7d2b">new_cached_dir</a> (char *s, time_t published)</td></tr>
<tr class="separator:a1f9b702470f577e3b47d852f664e7d2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4f82bd716ec94f012312bf508728269"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#ae4f82bd716ec94f012312bf508728269">validate_recommended_package_line</a> (const char *line)</td></tr>
<tr class="separator:ae4f82bd716ec94f012312bf508728269"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab83fe95748f2a7626fbb05f2ada5896e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#ab83fe95748f2a7626fbb05f2ada5896e">dirserv_query_measured_bw_cache_kb</a> (const char *node_id, long *bw_out, time_t *as_of_out)</td></tr>
<tr class="separator:ab83fe95748f2a7626fbb05f2ada5896e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af70a376b32a1d064cb589d81fa2f64d3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#af70a376b32a1d064cb589d81fa2f64d3">dirserv_clear_measured_bw_cache</a> (void)</td></tr>
<tr class="separator:af70a376b32a1d064cb589d81fa2f64d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab77a8f39d9154260c0c9ab4abcaa1a58"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#ab77a8f39d9154260c0c9ab4abcaa1a58">dirserv_has_measured_bw</a> (const char *node_id)</td></tr>
<tr class="separator:ab77a8f39d9154260c0c9ab4abcaa1a58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a58cd8f1b1e22a024a25ec69c3a64ac"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a2a58cd8f1b1e22a024a25ec69c3a64ac">dirserv_get_measured_bw_cache_size</a> (void)</td></tr>
<tr class="separator:a2a58cd8f1b1e22a024a25ec69c3a64ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5bf5f153e699ad278fca9fb9371b2b0c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a5bf5f153e699ad278fca9fb9371b2b0c">dirserv_count_measured_bws</a> (const <a class="el" href="structsmartlist__t.html">smartlist_t</a> *routers)</td></tr>
<tr class="separator:a5bf5f153e699ad278fca9fb9371b2b0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20cd245581c919c471e9f6689e4b05dc"><td class="memItemLeft" align="right" valign="top"><a id="a20cd245581c919c471e9f6689e4b05dc"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>running_long_enough_to_decide_unreachable</b> (void)</td></tr>
<tr class="separator:a20cd245581c919c471e9f6689e4b05dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6254e57429acb014cb8026a0cd8cc087"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a6254e57429acb014cb8026a0cd8cc087">dirserv_compute_performance_thresholds</a> (digestmap_t *omit_as_sybil)</td></tr>
<tr class="separator:a6254e57429acb014cb8026a0cd8cc087"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af364b236821a07880cc8dc54e98ca999"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#af364b236821a07880cc8dc54e98ca999">dirserv_read_measured_bandwidths</a> (const char *from_file, <a class="el" href="structsmartlist__t.html">smartlist_t</a> *routerstatuses)</td></tr>
<tr class="separator:af364b236821a07880cc8dc54e98ca999"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50e06fc916d8cbcc3ccfb7f919cb6928"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a50e06fc916d8cbcc3ccfb7f919cb6928">dirserv_read_guardfraction_file</a> (const char *fname, <a class="el" href="structsmartlist__t.html">smartlist_t</a> *vote_routerstatuses)</td></tr>
<tr class="separator:a50e06fc916d8cbcc3ccfb7f919cb6928"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ca4869b09fd8ffcff92515684788a64"><td class="memItemLeft" align="right" valign="top"><a id="a7ca4869b09fd8ffcff92515684788a64"></a>
<a class="el" href="structspooled__resource__t.html">spooled_resource_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>spooled_resource_new</b> (<a class="el" href="dirserv_8h.html#aac355320fd3daf8319b7fb1839c976d3">dir_spool_source_t</a> source, const uint8_t *digest, size_t digestlen)</td></tr>
<tr class="separator:a7ca4869b09fd8ffcff92515684788a64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78f90a90dabba118a3beb3130c9c66c7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structspooled__resource__t.html">spooled_resource_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a78f90a90dabba118a3beb3130c9c66c7">spooled_resource_new_from_cache_entry</a> (struct <a class="el" href="structconsensus__cache__entry__t.html">consensus_cache_entry_t</a> *entry)</td></tr>
<tr class="separator:a78f90a90dabba118a3beb3130c9c66c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63449de198177a1fbd1f1365bab914a2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a63449de198177a1fbd1f1365bab914a2">spooled_resource_free_</a> (<a class="el" href="structspooled__resource__t.html">spooled_resource_t</a> *spooled)</td></tr>
<tr class="separator:a63449de198177a1fbd1f1365bab914a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37b7370c96e2e908512aea4ea2b3f458"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a37b7370c96e2e908512aea4ea2b3f458">dirserv_spool_remove_missing_and_guess_size</a> (<a class="el" href="structdir__connection__t.html">dir_connection_t</a> *conn, time_t cutoff, int compression, size_t *size_out, int *n_expired_out)</td></tr>
<tr class="separator:a37b7370c96e2e908512aea4ea2b3f458"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a126be24e35ded1467ae68c81afee15bf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a126be24e35ded1467ae68c81afee15bf">dirserv_spool_sort</a> (<a class="el" href="structdir__connection__t.html">dir_connection_t</a> *conn)</td></tr>
<tr class="separator:a126be24e35ded1467ae68c81afee15bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ff1a515883ea205753feb2f410cbea6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8h.html#a8ff1a515883ea205753feb2f410cbea6">dir_conn_clear_spool</a> (<a class="el" href="structdir__connection__t.html">dir_connection_t</a> *conn)</td></tr>
<tr class="separator:a8ff1a515883ea205753feb2f410cbea6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Header file for <a class="el" href="dirserv_8c.html" title="Directory server core implementation. Manages directory contents and generates directories. ">dirserv.c</a>. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a14d9fd5cb272eb723bd44ae2561cc8e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14d9fd5cb272eb723bd44ae2561cc8e0">&#9670;&nbsp;</a></span>MAX_EXITPOLICY_SUMMARY_LEN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_EXITPOLICY_SUMMARY_LEN&#160;&#160;&#160;1000</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Maximum length of an exit policy summary. </p>

</div>
</div>
<a id="a4a54c4e418a55ed8ad31091843e7f171"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a54c4e418a55ed8ad31091843e7f171">&#9670;&nbsp;</a></span>MAX_V_LINE_LEN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_V_LINE_LEN&#160;&#160;&#160;128</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Maximum allowable length of a version line in a networkstatus. </p>

</div>
</div>
<a id="a460bca98a2dc94ec6f28a6ec8b9d91a7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a460bca98a2dc94ec6f28a6ec8b9d91a7">&#9670;&nbsp;</a></span>REACHABILITY_MODULO_PER_TEST</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define REACHABILITY_MODULO_PER_TEST&#160;&#160;&#160;128</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>What fraction (1 over this number) of the relay ID space do we (as a directory authority) launch connections to at each reachability test? </p>

</div>
</div>
<a id="a8b38eb1a359c1bf06d5715d5e4afadb1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b38eb1a359c1bf06d5715d5e4afadb1">&#9670;&nbsp;</a></span>REACHABILITY_TEST_CYCLE_PERIOD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define REACHABILITY_TEST_CYCLE_PERIOD&#160;&#160;&#160;(<a class="el" href="dirserv_8h.html#aa826f853ba4b903aae3f16cbed80af92">REACHABILITY_TEST_INTERVAL</a>*<a class="el" href="dirserv_8h.html#a460bca98a2dc94ec6f28a6ec8b9d91a7">REACHABILITY_MODULO_PER_TEST</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>How many seconds apart are the reachability tests for a given relay? </p>

</div>
</div>
<a id="aa826f853ba4b903aae3f16cbed80af92"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa826f853ba4b903aae3f16cbed80af92">&#9670;&nbsp;</a></span>REACHABILITY_TEST_INTERVAL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define REACHABILITY_TEST_INTERVAL&#160;&#160;&#160;10</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>How often (in seconds) do we launch reachability tests? </p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a3f6d564551372078d175179e883db693"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f6d564551372078d175179e883db693">&#9670;&nbsp;</a></span>dir_spool_source_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef enum <a class="el" href="dirserv_8h.html#aac355320fd3daf8319b7fb1839c976d3">dir_spool_source_t</a>  <a class="el" href="dirserv_8h.html#aac355320fd3daf8319b7fb1839c976d3">dir_spool_source_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Ways to convert a spoolable_resource_t to a bunch of bytes. </p>

</div>
</div>
<a id="abf27c2014f1f1b30b7da7194945055f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf27c2014f1f1b30b7da7194945055f8">&#9670;&nbsp;</a></span>spooled_resource_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structspooled__resource__t.html">spooled_resource_t</a>  <a class="el" href="structspooled__resource__t.html">spooled_resource_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Object to remember the identity of an object that we are spooling, or about to spool, in response to a directory request.</p>
<p>(Why do we spool? Because some directory responses are very large, and we don't want to just shove the complete answer into the output buffer: that would take a ridiculous amount of RAM.)</p>
<p>If the spooled resource is relatively small (like microdescriptors, descriptors, etc), we look them up by ID as needed, and add the whole thing onto the output buffer at once. If the spooled reseource is big (like networkstatus documents), we reference-count it, and add it a few K at a time. </p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="aac355320fd3daf8319b7fb1839c976d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac355320fd3daf8319b7fb1839c976d3">&#9670;&nbsp;</a></span>dir_spool_source_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="dirserv_8h.html#aac355320fd3daf8319b7fb1839c976d3">dir_spool_source_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Ways to convert a spoolable_resource_t to a bunch of bytes. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="adaceacf408562b95dd1169799995bd6c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adaceacf408562b95dd1169799995bd6c">&#9670;&nbsp;</a></span>authdir_wants_to_reject_router()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int authdir_wants_to_reject_router </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>complain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>valid_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Check whether we, as a directory server, want to accept <b>ri</b>. If so, set its is_valid,running fields and return 0. Otherwise, return -1.</p>
<p>If the router is rejected, set *<b>msg</b> to an explanation of why.</p>
<p>If <b>complain</b> then explain at log-level 'notice' why we refused a descriptor; else explain at log-level 'info'. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_adaceacf408562b95dd1169799995bd6c_cgraph.png" border="0" usemap="#dirserv_8h_adaceacf408562b95dd1169799995bd6c_cgraph" alt=""/></div>
<map name="dirserv_8h_adaceacf408562b95dd1169799995bd6c_cgraph" id="dirserv_8h_adaceacf408562b95dd1169799995bd6c_cgraph">
<area shape="rect" id="node2" href="dirserv_8c.html#a95906070553304c94a590affb671223e" title="dirserv_router_get\l_status" alt="" coords="213,30,340,71"/>
<area shape="rect" id="node5" href="router_8c.html#a4d59ce576eb8716561e1bc6be6f88de1" title="router_describe" alt="" coords="221,107,332,133"/>
<area shape="rect" id="node12" href="routerlist_8c.html#afd620fb5cbc29f6895ae016c0240d9a6" title="esc_router_info" alt="" coords="221,157,332,184"/>
<area shape="rect" id="node3" href="crypto__rsa_8c.html#a91336077a5062618ff895dae4e50079d" title="crypto_pk_get_digest" alt="" coords="397,16,543,43"/>
<area shape="rect" id="node4" href="crypto__rsa_8c.html#a47b1080a7a68f04e0e745168075c235f" title="crypto_pk_keysize" alt="" coords="600,5,731,32"/>
<area shape="rect" id="node6" href="router_8c.html#a54ab47db660fac7decf06081ba29f8dd" title="format_node_description" alt="" coords="388,107,552,133"/>
<area shape="rect" id="node7" href="util__format_8c.html#a8b8940b2ef607928eb3dca4850567ea5" title="base16_encode" alt="" coords="609,56,722,83"/>
<area shape="rect" id="node8" href="address_8c.html#a2de0e7c83f59d6235f74e76147db6e29" title="tor_addr_to_str" alt="" coords="611,107,720,133"/>
<area shape="rect" id="node9" href="address_8c.html#a78e7adae7e6b4e12cff810f6bd3a4e71" title="tor_inet_ntoa" alt="" coords="617,157,714,184"/>
<area shape="rect" id="node10" href="compat_8c.html#af032ac661214ae28b4f205781a515290" title="tor_snprintf" alt="" coords="779,157,865,184"/>
<area shape="rect" id="node11" href="compat_8c.html#a1df7873b16ae8936d25dfedb706f4ea6" title="tor_vsnprintf" alt="" coords="913,157,1008,184"/>
<area shape="rect" id="node13" href="util_8c.html#ac152e18c6deb4f05823053bb2980a8e4" title="esc_for_log" alt="" coords="425,157,515,184"/>
<area shape="rect" id="node14" href="compat_8c.html#ade97970c1d8a691241adac739c4f9b12" title="tor_asprintf" alt="" coords="427,208,513,235"/>
<area shape="rect" id="node15" href="compat_8c.html#a5ef7a08e8b543c0d61f9ef1081d4c1ea" title="tor_vasprintf" alt="" coords="618,208,713,235"/>
</map>
</div>

</div>
</div>
<a id="a079db5d58a49010fe8b2944ecb3189bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a079db5d58a49010fe8b2944ecb3189bd">&#9670;&nbsp;</a></span>cached_dir_decref()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cached_dir_decref </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structcached__dir__t.html">cached_dir_t</a> *&#160;</td>
          <td class="paramname"><em>d</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Decrement the reference count on <b>d</b>, and free it if it no longer has any references. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a079db5d58a49010fe8b2944ecb3189bd_icgraph.png" border="0" usemap="#dirserv_8h_a079db5d58a49010fe8b2944ecb3189bd_icgraph" alt=""/></div>
<map name="dirserv_8h_a079db5d58a49010fe8b2944ecb3189bd_icgraph" id="dirserv_8h_a079db5d58a49010fe8b2944ecb3189bd_icgraph">
<area shape="rect" id="node2" href="dirserv_8h.html#a63449de198177a1fbd1f1365bab914a2" title="spooled_resource_free_" alt="" coords="181,5,341,32"/>
</map>
</div>

</div>
</div>
<a id="acb9b2ed7234ed40438a3a5406c823c36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb9b2ed7234ed40438a3a5406c823c36">&#9670;&nbsp;</a></span>connection_dirserv_flushed_some()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_dirserv_flushed_some </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdir__connection__t.html">dir_connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Called whenever we have flushed some directory data in state SERVER_WRITING, or whenever we want to fill the buffer with initial directory data (so that subsequent writes will occur, and trigger this function again.)</p>
<p>Return 0 on success, and -1 on failure. </p>

</div>
</div>
<a id="a8ff1a515883ea205753feb2f410cbea6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ff1a515883ea205753feb2f410cbea6">&#9670;&nbsp;</a></span>dir_conn_clear_spool()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dir_conn_clear_spool </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdir__connection__t.html">dir_connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove every element from <b>conn</b>'s outgoing spool, and delete the spool. </p>

</div>
</div>
<a id="a57e2ff1ad2ea65abe9b969ad3d76a418"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57e2ff1ad2ea65abe9b969ad3d76a418">&#9670;&nbsp;</a></span>directory_caches_dir_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int directory_caches_dir_info </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if we want to fetch and serve descriptors, networkstatuses, etc Else return 0. Check options-&gt;DirPort_set and <a class="el" href="dirserv_8c.html#a7923860b3a8c27fa48c4dcec6ef6939f">directory_permits_begindir_requests()</a> to see if we are willing to serve these directory documents to others via the DirPort and begindir-over-ORPort, respectively.</p>
<p>To check if we should fetch documents, use we_want_to_fetch_flavor and we_want_to_fetch_unknown_auth_certs instead of this function. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a57e2ff1ad2ea65abe9b969ad3d76a418_cgraph.png" border="0" usemap="#dirserv_8h_a57e2ff1ad2ea65abe9b969ad3d76a418_cgraph" alt=""/></div>
<map name="dirserv_8h_a57e2ff1ad2ea65abe9b969ad3d76a418_cgraph" id="dirserv_8h_a57e2ff1ad2ea65abe9b969ad3d76a418_cgraph">
<area shape="rect" id="node2" href="router_8c.html#ab23297b12b098da9eac98126a587aa3b" title="dir_server_mode" alt="" coords="246,5,365,32"/>
<area shape="rect" id="node3" href="router_8c.html#afa75de94186fffc8f373de610ae4cab3" title="should_refuse_unknown\l_exits" alt="" coords="224,57,387,98"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a57e2ff1ad2ea65abe9b969ad3d76a418_icgraph.png" border="0" usemap="#dirserv_8h_a57e2ff1ad2ea65abe9b969ad3d76a418_icgraph" alt=""/></div>
<map name="dirserv_8h_a57e2ff1ad2ea65abe9b969ad3d76a418_icgraph" id="dirserv_8h_a57e2ff1ad2ea65abe9b969ad3d76a418_icgraph">
<area shape="rect" id="node2" href="dirserv_8h.html#a2c5edbbd6883a33af3d72bfead4033db" title="directory_too_idle\l_to_fetch_descriptors" alt="" coords="240,28,387,69"/>
<area shape="rect" id="node8" href="microdesc_8h.html#ad9c983a76a2f31a6a843f4df9be7de1d" title="we_fetch_microdescriptors" alt="" coords="224,95,403,122"/>
<area shape="rect" id="node9" href="microdesc_8h.html#a2667d23ef05f514b5bf916791b4a6bbd" title="we_fetch_router_descriptors" alt="" coords="451,151,637,178"/>
<area shape="rect" id="node3" href="main_8h.html#ac64189cc036980dc5785f76d85db9fa6" title="directory_info_has\l_arrived" alt="" coords="1124,5,1252,47"/>
<area shape="rect" id="node4" href="microdesc_8h.html#aad7f413d899b72e58bed8efc0162d8bd" title="update_microdesc_downloads" alt="" coords="685,34,883,61"/>
<area shape="rect" id="node6" href="routerlist_8h.html#a1a7cfda729e27cf26089db2112d21965" title="update_consensus_router\l_descriptor_downloads" alt="" coords="459,85,629,127"/>
<area shape="rect" id="node5" href="routerlist_8h.html#afe7f2c6bcc3135272bc6aa66ec09cd76" title="update_all_descriptor\l_downloads" alt="" coords="931,35,1076,76"/>
<area shape="rect" id="node7" href="routerlist_8h.html#a8b67f737b9ea614297414b26eb3b784c" title="update_router_descriptor\l_downloads" alt="" coords="701,85,867,127"/>
</map>
</div>

</div>
</div>
<a id="a5a9cf7f465217dbc8142aaf11384abbf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a9cf7f465217dbc8142aaf11384abbf">&#9670;&nbsp;</a></span>directory_caches_unknown_auth_certs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int directory_caches_unknown_auth_certs </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff we want to serve certificates for authorities that we don't acknowledge as authorities ourself. Use we_want_to_fetch_unknown_auth_certs to check if we want to fetch and keep these certificates. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a5a9cf7f465217dbc8142aaf11384abbf_cgraph.png" border="0" usemap="#dirserv_8h_a5a9cf7f465217dbc8142aaf11384abbf_cgraph" alt=""/></div>
<map name="dirserv_8h_a5a9cf7f465217dbc8142aaf11384abbf_cgraph" id="dirserv_8h_a5a9cf7f465217dbc8142aaf11384abbf_cgraph">
<area shape="rect" id="node2" href="router_8c.html#ab23297b12b098da9eac98126a587aa3b" title="dir_server_mode" alt="" coords="233,13,352,39"/>
</map>
</div>

</div>
</div>
<a id="ab38d643312052d4bfdb7d49dcba344a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab38d643312052d4bfdb7d49dcba344a6">&#9670;&nbsp;</a></span>directory_fetches_dir_info_early()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int directory_fetches_dir_info_early </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if we should fetch new networkstatuses, descriptors, etc on the "mirror" schedule rather than the "client" schedule. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_ab38d643312052d4bfdb7d49dcba344a6_cgraph.png" border="0" usemap="#dirserv_8h_ab38d643312052d4bfdb7d49dcba344a6_cgraph" alt=""/></div>
<map name="dirserv_8h_ab38d643312052d4bfdb7d49dcba344a6_cgraph" id="dirserv_8h_ab38d643312052d4bfdb7d49dcba344a6_cgraph">
<area shape="rect" id="node2" href="dirserv_8c.html#a0b84786e17352524036694baf1955167" title="directory_fetches_from\l_authorities" alt="" coords="196,35,351,76"/>
<area shape="rect" id="node3" href="router_8c.html#afa75de94186fffc8f373de610ae4cab3" title="should_refuse_unknown\l_exits" alt="" coords="399,5,561,47"/>
<area shape="rect" id="node4" href="router_8c.html#ab23297b12b098da9eac98126a587aa3b" title="dir_server_mode" alt="" coords="421,71,539,98"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_ab38d643312052d4bfdb7d49dcba344a6_icgraph.png" border="0" usemap="#dirserv_8h_ab38d643312052d4bfdb7d49dcba344a6_icgraph" alt=""/></div>
<map name="dirserv_8h_ab38d643312052d4bfdb7d49dcba344a6_icgraph" id="dirserv_8h_ab38d643312052d4bfdb7d49dcba344a6_icgraph">
<area shape="rect" id="node2" href="routerlist_8h.html#a33e8618001c42bd50575051362aaffa2" title="launch_descriptor_downloads" alt="" coords="196,13,389,39"/>
</map>
</div>

</div>
</div>
<a id="ab6172633152c7a88c49556085a2538f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab6172633152c7a88c49556085a2538f6">&#9670;&nbsp;</a></span>directory_fetches_dir_info_later()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int directory_fetches_dir_info_later </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if we should fetch new networkstatuses, descriptors, etc on a very passive schedule &ndash; waiting long enough for ordinary clients to probably have the info we want. These would include bridge users, and maybe others in the future e.g. if a Tor client uses another Tor client as a directory guard. </p>

</div>
</div>
<a id="a0b84786e17352524036694baf1955167"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b84786e17352524036694baf1955167">&#9670;&nbsp;</a></span>directory_fetches_from_authorities()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int directory_fetches_from_authorities </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if we fetch our directory material directly from the authorities, rather than from a mirror. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a0b84786e17352524036694baf1955167_cgraph.png" border="0" usemap="#dirserv_8h_a0b84786e17352524036694baf1955167_cgraph" alt=""/></div>
<map name="dirserv_8h_a0b84786e17352524036694baf1955167_cgraph" id="dirserv_8h_a0b84786e17352524036694baf1955167_cgraph">
<area shape="rect" id="node2" href="router_8c.html#afa75de94186fffc8f373de610ae4cab3" title="should_refuse_unknown\l_exits" alt="" coords="208,5,371,47"/>
<area shape="rect" id="node3" href="router_8c.html#ab23297b12b098da9eac98126a587aa3b" title="dir_server_mode" alt="" coords="230,71,349,98"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a0b84786e17352524036694baf1955167_icgraph.png" border="0" usemap="#dirserv_8h_a0b84786e17352524036694baf1955167_icgraph" alt=""/></div>
<map name="dirserv_8h_a0b84786e17352524036694baf1955167_icgraph" id="dirserv_8h_a0b84786e17352524036694baf1955167_icgraph">
<area shape="rect" id="node2" href="directory_8c.html#a2dcb34e25124200a8694ef07275a50b2" title="MOCK_IMPL" alt="" coords="229,5,329,32"/>
<area shape="rect" id="node3" href="dirserv_8h.html#ab38d643312052d4bfdb7d49dcba344a6" title="directory_fetches_dir\l_info_early" alt="" coords="208,57,351,98"/>
<area shape="rect" id="node5" href="main_8h.html#ac64189cc036980dc5785f76d85db9fa6" title="directory_info_has\l_arrived" alt="" coords="215,122,343,163"/>
<area shape="rect" id="node4" href="routerlist_8h.html#a33e8618001c42bd50575051362aaffa2" title="launch_descriptor_downloads" alt="" coords="399,64,592,91"/>
</map>
</div>

</div>
</div>
<a id="a7923860b3a8c27fa48c4dcec6ef6939f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7923860b3a8c27fa48c4dcec6ef6939f">&#9670;&nbsp;</a></span>directory_permits_begindir_requests()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int directory_permits_begindir_requests </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if we want to allow remote clients to ask us directory requests via the "begin_dir" interface, which doesn't require having any separate port open. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a7923860b3a8c27fa48c4dcec6ef6939f_cgraph.png" border="0" usemap="#dirserv_8h_a7923860b3a8c27fa48c4dcec6ef6939f_cgraph" alt=""/></div>
<map name="dirserv_8h_a7923860b3a8c27fa48c4dcec6ef6939f_cgraph" id="dirserv_8h_a7923860b3a8c27fa48c4dcec6ef6939f_cgraph">
<area shape="rect" id="node2" href="router_8c.html#ab23297b12b098da9eac98126a587aa3b" title="dir_server_mode" alt="" coords="228,13,347,39"/>
</map>
</div>

</div>
</div>
<a id="a2c5edbbd6883a33af3d72bfead4033db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c5edbbd6883a33af3d72bfead4033db">&#9670;&nbsp;</a></span>directory_too_idle_to_fetch_descriptors()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int directory_too_idle_to_fetch_descriptors </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if we have no need to fetch new descriptors. This generally happens when we're not a dir cache and we haven't built any circuits lately. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a2c5edbbd6883a33af3d72bfead4033db_cgraph.png" border="0" usemap="#dirserv_8h_a2c5edbbd6883a33af3d72bfead4033db_cgraph" alt=""/></div>
<map name="dirserv_8h_a2c5edbbd6883a33af3d72bfead4033db_cgraph" id="dirserv_8h_a2c5edbbd6883a33af3d72bfead4033db_cgraph">
<area shape="rect" id="node2" href="dirserv_8c.html#a57e2ff1ad2ea65abe9b969ad3d76a418" title="directory_caches_dir_info" alt="" coords="200,64,371,91"/>
<area shape="rect" id="node5" href="rephist_8c.html#a890009e83c2e90292a435526b8111727" title="rep_hist_circbuilding\l_dormant" alt="" coords="215,174,355,215"/>
<area shape="rect" id="node3" href="router_8c.html#ab23297b12b098da9eac98126a587aa3b" title="dir_server_mode" alt="" coords="441,5,559,32"/>
<area shape="rect" id="node4" href="router_8c.html#afa75de94186fffc8f373de610ae4cab3" title="should_refuse_unknown\l_exits" alt="" coords="419,57,581,98"/>
<area shape="rect" id="node6" href="rephist_8c.html#ae234f5b5dcf88ea65ef20ff5c3512327" title="any_predicted_circuits" alt="" coords="424,123,576,149"/>
<area shape="rect" id="node7" href="router_8c.html#a8b917b11fb2945b314286a6a567e34c3" title="check_whether_orport\l_reachable" alt="" coords="425,174,575,215"/>
<area shape="rect" id="node8" href="circuituse_8c.html#ac6c1a2c715351d85ef6747ca1a4db958" title="circuit_enough_testing\l_circs" alt="" coords="424,239,576,281"/>
<area shape="rect" id="node9" href="router_8c.html#a98317a030cb30700f60c8444d676087b" title="check_whether_dirport\l_reachable" alt="" coords="423,305,577,346"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a2c5edbbd6883a33af3d72bfead4033db_icgraph.png" border="0" usemap="#dirserv_8h_a2c5edbbd6883a33af3d72bfead4033db_icgraph" alt=""/></div>
<map name="dirserv_8h_a2c5edbbd6883a33af3d72bfead4033db_icgraph" id="dirserv_8h_a2c5edbbd6883a33af3d72bfead4033db_icgraph">
<area shape="rect" id="node2" href="main_8h.html#ac64189cc036980dc5785f76d85db9fa6" title="directory_info_has\l_arrived" alt="" coords="857,5,985,47"/>
<area shape="rect" id="node3" href="microdesc_8h.html#aad7f413d899b72e58bed8efc0162d8bd" title="update_microdesc_downloads" alt="" coords="419,34,616,61"/>
<area shape="rect" id="node5" href="routerlist_8h.html#a1a7cfda729e27cf26089db2112d21965" title="update_consensus_router\l_descriptor_downloads" alt="" coords="200,85,371,127"/>
<area shape="rect" id="node4" href="routerlist_8h.html#afe7f2c6bcc3135272bc6aa66ec09cd76" title="update_all_descriptor\l_downloads" alt="" coords="664,35,809,76"/>
<area shape="rect" id="node6" href="routerlist_8h.html#a8b67f737b9ea614297414b26eb3b784c" title="update_router_descriptor\l_downloads" alt="" coords="435,85,600,127"/>
</map>
</div>

</div>
</div>
<a id="a7a1e4335b7ab9518991addf3876fb0f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a1e4335b7ab9518991addf3876fb0f0">&#9670;&nbsp;</a></span>dirserv_add_descriptor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="or_8h.html#a7c96814e647f1b5b99e501ea5763842f">was_router_added_t</a> dirserv_add_descriptor </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>source</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Examine the parsed server descriptor in <b>ri</b> and maybe insert it into the list of server descriptors. Set *<b>msg</b> to a message that should be passed back to the origin of this descriptor, or NULL if there is no such message. Use <b>source</b> to produce better log messages.</p>
<p>If <b>ri</b> is not added to the list of server descriptors, free it. That means the caller must not access <b>ri</b> after this function returns, since it might have been freed.</p>
<p>Return the status of the operation.</p>
<p>This function is only called when fresh descriptors are posted, not when we re-load the cache. </p>

</div>
</div>
<a id="a917ddd9c8bf085d8742afdf78d2a578c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a917ddd9c8bf085d8742afdf78d2a578c">&#9670;&nbsp;</a></span>dirserv_add_multiple_descriptors()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="or_8h.html#a7c96814e647f1b5b99e501ea5763842f">was_router_added_t</a> dirserv_add_multiple_descriptors </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>purpose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>As for <a class="el" href="dirserv_8c.html#a5af480ce6b85c4740885e8a4965c5272">dirserv_add_descriptor()</a>, but accepts multiple documents, and returns the most severe error that occurred for any one of them. </p>

</div>
</div>
<a id="a95deb3d9d5367525bb51127b82269c87"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95deb3d9d5367525bb51127b82269c87">&#9670;&nbsp;</a></span>dirserv_add_own_fingerprint()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_add_own_fingerprint </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structcrypto__pk__t.html">crypto_pk_t</a> *&#160;</td>
          <td class="paramname"><em>pk</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add the fingerprint for this OR to the global list of recognized identity key fingerprints. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a95deb3d9d5367525bb51127b82269c87_cgraph.png" border="0" usemap="#dirserv_8h_a95deb3d9d5367525bb51127b82269c87_cgraph" alt=""/></div>
<map name="dirserv_8h_a95deb3d9d5367525bb51127b82269c87_cgraph" id="dirserv_8h_a95deb3d9d5367525bb51127b82269c87_cgraph">
<area shape="rect" id="node2" href="crypto__rsa_8c.html#a10149de1598ad3852fa49aa2c708371b" title="crypto_pk_get_fingerprint" alt="" coords="237,56,405,83"/>
<area shape="rect" id="node3" href="crypto__rsa_8c.html#a91336077a5062618ff895dae4e50079d" title="crypto_pk_get_digest" alt="" coords="465,5,612,32"/>
<area shape="rect" id="node5" href="util__format_8c.html#a8b8940b2ef607928eb3dca4850567ea5" title="base16_encode" alt="" coords="482,56,595,83"/>
<area shape="rect" id="node6" href="crypto_8c.html#aba85ade6ff380d6321263ca9363cb0ce" title="crypto_add_spaces_to_fp" alt="" coords="453,107,624,133"/>
<area shape="rect" id="node4" href="crypto__rsa_8c.html#a47b1080a7a68f04e0e745168075c235f" title="crypto_pk_keysize" alt="" coords="672,5,803,32"/>
</map>
</div>

</div>
</div>
<a id="af70a376b32a1d064cb589d81fa2f64d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af70a376b32a1d064cb589d81fa2f64d3">&#9670;&nbsp;</a></span>dirserv_clear_measured_bw_cache()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_clear_measured_bw_cache </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Clear and free the measured bandwidth cache </p>

</div>
</div>
<a id="a6254e57429acb014cb8026a0cd8cc087"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6254e57429acb014cb8026a0cd8cc087">&#9670;&nbsp;</a></span>dirserv_compute_performance_thresholds()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_compute_performance_thresholds </td>
          <td>(</td>
          <td class="paramtype">digestmap_t *&#160;</td>
          <td class="paramname"><em>omit_as_sybil</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Look through the routerlist, the Mean Time Between Failure history, and the Weighted Fractional Uptime history, and use them to set thresholds for the Stable, Fast, and Guard flags. Update the fields stable_uptime, stable_mtbf, enough_mtbf_info, guard_wfu, guard_tk, fast_bandwidth, guard_bandwidth_including_exits, and guard_bandwidth_excluding_exits.</p>
<p>Also, set the is_exit flag of each router appropriately. </p>

</div>
</div>
<a id="a5bf5f153e699ad278fca9fb9371b2b0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5bf5f153e699ad278fca9fb9371b2b0c">&#9670;&nbsp;</a></span>dirserv_count_measured_bws()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_count_measured_bws </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>routers</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Look through the routerlist, and using the measured bandwidth cache count how many measured bandwidths we know. This is used to decide whether we ever trust advertised bandwidths for purposes of assigning flags. </p>

</div>
</div>
<a id="aa86c752d8d8f446eba40db2d0c2269a7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa86c752d8d8f446eba40db2d0c2269a7">&#9670;&nbsp;</a></span>dirserv_free_all()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_free_all </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Release all storage used by the directory server. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_aa86c752d8d8f446eba40db2d0c2269a7_cgraph.png" border="0" usemap="#dirserv_8h_aa86c752d8d8f446eba40db2d0c2269a7_cgraph" alt=""/></div>
<map name="dirserv_8h_aa86c752d8d8f446eba40db2d0c2269a7_cgraph" id="dirserv_8h_aa86c752d8d8f446eba40db2d0c2269a7_cgraph">
<area shape="rect" id="node2" href="dirserv_8c.html#a952a2a3f8acd42cdebbae8631123cf1c" title="dirserv_free_fingerprint_list" alt="" coords="164,5,343,32"/>
<area shape="rect" id="node3" href="util_8c.html#a40d94cc20afc38582c65aa418919ebed" title="tor_free_" alt="" coords="391,5,464,32"/>
</map>
</div>

</div>
</div>
<a id="a952a2a3f8acd42cdebbae8631123cf1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a952a2a3f8acd42cdebbae8631123cf1c">&#9670;&nbsp;</a></span>dirserv_free_fingerprint_list()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_free_fingerprint_list </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Clear the current fingerprint list. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a952a2a3f8acd42cdebbae8631123cf1c_cgraph.png" border="0" usemap="#dirserv_8h_a952a2a3f8acd42cdebbae8631123cf1c_cgraph" alt=""/></div>
<map name="dirserv_8h_a952a2a3f8acd42cdebbae8631123cf1c_cgraph" id="dirserv_8h_a952a2a3f8acd42cdebbae8631123cf1c_cgraph">
<area shape="rect" id="node2" href="util_8c.html#a40d94cc20afc38582c65aa418919ebed" title="tor_free_" alt="" coords="232,5,305,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a952a2a3f8acd42cdebbae8631123cf1c_icgraph.png" border="0" usemap="#dirserv_8h_a952a2a3f8acd42cdebbae8631123cf1c_icgraph" alt=""/></div>
<map name="dirserv_8h_a952a2a3f8acd42cdebbae8631123cf1c_icgraph" id="dirserv_8h_a952a2a3f8acd42cdebbae8631123cf1c_icgraph">
<area shape="rect" id="node2" href="dirserv_8h.html#aa86c752d8d8f446eba40db2d0c2269a7" title="dirserv_free_all" alt="" coords="232,5,343,32"/>
</map>
</div>

</div>
</div>
<a id="a0f07c36cfc3121034f466d7cb6d27630"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f07c36cfc3121034f466d7cb6d27630">&#9670;&nbsp;</a></span>dirserv_get_consensus()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structcached__dir__t.html">cached_dir_t</a>* dirserv_get_consensus </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>flavor_name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the latest downloaded consensus networkstatus in encoded, signed, optionally compressed format, suitable for sending to clients. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a0f07c36cfc3121034f466d7cb6d27630_icgraph.png" border="0" usemap="#dirserv_8h_a0f07c36cfc3121034f466d7cb6d27630_icgraph" alt=""/></div>
<map name="dirserv_8h_a0f07c36cfc3121034f466d7cb6d27630_icgraph" id="dirserv_8h_a0f07c36cfc3121034f466d7cb6d27630_icgraph">
<area shape="rect" id="node2" href="directory_8c.html#a4af7e7ade522a1f118e7770955ff50ea" title="handle_response_fetch\l_consensus" alt="" coords="209,5,365,47"/>
</map>
</div>

</div>
</div>
<a id="a5be126c4926e7257fa5fbe5463ff4a6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5be126c4926e7257fa5fbe5463ff4a6a">&#9670;&nbsp;</a></span>dirserv_get_flag_thresholds_line()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* dirserv_get_flag_thresholds_line </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Give a statement of our current performance thresholds for inclusion in a vote document. </p>

</div>
</div>
<a id="a2a58cd8f1b1e22a024a25ec69c3a64ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a58cd8f1b1e22a024a25ec69c3a64ac">&#9670;&nbsp;</a></span>dirserv_get_measured_bw_cache_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_get_measured_bw_cache_size </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get the current size of the measured bandwidth cache </p>

</div>
</div>
<a id="a2e2cb1b422b5391b4b128813aac0971c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e2cb1b422b5391b4b128813aac0971c">&#9670;&nbsp;</a></span>dirserv_get_routerdesc_spool()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_get_routerdesc_spool </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>spool_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="dirserv_8h.html#aac355320fd3daf8319b7fb1839c976d3">dir_spool_source_t</a>&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>conn_is_encrypted</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>msg_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>As <a class="el" href="dirserv_8c.html#a8fca5a38cd000d8ccabe5bc73e296bb2">dirserv_get_routerdescs()</a>, but instead of getting <a class="el" href="structsigned__descriptor__t.html">signed_descriptor_t</a> pointers, adds copies of digests to fps_out, and doesn't use the /tor/server/ prefix. For a /d/ request, adds descriptor digests; for other requests, adds identity digests. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a2e2cb1b422b5391b4b128813aac0971c_cgraph.png" border="0" usemap="#dirserv_8h_a2e2cb1b422b5391b4b128813aac0971c_cgraph" alt=""/></div>
<map name="dirserv_8h_a2e2cb1b422b5391b4b128813aac0971c_cgraph" id="dirserv_8h_a2e2cb1b422b5391b4b128813aac0971c_cgraph">
<area shape="rect" id="node2" href="routerlist_8c.html#a9181bbed0ee6ff8088a7c53fc8c446f1" title="router_get_routerlist" alt="" coords="208,13,345,39"/>
</map>
</div>

</div>
</div>
<a id="a8fca5a38cd000d8ccabe5bc73e296bb2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8fca5a38cd000d8ccabe5bc73e296bb2">&#9670;&nbsp;</a></span>dirserv_get_routerdescs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_get_routerdescs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>descs_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add a <a class="el" href="structsigned__descriptor__t.html">signed_descriptor_t</a> to <b>descs_out</b> for each router matching <b>key</b>. The key should be either</p><ul>
<li>"/tor/server/authority" for our own routerinfo;</li>
<li>"/tor/server/all" for all the routerinfos we have, concatenated;</li>
<li>"/tor/server/fp/FP" where FP is a plus-separated sequence of hex identity digests; or</li>
<li>"/tor/server/d/D" where D is a plus-separated sequence of server descriptor digests, in hex.</li>
</ul>
<p>Return 0 if we found some matching descriptors, or -1 if we do not have any descriptors, no matching descriptors, or if we did not recognize the key (URL). If -1 is returned *<b>msg</b> will be set to an appropriate error message.</p>
<p>XXXX rename this function. It's only called from the controller. XXXX in fact, refactor this function, merging as much as possible. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a8fca5a38cd000d8ccabe5bc73e296bb2_cgraph.png" border="0" usemap="#dirserv_8h_a8fca5a38cd000d8ccabe5bc73e296bb2_cgraph" alt=""/></div>
<map name="dirserv_8h_a8fca5a38cd000d8ccabe5bc73e296bb2_cgraph" id="dirserv_8h_a8fca5a38cd000d8ccabe5bc73e296bb2_cgraph">
<area shape="rect" id="node2" href="routerlist_8c.html#a9181bbed0ee6ff8088a7c53fc8c446f1" title="router_get_routerlist" alt="" coords="215,5,352,32"/>
<area shape="rect" id="node3" href="container_8c.html#accf59a8b7d39a4286ff99653b6878006" title="smartlist_add" alt="" coords="233,56,333,83"/>
</map>
</div>

</div>
</div>
<a id="ab77a8f39d9154260c0c9ab4abcaa1a58"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab77a8f39d9154260c0c9ab4abcaa1a58">&#9670;&nbsp;</a></span>dirserv_has_measured_bw()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_has_measured_bw </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>node_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Predicate wrapper for dirserv_query_measured_bw_cache() </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_ab77a8f39d9154260c0c9ab4abcaa1a58_cgraph.png" border="0" usemap="#dirserv_8h_ab77a8f39d9154260c0c9ab4abcaa1a58_cgraph" alt=""/></div>
<map name="dirserv_8h_ab77a8f39d9154260c0c9ab4abcaa1a58_cgraph" id="dirserv_8h_ab77a8f39d9154260c0c9ab4abcaa1a58_cgraph">
<area shape="rect" id="node2" href="dirserv_8c.html#a6162d3c2d43a0ba2921b9f8902fe3cfa" title="dirserv_query_measured\l_bw_cache_kb" alt="" coords="231,5,395,47"/>
</map>
</div>

</div>
</div>
<a id="a258a245ff1505a9ea50b06de2b3e490f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a258a245ff1505a9ea50b06de2b3e490f">&#9670;&nbsp;</a></span>dirserv_load_fingerprint_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_load_fingerprint_file </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Load the nickname-&gt;fingerprint mappings stored in the approved-routers file. The file format is line-based, with each non-blank holding one nickname, some space, and a fingerprint for that nickname. On success, replace the current fingerprint list with the new list and return 0. On failure, leave the current fingerprint list untouched, and return -1. </p>

</div>
</div>
<a id="a2b981b610d4a3344b17a55300072ef66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b981b610d4a3344b17a55300072ef66">&#9670;&nbsp;</a></span>dirserv_orconn_tls_done()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_orconn_tls_done </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>or_port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>digest_rcvd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structed25519__public__key__t.html">ed25519_public_key_t</a> *&#160;</td>
          <td class="paramname"><em>ed_id_rcvd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Called when a TLS handshake has completed successfully with a router listening at <b>address</b>:<b>or_port</b>, and has yielded a certificate with digest <b>digest_rcvd</b>.</p>
<p>Inform the reachability checker that we could get to this relay. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a2b981b610d4a3344b17a55300072ef66_cgraph.png" border="0" usemap="#dirserv_8h_a2b981b610d4a3344b17a55300072ef66_cgraph" alt=""/></div>
<map name="dirserv_8h_a2b981b610d4a3344b17a55300072ef66_cgraph" id="dirserv_8h_a2b981b610d4a3344b17a55300072ef66_cgraph">
<area shape="rect" id="node2" href="nodelist_8c.html#a798e84107f21829549b67e28dca267ef" title="node_supports_ed25519\l_link_authentication" alt="" coords="216,5,379,47"/>
<area shape="rect" id="node4" href="crypto__ed25519_8c.html#a1d56281a358363aa105b7032aebc46e4" title="ed25519_public_key\l_is_zero" alt="" coords="227,71,367,112"/>
<area shape="rect" id="node6" href="crypto__ed25519_8c.html#af9396211603b40cf70b930b9ef726ed1" title="ed25519_pubkey_eq" alt="" coords="227,137,368,163"/>
<area shape="rect" id="node3" href="nodelist_8c.html#ad46ce292894cace0427366a53b765602" title="node_get_ed25519_id" alt="" coords="427,13,575,39"/>
<area shape="rect" id="node5" href="util_8c.html#a7c5079074e649dc0369225eca3073f7d" title="tor_mem_is_zero" alt="" coords="439,78,562,105"/>
<area shape="rect" id="node7" href="di__ops_8c.html#a473334ee93cca0aea10523321a444ea3" title="tor_memeq" alt="" coords="457,137,544,163"/>
</map>
</div>

</div>
</div>
<a id="ab83fe95748f2a7626fbb05f2ada5896e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab83fe95748f2a7626fbb05f2ada5896e">&#9670;&nbsp;</a></span>dirserv_query_measured_bw_cache_kb()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_query_measured_bw_cache_kb </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>node_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long *&#160;</td>
          <td class="paramname"><em>bw_kb_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t *&#160;</td>
          <td class="paramname"><em>as_of_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Query the cache by identity digest, return value indicates whether we found it. The bw_out and as_of_out pointers receive the cached bandwidth value and the time it was cached if not NULL. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_ab83fe95748f2a7626fbb05f2ada5896e_icgraph.png" border="0" usemap="#dirserv_8h_ab83fe95748f2a7626fbb05f2ada5896e_icgraph" alt=""/></div>
<map name="dirserv_8h_ab83fe95748f2a7626fbb05f2ada5896e_icgraph" id="dirserv_8h_ab83fe95748f2a7626fbb05f2ada5896e_icgraph">
<area shape="rect" id="node2" href="dirserv_8h.html#ab77a8f39d9154260c0c9ab4abcaa1a58" title="dirserv_has_measured_bw" alt="" coords="217,13,395,39"/>
</map>
</div>

</div>
</div>
<a id="a50e06fc916d8cbcc3ccfb7f919cb6928"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50e06fc916d8cbcc3ccfb7f919cb6928">&#9670;&nbsp;</a></span>dirserv_read_guardfraction_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_read_guardfraction_file </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>vote_routerstatuses</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read a guardfraction file at <b>fname</b> and load all its information to <b>vote_routerstatuses</b>. </p>

</div>
</div>
<a id="af364b236821a07880cc8dc54e98ca999"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af364b236821a07880cc8dc54e98ca999">&#9670;&nbsp;</a></span>dirserv_read_measured_bandwidths()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_read_measured_bandwidths </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>from_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>routerstatuses</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read the measured bandwidth file and apply it to the list of <a class="el" href="structvote__routerstatus__t.html">vote_routerstatus_t</a>. Returns -1 on error, 0 otherwise. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_af364b236821a07880cc8dc54e98ca999_cgraph.png" border="0" usemap="#dirserv_8h_af364b236821a07880cc8dc54e98ca999_cgraph" alt=""/></div>
<map name="dirserv_8h_af364b236821a07880cc8dc54e98ca999_cgraph" id="dirserv_8h_af364b236821a07880cc8dc54e98ca999_cgraph">
<area shape="rect" id="node2" href="compat_8c.html#a99ee17f8317be48a2391c20e31e8a7b8" title="tor_fopen_cloexec" alt="" coords="211,13,339,39"/>
</map>
</div>

</div>
</div>
<a id="a95906070553304c94a590affb671223e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95906070553304c94a590affb671223e">&#9670;&nbsp;</a></span>dirserv_router_get_status()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t dirserv_router_get_status </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *&#160;</td>
          <td class="paramname"><em>router</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>severity</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Check whether <b>router</b> has a nickname/identity key combination that we recognize from the fingerprint list, or an IP we automatically act on according to our configuration. Return the appropriate router status.</p>
<p>If the status is 'FP_REJECT' and <b>msg</b> is provided, set *<b>msg</b> to an explanation of why. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a95906070553304c94a590affb671223e_cgraph.png" border="0" usemap="#dirserv_8h_a95906070553304c94a590affb671223e_cgraph" alt=""/></div>
<map name="dirserv_8h_a95906070553304c94a590affb671223e_cgraph" id="dirserv_8h_a95906070553304c94a590affb671223e_cgraph">
<area shape="rect" id="node2" href="crypto__rsa_8c.html#a91336077a5062618ff895dae4e50079d" title="crypto_pk_get_digest" alt="" coords="180,13,327,39"/>
<area shape="rect" id="node3" href="crypto__rsa_8c.html#a47b1080a7a68f04e0e745168075c235f" title="crypto_pk_keysize" alt="" coords="375,13,505,39"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a95906070553304c94a590affb671223e_icgraph.png" border="0" usemap="#dirserv_8h_a95906070553304c94a590affb671223e_icgraph" alt=""/></div>
<map name="dirserv_8h_a95906070553304c94a590affb671223e_icgraph" id="dirserv_8h_a95906070553304c94a590affb671223e_icgraph">
<area shape="rect" id="node2" href="dirserv_8h.html#adaceacf408562b95dd1169799995bd6c" title="authdir_wants_to_reject\l_router" alt="" coords="180,5,340,47"/>
</map>
</div>

</div>
</div>
<a id="a4ae8f9b0f02056a69bd8c92adda96579"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ae8f9b0f02056a69bd8c92adda96579">&#9670;&nbsp;</a></span>dirserv_set_cached_consensus_networkstatus()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_set_cached_consensus_networkstatus </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>networkstatus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>flavor_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structcommon__digests__t.html">common_digests_t</a> *&#160;</td>
          <td class="paramname"><em>digests</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>sha3_as_signed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>published</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Replace the v3 consensus networkstatus of type <b>flavor_name</b> that we're serving with <b>networkstatus</b>, published at <b>published</b>. No validation is performed. </p>

</div>
</div>
<a id="a5f2508c28e6b8a1d7b9ae921598a9860"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f2508c28e6b8a1d7b9ae921598a9860">&#9670;&nbsp;</a></span>dirserv_set_node_flags_from_authoritative_status()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_set_node_flags_from_authoritative_status </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structnode__t.html">node_t</a> *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>authstatus</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Update the relevant flags of <b>node</b> based on our opinion as a directory authority in <b>authstatus</b>, as returned by dirserv_router_get_status or equivalent. </p>

</div>
</div>
<a id="ad1772dc2a4a12cc0eb181d1f52c5a54a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad1772dc2a4a12cc0eb181d1f52c5a54a">&#9670;&nbsp;</a></span>dirserv_set_router_is_running()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_set_router_is_running </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *&#160;</td>
          <td class="paramname"><em>router</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Treat a router as alive if</p><ul>
<li>It's me, and I'm not hibernating. or - We've found it reachable recently. </li>
</ul>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_ad1772dc2a4a12cc0eb181d1f52c5a54a_cgraph.png" border="0" usemap="#dirserv_8h_ad1772dc2a4a12cc0eb181d1f52c5a54a_cgraph" alt=""/></div>
<map name="dirserv_8h_ad1772dc2a4a12cc0eb181d1f52c5a54a_cgraph" id="dirserv_8h_ad1772dc2a4a12cc0eb181d1f52c5a54a_cgraph">
<area shape="rect" id="node2" href="router_8c.html#adcfdecf66a4aa5e6d09a702784c8197f" title="router_is_me" alt="" coords="188,5,285,32"/>
<area shape="rect" id="node5" href="address_8c.html#a6ecc12236743caf7527376436791c75e" title="tor_addr_is_null" alt="" coords="180,56,293,83"/>
<area shape="rect" id="node3" href="router_8c.html#abeb0f38915a46f77352900604075d82f" title="router_digest_is_me" alt="" coords="341,5,480,32"/>
<area shape="rect" id="node4" href="di__ops_8c.html#a473334ee93cca0aea10523321a444ea3" title="tor_memeq" alt="" coords="528,5,615,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_ad1772dc2a4a12cc0eb181d1f52c5a54a_icgraph.png" border="0" usemap="#dirserv_8h_ad1772dc2a4a12cc0eb181d1f52c5a54a_icgraph" alt=""/></div>
<map name="dirserv_8h_ad1772dc2a4a12cc0eb181d1f52c5a54a_icgraph" id="dirserv_8h_ad1772dc2a4a12cc0eb181d1f52c5a54a_icgraph">
<area shape="rect" id="node2" href="dirserv_8h.html#a6c7009f040e0a812c40a6ae0fa6efd79" title="list_server_status_v1" alt="" coords="180,13,327,39"/>
</map>
</div>

</div>
</div>
<a id="a0c97fbc43a4398a45feb2fafa3d42fc1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c97fbc43a4398a45feb2fafa3d42fc1">&#9670;&nbsp;</a></span>dirserv_should_launch_reachability_test()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_should_launch_reachability_test </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *&#160;</td>
          <td class="paramname"><em>ri_old</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Called when we, as an authority, receive a new router descriptor either as an upload or a download. Used to decide whether to relaunch reachability testing for the server. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a0c97fbc43a4398a45feb2fafa3d42fc1_cgraph.png" border="0" usemap="#dirserv_8h_a0c97fbc43a4398a45feb2fafa3d42fc1_cgraph" alt=""/></div>
<map name="dirserv_8h_a0c97fbc43a4398a45feb2fafa3d42fc1_cgraph" id="dirserv_8h_a0c97fbc43a4398a45feb2fafa3d42fc1_cgraph">
<area shape="rect" id="node2" href="router_8c.html#a8522dfca1851365846ddef293a416656" title="authdir_mode_handles\l_descs" alt="" coords="205,5,357,47"/>
<area shape="rect" id="node3" href="routerlist_8c.html#a9b25dd842df15283a342bb77cf5935a8" title="routers_have_same_or\l_addrs" alt="" coords="204,71,359,112"/>
</map>
</div>

</div>
</div>
<a id="a87235a887afe2a5f796bd9a88b474909"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87235a887afe2a5f796bd9a88b474909">&#9670;&nbsp;</a></span>dirserv_single_reachability_test()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_single_reachability_test </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *&#160;</td>
          <td class="paramname"><em>router</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Helper function for <a class="el" href="dirserv_8c.html#aac91a65fca7d877c033a594a96203ad7">dirserv_test_reachability()</a>. Start a TLS connection to <b>router</b>, and annotate it with when we started the test. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a87235a887afe2a5f796bd9a88b474909_cgraph.png" border="0" usemap="#dirserv_8h_a87235a887afe2a5f796bd9a88b474909_cgraph" alt=""/></div>
<map name="dirserv_8h_a87235a887afe2a5f796bd9a88b474909_cgraph" id="dirserv_8h_a87235a887afe2a5f796bd9a88b474909_cgraph">
<area shape="rect" id="node2" href="nodelist_8c.html#a798e84107f21829549b67e28dca267ef" title="node_supports_ed25519\l_link_authentication" alt="" coords="257,5,420,47"/>
<area shape="rect" id="node3" href="nodelist_8c.html#ad46ce292894cace0427366a53b765602" title="node_get_ed25519_id" alt="" coords="468,13,616,39"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a87235a887afe2a5f796bd9a88b474909_icgraph.png" border="0" usemap="#dirserv_8h_a87235a887afe2a5f796bd9a88b474909_icgraph" alt=""/></div>
<map name="dirserv_8h_a87235a887afe2a5f796bd9a88b474909_icgraph" id="dirserv_8h_a87235a887afe2a5f796bd9a88b474909_icgraph">
<area shape="rect" id="node2" href="dirserv_8h.html#aac91a65fca7d877c033a594a96203ad7" title="dirserv_test_reachability" alt="" coords="257,5,420,32"/>
<area shape="rect" id="node3" href="routerlist_8h.html#ad0e00a6f0df9aace49976da496902957" title="routerlist_descriptors\l_added" alt="" coords="267,57,410,98"/>
</map>
</div>

</div>
</div>
<a id="a37b7370c96e2e908512aea4ea2b3f458"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a37b7370c96e2e908512aea4ea2b3f458">&#9670;&nbsp;</a></span>dirserv_spool_remove_missing_and_guess_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_spool_remove_missing_and_guess_size </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdir__connection__t.html">dir_connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>cutoff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>compression</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>size_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>n_expired_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Try to guess the number of bytes that will be needed to send the spooled objects for <b>conn</b>'s outgoing spool. In the process, remove every element of the spool that refers to an absent object, or which was published earlier than <b>cutoff</b>. Set *<b>size_out</b> to the number of bytes, and *<b>n_expired_out</b> to the number of objects removed for being too old. </p>

</div>
</div>
<a id="a126be24e35ded1467ae68c81afee15bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a126be24e35ded1467ae68c81afee15bf">&#9670;&nbsp;</a></span>dirserv_spool_sort()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_spool_sort </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdir__connection__t.html">dir_connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Sort all the entries in <b>conn</b> by digest. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a126be24e35ded1467ae68c81afee15bf_cgraph.png" border="0" usemap="#dirserv_8h_a126be24e35ded1467ae68c81afee15bf_cgraph" alt=""/></div>
<map name="dirserv_8h_a126be24e35ded1467ae68c81afee15bf_cgraph" id="dirserv_8h_a126be24e35ded1467ae68c81afee15bf_cgraph">
<area shape="rect" id="node2" href="container_8c.html#adeb0528c65b62117acb2b8f6e2b0e910" title="smartlist_sort" alt="" coords="181,5,283,32"/>
</map>
</div>

</div>
</div>
<a id="aac91a65fca7d877c033a594a96203ad7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac91a65fca7d877c033a594a96203ad7">&#9670;&nbsp;</a></span>dirserv_test_reachability()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_test_reachability </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Auth dir server only: load balance such that we only try a few connections per call.</p>
<p>The load balancing is such that if we get called once every ten seconds, we will cycle through all the tests in REACHABILITY_TEST_CYCLE_PERIOD seconds (a bit over 20 minutes). </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_aac91a65fca7d877c033a594a96203ad7_cgraph.png" border="0" usemap="#dirserv_8h_aac91a65fca7d877c033a594a96203ad7_cgraph" alt=""/></div>
<map name="dirserv_8h_aac91a65fca7d877c033a594a96203ad7_cgraph" id="dirserv_8h_aac91a65fca7d877c033a594a96203ad7_cgraph">
<area shape="rect" id="node2" href="routerlist_8c.html#a9181bbed0ee6ff8088a7c53fc8c446f1" title="router_get_routerlist" alt="" coords="249,5,387,32"/>
<area shape="rect" id="node3" href="router_8c.html#aabab68011cc297e16ad83af25c521bf6" title="authdir_mode_bridge" alt="" coords="247,56,389,83"/>
<area shape="rect" id="node5" href="router_8c.html#adcfdecf66a4aa5e6d09a702784c8197f" title="router_is_me" alt="" coords="269,107,367,133"/>
<area shape="rect" id="node8" href="dirserv_8c.html#a87235a887afe2a5f796bd9a88b474909" title="dirserv_single_reachability_test" alt="" coords="216,161,420,188"/>
<area shape="rect" id="node4" href="router_8c.html#a2d62b1eeaa990670a04de8dfbb42ab8f" title="authdir_mode" alt="" coords="499,56,599,83"/>
<area shape="rect" id="node6" href="router_8c.html#abeb0f38915a46f77352900604075d82f" title="router_digest_is_me" alt="" coords="480,107,619,133"/>
<area shape="rect" id="node7" href="di__ops_8c.html#a473334ee93cca0aea10523321a444ea3" title="tor_memeq" alt="" coords="709,107,796,133"/>
<area shape="rect" id="node9" href="nodelist_8c.html#a798e84107f21829549b67e28dca267ef" title="node_supports_ed25519\l_link_authentication" alt="" coords="468,158,631,199"/>
<area shape="rect" id="node10" href="nodelist_8c.html#ad46ce292894cace0427366a53b765602" title="node_get_ed25519_id" alt="" coords="679,165,827,192"/>
</map>
</div>

</div>
</div>
<a id="abbb851f560879781b07f4b99762f45b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abbb851f560879781b07f4b99762f45b3">&#9670;&nbsp;</a></span>dirserv_would_reject_router()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_would_reject_router </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structrouterstatus__t.html">routerstatus_t</a> *&#160;</td>
          <td class="paramname"><em>rs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true if there is no point in downloading the router described by <b>rs</b> because this directory would reject it. </p>

</div>
</div>
<a id="a6c7009f040e0a812c40a6ae0fa6efd79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c7009f040e0a812c40a6ae0fa6efd79">&#9670;&nbsp;</a></span>list_server_status_v1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int list_server_status_v1 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>routers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>router_status_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>for_controller</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Based on the routerinfo_ts in <b>routers</b>, allocate the contents of a v1-style router-status line, and store it in *<b>router_status_out</b>. Return 0 on success, -1 on failure.</p>
<p>If for_controller is true, include the routers with very old descriptors.</p>
<p>This is deprecated: it's only used for controllers that want outputs in the old format. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a6c7009f040e0a812c40a6ae0fa6efd79_cgraph.png" border="0" usemap="#dirserv_8h_a6c7009f040e0a812c40a6ae0fa6efd79_cgraph" alt=""/></div>
<map name="dirserv_8h_a6c7009f040e0a812c40a6ae0fa6efd79_cgraph" id="dirserv_8h_a6c7009f040e0a812c40a6ae0fa6efd79_cgraph">
<area shape="rect" id="node2" href="router_8c.html#aea820da6141eaf03649558d4ec6d5872" title="authdir_mode_publishes\l_statuses" alt="" coords="200,49,363,90"/>
<area shape="rect" id="node5" href="dirserv_8c.html#ad1772dc2a4a12cc0eb181d1f52c5a54a" title="dirserv_set_router\l_is_running" alt="" coords="218,125,345,166"/>
<area shape="rect" id="node10" href="router_8c.html#a2f3a022f2ddb8fb15047fb91522000eb" title="router_get_verbose\l_nickname" alt="" coords="215,190,348,231"/>
<area shape="rect" id="node12" href="util_8c.html#a95ad8dd258dec01eebc504928e6df180" title="smartlist_add_strdup" alt="" coords="210,256,353,283"/>
<area shape="rect" id="node13" href="container_8c.html#accf59a8b7d39a4286ff99653b6878006" title="smartlist_add" alt="" coords="231,307,331,333"/>
<area shape="rect" id="node3" href="router_8c.html#aabab68011cc297e16ad83af25c521bf6" title="authdir_mode_bridge" alt="" coords="411,5,553,32"/>
<area shape="rect" id="node4" href="router_8c.html#a2d62b1eeaa990670a04de8dfbb42ab8f" title="authdir_mode" alt="" coords="621,31,721,57"/>
<area shape="rect" id="node6" href="router_8c.html#adcfdecf66a4aa5e6d09a702784c8197f" title="router_is_me" alt="" coords="433,107,531,133"/>
<area shape="rect" id="node9" href="address_8c.html#a6ecc12236743caf7527376436791c75e" title="tor_addr_is_null" alt="" coords="425,157,539,184"/>
<area shape="rect" id="node7" href="router_8c.html#abeb0f38915a46f77352900604075d82f" title="router_digest_is_me" alt="" coords="601,107,740,133"/>
<area shape="rect" id="node8" href="di__ops_8c.html#a473334ee93cca0aea10523321a444ea3" title="tor_memeq" alt="" coords="788,107,875,133"/>
<area shape="rect" id="node11" href="util__format_8c.html#a8b8940b2ef607928eb3dca4850567ea5" title="base16_encode" alt="" coords="425,208,539,235"/>
</map>
</div>

</div>
</div>
<a id="a1f9b702470f577e3b47d852f664e7d2b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f9b702470f577e3b47d852f664e7d2b">&#9670;&nbsp;</a></span>new_cached_dir()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structcached__dir__t.html">cached_dir_t</a>* new_cached_dir </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>published</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate and return a new <a class="el" href="structcached__dir__t.html">cached_dir_t</a> containing the string <b>s</b>, published at <b>published</b>. </p>

</div>
</div>
<a id="a462a8ae7270a4bea92c8d6269e7489db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a462a8ae7270a4bea92c8d6269e7489db">&#9670;&nbsp;</a></span>routerstatus_format_entry()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* routerstatus_format_entry </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structrouterstatus__t.html">routerstatus_t</a> *&#160;</td>
          <td class="paramname"><em>rs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>protocols</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="or_8h.html#a46368555a0446803c7acfd3b8230adef">routerstatus_format_type_t</a>&#160;</td>
          <td class="paramname"><em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>consensus_method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structvote__routerstatus__t.html">vote_routerstatus_t</a> *&#160;</td>
          <td class="paramname"><em>vrs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Helper: write the router-status information in <b>rs</b> into a newly allocated character buffer. Use the same format as in network-status documents. If <b>version</b> is non-NULL, add a "v" line for the platform.</p>
<p>consensus_method is the current consensus method when format is NS_V3_CONSENSUS or NS_V3_CONSENSUS_MICRODESC. It is ignored for other formats: pass ROUTERSTATUS_FORMAT_NO_CONSENSUS_METHOD.</p>
<p>Return 0 on success, -1 on failure.</p>
<p>The format argument has one of the following values: NS_V2 - Output an entry suitable for a V2 NS opinion document NS_V3_CONSENSUS - Output the first portion of a V3 NS consensus entry for consensus_method. NS_V3_CONSENSUS_MICRODESC - Output the first portion of a V3 microdesc consensus entry for consensus_method. NS_V3_VOTE - Output a complete V3 NS vote. If <b>vrs</b> is present, it contains additional information for the vote. NS_CONTROL_PORT - Output a NS document for the control port. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a462a8ae7270a4bea92c8d6269e7489db_icgraph.png" border="0" usemap="#dirserv_8h_a462a8ae7270a4bea92c8d6269e7489db_icgraph" alt=""/></div>
<map name="dirserv_8h_a462a8ae7270a4bea92c8d6269e7489db_icgraph" id="dirserv_8h_a462a8ae7270a4bea92c8d6269e7489db_icgraph">
<area shape="rect" id="node2" href="networkstatus_8h.html#a07b2840d2a72326847e2e68152402dcf" title="networkstatus_getinfo\l_helper_single" alt="" coords="188,5,339,47"/>
</map>
</div>

</div>
</div>
<a id="a63449de198177a1fbd1f1365bab914a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a63449de198177a1fbd1f1365bab914a2">&#9670;&nbsp;</a></span>spooled_resource_free_()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void spooled_resource_free_ </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structspooled__resource__t.html">spooled_resource_t</a> *&#160;</td>
          <td class="paramname"><em>spooled</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Release all storage held by <b>spooled</b>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_a63449de198177a1fbd1f1365bab914a2_cgraph.png" border="0" usemap="#dirserv_8h_a63449de198177a1fbd1f1365bab914a2_cgraph" alt=""/></div>
<map name="dirserv_8h_a63449de198177a1fbd1f1365bab914a2_cgraph" id="dirserv_8h_a63449de198177a1fbd1f1365bab914a2_cgraph">
<area shape="rect" id="node2" href="dirserv_8c.html#a079db5d58a49010fe8b2944ecb3189bd" title="cached_dir_decref" alt="" coords="213,5,341,32"/>
</map>
</div>

</div>
</div>
<a id="a78f90a90dabba118a3beb3130c9c66c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78f90a90dabba118a3beb3130c9c66c7">&#9670;&nbsp;</a></span>spooled_resource_new_from_cache_entry()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structspooled__resource__t.html">spooled_resource_t</a>* spooled_resource_new_from_cache_entry </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconsensus__cache__entry__t.html">consensus_cache_entry_t</a> *&#160;</td>
          <td class="paramname"><em>entry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create a new <a class="el" href="structspooled__resource__t.html">spooled_resource_t</a> to spool the contents of <b>entry</b> to the user. Return the spooled object on success, or NULL on failure (which is probably caused by a failure to map the body of the item from disk).</p>
<p>Adds a reference to entry's reference counter. </p>

</div>
</div>
<a id="ae4f82bd716ec94f012312bf508728269"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae4f82bd716ec94f012312bf508728269">&#9670;&nbsp;</a></span>validate_recommended_package_line()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int validate_recommended_package_line </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>line</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff <b>line</b> is a valid RecommendedPackages line. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8h_ae4f82bd716ec94f012312bf508728269_icgraph.png" border="0" usemap="#dirserv_8h_ae4f82bd716ec94f012312bf508728269_icgraph" alt=""/></div>
<map name="dirserv_8h_ae4f82bd716ec94f012312bf508728269_icgraph" id="dirserv_8h_ae4f82bd716ec94f012312bf508728269_icgraph">
<area shape="rect" id="node2" href="dirvote_8c.html#ab876fd37d49b88c5ce095d93e458ff10" title="compute_consensus_package\l_lines" alt="" coords="209,5,408,47"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
