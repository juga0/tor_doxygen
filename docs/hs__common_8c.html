<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tor: /home/user/_my/code/bwauth-related/tor/src/or/hs_common.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tor
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_95039623eb1ebeaf46c028778b39de98.html">or</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">hs_common.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Contains code shared between different HS protocol version as well as useful data structures and accessors used by other subsystems. The <a class="el" href="rendcommon_8c.html" title="Rendezvous implementation: shared code between introducers, services, clients, and rendezvous points...">rendcommon.c</a> should only contains code relating to the v2 protocol.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="or_8h_source.html">or.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="config_8h_source.html">config.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="circuitbuild_8h_source.html">circuitbuild.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="networkstatus_8h_source.html">networkstatus.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="nodelist_8h_source.html">nodelist.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hs__cache_8h_source.html">hs_cache.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hs__common_8h_source.html">hs_common.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hs__client_8h_source.html">hs_client.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hs__ident_8h_source.html">hs_ident.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hs__service_8h_source.html">hs_service.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hs__circuitmap_8h_source.html">hs_circuitmap.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="policies_8h_source.html">policies.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rendcommon_8h_source.html">rendcommon.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rendservice_8h_source.html">rendservice.h</a>&quot;</code><br />
<code>#include &quot;routerset.h&quot;</code><br />
<code>#include &quot;<a class="el" href="router_8h_source.html">router.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="shared__random__client_8h_source.html">shared_random_client.h</a>&quot;</code><br />
<code>#include &quot;dirauth/shared_random_state.h&quot;</code><br />
<code>#include &quot;ed25519_cert.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for hs_common.c:</div>
<div class="dyncontent">
<div class="center"><img src="hs__common_8c__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2hs__common_8c" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2hs__common_8c" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2hs__common_8c">
<area shape="rect" id="node2" href="or_8h.html" title="Master header file for Tor&#45;specific functionality. " alt="" coords="1091,423,1135,449"/>
<area shape="rect" id="node26" href="hs__circuitmap_8h.html" title="Header file for hs_circuitmap.c. " alt="" coords="1883,497,1998,524"/>
<area shape="rect" id="node27" href="config_8h.html" title="Header file for config.c. " alt="" coords="5,273,73,300"/>
<area shape="rect" id="node28" href="circuitbuild_8h.html" title="Header file for circuitbuild.c. " alt="" coords="2452,117,2547,143"/>
<area shape="rect" id="node29" href="networkstatus_8h.html" title="Header file for networkstatus.c. " alt="" coords="538,199,653,225"/>
<area shape="rect" id="node30" href="nodelist_8h.html" title="Header file for nodelist.c. " alt="" coords="2571,117,2649,143"/>
<area shape="rect" id="node31" href="hs__cache_8h.html" title="Header file for hs_cache.c. " alt="" coords="1621,273,1711,300"/>
<area shape="rect" id="node33" href="hs__common_8h.html" title="Header file containing common data for the whole HS subsytem. " alt="" coords="1990,348,2094,375"/>
<area shape="rect" id="node34" href="ed25519__cert_8h_source.html" title="ed25519_cert.h" alt="" coords="2220,423,2331,449"/>
<area shape="rect" id="node38" href="rendcommon_8h.html" title="Header file for rendcommon.c. " alt="" coords="1756,348,1864,375"/>
<area shape="rect" id="node39" href="hs__client_8h.html" title="Header file containing client data for the HS subsytem. " alt="" coords="1851,199,1937,225"/>
<area shape="rect" id="node40" href="hs__ident_8h.html" title="Header file containing circuit and connection identifier data for the whole HS subsytem. " alt="" coords="1910,273,1993,300"/>
<area shape="rect" id="node41" href="hs__service_8h.html" title="Header file containing service data for the HS subsytem. " alt="" coords="2075,199,2171,225"/>
<area shape="rect" id="node44" href="policies_8h.html" title="Header file for policies.c. " alt="" coords="2674,117,2751,143"/>
<area shape="rect" id="node45" href="rendservice_8h.html" title="Header file for rendservice.c. " alt="" coords="1703,117,1803,143"/>
<area shape="rect" id="node46" href="routerset_8h_source.html" title="routerset.h" alt="" coords="2776,117,2860,143"/>
<area shape="rect" id="node47" href="router_8h.html" title="Header file for router.c. " alt="" coords="449,273,515,300"/>
<area shape="rect" id="node48" href="shared__random__client_8h.html" title="Header file for shared_random_client.c. " alt="" coords="1003,117,1163,143"/>
<area shape="rect" id="node50" href="shared__random__state_8h_source.html" title="dirauth/shared_random\l_state.h" alt="" coords="1187,109,1342,151"/>
<area shape="rect" id="node3" href="orconfig_8h_source.html" title="orconfig.h" alt="" coords="655,871,733,897"/>
<area shape="rect" id="node4" href="torint_8h.html" title="Header file to define uint32_t and friends. " alt="" coords="1368,796,1431,823"/>
<area shape="rect" id="node6" href="crypto_8h.html" title="Headers for crypto.c. " alt="" coords="646,572,715,599"/>
<area shape="rect" id="node11" href="crypto__format_8h_source.html" title="crypto_format.h" alt="" coords="1313,497,1427,524"/>
<area shape="rect" id="node12" href="crypto__ed25519_8h_source.html" title="crypto_ed25519.h" alt="" coords="1562,572,1687,599"/>
<area shape="rect" id="node13" href="crypto__curve25519_8h_source.html" title="crypto_curve25519.h" alt="" coords="1563,647,1705,673"/>
<area shape="rect" id="node14" href="tortls_8h.html" title="Headers for tortls.c. " alt="" coords="504,647,567,673"/>
<area shape="rect" id="node15" href="torlog_8h.html" title="Headers for log.c. " alt="" coords="363,647,428,673"/>
<area shape="rect" id="node16" href="container_8h_source.html" title="container.h" alt="" coords="977,572,1064,599"/>
<area shape="rect" id="node17" href="compress_8h.html" title="Headers for compress.c. " alt="" coords="554,497,645,524"/>
<area shape="rect" id="node18" href="address_8h.html" title="Headers for address.h. " alt="" coords="1211,497,1289,524"/>
<area shape="rect" id="node19" href="compat__libevent_8h_source.html" title="compat_libevent.h" alt="" coords="250,721,378,748"/>
<area shape="rect" id="node20" href="ht_8h_source.html" title="ht.h" alt="" coords="669,497,713,524"/>
<area shape="rect" id="node21" href="confline_8h_source.html" title="confline.h" alt="" coords="955,497,1033,524"/>
<area shape="rect" id="node22" href="replaycache_8h.html" title="Header file for replaycache.c. " alt="" coords="1756,497,1859,524"/>
<area shape="rect" id="node23" href="tor__queue_8h_source.html" title="tor_queue.h" alt="" coords="738,497,829,524"/>
<area shape="rect" id="node24" href="token__bucket_8h_source.html" title="token_bucket.h" alt="" coords="909,721,1020,748"/>
<area shape="rect" id="node25" href="util__format_8h_source.html" title="util_format.h" alt="" coords="1197,721,1292,748"/>
<area shape="rect" id="node8" href="testsupport_8h_source.html" title="testsupport.h" alt="" coords="475,796,574,823"/>
<area shape="rect" id="node9" href="compat_8h_source.html" title="compat.h" alt="" coords="656,721,732,748"/>
<area shape="rect" id="node10" href="util_8h.html" title="Headers for util.c. " alt="" coords="1055,647,1106,673"/>
<area shape="rect" id="node36" href="hs__descriptor_8h.html" title="Header file for hs_descriptor.c. " alt="" coords="1468,348,1579,375"/>
<area shape="rect" id="node37" href="torcert_8h_source.html" title="torcert.h" alt="" coords="1705,423,1776,449"/>
<area shape="rect" id="node35" href="trunnel_8h_source.html" title="trunnel.h" alt="" coords="2333,497,2405,524"/>
<area shape="rect" id="node42" href="hs__intropoint_8h.html" title="Header file for hs_intropoint.c. " alt="" coords="2219,348,2326,375"/>
<area shape="rect" id="node43" href="cell__establish__intro_8h_source.html" title="hs/cell_establish_intro.h" alt="" coords="2355,423,2518,449"/>
<area shape="rect" id="node49" href="shared__random_8h_source.html" title="dirauth/shared_random.h" alt="" coords="1030,199,1195,225"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a620048b5e5d5b1e18c723fcca43a5a5c"><td class="memItemLeft" align="right" valign="top"><a id="a620048b5e5d5b1e18c723fcca43a5a5c"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>HS_COMMON_PRIVATE</b></td></tr>
<tr class="separator:a620048b5e5d5b1e18c723fcca43a5a5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad2824e9718bf70be95c337ccebfb09a1"><td class="memItemLeft" align="right" valign="top"><a id="ad2824e9718bf70be95c337ccebfb09a1"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MAX_REND_FAILURES_DEFAULT</b>&#160;&#160;&#160;2</td></tr>
<tr class="separator:ad2824e9718bf70be95c337ccebfb09a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9062121850c27ce15a47bef83c7bc783"><td class="memItemLeft" align="right" valign="top"><a id="a9062121850c27ce15a47bef83c7bc783"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MAX_REND_FAILURES_MIN</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a9062121850c27ce15a47bef83c7bc783"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab449c677d62fe27d8eee3a08afdd23d2"><td class="memItemLeft" align="right" valign="top"><a id="ab449c677d62fe27d8eee3a08afdd23d2"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MAX_REND_FAILURES_MAX</b>&#160;&#160;&#160;10</td></tr>
<tr class="separator:ab449c677d62fe27d8eee3a08afdd23d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a8baca74973f2b60defd9421de94d0704"><td class="memItemLeft" align="right" valign="top"><a id="a8baca74973f2b60defd9421de94d0704"></a>
char *&#160;</td><td class="memItemRight" valign="bottom"><b>hs_path_from_filename</b> (const char *directory, const char *filename)</td></tr>
<tr class="separator:a8baca74973f2b60defd9421de94d0704"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad15a047350a7502bf40edb75b4ad77d2"><td class="memItemLeft" align="right" valign="top"><a id="ad15a047350a7502bf40edb75b4ad77d2"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>hs_check_service_private_dir</b> (const char *username, const char *path, unsigned int dir_group_readable, unsigned int create)</td></tr>
<tr class="separator:ad15a047350a7502bf40edb75b4ad77d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f425cc658ae2b6eadd0ef1c5d10aebe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hs__common_8c.html#a8f425cc658ae2b6eadd0ef1c5d10aebe">hs_get_service_max_rend_failures</a> (void)</td></tr>
<tr class="separator:a8f425cc658ae2b6eadd0ef1c5d10aebe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad86b31c9e6c875ceceee74cfab4fbf64"><td class="memItemLeft" align="right" valign="top">STATIC uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hs__common_8c.html#ad86b31c9e6c875ceceee74cfab4fbf64">get_time_period_length</a> (void)</td></tr>
<tr class="separator:ad86b31c9e6c875ceceee74cfab4fbf64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a265dd15b5d06861b811cc8b9ce8e5f9e"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hs__common_8c.html#a265dd15b5d06861b811cc8b9ce8e5f9e">hs_get_time_period_num</a> (time_t now)</td></tr>
<tr class="separator:a265dd15b5d06861b811cc8b9ce8e5f9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5debb4cfbd37ae0175658c432a902ee3"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hs__common_8c.html#a5debb4cfbd37ae0175658c432a902ee3">hs_get_next_time_period_num</a> (time_t now)</td></tr>
<tr class="separator:a5debb4cfbd37ae0175658c432a902ee3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a792b1f3d6e92506dd8828c1623e5634f"><td class="memItemLeft" align="right" valign="top"><a id="a792b1f3d6e92506dd8828c1623e5634f"></a>
uint64_t&#160;</td><td class="memItemRight" valign="bottom"><b>hs_get_previous_time_period_num</b> (time_t now)</td></tr>
<tr class="separator:a792b1f3d6e92506dd8828c1623e5634f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42bd027a38c106a3c0d0ba4867d6bfc8"><td class="memItemLeft" align="right" valign="top"><a id="a42bd027a38c106a3c0d0ba4867d6bfc8"></a>
time_t&#160;</td><td class="memItemRight" valign="bottom"><b>hs_get_start_time_of_next_time_period</b> (time_t now)</td></tr>
<tr class="separator:a42bd027a38c106a3c0d0ba4867d6bfc8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d509b0576e80d374aac611962efb3ef"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hs__common_8c.html#a2d509b0576e80d374aac611962efb3ef">rend_data_free_</a> (<a class="el" href="structrend__data__t.html">rend_data_t</a> *data)</td></tr>
<tr class="separator:a2d509b0576e80d374aac611962efb3ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e861907b5ed972758bdff02b1fff7f7"><td class="memItemLeft" align="right" valign="top"><a id="a3e861907b5ed972758bdff02b1fff7f7"></a>
<a class="el" href="structrend__data__t.html">rend_data_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>rend_data_dup</b> (const <a class="el" href="structrend__data__t.html">rend_data_t</a> *data)</td></tr>
<tr class="separator:a3e861907b5ed972758bdff02b1fff7f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32bf2108c6c803a11486e89dfa5b55ab"><td class="memItemLeft" align="right" valign="top"><a id="a32bf2108c6c803a11486e89dfa5b55ab"></a>
<a class="el" href="structrend__data__t.html">rend_data_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>rend_data_service_create</b> (const char *onion_address, const char *pk_digest, const uint8_t *cookie, <a class="el" href="or_8h.html#aafc6920f8a16e10f46703e7819795c74">rend_auth_type_t</a> auth_type)</td></tr>
<tr class="separator:a32bf2108c6c803a11486e89dfa5b55ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba983562d99c5c2f278cd4e1f616ff93"><td class="memItemLeft" align="right" valign="top"><a id="aba983562d99c5c2f278cd4e1f616ff93"></a>
<a class="el" href="structrend__data__t.html">rend_data_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>rend_data_client_create</b> (const char *onion_address, const char *desc_id, const char *cookie, <a class="el" href="or_8h.html#aafc6920f8a16e10f46703e7819795c74">rend_auth_type_t</a> auth_type)</td></tr>
<tr class="separator:aba983562d99c5c2f278cd4e1f616ff93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeccc7839a5deb7aa76714f14f30aa312"><td class="memItemLeft" align="right" valign="top"><a id="aeccc7839a5deb7aa76714f14f30aa312"></a>
const char *&#160;</td><td class="memItemRight" valign="bottom"><b>rend_data_get_address</b> (const <a class="el" href="structrend__data__t.html">rend_data_t</a> *rend_data)</td></tr>
<tr class="separator:aeccc7839a5deb7aa76714f14f30aa312"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ec9fa2a4e1a2a62fc1aebfb437af1ea"><td class="memItemLeft" align="right" valign="top"><a id="a6ec9fa2a4e1a2a62fc1aebfb437af1ea"></a>
const char *&#160;</td><td class="memItemRight" valign="bottom"><b>rend_data_get_desc_id</b> (const <a class="el" href="structrend__data__t.html">rend_data_t</a> *rend_data, uint8_t replica, size_t *len_out)</td></tr>
<tr class="separator:a6ec9fa2a4e1a2a62fc1aebfb437af1ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51fd60ab2c01cdf34686e948ac8e40d4"><td class="memItemLeft" align="right" valign="top"><a id="a51fd60ab2c01cdf34686e948ac8e40d4"></a>
const uint8_t *&#160;</td><td class="memItemRight" valign="bottom"><b>rend_data_get_pk_digest</b> (const <a class="el" href="structrend__data__t.html">rend_data_t</a> *rend_data, size_t *len_out)</td></tr>
<tr class="separator:a51fd60ab2c01cdf34686e948ac8e40d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acac322f7c0b83896db2dd30a5babdf5a"><td class="memItemLeft" align="right" valign="top">STATIC void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hs__common_8c.html#acac322f7c0b83896db2dd30a5babdf5a">get_disaster_srv</a> (uint64_t time_period_num, uint8_t *srv_out)</td></tr>
<tr class="separator:acac322f7c0b83896db2dd30a5babdf5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9d8181ee24c8070a1e44a91eaefa4fe"><td class="memItemLeft" align="right" valign="top"><a id="af9d8181ee24c8070a1e44a91eaefa4fe"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>hs_get_subcredential</b> (const <a class="el" href="structed25519__public__key__t.html">ed25519_public_key_t</a> *identity_pk, const <a class="el" href="structed25519__public__key__t.html">ed25519_public_key_t</a> *blinded_pk, uint8_t *subcred_out)</td></tr>
<tr class="separator:af9d8181ee24c8070a1e44a91eaefa4fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5e04eb2bcb5077e1d08e371c444f54e"><td class="memItemLeft" align="right" valign="top"><a id="aa5e04eb2bcb5077e1d08e371c444f54e"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>hs_set_conn_addr_port</b> (const <a class="el" href="structsmartlist__t.html">smartlist_t</a> *ports, <a class="el" href="structedge__connection__t.html">edge_connection_t</a> *conn)</td></tr>
<tr class="separator:aa5e04eb2bcb5077e1d08e371c444f54e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f5a43c23fb10cd33e081b55e968285a"><td class="memItemLeft" align="right" valign="top"><a id="a7f5a43c23fb10cd33e081b55e968285a"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>hs_parse_address</b> (const char *address, <a class="el" href="structed25519__public__key__t.html">ed25519_public_key_t</a> *key_out, uint8_t *checksum_out, uint8_t *version_out)</td></tr>
<tr class="separator:a7f5a43c23fb10cd33e081b55e968285a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80d6759093bbb12cc7754f435829fa1f"><td class="memItemLeft" align="right" valign="top"><a id="a80d6759093bbb12cc7754f435829fa1f"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>hs_address_is_valid</b> (const char *address)</td></tr>
<tr class="separator:a80d6759093bbb12cc7754f435829fa1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67f428cf0da6fd68bb4e147e9ae35146"><td class="memItemLeft" align="right" valign="top"><a id="a67f428cf0da6fd68bb4e147e9ae35146"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>hs_build_address</b> (const <a class="el" href="structed25519__public__key__t.html">ed25519_public_key_t</a> *key, uint8_t version, char *addr_out)</td></tr>
<tr class="separator:a67f428cf0da6fd68bb4e147e9ae35146"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7eff71ca580c305d11e27720bfe23a94"><td class="memItemLeft" align="right" valign="top"><a id="a7eff71ca580c305d11e27720bfe23a94"></a>
<a class="el" href="structlink__specifier__st.html">link_specifier_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>hs_link_specifier_dup</b> (const <a class="el" href="structlink__specifier__st.html">link_specifier_t</a> *lspec)</td></tr>
<tr class="separator:a7eff71ca580c305d11e27720bfe23a94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d26dfbb9615c589f15394fbaf2c17fa"><td class="memItemLeft" align="right" valign="top"><a id="a4d26dfbb9615c589f15394fbaf2c17fa"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>hs_build_blinded_pubkey</b> (const <a class="el" href="structed25519__public__key__t.html">ed25519_public_key_t</a> *pk, const uint8_t *secret, size_t secret_len, uint64_t time_period_num, <a class="el" href="structed25519__public__key__t.html">ed25519_public_key_t</a> *blinded_pk_out)</td></tr>
<tr class="separator:a4d26dfbb9615c589f15394fbaf2c17fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a044fd94c481904bc38be5cd743a288ff"><td class="memItemLeft" align="right" valign="top"><a id="a044fd94c481904bc38be5cd743a288ff"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>hs_build_blinded_keypair</b> (const <a class="el" href="structed25519__keypair__t.html">ed25519_keypair_t</a> *kp, const uint8_t *secret, size_t secret_len, uint64_t time_period_num, <a class="el" href="structed25519__keypair__t.html">ed25519_keypair_t</a> *blinded_kp_out)</td></tr>
<tr class="separator:a044fd94c481904bc38be5cd743a288ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2d3fe761e1d645b4d5b7f37ac2ed190"><td class="memItemLeft" align="right" valign="top"><a id="ac2d3fe761e1d645b4d5b7f37ac2ed190"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>MOCK_IMPL</b> (int, hs_in_period_between_tp_and_srv,(const <a class="el" href="structnetworkstatus__t.html">networkstatus_t</a> *consensus, time_t now))</td></tr>
<tr class="separator:ac2d3fe761e1d645b4d5b7f37ac2ed190"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aecc443038d36a6aa7ec863cdfb72fed9"><td class="memItemLeft" align="right" valign="top"><a id="aecc443038d36a6aa7ec863cdfb72fed9"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>hs_service_requires_uptime_circ</b> (const <a class="el" href="structsmartlist__t.html">smartlist_t</a> *ports)</td></tr>
<tr class="separator:aecc443038d36a6aa7ec863cdfb72fed9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a396195887eae7fbe23dc640813dee270"><td class="memItemLeft" align="right" valign="top"><a id="a396195887eae7fbe23dc640813dee270"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>hs_build_hs_index</b> (uint64_t replica, const <a class="el" href="structed25519__public__key__t.html">ed25519_public_key_t</a> *blinded_pk, uint64_t period_num, uint8_t *hs_index_out)</td></tr>
<tr class="separator:a396195887eae7fbe23dc640813dee270"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf136d03e417c8d92f29e96482256615"><td class="memItemLeft" align="right" valign="top"><a id="acf136d03e417c8d92f29e96482256615"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>hs_build_hsdir_index</b> (const <a class="el" href="structed25519__public__key__t.html">ed25519_public_key_t</a> *identity_pk, const uint8_t *srv_value, uint64_t period_num, uint8_t *hsdir_index_out)</td></tr>
<tr class="separator:acf136d03e417c8d92f29e96482256615"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8291c1b726735212f71f4e8cde1be5dc"><td class="memItemLeft" align="right" valign="top"><a id="a8291c1b726735212f71f4e8cde1be5dc"></a>
uint8_t *&#160;</td><td class="memItemRight" valign="bottom"><b>hs_get_current_srv</b> (uint64_t time_period_num, const <a class="el" href="structnetworkstatus__t.html">networkstatus_t</a> *ns)</td></tr>
<tr class="separator:a8291c1b726735212f71f4e8cde1be5dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6ae2c687d162ae76b33076b320e02d2"><td class="memItemLeft" align="right" valign="top"><a id="ad6ae2c687d162ae76b33076b320e02d2"></a>
uint8_t *&#160;</td><td class="memItemRight" valign="bottom"><b>hs_get_previous_srv</b> (uint64_t time_period_num, const <a class="el" href="structnetworkstatus__t.html">networkstatus_t</a> *ns)</td></tr>
<tr class="separator:ad6ae2c687d162ae76b33076b320e02d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f9e7924ca3119c1649f58292385511d"><td class="memItemLeft" align="right" valign="top"><a id="a5f9e7924ca3119c1649f58292385511d"></a>
int32_t&#160;</td><td class="memItemRight" valign="bottom"><b>hs_get_hsdir_n_replicas</b> (void)</td></tr>
<tr class="separator:a5f9e7924ca3119c1649f58292385511d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9df3bff05586ae6c7b33339b724e2a41"><td class="memItemLeft" align="right" valign="top"><a id="a9df3bff05586ae6c7b33339b724e2a41"></a>
int32_t&#160;</td><td class="memItemRight" valign="bottom"><b>hs_get_hsdir_spread_fetch</b> (void)</td></tr>
<tr class="separator:a9df3bff05586ae6c7b33339b724e2a41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa01720f1f4c141a68a0ad260a5b78e0"><td class="memItemLeft" align="right" valign="top"><a id="afa01720f1f4c141a68a0ad260a5b78e0"></a>
int32_t&#160;</td><td class="memItemRight" valign="bottom"><b>hs_get_hsdir_spread_store</b> (void)</td></tr>
<tr class="separator:afa01720f1f4c141a68a0ad260a5b78e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a010e22b21cbcd6da7279c4390cecfb49"><td class="memItemLeft" align="right" valign="top"><a id="a010e22b21cbcd6da7279c4390cecfb49"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>hs_get_responsible_hsdirs</b> (const <a class="el" href="structed25519__public__key__t.html">ed25519_public_key_t</a> *blinded_pk, uint64_t time_period_num, int use_second_hsdir_index, int for_fetching, <a class="el" href="structsmartlist__t.html">smartlist_t</a> *responsible_dirs)</td></tr>
<tr class="separator:a010e22b21cbcd6da7279c4390cecfb49"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae1764b60b2a40468b340977ca706b26"><td class="memItemLeft" align="right" valign="top">time_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hs__common_8c.html#aae1764b60b2a40468b340977ca706b26">hs_hsdir_requery_period</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:aae1764b60b2a40468b340977ca706b26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae03858c7559eecbf8e00ced1746de764"><td class="memItemLeft" align="right" valign="top">STATIC strmap_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hs__common_8c.html#ae03858c7559eecbf8e00ced1746de764">get_last_hid_serv_requests</a> (void)</td></tr>
<tr class="separator:ae03858c7559eecbf8e00ced1746de764"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24b581fdab0cc96be8ab7ae6cac2eef1"><td class="memItemLeft" align="right" valign="top">time_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hs__common_8c.html#a24b581fdab0cc96be8ab7ae6cac2eef1">hs_lookup_last_hid_serv_request</a> (<a class="el" href="structrouterstatus__t.html">routerstatus_t</a> *hs_dir, const char *req_key_str, time_t now, int set)</td></tr>
<tr class="separator:a24b581fdab0cc96be8ab7ae6cac2eef1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad18a9fbbc310683d64f150e1751be328"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hs__common_8c.html#ad18a9fbbc310683d64f150e1751be328">hs_clean_last_hid_serv_requests</a> (time_t now)</td></tr>
<tr class="separator:ad18a9fbbc310683d64f150e1751be328"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59273c674dec561625215b9bbbe8b53e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hs__common_8c.html#a59273c674dec561625215b9bbbe8b53e">hs_purge_hid_serv_from_last_hid_serv_requests</a> (const char *req_key_str)</td></tr>
<tr class="separator:a59273c674dec561625215b9bbbe8b53e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e3f8cb2cfdef299235268fb6bccdaab"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hs__common_8c.html#a2e3f8cb2cfdef299235268fb6bccdaab">hs_purge_last_hid_serv_requests</a> (void)</td></tr>
<tr class="separator:a2e3f8cb2cfdef299235268fb6bccdaab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9af4bf6fe3cc01d5524f2dd4123573a8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structrouterstatus__t.html">routerstatus_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hs__common_8c.html#a9af4bf6fe3cc01d5524f2dd4123573a8">hs_pick_hsdir</a> (<a class="el" href="structsmartlist__t.html">smartlist_t</a> *responsible_dirs, const char *req_key_str)</td></tr>
<tr class="separator:a9af4bf6fe3cc01d5524f2dd4123573a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1f2907724597c88011e25268cbe9550"><td class="memItemLeft" align="right" valign="top"><a id="ae1f2907724597c88011e25268cbe9550"></a>
<a class="el" href="structextend__info__t.html">extend_info_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>hs_get_extend_info_from_lspecs</b> (const <a class="el" href="structsmartlist__t.html">smartlist_t</a> *lspecs, const <a class="el" href="structcurve25519__public__key__t.html">curve25519_public_key_t</a> *onion_key, int direct_conn)</td></tr>
<tr class="separator:ae1f2907724597c88011e25268cbe9550"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abba19dad6cb2d2854c30506c93da13a9"><td class="memItemLeft" align="right" valign="top"><a id="abba19dad6cb2d2854c30506c93da13a9"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>hs_init</b> (void)</td></tr>
<tr class="separator:abba19dad6cb2d2854c30506c93da13a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4218abc030ee244ef9bd42a0a83b929"><td class="memItemLeft" align="right" valign="top"><a id="ad4218abc030ee244ef9bd42a0a83b929"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>hs_free_all</b> (void)</td></tr>
<tr class="separator:ad4218abc030ee244ef9bd42a0a83b929"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6aaa1cdd146691d6c0bbd9491226bd94"><td class="memItemLeft" align="right" valign="top"><a id="a6aaa1cdd146691d6c0bbd9491226bd94"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>hs_dec_rdv_stream_counter</b> (<a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *circ)</td></tr>
<tr class="separator:a6aaa1cdd146691d6c0bbd9491226bd94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9b738a64351bae794d89802215bb889"><td class="memItemLeft" align="right" valign="top"><a id="ac9b738a64351bae794d89802215bb889"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>hs_inc_rdv_stream_counter</b> (<a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *circ)</td></tr>
<tr class="separator:ac9b738a64351bae794d89802215bb889"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Contains code shared between different HS protocol version as well as useful data structures and accessors used by other subsystems. The <a class="el" href="rendcommon_8c.html" title="Rendezvous implementation: shared code between introducers, services, clients, and rendezvous points...">rendcommon.c</a> should only contains code relating to the v2 protocol. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="acac322f7c0b83896db2dd30a5babdf5a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acac322f7c0b83896db2dd30a5babdf5a">&#9670;&nbsp;</a></span>get_disaster_srv()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC void get_disaster_srv </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>time_period_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>srv_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute the disaster SRV value for this <b>time_period_num</b> and put it in <b>srv_out</b> (of size at least DIGEST256_LEN). First check our caches to see if we have already computed it. </p>

</div>
</div>
<a id="ae03858c7559eecbf8e00ced1746de764"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae03858c7559eecbf8e00ced1746de764">&#9670;&nbsp;</a></span>get_last_hid_serv_requests()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC strmap_t* get_last_hid_serv_requests </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns last_hid_serv_requests_, initializing it to a new strmap if necessary. </p>

</div>
</div>
<a id="ad86b31c9e6c875ceceee74cfab4fbf64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad86b31c9e6c875ceceee74cfab4fbf64">&#9670;&nbsp;</a></span>get_time_period_length()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC uint64_t get_time_period_length </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get the default HS time period length in minutes from the consensus. </p>

</div>
</div>
<a id="ad18a9fbbc310683d64f150e1751be328"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad18a9fbbc310683d64f150e1751be328">&#9670;&nbsp;</a></span>hs_clean_last_hid_serv_requests()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void hs_clean_last_hid_serv_requests </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Clean the history of request times to hidden service directories, so that it does not contain requests older than REND_HID_SERV_DIR_REQUERY_PERIOD seconds any more. </p>

</div>
</div>
<a id="a5debb4cfbd37ae0175658c432a902ee3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5debb4cfbd37ae0175658c432a902ee3">&#9670;&nbsp;</a></span>hs_get_next_time_period_num()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t hs_get_next_time_period_num </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get the number of the <em>upcoming</em> HS time period, given that the current time is <b>now</b>. If <b>now</b> is not set, we try to get the time from a live consensus. </p>

</div>
</div>
<a id="a8f425cc658ae2b6eadd0ef1c5d10aebe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f425cc658ae2b6eadd0ef1c5d10aebe">&#9670;&nbsp;</a></span>hs_get_service_max_rend_failures()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int hs_get_service_max_rend_failures </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>How many times will a hidden service operator attempt to connect to a requested rendezvous point before giving up? </p>

</div>
</div>
<a id="a265dd15b5d06861b811cc8b9ce8e5f9e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a265dd15b5d06861b811cc8b9ce8e5f9e">&#9670;&nbsp;</a></span>hs_get_time_period_num()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t hs_get_time_period_num </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get the HS time period number at time <b>now</b>. If <b>now</b> is not set, we try to get the time ourselves from a live consensus. </p>

</div>
</div>
<a id="aae1764b60b2a40468b340977ca706b26"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae1764b60b2a40468b340977ca706b26">&#9670;&nbsp;</a></span>hs_hsdir_requery_period()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">time_t hs_hsdir_requery_period </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the period for which a hidden service directory cannot be queried for the same descriptor ID again, taking TestingTorNetwork into account. </p>

</div>
</div>
<a id="a24b581fdab0cc96be8ab7ae6cac2eef1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24b581fdab0cc96be8ab7ae6cac2eef1">&#9670;&nbsp;</a></span>hs_lookup_last_hid_serv_request()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">time_t hs_lookup_last_hid_serv_request </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrouterstatus__t.html">routerstatus_t</a> *&#160;</td>
          <td class="paramname"><em>hs_dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>req_key_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>set</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Look up the last request time to hidden service directory <b>hs_dir</b> for descriptor request key <b>req_key_str</b> which is the descriptor ID for a v2 service or the blinded key for v3. If <b>set</b> is non-zero, assign the current time <b>now</b> and return that. Otherwise, return the most recent request time, or 0 if no such request has been sent before. </p>

</div>
</div>
<a id="a9af4bf6fe3cc01d5524f2dd4123573a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9af4bf6fe3cc01d5524f2dd4123573a8">&#9670;&nbsp;</a></span>hs_pick_hsdir()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structrouterstatus__t.html">routerstatus_t</a>* hs_pick_hsdir </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>responsible_dirs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>req_key_str</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given the list of responsible HSDirs in <b>responsible_dirs</b>, pick the one that we should use to fetch a descriptor right now. Take into account previous failed attempts at fetching this descriptor from HSDirs using the string identifier <b>req_key_str</b>.</p>
<p>Steals ownership of <b>responsible_dirs</b>.</p>
<p>Return the routerstatus of the chosen HSDir if successful, otherwise return NULL if no HSDirs are worth trying right now. </p>

</div>
</div>
<a id="a59273c674dec561625215b9bbbe8b53e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59273c674dec561625215b9bbbe8b53e">&#9670;&nbsp;</a></span>hs_purge_hid_serv_from_last_hid_serv_requests()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void hs_purge_hid_serv_from_last_hid_serv_requests </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>req_key_str</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove all requests related to the descriptor request key string <b>req_key_str</b> from the history of times of requests to hidden service directories.</p>
<p>This is called from <a class="el" href="rendclient_8c.html#ab6a404500892962da09d28a99822d176">rend_client_note_connection_attempt_ended()</a>, which must be idempotent, so any future changes to this function must leave it idempotent too. </p>

</div>
</div>
<a id="a2e3f8cb2cfdef299235268fb6bccdaab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e3f8cb2cfdef299235268fb6bccdaab">&#9670;&nbsp;</a></span>hs_purge_last_hid_serv_requests()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void hs_purge_last_hid_serv_requests </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Purge the history of request times to hidden service directories, so that future lookups of an HS descriptor will not fail because we accessed all of the HSDir relays responsible for the descriptor recently. </p>

</div>
</div>
<a id="a2d509b0576e80d374aac611962efb3ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d509b0576e80d374aac611962efb3ef">&#9670;&nbsp;</a></span>rend_data_free_()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rend_data_free_ </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrend__data__t.html">rend_data_t</a> *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Free all storage associated with <b>data</b> </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
