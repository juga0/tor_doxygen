<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tor: /home/user/_my/code/bwauth-related/tor/src/or/connection.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tor
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97b64286d42c5ef1697cb5f17129db19.html">tor</a></li><li class="navelem"><a class="el" href="dir_3cb0ba3f4b82dbe34a1a06276e96bc8d.html">src</a></li><li class="navelem"><a class="el" href="dir_386635fabd7f6c74e9d9c7a8604514a0.html">or</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">connection.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>General high-level functions to handle reading and writing on connections.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="or_8h_source.html">or.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="bridges_8h_source.html">bridges.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="buffers_8h_source.html">buffers.h</a>&quot;</code><br />
<code>#include &quot;buffers_tls.h&quot;</code><br />
<code>#include &quot;backtrace.h&quot;</code><br />
<code>#include &quot;<a class="el" href="channel_8h_source.html">channel.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="channeltls_8h_source.html">channeltls.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="circuitbuild_8h_source.html">circuitbuild.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="circuitlist_8h_source.html">circuitlist.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="circuituse_8h_source.html">circuituse.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="config_8h_source.html">config.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="connection_8h_source.html">connection.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="connection__edge_8h_source.html">connection_edge.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="connection__or_8h_source.html">connection_or.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="control_8h_source.html">control.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="crypto__util_8h_source.html">crypto_util.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="directory_8h_source.html">directory.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="dirserv_8h_source.html">dirserv.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="dns_8h_source.html">dns.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="dnsserv_8h_source.html">dnsserv.h</a>&quot;</code><br />
<code>#include &quot;dos.h&quot;</code><br />
<code>#include &quot;<a class="el" href="entrynodes_8h_source.html">entrynodes.h</a>&quot;</code><br />
<code>#include &quot;ext_orport.h&quot;</code><br />
<code>#include &quot;<a class="el" href="geoip_8h_source.html">geoip.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="main_8h_source.html">main.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hibernate_8h_source.html">hibernate.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hs__common_8h_source.html">hs_common.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hs__ident_8h_source.html">hs_ident.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="nodelist_8h_source.html">nodelist.h</a>&quot;</code><br />
<code>#include &quot;proto_http.h&quot;</code><br />
<code>#include &quot;proto_socks.h&quot;</code><br />
<code>#include &quot;<a class="el" href="policies_8h_source.html">policies.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="reasons_8h_source.html">reasons.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="relay_8h_source.html">relay.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rendclient_8h_source.html">rendclient.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rendcommon_8h_source.html">rendcommon.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rephist_8h_source.html">rephist.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="router_8h_source.html">router.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="routerlist_8h_source.html">routerlist.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="transports_8h_source.html">transports.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="routerparse_8h_source.html">routerparse.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sandbox_8h_source.html">sandbox.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for connection.c:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2connection_8c" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2connection_8c" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2connection_8c">
<area shape="rect" id="node2" href="or_8h.html" title="Master header file for Tor&#45;specific functionality. " alt="" coords="781,333,825,360"/>
<area shape="rect" id="node10" href="bridges_8h.html" title="Header file for circuitbuild.c. " alt="" coords="38,109,113,136"/>
<area shape="rect" id="node11" href="buffers_8h.html" title="Header file for buffers.c. " alt="" coords="1536,184,1609,211"/>
<area shape="rect" id="node12" href="buffers__tls_8h_source.html" title="buffers_tls.h" alt="" coords="247,109,341,136"/>
<area shape="rect" id="node13" href="backtrace_8h_source.html" title="backtrace.h" alt="" coords="75,333,166,360"/>
<area shape="rect" id="node14" href="channel_8h.html" title="Header file for channel.c. " alt="" coords="687,184,765,211"/>
<area shape="rect" id="node15" href="channeltls_8h.html" title="Header file for channeltls.c. " alt="" coords="745,109,837,136"/>
<area shape="rect" id="node16" href="circuitbuild_8h.html" title="Header file for circuitbuild.c. " alt="" coords="575,109,669,136"/>
<area shape="rect" id="node17" href="circuitlist_8h.html" title="Header file for circuitlist.c. " alt="" coords="137,109,222,136"/>
<area shape="rect" id="node18" href="hs__ident_8h.html" title="Header file containing circuit and connection identifier data for the whole HS subsytem. " alt="" coords="377,184,459,211"/>
<area shape="rect" id="node19" href="hs__common_8h.html" title="Header file containing common data for the whole HS subsytem. " alt="" coords="485,259,589,285"/>
<area shape="rect" id="node20" href="circuituse_8h.html" title="Header file for circuituse.c. " alt="" coords="913,109,1003,136"/>
<area shape="rect" id="node21" href="config_8h.html" title="Header file for config.c. " alt="" coords="1027,109,1095,136"/>
<area shape="rect" id="node22" href="connection_8h.html" title="Header file for connection.c. " alt="" coords="1610,109,1706,136"/>
<area shape="rect" id="node23" href="connection__edge_8h.html" title="Header file for connection_edge.c. " alt="" coords="1170,109,1301,136"/>
<area shape="rect" id="node24" href="connection__or_8h.html" title="Header file for connection_or.c. " alt="" coords="1325,109,1439,136"/>
<area shape="rect" id="node25" href="control_8h.html" title="Header file for control.c. " alt="" coords="1463,109,1535,136"/>
<area shape="rect" id="node26" href="crypto__util_8h.html" title="Common functions for cryptographic routines. " alt="" coords="1086,259,1179,285"/>
<area shape="rect" id="node27" href="directory_8h.html" title="Header file for directory.c. " alt="" coords="417,109,499,136"/>
<area shape="rect" id="node28" href="dirserv_8h.html" title="Header file for dirserv.c. " alt="" coords="1730,109,1802,136"/>
<area shape="rect" id="node29" href="dns_8h.html" title="Header file for dns.c. " alt="" coords="1827,109,1881,136"/>
<area shape="rect" id="node30" href="dnsserv_8h.html" title="Header file for dnsserv.c. " alt="" coords="1905,109,1984,136"/>
<area shape="rect" id="node31" href="dos_8h_source.html" title="dos.h" alt="" coords="2148,184,2203,211"/>
<area shape="rect" id="node32" href="entrynodes_8h.html" title="Header file for circuitbuild.c. " alt="" coords="2060,109,2157,136"/>
<area shape="rect" id="node33" href="ext__orport_8h_source.html" title="ext_orport.h" alt="" coords="2182,109,2273,136"/>
<area shape="rect" id="node34" href="geoip_8h.html" title="Header file for geoip.c. " alt="" coords="2297,109,2361,136"/>
<area shape="rect" id="node35" href="main_8h.html" title="Header file for main.c. " alt="" coords="2385,109,2446,136"/>
<area shape="rect" id="node36" href="hibernate_8h.html" title="Header file for hibernate.c. " alt="" coords="2471,109,2557,136"/>
<area shape="rect" id="node37" href="nodelist_8h.html" title="Header file for nodelist.c. " alt="" coords="2581,109,2660,136"/>
<area shape="rect" id="node38" href="proto__http_8h_source.html" title="proto_http.h" alt="" coords="2685,109,2775,136"/>
<area shape="rect" id="node39" href="proto__socks_8h_source.html" title="proto_socks.h" alt="" coords="2799,109,2903,136"/>
<area shape="rect" id="node40" href="policies_8h.html" title="Header file for policies.c. " alt="" coords="2927,109,3005,136"/>
<area shape="rect" id="node41" href="reasons_8h.html" title="Header file for reasons.c. " alt="" coords="3029,109,3108,136"/>
<area shape="rect" id="node42" href="relay_8h.html" title="Header file for relay.c. " alt="" coords="3133,109,3194,136"/>
<area shape="rect" id="node43" href="rendclient_8h.html" title="Header file for rendclient.c. " alt="" coords="3219,109,3308,136"/>
<area shape="rect" id="node44" href="rendcommon_8h.html" title="Header file for rendcommon.c. " alt="" coords="3332,109,3440,136"/>
<area shape="rect" id="node45" href="rephist_8h.html" title="Header file for rephist.c. " alt="" coords="3465,109,3537,136"/>
<area shape="rect" id="node46" href="router_8h.html" title="Header file for router.c. " alt="" coords="3561,109,3627,136"/>
<area shape="rect" id="node47" href="routerlist_8h.html" title="Header file for routerlist.c. " alt="" coords="3651,109,3734,136"/>
<area shape="rect" id="node48" href="transports_8h.html" title="Headers for transports.c. " alt="" coords="3758,109,3849,136"/>
<area shape="rect" id="node49" href="routerparse_8h.html" title="Header file for routerparse.c. " alt="" coords="3873,109,3971,136"/>
<area shape="rect" id="node50" href="sandbox_8h.html" title="Header file for sandbox.c. " alt="" coords="1254,408,1337,435"/>
<area shape="rect" id="node3" href="orconfig_8h_source.html" title="orconfig.h" alt="" coords="848,557,927,584"/>
<area shape="rect" id="node4" href="torint_8h.html" title="Header file to define uint32_t and friends. " alt="" coords="1023,483,1085,509"/>
<area shape="rect" id="node5" href="crypto_8h.html" title="Headers for crypto.c. " alt="" coords="853,408,922,435"/>
<area shape="rect" id="node6" href="crypto__format_8h_source.html" title="crypto_format.h" alt="" coords="997,408,1111,435"/>
<area shape="rect" id="node7" href="tortls_8h.html" title="Headers for tortls.c. " alt="" coords="515,408,577,435"/>
<area shape="rect" id="node8" href="torlog_8h.html" title="Headers for log.c. " alt="" coords="601,408,667,435"/>
<area shape="rect" id="node9" href="container_8h_source.html" title="container.h" alt="" coords="691,408,777,435"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a261072dd7542abb817ebe4353bab5f8d"><td class="memItemLeft" align="right" valign="top"><a id="a261072dd7542abb817ebe4353bab5f8d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CONNECTION_PRIVATE</b></td></tr>
<tr class="separator:a261072dd7542abb817ebe4353bab5f8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2eda2cfbeb176ae5a0ed6613d53022a"><td class="memItemLeft" align="right" valign="top"><a id="ab2eda2cfbeb176ae5a0ed6613d53022a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>TOR_CHANNEL_INTERNAL_</b></td></tr>
<tr class="separator:ab2eda2cfbeb176ae5a0ed6613d53022a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a261072dd7542abb817ebe4353bab5f8d"><td class="memItemLeft" align="right" valign="top"><a id="a261072dd7542abb817ebe4353bab5f8d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CONNECTION_PRIVATE</b></td></tr>
<tr class="separator:a261072dd7542abb817ebe4353bab5f8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a907c87f1a07729b9a04e3e83ab36bf58"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>CASE_ANY_LISTENER_TYPE</b></td></tr>
<tr class="separator:a907c87f1a07729b9a04e3e83ab36bf58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf51b7f7a691069361b98ca4f275188e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#adf51b7f7a691069361b98ca4f275188e">CONN_IS_CLOSED</a>(c)&#160;&#160;&#160;((c)-&gt;linked ? ((c)-&gt;linked_conn_is_closed) : (! SOCKET_OK(c-&gt;s)))</td></tr>
<tr class="separator:adf51b7f7a691069361b98ca4f275188e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f1af1b62ed6186b193d101eee7ec6fe"><td class="memItemLeft" align="right" valign="top"><a id="a9f1af1b62ed6186b193d101eee7ec6fe"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>WARN_TOO_MANY_CONNS_INTERVAL</b>&#160;&#160;&#160;(6*60*60)</td></tr>
<tr class="separator:a9f1af1b62ed6186b193d101eee7ec6fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a281c7ccc4e6a39e8206cf0ffd31bdebf"><td class="memItemLeft" align="right" valign="top"><a id="a281c7ccc4e6a39e8206cf0ffd31bdebf"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SOCKS4_STANDARD_BUFFER_SIZE</b>&#160;&#160;&#160;(1 + 1 + 2 + 4 + 1)</td></tr>
<tr class="separator:a281c7ccc4e6a39e8206cf0ffd31bdebf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5e603d674fb3102d163c4ad33b3a9ee"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#af5e603d674fb3102d163c4ad33b3a9ee">CLIENT_IDLE_TIME_FOR_PRIORITY</a>&#160;&#160;&#160;30</td></tr>
<tr class="separator:af5e603d674fb3102d163c4ad33b3a9ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac702e03a6f1b49bd092cd1217ef4abcf"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>CONN_GET_ALL_TEMPLATE</b>(var,  test)</td></tr>
<tr class="separator:ac702e03a6f1b49bd092cd1217ef4abcf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e89c204c3d478dbc22f8d9881c4b475"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a4e89c204c3d478dbc22f8d9881c4b475">CONN_GET_TEMPLATE</a>(var,  test)</td></tr>
<tr class="separator:a4e89c204c3d478dbc22f8d9881c4b475"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50dadbeb8efd80876453a7de512f257e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a50dadbeb8efd80876453a7de512f257e">DIR_CONN_LIST_TEMPLATE</a>(conn_var,  conn_test,  dirconn_var,  dirconn_test)</td></tr>
<tr class="separator:a50dadbeb8efd80876453a7de512f257e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a8563df222c8cdd0bc7daf33869eefb2b"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a8563df222c8cdd0bc7daf33869eefb2b">conn_get_outbound_address</a> (sa_family_t family, const <a class="el" href="structor__options__t.html">or_options_t</a> *options, unsigned int conn_type)</td></tr>
<tr class="separator:a8563df222c8cdd0bc7daf33869eefb2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa05a243a33eb2a242e48f1866ab2806a"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#aa05a243a33eb2a242e48f1866ab2806a">conn_type_to_string</a> (int type)</td></tr>
<tr class="separator:aa05a243a33eb2a242e48f1866ab2806a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f03ee7b48ac2f674af67ce1f0201d3c"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a0f03ee7b48ac2f674af67ce1f0201d3c">conn_state_to_string</a> (int type, int state)</td></tr>
<tr class="separator:a0f03ee7b48ac2f674af67ce1f0201d3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17c7be36733025b9c1384db24193776c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdir__connection__t.html">dir_connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a17c7be36733025b9c1384db24193776c">dir_connection_new</a> (int socket_family)</td></tr>
<tr class="separator:a17c7be36733025b9c1384db24193776c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0873faa8af99710bc36a3950b1bf68a6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structor__connection__t.html">or_connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a0873faa8af99710bc36a3950b1bf68a6">or_connection_new</a> (int type, int socket_family)</td></tr>
<tr class="separator:a0873faa8af99710bc36a3950b1bf68a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf77e71582e9f5e3a07d50af731b0427"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structentry__connection__t.html">entry_connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#adf77e71582e9f5e3a07d50af731b0427">entry_connection_new</a> (int type, int socket_family)</td></tr>
<tr class="separator:adf77e71582e9f5e3a07d50af731b0427"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ec50dd3f5bb871bf4a7058e4a57a754"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structedge__connection__t.html">edge_connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a2ec50dd3f5bb871bf4a7058e4a57a754">edge_connection_new</a> (int type, int socket_family)</td></tr>
<tr class="separator:a2ec50dd3f5bb871bf4a7058e4a57a754"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ab4242cd0fbf4bf874bcbb86ce1e7ba"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structcontrol__connection__t.html">control_connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a1ab4242cd0fbf4bf874bcbb86ce1e7ba">control_connection_new</a> (int socket_family)</td></tr>
<tr class="separator:a1ab4242cd0fbf4bf874bcbb86ce1e7ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b0571735fc8e34f09a8eb776f0f4d67"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlistener__connection__t.html">listener_connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a0b0571735fc8e34f09a8eb776f0f4d67">listener_connection_new</a> (int type, int socket_family)</td></tr>
<tr class="separator:a0b0571735fc8e34f09a8eb776f0f4d67"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4810086178d87cb306c2bb4b60145abe"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a4810086178d87cb306c2bb4b60145abe">connection_new</a> (int type, int socket_family)</td></tr>
<tr class="separator:a4810086178d87cb306c2bb4b60145abe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15be4ffce8c79930976b89d6c1d3c5a8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a15be4ffce8c79930976b89d6c1d3c5a8">connection_link_connections</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn_a, <a class="el" href="structconnection__t.html">connection_t</a> *conn_b)</td></tr>
<tr class="separator:a15be4ffce8c79930976b89d6c1d3c5a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab30a9246a7ca639ec6d7d42e1fa979c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#aab30a9246a7ca639ec6d7d42e1fa979c">conn_listener_type_supports_af_unix</a> (int type)</td></tr>
<tr class="separator:aab30a9246a7ca639ec6d7d42e1fa979c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b7ec2f7609aff902a55e7d2db9eb6f6"><td class="memItemLeft" align="right" valign="top">STATIC void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a9b7ec2f7609aff902a55e7d2db9eb6f6">connection_free_minimal</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:a9b7ec2f7609aff902a55e7d2db9eb6f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39b04f82ada8e36e17821d9fbfaa43df"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a39b04f82ada8e36e17821d9fbfaa43df">MOCK_IMPL</a> (void, connection_free_,(<a class="el" href="structconnection__t.html">connection_t</a> *conn))</td></tr>
<tr class="separator:a39b04f82ada8e36e17821d9fbfaa43df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade7f55aa182a3f727d25a510566351fd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#ade7f55aa182a3f727d25a510566351fd">connection_about_to_close_connection</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:ade7f55aa182a3f727d25a510566351fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a408567fdce15abf5e16163547d8223c1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a408567fdce15abf5e16163547d8223c1">connection_close_immediate</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:a408567fdce15abf5e16163547d8223c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a15ddd62951cefd848ec070f1d9c912"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a2a15ddd62951cefd848ec070f1d9c912">connection_mark_for_close_</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, int line, const char *file)</td></tr>
<tr class="separator:a2a15ddd62951cefd848ec070f1d9c912"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e0262219d1afbc700eacae441599fb4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a6e0262219d1afbc700eacae441599fb4">MOCK_IMPL</a> (void, connection_mark_for_close_internal_,(<a class="el" href="structconnection__t.html">connection_t</a> *conn, int line, const char *file))</td></tr>
<tr class="separator:a6e0262219d1afbc700eacae441599fb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afaaaf64de0fd3c6824a99950a50c822c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#afaaaf64de0fd3c6824a99950a50c822c">connection_expire_held_open</a> (void)</td></tr>
<tr class="separator:afaaaf64de0fd3c6824a99950a50c822c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb0804d5890924a2d6e3c4e3638ccfe4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#acb0804d5890924a2d6e3c4e3638ccfe4">connection_init_accepted_conn</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, const <a class="el" href="structlistener__connection__t.html">listener_connection_t</a> *listener)</td></tr>
<tr class="separator:acb0804d5890924a2d6e3c4e3638ccfe4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d38cc1df37b7254ce759c39b7c550b9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a2d38cc1df37b7254ce759c39b7c550b9">MOCK_IMPL</a> (STATIC int, connection_connect_sockaddr,(<a class="el" href="structconnection__t.html">connection_t</a> *conn, const struct sockaddr *sa, socklen_t sa_len, const struct sockaddr *bindaddr, socklen_t bindaddr_len, int *socket_error))</td></tr>
<tr class="separator:a2d38cc1df37b7254ce759c39b7c550b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8da7ea5e1894734eb989e42fde859b2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#af8da7ea5e1894734eb989e42fde859b2">connection_connect</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, const char *address, const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *addr, uint16_t port, int *socket_error)</td></tr>
<tr class="separator:af8da7ea5e1894734eb989e42fde859b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f7e49d562c42623a0bd1d8edeb2c269"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a2f7e49d562c42623a0bd1d8edeb2c269">connection_proxy_connect</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, int type)</td></tr>
<tr class="separator:a2f7e49d562c42623a0bd1d8edeb2c269"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a762af8c79046607b86c5be3a403c736b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a762af8c79046607b86c5be3a403c736b">connection_read_proxy_handshake</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:a762af8c79046607b86c5be3a403c736b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70eb2da60775cc0bda58682470a752b6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a70eb2da60775cc0bda58682470a752b6">retry_all_listeners</a> (<a class="el" href="structsmartlist__t.html">smartlist_t</a> *replaced_conns, <a class="el" href="structsmartlist__t.html">smartlist_t</a> *new_conns, int close_all_noncontrol)</td></tr>
<tr class="separator:a70eb2da60775cc0bda58682470a752b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01097d299ca112865a182ea93e1a936f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a01097d299ca112865a182ea93e1a936f">connection_mark_all_noncontrol_listeners</a> (void)</td></tr>
<tr class="separator:a01097d299ca112865a182ea93e1a936f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad57ab7f216b7f1565fb39ec2b00f8edd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#ad57ab7f216b7f1565fb39ec2b00f8edd">connection_mark_all_noncontrol_connections</a> (void)</td></tr>
<tr class="separator:ad57ab7f216b7f1565fb39ec2b00f8edd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c57c611567b6477ed9510bb633830ab"><td class="memItemLeft" align="right" valign="top">ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a7c57c611567b6477ed9510bb633830ab">connection_bucket_write_limit</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, time_t now)</td></tr>
<tr class="separator:a7c57c611567b6477ed9510bb633830ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af717f75714620d7187bcdaae2df1434e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#af717f75714620d7187bcdaae2df1434e">global_write_bucket_low</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, size_t attempt, int priority)</td></tr>
<tr class="separator:af717f75714620d7187bcdaae2df1434e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50fb185395ce0ef1cdb43114f90d5941"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a50fb185395ce0ef1cdb43114f90d5941">connection_read_bw_exhausted</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, bool is_global_bw)</td></tr>
<tr class="separator:a50fb185395ce0ef1cdb43114f90d5941"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbe6c9ccec29b7d6f20a657346f691bc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#adbe6c9ccec29b7d6f20a657346f691bc">connection_write_bw_exhausted</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, bool is_global_bw)</td></tr>
<tr class="separator:adbe6c9ccec29b7d6f20a657346f691bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa47137e71db6bcafff38485825c031be"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#aa47137e71db6bcafff38485825c031be">connection_consider_empty_read_buckets</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:aa47137e71db6bcafff38485825c031be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c1b68af6824c56fa7148db648b381fa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a3c1b68af6824c56fa7148db648b381fa">connection_consider_empty_write_buckets</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:a3c1b68af6824c56fa7148db648b381fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ff0267e6da4a42daaca672efb6a82b0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a4ff0267e6da4a42daaca672efb6a82b0">connection_bucket_init</a> (void)</td></tr>
<tr class="separator:a4ff0267e6da4a42daaca672efb6a82b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c0760d1fc50f5bd96ab05890f121f11"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a9c0760d1fc50f5bd96ab05890f121f11">connection_bucket_adjust</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:a9c0760d1fc50f5bd96ab05890f121f11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31da07e56253f0ca1dc6e4a0620d469b"><td class="memItemLeft" align="right" valign="top"><a id="a31da07e56253f0ca1dc6e4a0620d469b"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>connection_handle_read</b> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:a31da07e56253f0ca1dc6e4a0620d469b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09e89d0a59c7f3a016ce0835ee5bbbbe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a09e89d0a59c7f3a016ce0835ee5bbbbe">connection_buf_get_bytes</a> (char *string, size_t len, <a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:a09e89d0a59c7f3a016ce0835ee5bbbbe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a214ac732b498552723a03c07aad66ffc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a214ac732b498552723a03c07aad66ffc">connection_buf_get_line</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, char *data, size_t *data_len)</td></tr>
<tr class="separator:a214ac732b498552723a03c07aad66ffc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a173a993b4f9bcc7522f35c56e65b615f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a173a993b4f9bcc7522f35c56e65b615f">connection_fetch_from_buf_http</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, char **headers_out, size_t max_headerlen, char **body_out, size_t *body_used, size_t max_bodylen, int force_complete)</td></tr>
<tr class="separator:a173a993b4f9bcc7522f35c56e65b615f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2314f1a80fe9795a41202f9751d090a5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a2314f1a80fe9795a41202f9751d090a5">connection_wants_to_flush</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:a2314f1a80fe9795a41202f9751d090a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a6be46082e23668c2cb0f323c171ad2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a1a6be46082e23668c2cb0f323c171ad2">connection_outbuf_too_full</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:a1a6be46082e23668c2cb0f323c171ad2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e5a7a2ae63401fe8701b047e01fd2c4"><td class="memItemLeft" align="right" valign="top"><a id="a6e5a7a2ae63401fe8701b047e01fd2c4"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>connection_handle_write</b> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, int force)</td></tr>
<tr class="separator:a6e5a7a2ae63401fe8701b047e01fd2c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6fa2b1498c44f367a9bcf97986a31613"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a6fa2b1498c44f367a9bcf97986a31613">connection_flush</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:a6fa2b1498c44f367a9bcf97986a31613"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacd5b15598f9b3f9aa4e2695f38cd1f9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#aacd5b15598f9b3f9aa4e2695f38cd1f9">MOCK_IMPL</a> (void, connection_write_to_buf_impl_,(const char *string, size_t len, <a class="el" href="structconnection__t.html">connection_t</a> *conn, int zlib))</td></tr>
<tr class="separator:aacd5b15598f9b3f9aa4e2695f38cd1f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c604f1de607bec2ee660fcb3ab2503c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a1c604f1de607bec2ee660fcb3ab2503c">connection_buf_add_buf</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, buf_t *buf)</td></tr>
<tr class="separator:a1c604f1de607bec2ee660fcb3ab2503c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b70c46ecbac7c95507eedc1cf288da3"><td class="memItemLeft" align="right" valign="top"><a id="a5b70c46ecbac7c95507eedc1cf288da3"></a>
<a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>connection_list_by_type_state</b> (int type, int state)</td></tr>
<tr class="separator:a5b70c46ecbac7c95507eedc1cf288da3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44aa7984c12e41a880ea5688548d3a21"><td class="memItemLeft" align="right" valign="top"><a id="a44aa7984c12e41a880ea5688548d3a21"></a>
<a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>connection_list_by_type_purpose</b> (int type, int purpose)</td></tr>
<tr class="separator:a44aa7984c12e41a880ea5688548d3a21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68efdfdae46e70fa479296ee69358e61"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a68efdfdae46e70fa479296ee69358e61">MOCK_IMPL</a> (<a class="el" href="structconnection__t.html">connection_t</a> *, connection_get_by_type_addr_port_purpose,(int type, const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *addr, uint16_t port, int purpose))</td></tr>
<tr class="separator:a68efdfdae46e70fa479296ee69358e61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8172634fb511668d4ee40ab954ea262a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a8172634fb511668d4ee40ab954ea262a">connection_get_by_global_id</a> (uint64_t id)</td></tr>
<tr class="separator:a8172634fb511668d4ee40ab954ea262a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32c388b39c89a0a0caa40b4a9398eec7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a32c388b39c89a0a0caa40b4a9398eec7">connection_get_by_type</a> (int type)</td></tr>
<tr class="separator:a32c388b39c89a0a0caa40b4a9398eec7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaba7b52de4c051e6f72b649287dbf0d0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#aaba7b52de4c051e6f72b649287dbf0d0">connection_get_by_type_state</a> (int type, int state)</td></tr>
<tr class="separator:aaba7b52de4c051e6f72b649287dbf0d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a834b51dc69efa955ab17e7cd20a3c1f2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a834b51dc69efa955ab17e7cd20a3c1f2">connection_get_by_type_state_rendquery</a> (int type, int state, const char *rendquery)</td></tr>
<tr class="separator:a834b51dc69efa955ab17e7cd20a3c1f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86d2c5314a90b6c62dae9c9fc82ed241"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a86d2c5314a90b6c62dae9c9fc82ed241">connection_dir_list_by_purpose_and_resource</a> (int purpose, const char *resource)</td></tr>
<tr class="separator:a86d2c5314a90b6c62dae9c9fc82ed241"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a147c7e687750c8a345c5febefe4a1409"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a147c7e687750c8a345c5febefe4a1409">connection_dir_list_by_purpose_resource_and_state</a> (int purpose, const char *resource, int state)</td></tr>
<tr class="separator:a147c7e687750c8a345c5febefe4a1409"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ea12080fcbf972d9dbd36392ab8335f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a9ea12080fcbf972d9dbd36392ab8335f">any_other_active_or_conns</a> (const <a class="el" href="structor__connection__t.html">or_connection_t</a> *this_conn)</td></tr>
<tr class="separator:a9ea12080fcbf972d9dbd36392ab8335f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c3a40d68e869567e1a01d0e577534b2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a1c3a40d68e869567e1a01d0e577534b2">connection_is_listener</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:a1c3a40d68e869567e1a01d0e577534b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8cdf763ad0a8fa79e7561c91b3f8ecca"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a8cdf763ad0a8fa79e7561c91b3f8ecca">connection_state_is_open</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:a8cdf763ad0a8fa79e7561c91b3f8ecca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef88441c4b3ee3a887d3ec0927c66675"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#aef88441c4b3ee3a887d3ec0927c66675">connection_state_is_connecting</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:aef88441c4b3ee3a887d3ec0927c66675"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aafb7ad80e97c7c4d92831785f5262853"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#aafb7ad80e97c7c4d92831785f5262853">alloc_http_authenticator</a> (const char *authenticator)</td></tr>
<tr class="separator:aafb7ad80e97c7c4d92831785f5262853"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac609b4da1d53630fa78d115ce15f3ef1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#ac609b4da1d53630fa78d115ce15f3ef1">MOCK_IMPL</a> (STATIC <a class="el" href="structsmartlist__t.html">smartlist_t</a> *, pick_oos_victims,(int n))</td></tr>
<tr class="separator:ac609b4da1d53630fa78d115ce15f3ef1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7559009dae296c8d0cce9be7f3203660"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a7559009dae296c8d0cce9be7f3203660">MOCK_IMPL</a> (STATIC void, kill_conn_list_for_oos,(<a class="el" href="structsmartlist__t.html">smartlist_t</a> *conns))</td></tr>
<tr class="separator:a7559009dae296c8d0cce9be7f3203660"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd3783a8e4fc9ee457e1e50cc638b169"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#afd3783a8e4fc9ee457e1e50cc638b169">connection_check_oos</a> (int n_socks, int failed)</td></tr>
<tr class="separator:afd3783a8e4fc9ee457e1e50cc638b169"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4da339a8cd53ba30262d8445ab62e8a3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a4da339a8cd53ba30262d8445ab62e8a3">connection_dump_buffer_mem_stats</a> (int severity)</td></tr>
<tr class="separator:a4da339a8cd53ba30262d8445ab62e8a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a738d9e7ef0c4a101c2adbd4cade35475"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#a738d9e7ef0c4a101c2adbd4cade35475">assert_connection_ok</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, time_t now)</td></tr>
<tr class="separator:a738d9e7ef0c4a101c2adbd4cade35475"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe9e86e1e84ebe4b3a167c0c8f9314c3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#afe9e86e1e84ebe4b3a167c0c8f9314c3">get_proxy_addrport</a> (<a class="el" href="structtor__addr__t.html">tor_addr_t</a> *addr, uint16_t *port, int *proxy_type, const <a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:afe9e86e1e84ebe4b3a167c0c8f9314c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7f6042798d28314aa4553456bd5f9e5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#ad7f6042798d28314aa4553456bd5f9e5">log_failed_proxy_connection</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:ad7f6042798d28314aa4553456bd5f9e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac060666510d641a1a275af05d985a92"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#aac060666510d641a1a275af05d985a92">connection_free_all</a> (void)</td></tr>
<tr class="separator:aac060666510d641a1a275af05d985a92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab88cfc0f345a7adb709c58312e6ae462"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8c.html#ab88cfc0f345a7adb709c58312e6ae462">MOCK_IMPL</a> (void, clock_skew_warning,(const <a class="el" href="structconnection__t.html">connection_t</a> *conn, long apparent_skew, int trusted, <a class="el" href="torlog_8h.html#a3ea3afb80db88b6ccec80d80ac98cea1">log_domain_mask_t</a> domain, const char *received, const char *source))</td></tr>
<tr class="separator:ab88cfc0f345a7adb709c58312e6ae462"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>General high-level functions to handle reading and writing on connections. </p>
<p>Each connection (ideally) represents a TLS connection, a TCP socket, a unix socket, or a UDP socket on which reads and writes can occur. (But see <a class="el" href="connection__edge_8c.html" title="Handle edge streams. ">connection_edge.c</a> for cases where connections can also represent streams that do not have a corresponding socket.)</p>
<p>The module implements the abstract type, <a class="el" href="structconnection__t.html">connection_t</a>. The subtypes are: </p><ul>
<li>
<a class="el" href="structlistener__connection__t.html">listener_connection_t</a>, implemented here in <a class="el" href="connection_8c.html" title="General high-level functions to handle reading and writing on connections. ">connection.c</a> </li>
<li>
<a class="el" href="structdir__connection__t.html">dir_connection_t</a>, implemented in <a class="el" href="directory_8c.html" title="Code to send and fetch information from directory authorities and caches via HTTP. ">directory.c</a> </li>
<li>
<a class="el" href="structor__connection__t.html">or_connection_t</a>, implemented in <a class="el" href="connection__or_8c.html" title="Functions to handle OR connections, TLS handshaking, and cells on the network. ">connection_or.c</a> </li>
<li>
<a class="el" href="structedge__connection__t.html">edge_connection_t</a>, implemented in <a class="el" href="connection__edge_8c.html" title="Handle edge streams. ">connection_edge.c</a>, along with its subtype(s): <ul>
<li>
<a class="el" href="structentry__connection__t.html">entry_connection_t</a>, also implemented in <a class="el" href="connection__edge_8c.html" title="Handle edge streams. ">connection_edge.c</a> </li>
</ul>
</li>
<li>
<a class="el" href="structcontrol__connection__t.html">control_connection_t</a>, implemented in <a class="el" href="control_8c.html" title="Implementation for Tor&#39;s control-socket interface. ">control.c</a> </li>
</ul>
<p>The base type implemented in this module is responsible for basic rate limiting, flow control, and marshalling bytes onto and off of the network (either directly or via TLS).</p>
<p>Connections are registered with the main loop with connection_add(). As they become able to read or write register the fact with the event main loop by calling <a class="el" href="main_8c.html#a15bfc77f804db60403980cb1abed4804">connection_watch_events()</a>, connection_start_reading(), or connection_start_writing(). When they no longer want to read or write, they call connection_stop_reading() or connection_stop_writing().</p>
<p>To queue data to be written on a connection, call connection_buf_add(). When data arrives, the connection_process_inbuf() callback is invoked, which dispatches to a type-specific function (such as <a class="el" href="connection__edge_8c.html#af7fb9b70852e8b94a3aae49033285cfc">connection_edge_process_inbuf()</a> for example). Connection types that need notice of when data has been written receive notification via connection_flushed_some() and connection_finished_flushing(). These functions all delegate to type-specific implementations.</p>
<p>Additionally, beyond the core of <a class="el" href="structconnection__t.html">connection_t</a>, this module also implements: </p><ul>
<li>
Listeners, which wait for incoming sockets and launch connections </li>
<li>
Outgoing SOCKS proxy support </li>
<li>
Outgoing HTTP proxy support </li>
<li>
An out-of-sockets handler for dealing with socket exhaustion </li>
</ul>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a907c87f1a07729b9a04e3e83ab36bf58"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a907c87f1a07729b9a04e3e83ab36bf58">&#9670;&nbsp;</a></span>CASE_ANY_LISTENER_TYPE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CASE_ANY_LISTENER_TYPE</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">case</span> <a class="code" href="or_8h.html#a39de45094214b726f4caa0de534f390c">CONN_TYPE_OR_LISTENER</a>: \</div><div class="line">    case <a class="code" href="or_8h.html#a7ee8fc8604d4ca8b43d4b29ab277104c">CONN_TYPE_EXT_OR_LISTENER</a>: \</div><div class="line">    case <a class="code" href="or_8h.html#acee38ce81e0533f73f399367250afbfb">CONN_TYPE_AP_LISTENER</a>: \</div><div class="line">    case <a class="code" href="or_8h.html#a298bb4f89fbe3ee40a6259037f93b9dd">CONN_TYPE_DIR_LISTENER</a>: \</div><div class="line">    case <a class="code" href="or_8h.html#a52ccb8c5940e5615f547237dabc27fbc">CONN_TYPE_CONTROL_LISTENER</a>: \</div><div class="line">    case <a class="code" href="or_8h.html#af963f113c68908d9361243f0dd7afc1d">CONN_TYPE_AP_TRANS_LISTENER</a>: \</div><div class="line">    case <a class="code" href="or_8h.html#ac50462426ee5ec5abebeb59ded563c2c">CONN_TYPE_AP_NATD_LISTENER</a>: \</div><div class="line">    case <a class="code" href="or_8h.html#ae3e01d7ba2ff711f4bbc24f27b21570c">CONN_TYPE_AP_DNS_LISTENER</a>: \</div><div class="line">    case <a class="code" href="or_8h.html#a1faead8ee2d3fcf0c71d60f7ff4fc136">CONN_TYPE_AP_HTTP_CONNECT_LISTENER</a></div><div class="ttc" id="or_8h_html_a39de45094214b726f4caa0de534f390c"><div class="ttname"><a href="or_8h.html#a39de45094214b726f4caa0de534f390c">CONN_TYPE_OR_LISTENER</a></div><div class="ttdeci">#define CONN_TYPE_OR_LISTENER</div><div class="ttdef"><b>Definition:</b> or.h:197</div></div>
<div class="ttc" id="or_8h_html_a52ccb8c5940e5615f547237dabc27fbc"><div class="ttname"><a href="or_8h.html#a52ccb8c5940e5615f547237dabc27fbc">CONN_TYPE_CONTROL_LISTENER</a></div><div class="ttdeci">#define CONN_TYPE_CONTROL_LISTENER</div><div class="ttdef"><b>Definition:</b> or.h:214</div></div>
<div class="ttc" id="or_8h_html_a7ee8fc8604d4ca8b43d4b29ab277104c"><div class="ttname"><a href="or_8h.html#a7ee8fc8604d4ca8b43d4b29ab277104c">CONN_TYPE_EXT_OR_LISTENER</a></div><div class="ttdeci">#define CONN_TYPE_EXT_OR_LISTENER</div><div class="ttdef"><b>Definition:</b> or.h:229</div></div>
<div class="ttc" id="or_8h_html_ae3e01d7ba2ff711f4bbc24f27b21570c"><div class="ttname"><a href="or_8h.html#ae3e01d7ba2ff711f4bbc24f27b21570c">CONN_TYPE_AP_DNS_LISTENER</a></div><div class="ttdeci">#define CONN_TYPE_AP_DNS_LISTENER</div><div class="ttdef"><b>Definition:</b> or.h:224</div></div>
<div class="ttc" id="or_8h_html_ac50462426ee5ec5abebeb59ded563c2c"><div class="ttname"><a href="or_8h.html#ac50462426ee5ec5abebeb59ded563c2c">CONN_TYPE_AP_NATD_LISTENER</a></div><div class="ttdeci">#define CONN_TYPE_AP_NATD_LISTENER</div><div class="ttdef"><b>Definition:</b> or.h:222</div></div>
<div class="ttc" id="or_8h_html_af963f113c68908d9361243f0dd7afc1d"><div class="ttname"><a href="or_8h.html#af963f113c68908d9361243f0dd7afc1d">CONN_TYPE_AP_TRANS_LISTENER</a></div><div class="ttdeci">#define CONN_TYPE_AP_TRANS_LISTENER</div><div class="ttdef"><b>Definition:</b> or.h:219</div></div>
<div class="ttc" id="or_8h_html_a298bb4f89fbe3ee40a6259037f93b9dd"><div class="ttname"><a href="or_8h.html#a298bb4f89fbe3ee40a6259037f93b9dd">CONN_TYPE_DIR_LISTENER</a></div><div class="ttdeci">#define CONN_TYPE_DIR_LISTENER</div><div class="ttdef"><b>Definition:</b> or.h:209</div></div>
<div class="ttc" id="or_8h_html_acee38ce81e0533f73f399367250afbfb"><div class="ttname"><a href="or_8h.html#acee38ce81e0533f73f399367250afbfb">CONN_TYPE_AP_LISTENER</a></div><div class="ttdeci">#define CONN_TYPE_AP_LISTENER</div><div class="ttdef"><b>Definition:</b> or.h:204</div></div>
<div class="ttc" id="or_8h_html_a1faead8ee2d3fcf0c71d60f7ff4fc136"><div class="ttname"><a href="or_8h.html#a1faead8ee2d3fcf0c71d60f7ff4fc136">CONN_TYPE_AP_HTTP_CONNECT_LISTENER</a></div><div class="ttdeci">#define CONN_TYPE_AP_HTTP_CONNECT_LISTENER</div><div class="ttdef"><b>Definition:</b> or.h:231</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af5e603d674fb3102d163c4ad33b3a9ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af5e603d674fb3102d163c4ad33b3a9ee">&#9670;&nbsp;</a></span>CLIENT_IDLE_TIME_FOR_PRIORITY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CLIENT_IDLE_TIME_FOR_PRIORITY&#160;&#160;&#160;30</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>How many seconds of no active local circuits will make the connection revert to the "relayed" bandwidth class? </p>

</div>
</div>
<a id="ac702e03a6f1b49bd092cd1217ef4abcf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac702e03a6f1b49bd092cd1217ef4abcf">&#9670;&nbsp;</a></span>CONN_GET_ALL_TEMPLATE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CONN_GET_ALL_TEMPLATE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">var, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">test&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">STMT_BEGIN \</div><div class="line">    smartlist_t *conns = get_connection_array();   \</div><div class="line">    smartlist_t *ret_conns = smartlist_new();     \</div><div class="line">    SMARTLIST_FOREACH_BEGIN(conns, <a class="code" href="structconnection__t.html">connection_t</a> *, var) { \</div><div class="line">      if (var &amp;&amp; (test) &amp;&amp; !var-&gt;marked_for_close) \</div><div class="line">        smartlist_add(ret_conns, var); \</div><div class="line">    } SMARTLIST_FOREACH_END(var);                                            \</div><div class="line">    return ret_conns; \</div><div class="line">  STMT_END</div><div class="ttc" id="structconnection__t_html"><div class="ttname"><a href="structconnection__t.html">connection_t</a></div><div class="ttdef"><b>Definition:</b> or.h:1326</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4e89c204c3d478dbc22f8d9881c4b475"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e89c204c3d478dbc22f8d9881c4b475">&#9670;&nbsp;</a></span>CONN_GET_TEMPLATE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CONN_GET_TEMPLATE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">var, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">test&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">STMT_BEGIN                                       \</div><div class="line">    smartlist_t *conns = get_connection_array();   \</div><div class="line">    SMARTLIST_FOREACH(conns, <a class="code" href="structconnection__t.html">connection_t</a> *, var,  \</div><div class="line">    {                                              \</div><div class="line">      if (var &amp;&amp; (test) &amp;&amp; !var-&gt;marked_for_close) \</div><div class="line">        return var;                                \</div><div class="line">    });                                            \</div><div class="line">    return NULL;                                   \</div><div class="line">  STMT_END</div><div class="ttc" id="structconnection__t_html"><div class="ttname"><a href="structconnection__t.html">connection_t</a></div><div class="ttdef"><b>Definition:</b> or.h:1326</div></div>
</div><!-- fragment --><p>Return a <a class="el" href="structconnection__t.html">connection_t</a> * from get_connection_array() that satisfies test on var, and that is not marked for close. </p>

</div>
</div>
<a id="adf51b7f7a691069361b98ca4f275188e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf51b7f7a691069361b98ca4f275188e">&#9670;&nbsp;</a></span>CONN_IS_CLOSED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CONN_IS_CLOSED</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">c</td><td>)</td>
          <td>&#160;&#160;&#160;((c)-&gt;linked ? ((c)-&gt;linked_conn_is_closed) : (! SOCKET_OK(c-&gt;s)))</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff <a class="el" href="connection_8c.html#a408567fdce15abf5e16163547d8223c1">connection_close_immediate()</a> has been called on this connection. </p>

</div>
</div>
<a id="a50dadbeb8efd80876453a7de512f257e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50dadbeb8efd80876453a7de512f257e">&#9670;&nbsp;</a></span>DIR_CONN_LIST_TEMPLATE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DIR_CONN_LIST_TEMPLATE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">conn_var, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">conn_test, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">dirconn_var, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">dirconn_test&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">STMT_BEGIN                                                    \</div><div class="line">    smartlist_t *conns = get_connection_array();                \</div><div class="line">    smartlist_t *dir_conns = smartlist_new();                   \</div><div class="line">    SMARTLIST_FOREACH_BEGIN(conns, <a class="code" href="structconnection__t.html">connection_t</a> *, conn_var) {  \</div><div class="line">      if (conn_var &amp;&amp; (conn_test)                               \</div><div class="line">          &amp;&amp; conn_var-&gt;type == <a class="code" href="or_8h.html#ab1f1548533130800349a76e269272aa6">CONN_TYPE_DIR</a>                    \</div><div class="line">          &amp;&amp; !conn_var-&gt;marked_for_close) {                     \</div><div class="line">        dir_connection_t *dirconn_var = TO_DIR_CONN(conn_var);  \</div><div class="line">        if (dirconn_var &amp;&amp; (dirconn_test)) {                    \</div><div class="line">          smartlist_add(dir_conns, dirconn_var);                \</div><div class="line">        }                                                       \</div><div class="line">      }                                                         \</div><div class="line">    } SMARTLIST_FOREACH_END(conn_var);                          \</div><div class="line">    return dir_conns;                                           \</div><div class="line">  STMT_END</div><div class="ttc" id="structconnection__t_html"><div class="ttname"><a href="structconnection__t.html">connection_t</a></div><div class="ttdef"><b>Definition:</b> or.h:1326</div></div>
<div class="ttc" id="or_8h_html_ab1f1548533130800349a76e269272aa6"><div class="ttname"><a href="or_8h.html#ab1f1548533130800349a76e269272aa6">CONN_TYPE_DIR</a></div><div class="ttdeci">#define CONN_TYPE_DIR</div><div class="ttdef"><b>Definition:</b> or.h:211</div></div>
</div><!-- fragment --><p>Return a new smartlist of <a class="el" href="structdir__connection__t.html">dir_connection_t</a> * from get_connection_array() that satisfy conn_test on <a class="el" href="structconnection__t.html">connection_t</a> *conn_var, and dirconn_test on <a class="el" href="structdir__connection__t.html">dir_connection_t</a> *dirconn_var. conn_var must be of CONN_TYPE_DIR and not marked for close to be included in the list. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="aafb7ad80e97c7c4d92831785f5262853"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aafb7ad80e97c7c4d92831785f5262853">&#9670;&nbsp;</a></span>alloc_http_authenticator()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* alloc_http_authenticator </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>authenticator</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocates a base64'ed authenticator for use in http or https auth, based on the input string <b>authenticator</b>. Returns it if success, else returns NULL. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_aafb7ad80e97c7c4d92831785f5262853_cgraph.png" border="0" usemap="#connection_8c_aafb7ad80e97c7c4d92831785f5262853_cgraph" alt=""/></div>
<map name="connection_8c_aafb7ad80e97c7c4d92831785f5262853_cgraph" id="connection_8c_aafb7ad80e97c7c4d92831785f5262853_cgraph">
<area shape="rect" id="node2" href="util__format_8c.html#a733f32f58c6056750ad6f64228af51b2" title="base64_encode_size" alt="" coords="213,5,357,32"/>
</map>
</div>

</div>
</div>
<a id="a9ea12080fcbf972d9dbd36392ab8335f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ea12080fcbf972d9dbd36392ab8335f">&#9670;&nbsp;</a></span>any_other_active_or_conns()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int any_other_active_or_conns </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__connection__t.html">or_connection_t</a> *&#160;</td>
          <td class="paramname"><em>this_conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if there are any active OR connections apart from <b>this_conn</b>.</p>
<p>We use this to guess if we should tell the controller that we didn't manage to connect to any of our bridges. </p>

</div>
</div>
<a id="a738d9e7ef0c4a101c2adbd4cade35475"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a738d9e7ef0c4a101c2adbd4cade35475">&#9670;&nbsp;</a></span>assert_connection_ok()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void assert_connection_ok </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Verify that connection <b>conn</b> has all of its invariants correct. Trigger an assert if anything is invalid. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a738d9e7ef0c4a101c2adbd4cade35475_icgraph.png" border="0" usemap="#connection_8c_a738d9e7ef0c4a101c2adbd4cade35475_icgraph" alt=""/></div>
<map name="connection_8c_a738d9e7ef0c4a101c2adbd4cade35475_icgraph" id="connection_8c_a738d9e7ef0c4a101c2adbd4cade35475_icgraph">
<area shape="rect" id="node2" href="connection_8h.html#a408567fdce15abf5e16163547d8223c1" title="connection_close_immediate" alt="" coords="216,5,407,32"/>
<area shape="rect" id="node3" href="connection_8h.html#a2a15ddd62951cefd848ec070f1d9c912" title="connection_mark_for\l_close_" alt="" coords="240,57,383,98"/>
<area shape="rect" id="node5" href="connection_8c.html#a6e0262219d1afbc700eacae441599fb4" title="MOCK_IMPL" alt="" coords="261,123,361,149"/>
<area shape="rect" id="node6" href="connection__or_8h.html#a61f2d552138b0e015906710a045a6c55" title="connection_or_finished\l_flushing" alt="" coords="234,174,389,215"/>
<area shape="rect" id="node7" href="dns_8h.html#abab9ee4ae98eafd0454adef2477f1a76" title="assert_all_pending\l_dns_resolves_ok" alt="" coords="246,239,377,281"/>
<area shape="rect" id="node8" href="main_8h.html#a5a32ff7bb266432116efdc333987a0e4" title="add_connection_to_closeable_list" alt="" coords="203,305,420,332"/>
<area shape="rect" id="node4" href="connection__edge_8c.html#a5922c995ab015f688168d02a6b954050" title="MOCK_IMPL" alt="" coords="468,64,568,91"/>
</map>
</div>

</div>
</div>
<a id="a8563df222c8cdd0bc7daf33869eefb2b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8563df222c8cdd0bc7daf33869eefb2b">&#9670;&nbsp;</a></span>conn_get_outbound_address()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> * conn_get_outbound_address </td>
          <td>(</td>
          <td class="paramtype">sa_family_t&#160;</td>
          <td class="paramname"><em>family</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>conn_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Retrieve the outbound address depending on the protocol (IPv4 or IPv6) and the connection type (relay, exit, ...) Return a socket address or NULL in case nothing is configured. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a8563df222c8cdd0bc7daf33869eefb2b_cgraph.png" border="0" usemap="#connection_8c_a8563df222c8cdd0bc7daf33869eefb2b_cgraph" alt=""/></div>
<map name="connection_8c_a8563df222c8cdd0bc7daf33869eefb2b_cgraph" id="connection_8c_a8563df222c8cdd0bc7daf33869eefb2b_cgraph">
<area shape="rect" id="node2" href="address_8c.html#a6ecc12236743caf7527376436791c75e" title="tor_addr_is_null" alt="" coords="241,5,355,32"/>
</map>
</div>

</div>
</div>
<a id="aab30a9246a7ca639ec6d7d42e1fa979c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab30a9246a7ca639ec6d7d42e1fa979c">&#9670;&nbsp;</a></span>conn_listener_type_supports_af_unix()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int conn_listener_type_supports_af_unix </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff the provided connection listener type supports AF_UNIX sockets. </p>

</div>
</div>
<a id="a0f03ee7b48ac2f674af67ce1f0201d3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f03ee7b48ac2f674af67ce1f0201d3c">&#9670;&nbsp;</a></span>conn_state_to_string()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* conn_state_to_string </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the human-readable name for the connection state <b>state</b> for the connection type <b>type</b> </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a0f03ee7b48ac2f674af67ce1f0201d3c_icgraph.png" border="0" usemap="#connection_8c_a0f03ee7b48ac2f674af67ce1f0201d3c_icgraph" alt=""/></div>
<map name="connection_8c_a0f03ee7b48ac2f674af67ce1f0201d3c_icgraph" id="connection_8c_a0f03ee7b48ac2f674af67ce1f0201d3c_icgraph">
<area shape="rect" id="node2" href="connection_8h.html#afaaaf64de0fd3c6824a99950a50c822c" title="connection_expire_held_open" alt="" coords="196,5,389,32"/>
</map>
</div>

</div>
</div>
<a id="aa05a243a33eb2a242e48f1866ab2806a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa05a243a33eb2a242e48f1866ab2806a">&#9670;&nbsp;</a></span>conn_type_to_string()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* conn_type_to_string </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the human-readable name for the connection type <b>type</b> </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_aa05a243a33eb2a242e48f1866ab2806a_icgraph.png" border="0" usemap="#connection_8c_aa05a243a33eb2a242e48f1866ab2806a_icgraph" alt=""/></div>
<map name="connection_8c_aa05a243a33eb2a242e48f1866ab2806a_icgraph" id="connection_8c_aa05a243a33eb2a242e48f1866ab2806a_icgraph">
<area shape="rect" id="node2" href="connection_8h.html#afaaaf64de0fd3c6824a99950a50c822c" title="connection_expire_held_open" alt="" coords="192,5,385,32"/>
</map>
</div>

</div>
</div>
<a id="ade7f55aa182a3f727d25a510566351fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade7f55aa182a3f727d25a510566351fd">&#9670;&nbsp;</a></span>connection_about_to_close_connection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_about_to_close_connection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Called when we're about to finally unlink and free a connection: perform necessary accounting and cleanup</p><ul>
<li>Directory conns that failed to fetch a rendezvous descriptor need to inform pending rendezvous streams.</li>
<li>OR conns need to call rep_hist_note_*() to record status.</li>
<li>AP conns need to send a socks reject if necessary.</li>
<li>Exit conns need to call <a class="el" href="dns_8c.html#a6a761da0f544b95dc87b5522f49d9866">connection_dns_remove()</a> if necessary.</li>
<li>AP and Exit conns need to send an end cell if they can.</li>
<li>DNS conns need to fail any resolves that are pending on them.</li>
<li>OR and edge connections need to be unlinked from circuits. </li>
</ul>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_ade7f55aa182a3f727d25a510566351fd_cgraph.png" border="0" usemap="#connection_8c_ade7f55aa182a3f727d25a510566351fd_cgraph" alt=""/></div>
<map name="connection_8c_ade7f55aa182a3f727d25a510566351fd_cgraph" id="connection_8c_ade7f55aa182a3f727d25a510566351fd_cgraph">
<area shape="rect" id="node2" href="directory_8c.html#ae225c64a35559d7a6e7b06d8fd5c121c" title="connection_dir_about\l_to_close" alt="" coords="196,5,341,47"/>
</map>
</div>

</div>
</div>
<a id="a9c0760d1fc50f5bd96ab05890f121f11"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c0760d1fc50f5bd96ab05890f121f11">&#9670;&nbsp;</a></span>connection_bucket_adjust()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_bucket_adjust </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Update the global connection bucket settings to a new value. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a9c0760d1fc50f5bd96ab05890f121f11_cgraph.png" border="0" usemap="#connection_8c_a9c0760d1fc50f5bd96ab05890f121f11_cgraph" alt=""/></div>
<map name="connection_8c_a9c0760d1fc50f5bd96ab05890f121f11_cgraph" id="connection_8c_a9c0760d1fc50f5bd96ab05890f121f11_cgraph">
<area shape="rect" id="node2" href="token__bucket_8c.html#a50fe824eab38393da0fc4f96d745d42c" title="token_bucket_rw_adjust" alt="" coords="227,64,389,91"/>
<area shape="rect" id="node3" href="token__bucket_8c.html#a7e7591bea5c400ec818196fc5435cb15" title="token_bucket_cfg_init" alt="" coords="448,5,597,32"/>
<area shape="rect" id="node4" href="token__bucket_8c.html#a22392cbca806a78cd2e87691a6065251" title="rate_per_sec_to_rate\l_per_step" alt="" coords="451,57,595,98"/>
<area shape="rect" id="node6" href="token__bucket_8c.html#a43ef8eed8a63421520fce9b002013f46" title="token_bucket_raw_adjust" alt="" coords="437,123,608,149"/>
<area shape="rect" id="node5" href="compat__time_8c.html#a663ad7bf6571707eee93acdc3dc51384" title="monotime_coarse_stamp\l_units_to_approx_msec" alt="" coords="656,57,824,98"/>
</map>
</div>

</div>
</div>
<a id="a4ff0267e6da4a42daaca672efb6a82b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ff0267e6da4a42daaca672efb6a82b0">&#9670;&nbsp;</a></span>connection_bucket_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_bucket_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize the global buckets to the values configured in the options </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a4ff0267e6da4a42daaca672efb6a82b0_cgraph.png" border="0" usemap="#connection_8c_a4ff0267e6da4a42daaca672efb6a82b0_cgraph" alt=""/></div>
<map name="connection_8c_a4ff0267e6da4a42daaca672efb6a82b0_cgraph" id="connection_8c_a4ff0267e6da4a42daaca672efb6a82b0_cgraph">
<area shape="rect" id="node2" href="compat__time_8c.html#abb7b0b5ad3f045729cb47cc2151000b2" title="monotime_coarse_get\l_stamp" alt="" coords="208,46,359,87"/>
<area shape="rect" id="node3" href="token__bucket_8c.html#a41006ac9011ad57892c02f1e6448a9f2" title="token_bucket_rw_init" alt="" coords="211,112,356,139"/>
<area shape="rect" id="node4" href="token__bucket_8c.html#a50fe824eab38393da0fc4f96d745d42c" title="token_bucket_rw_adjust" alt="" coords="407,79,569,105"/>
<area shape="rect" id="node9" href="token__bucket_8c.html#af5d53fffb8a825d38565fc013e04f4db" title="token_bucket_rw_reset" alt="" coords="409,144,567,171"/>
<area shape="rect" id="node5" href="token__bucket_8c.html#a7e7591bea5c400ec818196fc5435cb15" title="token_bucket_cfg_init" alt="" coords="628,5,777,32"/>
<area shape="rect" id="node6" href="token__bucket_8c.html#a22392cbca806a78cd2e87691a6065251" title="rate_per_sec_to_rate\l_per_step" alt="" coords="631,57,775,98"/>
<area shape="rect" id="node8" href="token__bucket_8c.html#a43ef8eed8a63421520fce9b002013f46" title="token_bucket_raw_adjust" alt="" coords="617,123,788,149"/>
<area shape="rect" id="node7" href="compat__time_8c.html#a663ad7bf6571707eee93acdc3dc51384" title="monotime_coarse_stamp\l_units_to_approx_msec" alt="" coords="836,57,1004,98"/>
<area shape="rect" id="node10" href="token__bucket_8c.html#abd787fcddb80c9ea7ace35aece2f3988" title="token_bucket_raw_reset" alt="" coords="621,173,785,200"/>
</map>
</div>

</div>
</div>
<a id="a7c57c611567b6477ed9510bb633830ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c57c611567b6477ed9510bb633830ab">&#9670;&nbsp;</a></span>connection_bucket_write_limit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t connection_bucket_write_limit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>How many bytes at most can we write onto this connection? </p>

</div>
</div>
<a id="a1c604f1de607bec2ee660fcb3ab2503c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c604f1de607bec2ee660fcb3ab2503c">&#9670;&nbsp;</a></span>connection_buf_add_buf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_buf_add_buf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">buf_t *&#160;</td>
          <td class="paramname"><em>buf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add all bytes from <b>buf</b> to <b>conn</b>'s outbuf, draining them from <b>buf</b>. (If the connection is marked and will soon be closed, nothing is drained.) </p>

</div>
</div>
<a id="a09e89d0a59c7f3a016ce0835ee5bbbbe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09e89d0a59c7f3a016ce0835ee5bbbbe">&#9670;&nbsp;</a></span>connection_buf_get_bytes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_buf_get_bytes </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A pass-through to fetch_from_buf. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a09e89d0a59c7f3a016ce0835ee5bbbbe_cgraph.png" border="0" usemap="#connection_8c_a09e89d0a59c7f3a016ce0835ee5bbbbe_cgraph" alt=""/></div>
<map name="connection_8c_a09e89d0a59c7f3a016ce0835ee5bbbbe_cgraph" id="connection_8c_a09e89d0a59c7f3a016ce0835ee5bbbbe_cgraph">
<area shape="rect" id="node2" href="buffers_8c.html#aee885c0513a4508ae43799128f2ef740" title="buf_get_bytes" alt="" coords="188,13,292,39"/>
</map>
</div>

</div>
</div>
<a id="a214ac732b498552723a03c07aad66ffc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a214ac732b498552723a03c07aad66ffc">&#9670;&nbsp;</a></span>connection_buf_get_line()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_buf_get_line </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>data_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>As <a class="el" href="buffers_8c.html#a8eae1b7d95fe3452ed0a7015c8928d06">buf_get_line()</a>, but read from a connection's input buffer. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a214ac732b498552723a03c07aad66ffc_cgraph.png" border="0" usemap="#connection_8c_a214ac732b498552723a03c07aad66ffc_cgraph" alt=""/></div>
<map name="connection_8c_a214ac732b498552723a03c07aad66ffc_cgraph" id="connection_8c_a214ac732b498552723a03c07aad66ffc_cgraph">
<area shape="rect" id="node2" href="buffers_8c.html#a8eae1b7d95fe3452ed0a7015c8928d06" title="buf_get_line" alt="" coords="216,5,308,32"/>
</map>
</div>

</div>
</div>
<a id="afd3783a8e4fc9ee457e1e50cc638b169"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd3783a8e4fc9ee457e1e50cc638b169">&#9670;&nbsp;</a></span>connection_check_oos()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_check_oos </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n_socks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>failed</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Out-of-Sockets handler; n_socks is the current number of open sockets, and failed is non-zero if a socket exhaustion related error immediately preceded this call. This is where to do circuit-killing heuristics as needed. </p>

</div>
</div>
<a id="a408567fdce15abf5e16163547d8223c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a408567fdce15abf5e16163547d8223c1">&#9670;&nbsp;</a></span>connection_close_immediate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_close_immediate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Close the underlying socket for <b>conn</b>, so we don't try to flush it. Must be used in conjunction with (right before) connection_mark_for_close(). </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a408567fdce15abf5e16163547d8223c1_cgraph.png" border="0" usemap="#connection_8c_a408567fdce15abf5e16163547d8223c1_cgraph" alt=""/></div>
<map name="connection_8c_a408567fdce15abf5e16163547d8223c1_cgraph" id="connection_8c_a408567fdce15abf5e16163547d8223c1_cgraph">
<area shape="rect" id="node2" href="connection_8c.html#a738d9e7ef0c4a101c2adbd4cade35475" title="assert_connection_ok" alt="" coords="244,5,393,32"/>
</map>
</div>

</div>
</div>
<a id="af8da7ea5e1894734eb989e42fde859b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8da7ea5e1894734eb989e42fde859b2">&#9670;&nbsp;</a></span>connection_connect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_connect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>socket_error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Take conn, make a nonblocking socket; try to connect to addr:port (port arrives in <em>host order</em>). If fail, return -1 and if applicable put your best guess about errno into *<b>socket_error</b>. Else assign s to conn-&gt;s: if connected return 1, if EAGAIN return 0.</p>
<p>addr:port can be different to conn-&gt;addr:conn-&gt;port if connecting through a proxy.</p>
<p>address is used to make the logs useful.</p>
<p>On success, add conn to the list of polled connections. </p>

</div>
</div>
<a id="aa47137e71db6bcafff38485825c031be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa47137e71db6bcafff38485825c031be">&#9670;&nbsp;</a></span>connection_consider_empty_read_buckets()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_consider_empty_read_buckets </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If we have exhausted our global buckets, or the buckets for conn, stop reading. </p>

</div>
</div>
<a id="a3c1b68af6824c56fa7148db648b381fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c1b68af6824c56fa7148db648b381fa">&#9670;&nbsp;</a></span>connection_consider_empty_write_buckets()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_consider_empty_write_buckets </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If we have exhausted our global buckets, or the buckets for conn, stop writing. </p>

</div>
</div>
<a id="a86d2c5314a90b6c62dae9c9fc82ed241"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86d2c5314a90b6c62dae9c9fc82ed241">&#9670;&nbsp;</a></span>connection_dir_list_by_purpose_and_resource()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structsmartlist__t.html">smartlist_t</a>* connection_dir_list_by_purpose_and_resource </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>purpose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>resource</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a list of directory connections that are fetching the item described by <b>purpose</b>/<b>resource</b>. If there are none, return an empty list. This list must be freed using smartlist_free, but the pointers in it must not be freed. Note that this list should not be cached, as the pointers in it can be freed if their connections close. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a86d2c5314a90b6c62dae9c9fc82ed241_cgraph.png" border="0" usemap="#connection_8c_a86d2c5314a90b6c62dae9c9fc82ed241_cgraph" alt=""/></div>
<map name="connection_8c_a86d2c5314a90b6c62dae9c9fc82ed241_cgraph" id="connection_8c_a86d2c5314a90b6c62dae9c9fc82ed241_cgraph">
<area shape="rect" id="node2" href="util_8c.html#a66dfc160abb620a3fccaf54d563e5725" title="strcmp_opt" alt="" coords="235,13,321,39"/>
</map>
</div>

</div>
</div>
<a id="a147c7e687750c8a345c5febefe4a1409"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a147c7e687750c8a345c5febefe4a1409">&#9670;&nbsp;</a></span>connection_dir_list_by_purpose_resource_and_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structsmartlist__t.html">smartlist_t</a>* connection_dir_list_by_purpose_resource_and_state </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>purpose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>resource</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a list of directory connections that are fetching the item described by <b>purpose</b>/<b>resource</b>/<b>state</b>. If there are none, return an empty list. This list must be freed using smartlist_free, but the pointers in it must not be freed. Note that this list should not be cached, as the pointers in it can be freed if their connections close. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a147c7e687750c8a345c5febefe4a1409_cgraph.png" border="0" usemap="#connection_8c_a147c7e687750c8a345c5febefe4a1409_cgraph" alt=""/></div>
<map name="connection_8c_a147c7e687750c8a345c5febefe4a1409_cgraph" id="connection_8c_a147c7e687750c8a345c5febefe4a1409_cgraph">
<area shape="rect" id="node2" href="util_8c.html#a66dfc160abb620a3fccaf54d563e5725" title="strcmp_opt" alt="" coords="207,20,293,47"/>
</map>
</div>

</div>
</div>
<a id="a4da339a8cd53ba30262d8445ab62e8a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4da339a8cd53ba30262d8445ab62e8a3">&#9670;&nbsp;</a></span>connection_dump_buffer_mem_stats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_dump_buffer_mem_stats </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>severity</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Log how many bytes are used by buffers of different kinds and sizes. </p>

</div>
</div>
<a id="afaaaf64de0fd3c6824a99950a50c822c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afaaaf64de0fd3c6824a99950a50c822c">&#9670;&nbsp;</a></span>connection_expire_held_open()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_expire_held_open </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Find each connection that has hold_open_until_flushed set to 1 but hasn't written in the past 15 seconds, and set hold_open_until_flushed to 0. This means it will get cleaned up in the next loop through close_if_marked() in <a class="el" href="main_8c.html" title="Toplevel module. Handles signals, multiplexes between connections, implements main loop...">main.c</a>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_afaaaf64de0fd3c6824a99950a50c822c_cgraph.png" border="0" usemap="#connection_8c_afaaaf64de0fd3c6824a99950a50c822c_cgraph" alt=""/></div>
<map name="connection_8c_afaaaf64de0fd3c6824a99950a50c822c_cgraph" id="connection_8c_afaaaf64de0fd3c6824a99950a50c822c_cgraph">
<area shape="rect" id="node2" href="connection_8c.html#aa05a243a33eb2a242e48f1866ab2806a" title="conn_type_to_string" alt="" coords="249,5,387,32"/>
<area shape="rect" id="node3" href="connection_8c.html#a0f03ee7b48ac2f674af67ce1f0201d3c" title="conn_state_to_string" alt="" coords="247,56,389,83"/>
</map>
</div>

</div>
</div>
<a id="a173a993b4f9bcc7522f35c56e65b615f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a173a993b4f9bcc7522f35c56e65b615f">&#9670;&nbsp;</a></span>connection_fetch_from_buf_http()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_fetch_from_buf_http </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>headers_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>max_headerlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>body_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>body_used</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>max_bodylen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>force_complete</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>As fetch_from_buf_http, but fetches from a connection's input buffer_t as appropriate. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a173a993b4f9bcc7522f35c56e65b615f_icgraph.png" border="0" usemap="#connection_8c_a173a993b4f9bcc7522f35c56e65b615f_icgraph" alt=""/></div>
<map name="connection_8c_a173a993b4f9bcc7522f35c56e65b615f_icgraph" id="connection_8c_a173a993b4f9bcc7522f35c56e65b615f_icgraph">
<area shape="rect" id="node2" href="directory_8c.html#ac2e15267200fb185ec30e74b7d16d834" title="directory_handle_command" alt="" coords="208,13,389,39"/>
<area shape="rect" id="node3" href="directory_8h.html#af2bfa4b827d711bd2ed6bdeb506c8b6d" title="connection_dir_process\l_inbuf" alt="" coords="437,5,596,47"/>
</map>
</div>

</div>
</div>
<a id="a6fa2b1498c44f367a9bcf97986a31613"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6fa2b1498c44f367a9bcf97986a31613">&#9670;&nbsp;</a></span>connection_flush()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_flush </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Try to flush data that's waiting for a write on <b>conn</b>. Return -1 on failure, 0 on success.</p>
<p>Don't use this function for regular writing; the buffers system should be good enough at scheduling writes there. Instead, this function is for cases when we're about to exit or something and we want to report it right away. </p>

</div>
</div>
<a id="aac060666510d641a1a275af05d985a92"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac060666510d641a1a275af05d985a92">&#9670;&nbsp;</a></span>connection_free_all()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_free_all </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Call <a class="el" href="connection_8c.html#a9b7ec2f7609aff902a55e7d2db9eb6f6">connection_free_minimal()</a> on every connection in our array, and release all storage held by <a class="el" href="connection_8c.html" title="General high-level functions to handle reading and writing on connections. ">connection.c</a>.</p>
<p>Don't do the checks in connection_free(), because they will fail. </p>

</div>
</div>
<a id="a9b7ec2f7609aff902a55e7d2db9eb6f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b7ec2f7609aff902a55e7d2db9eb6f6">&#9670;&nbsp;</a></span>connection_free_minimal()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC void connection_free_minimal </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Deallocate memory used by <b>conn</b>. Deallocate its buffers if necessary, close its socket if necessary, and mark the directory as dirty if <b>conn</b> is an OR or OP connection. </p>

</div>
</div>
<a id="a8172634fb511668d4ee40ab954ea262a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8172634fb511668d4ee40ab954ea262a">&#9670;&nbsp;</a></span>connection_get_by_global_id()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structconnection__t.html">connection_t</a>* connection_get_by_global_id </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the stream with id <b>id</b> if it is not already marked for close. </p>

</div>
</div>
<a id="a32c388b39c89a0a0caa40b4a9398eec7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32c388b39c89a0a0caa40b4a9398eec7">&#9670;&nbsp;</a></span>connection_get_by_type()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structconnection__t.html">connection_t</a>* connection_get_by_type </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a connection of type <b>type</b> that is not marked for close. </p>

</div>
</div>
<a id="aaba7b52de4c051e6f72b649287dbf0d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaba7b52de4c051e6f72b649287dbf0d0">&#9670;&nbsp;</a></span>connection_get_by_type_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structconnection__t.html">connection_t</a>* connection_get_by_type_state </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a connection of type <b>type</b> that is in state <b>state</b>, and that is not marked for close. </p>

</div>
</div>
<a id="a834b51dc69efa955ab17e7cd20a3c1f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a834b51dc69efa955ab17e7cd20a3c1f2">&#9670;&nbsp;</a></span>connection_get_by_type_state_rendquery()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structconnection__t.html">connection_t</a>* connection_get_by_type_state_rendquery </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>rendquery</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a connection of type <b>type</b> that has rendquery equal to <b>rendquery</b>, and that is not marked for close. If state is non-zero, conn must be of that state too. </p>

</div>
</div>
<a id="acb0804d5890924a2d6e3c4e3638ccfe4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb0804d5890924a2d6e3c4e3638ccfe4">&#9670;&nbsp;</a></span>connection_init_accepted_conn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_init_accepted_conn </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structlistener__connection__t.html">listener_connection_t</a> *&#160;</td>
          <td class="paramname"><em>listener</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize states for newly accepted connection <b>conn</b>.</p>
<p>If conn is an OR, start the TLS handshake.</p>
<p>If conn is a transparent AP, get its original destination and place it in circuit_wait.</p>
<p>The <b>listener</b> parameter is only used for AP connections. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_acb0804d5890924a2d6e3c4e3638ccfe4_cgraph.png" border="0" usemap="#connection_8c_acb0804d5890924a2d6e3c4e3638ccfe4_cgraph" alt=""/></div>
<map name="connection_8c_acb0804d5890924a2d6e3c4e3638ccfe4_cgraph" id="connection_8c_acb0804d5890924a2d6e3c4e3638ccfe4_cgraph">
<area shape="rect" id="node2" href="ext__orport_8c.html#ab9d4a08079b59b67b52a4a9278604b9f" title="connection_ext_or_start_auth" alt="" coords="257,5,451,32"/>
</map>
</div>

</div>
</div>
<a id="a1c3a40d68e869567e1a01d0e577534b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c3a40d68e869567e1a01d0e577534b2">&#9670;&nbsp;</a></span>connection_is_listener()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_is_listener </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if <b>conn</b> is a listener conn, else return 0. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a1c3a40d68e869567e1a01d0e577534b2_icgraph.png" border="0" usemap="#connection_8c_a1c3a40d68e869567e1a01d0e577534b2_icgraph" alt=""/></div>
<map name="connection_8c_a1c3a40d68e869567e1a01d0e577534b2_icgraph" id="connection_8c_a1c3a40d68e869567e1a01d0e577534b2_icgraph">
<area shape="rect" id="node2" href="connection_8h.html#a70eb2da60775cc0bda58682470a752b6" title="retry_all_listeners" alt="" coords="215,5,339,32"/>
<area shape="rect" id="node3" href="connection_8h.html#a01097d299ca112865a182ea93e1a936f" title="connection_mark_all\l_noncontrol_listeners" alt="" coords="204,57,349,98"/>
</map>
</div>

</div>
</div>
<a id="a15be4ffce8c79930976b89d6c1d3c5a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15be4ffce8c79930976b89d6c1d3c5a8">&#9670;&nbsp;</a></span>connection_link_connections()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_link_connections </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn_a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn_b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create a link between <b>conn_a</b> and <b>conn_b</b>. </p>

</div>
</div>
<a id="ad57ab7f216b7f1565fb39ec2b00f8edd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad57ab7f216b7f1565fb39ec2b00f8edd">&#9670;&nbsp;</a></span>connection_mark_all_noncontrol_connections()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_mark_all_noncontrol_connections </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Mark every external connection not used for controllers for close. </p>

</div>
</div>
<a id="a01097d299ca112865a182ea93e1a936f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01097d299ca112865a182ea93e1a936f">&#9670;&nbsp;</a></span>connection_mark_all_noncontrol_listeners()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_mark_all_noncontrol_listeners </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Mark every listener of type other than CONTROL_LISTENER to be closed. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a01097d299ca112865a182ea93e1a936f_cgraph.png" border="0" usemap="#connection_8c_a01097d299ca112865a182ea93e1a936f_cgraph" alt=""/></div>
<map name="connection_8c_a01097d299ca112865a182ea93e1a936f_cgraph" id="connection_8c_a01097d299ca112865a182ea93e1a936f_cgraph">
<area shape="rect" id="node2" href="connection_8c.html#a1c3a40d68e869567e1a01d0e577534b2" title="connection_is_listener" alt="" coords="199,13,349,39"/>
</map>
</div>

</div>
</div>
<a id="a2a15ddd62951cefd848ec070f1d9c912"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a15ddd62951cefd848ec070f1d9c912">&#9670;&nbsp;</a></span>connection_mark_for_close_()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_mark_for_close_ </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Mark <b>conn</b> to be closed next time we loop through conn_close_if_marked() in <a class="el" href="main_8c.html" title="Toplevel module. Handles signals, multiplexes between connections, implements main loop...">main.c</a>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a2a15ddd62951cefd848ec070f1d9c912_cgraph.png" border="0" usemap="#connection_8c_a2a15ddd62951cefd848ec070f1d9c912_cgraph" alt=""/></div>
<map name="connection_8c_a2a15ddd62951cefd848ec070f1d9c912_cgraph" id="connection_8c_a2a15ddd62951cefd848ec070f1d9c912_cgraph">
<area shape="rect" id="node2" href="connection_8c.html#a738d9e7ef0c4a101c2adbd4cade35475" title="assert_connection_ok" alt="" coords="196,13,345,39"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a2a15ddd62951cefd848ec070f1d9c912_icgraph.png" border="0" usemap="#connection_8c_a2a15ddd62951cefd848ec070f1d9c912_icgraph" alt=""/></div>
<map name="connection_8c_a2a15ddd62951cefd848ec070f1d9c912_icgraph" id="connection_8c_a2a15ddd62951cefd848ec070f1d9c912_icgraph">
<area shape="rect" id="node2" href="connection__edge_8c.html#a5922c995ab015f688168d02a6b954050" title="MOCK_IMPL" alt="" coords="196,13,296,39"/>
</map>
</div>

</div>
</div>
<a id="a4810086178d87cb306c2bb4b60145abe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4810086178d87cb306c2bb4b60145abe">&#9670;&nbsp;</a></span>connection_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structconnection__t.html">connection_t</a>* connection_new </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>socket_family</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate, initialize, and return a new <a class="el" href="structconnection__t.html">connection_t</a> subtype of <b>type</b> to make or receive connections of address family <b>socket_family</b>. The type should be one of the CONN_TYPE_* constants. </p>

</div>
</div>
<a id="a1a6be46082e23668c2cb0f323c171ad2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a6be46082e23668c2cb0f323c171ad2">&#9670;&nbsp;</a></span>connection_outbuf_too_full()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_outbuf_too_full </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Are there too many bytes on edge connection <b>conn</b>'s outbuf to send back a relay-level sendme yet? Return 1 if so, 0 if not. Used by <a class="el" href="relay_8c.html#a4e70e8fbfc6c89fa97102836a87a99c4">connection_edge_consider_sending_sendme()</a>. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a1a6be46082e23668c2cb0f323c171ad2_icgraph.png" border="0" usemap="#connection_8c_a1a6be46082e23668c2cb0f323c171ad2_icgraph" alt=""/></div>
<map name="connection_8c_a1a6be46082e23668c2cb0f323c171ad2_icgraph" id="connection_8c_a1a6be46082e23668c2cb0f323c171ad2_icgraph">
<area shape="rect" id="node2" href="relay_8h.html#a4e70e8fbfc6c89fa97102836a87a99c4" title="connection_edge_consider\l_sending_sendme" alt="" coords="231,27,407,69"/>
<area shape="rect" id="node3" href="connection__edge_8h.html#a98855be3866a7e56063cefe658788fcd" title="connection_edge_flushed_some" alt="" coords="455,5,663,32"/>
<area shape="rect" id="node4" href="connection__edge_8h.html#a84d464ff322df919a496d6fdfba9dade" title="connection_edge_finished\l_flushing" alt="" coords="473,57,645,98"/>
</map>
</div>

</div>
</div>
<a id="a2f7e49d562c42623a0bd1d8edeb2c269"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f7e49d562c42623a0bd1d8edeb2c269">&#9670;&nbsp;</a></span>connection_proxy_connect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_proxy_connect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write a proxy request of <b>type</b> (socks4, socks5, https) to conn for conn-&gt;addr:conn-&gt;port, authenticating with the auth details given in the configuration (if available). SOCKS 5 and HTTP CONNECT proxies support authentication.</p>
<p>Returns -1 if conn-&gt;addr is incompatible with the proxy protocol, and 0 otherwise.</p>
<p>Use <a class="el" href="connection_8c.html#a762af8c79046607b86c5be3a403c736b">connection_read_proxy_handshake()</a> to complete the handshake. </p>

</div>
</div>
<a id="a50fb185395ce0ef1cdb43114f90d5941"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50fb185395ce0ef1cdb43114f90d5941">&#9670;&nbsp;</a></span>connection_read_bw_exhausted()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_read_bw_exhausted </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>is_global_bw</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Mark <b>conn</b> as needing to stop reading because bandwidth has been exhausted. If <b>is_global_bw</b>, it is closing because global bandwidth limit has been exhausted. Otherwise, it is closing because its own bandwidth limit has been exhausted. </p>

</div>
</div>
<a id="a762af8c79046607b86c5be3a403c736b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a762af8c79046607b86c5be3a403c736b">&#9670;&nbsp;</a></span>connection_read_proxy_handshake()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_read_proxy_handshake </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Call this from connection_*_process_inbuf() to advance the proxy handshake.</p>
<p>No matter what proxy protocol is used, if this function returns 1, the handshake is complete, and the data remaining on inbuf may contain the start of the communication with the requested server.</p>
<p>Returns 0 if the current buffer contains an incomplete response, and -1 on error. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a762af8c79046607b86c5be3a403c736b_icgraph.png" border="0" usemap="#connection_8c_a762af8c79046607b86c5be3a403c736b_icgraph" alt=""/></div>
<map name="connection_8c_a762af8c79046607b86c5be3a403c736b_icgraph" id="connection_8c_a762af8c79046607b86c5be3a403c736b_icgraph">
<area shape="rect" id="node2" href="connection__or_8h.html#a1c9c08479c7f8118438c42edb7046d32" title="connection_or_process\l_inbuf" alt="" coords="209,5,365,47"/>
</map>
</div>

</div>
</div>
<a id="aef88441c4b3ee3a887d3ec0927c66675"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef88441c4b3ee3a887d3ec0927c66675">&#9670;&nbsp;</a></span>connection_state_is_connecting()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_state_is_connecting </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if conn is in 'connecting' state, else return 0. </p>

</div>
</div>
<a id="a8cdf763ad0a8fa79e7561c91b3f8ecca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8cdf763ad0a8fa79e7561c91b3f8ecca">&#9670;&nbsp;</a></span>connection_state_is_open()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_state_is_open </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if <b>conn</b> is in state "open" and is not marked for close, else return 0. </p>

</div>
</div>
<a id="a2314f1a80fe9795a41202f9751d090a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2314f1a80fe9795a41202f9751d090a5">&#9670;&nbsp;</a></span>connection_wants_to_flush()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_wants_to_flush </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return conn-&gt;outbuf_flushlen: how many bytes conn wants to flush from its outbuf. </p>

</div>
</div>
<a id="adbe6c9ccec29b7d6f20a657346f691bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbe6c9ccec29b7d6f20a657346f691bc">&#9670;&nbsp;</a></span>connection_write_bw_exhausted()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_write_bw_exhausted </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>is_global_bw</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Mark <b>conn</b> as needing to stop reading because write bandwidth has been exhausted. If <b>is_global_bw</b>, it is closing because global bandwidth limit has been exhausted. Otherwise, it is closing because its own bandwidth limit has been exhausted. </p>

</div>
</div>
<a id="a1ab4242cd0fbf4bf874bcbb86ce1e7ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ab4242cd0fbf4bf874bcbb86ce1e7ba">&#9670;&nbsp;</a></span>control_connection_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structcontrol__connection__t.html">control_connection_t</a>* control_connection_new </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>socket_family</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate and return a new <a class="el" href="structcontrol__connection__t.html">control_connection_t</a>, initialized as by connection_init(). </p>

</div>
</div>
<a id="a17c7be36733025b9c1384db24193776c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17c7be36733025b9c1384db24193776c">&#9670;&nbsp;</a></span>dir_connection_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdir__connection__t.html">dir_connection_t</a>* dir_connection_new </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>socket_family</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate and return a new <a class="el" href="structdir__connection__t.html">dir_connection_t</a>, initialized as by connection_init(). </p>

</div>
</div>
<a id="a2ec50dd3f5bb871bf4a7058e4a57a754"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ec50dd3f5bb871bf4a7058e4a57a754">&#9670;&nbsp;</a></span>edge_connection_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structedge__connection__t.html">edge_connection_t</a>* edge_connection_new </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>socket_family</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate and return a new <a class="el" href="structedge__connection__t.html">edge_connection_t</a>, initialized as by connection_init(). </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a2ec50dd3f5bb871bf4a7058e4a57a754_icgraph.png" border="0" usemap="#connection_8c_a2ec50dd3f5bb871bf4a7058e4a57a754_icgraph" alt=""/></div>
<map name="connection_8c_a2ec50dd3f5bb871bf4a7058e4a57a754_icgraph" id="connection_8c_a2ec50dd3f5bb871bf4a7058e4a57a754_icgraph">
<area shape="rect" id="node2" href="connection__edge_8h.html#a8805ef6708301581c9339e83f41e76e0" title="connection_exit_begin\l_resolve" alt="" coords="204,5,355,47"/>
</map>
</div>

</div>
</div>
<a id="adf77e71582e9f5e3a07d50af731b0427"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf77e71582e9f5e3a07d50af731b0427">&#9670;&nbsp;</a></span>entry_connection_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structentry__connection__t.html">entry_connection_t</a>* entry_connection_new </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>socket_family</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate and return a new <a class="el" href="structentry__connection__t.html">entry_connection_t</a>, initialized as by connection_init().</p>
<p>Allocate space to store the socks_request. </p>

</div>
</div>
<a id="afe9e86e1e84ebe4b3a167c0c8f9314c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe9e86e1e84ebe4b3a167c0c8f9314c3">&#9670;&nbsp;</a></span>get_proxy_addrport()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int get_proxy_addrport </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structtor__addr__t.html">tor_addr_t</a> *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>proxy_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Fills <b>addr</b> and <b>port</b> with the details of the global proxy server we are using. <b>conn</b> contains the connection we are using the proxy for.</p>
<p>Return 0 on success, -1 on failure. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_afe9e86e1e84ebe4b3a167c0c8f9314c3_cgraph.png" border="0" usemap="#connection_8c_afe9e86e1e84ebe4b3a167c0c8f9314c3_cgraph" alt=""/></div>
<map name="connection_8c_afe9e86e1e84ebe4b3a167c0c8f9314c3_cgraph" id="connection_8c_afe9e86e1e84ebe4b3a167c0c8f9314c3_cgraph">
<area shape="rect" id="node2" href="bridges_8c.html#ac470a19b5347828069e8678db5a87779" title="get_transport_by_bridge\l_addrport" alt="" coords="187,5,348,47"/>
<area shape="rect" id="node3" href="address_8c.html#a139ff425c957e4eed3a766cb48f55f93" title="tor_addr_copy" alt="" coords="215,71,319,98"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_afe9e86e1e84ebe4b3a167c0c8f9314c3_icgraph.png" border="0" usemap="#connection_8c_afe9e86e1e84ebe4b3a167c0c8f9314c3_icgraph" alt=""/></div>
<map name="connection_8c_afe9e86e1e84ebe4b3a167c0c8f9314c3_icgraph" id="connection_8c_afe9e86e1e84ebe4b3a167c0c8f9314c3_icgraph">
<area shape="rect" id="node2" href="connection_8h.html#ad7f6042798d28314aa4553456bd5f9e5" title="log_failed_proxy_connection" alt="" coords="187,5,373,32"/>
</map>
</div>

</div>
</div>
<a id="af717f75714620d7187bcdaae2df1434e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af717f75714620d7187bcdaae2df1434e">&#9670;&nbsp;</a></span>global_write_bucket_low()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int global_write_bucket_low </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>attempt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>priority</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if the global write buckets are low enough that we shouldn't send <b>attempt</b> bytes of low-priority directory stuff out to <b>conn</b>. Else return 0.</p>
<p>Priority was 1 for v1 requests (directories and running-routers), and 2 for v2 requests and later (statuses and descriptors).</p>
<p>There are a lot of parameters we could use here:</p><ul>
<li>global_relayed_write_bucket. Low is bad.</li>
<li>global_write_bucket. Low is bad.</li>
<li>bandwidthrate. Low is bad.</li>
<li>bandwidthburst. Not a big factor?</li>
<li>attempt. High is bad.</li>
<li>total bytes queued on outbufs. High is bad. But I'm wary of using this, since a few slow-flushing queues will pump up the number without meaning what we meant to mean. What we really mean is "total directory bytes added to outbufs recently", but that's harder to quantify and harder to keep track of. </li>
</ul>

</div>
</div>
<a id="a0b0571735fc8e34f09a8eb776f0f4d67"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b0571735fc8e34f09a8eb776f0f4d67">&#9670;&nbsp;</a></span>listener_connection_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlistener__connection__t.html">listener_connection_t</a>* listener_connection_new </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>socket_family</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate and return a new <a class="el" href="structlistener__connection__t.html">listener_connection_t</a>, initialized as by connection_init(). </p>

</div>
</div>
<a id="ad7f6042798d28314aa4553456bd5f9e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7f6042798d28314aa4553456bd5f9e5">&#9670;&nbsp;</a></span>log_failed_proxy_connection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void log_failed_proxy_connection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Log a failed connection to a proxy server. <b>conn</b> is the connection we use the proxy server for. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_ad7f6042798d28314aa4553456bd5f9e5_cgraph.png" border="0" usemap="#connection_8c_ad7f6042798d28314aa4553456bd5f9e5_cgraph" alt=""/></div>
<map name="connection_8c_ad7f6042798d28314aa4553456bd5f9e5_cgraph" id="connection_8c_ad7f6042798d28314aa4553456bd5f9e5_cgraph">
<area shape="rect" id="node2" href="connection_8c.html#afe9e86e1e84ebe4b3a167c0c8f9314c3" title="get_proxy_addrport" alt="" coords="240,42,373,69"/>
<area shape="rect" id="node3" href="bridges_8c.html#ac470a19b5347828069e8678db5a87779" title="get_transport_by_bridge\l_addrport" alt="" coords="421,5,583,47"/>
<area shape="rect" id="node4" href="address_8c.html#a139ff425c957e4eed3a766cb48f55f93" title="tor_addr_copy" alt="" coords="450,71,554,98"/>
</map>
</div>

</div>
</div>
<a id="a39b04f82ada8e36e17821d9fbfaa43df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39b04f82ada8e36e17821d9fbfaa43df">&#9670;&nbsp;</a></span>MOCK_IMPL() <span class="overload">[1/8]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MOCK_IMPL </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">connection_free_&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">(<a class="el" href="structconnection__t.html">connection_t</a> *conn)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Make sure <b>conn</b> isn't in any of the global conn lists; then free it. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a39b04f82ada8e36e17821d9fbfaa43df_cgraph.png" border="0" usemap="#connection_8c_a39b04f82ada8e36e17821d9fbfaa43df_cgraph" alt=""/></div>
<map name="connection_8c_a39b04f82ada8e36e17821d9fbfaa43df_cgraph" id="connection_8c_a39b04f82ada8e36e17821d9fbfaa43df_cgraph">
<area shape="rect" id="node2" href="main_8c.html#a66b81d23c35de4399af3b83ae7a569db" title="connection_is_on_closeable_list" alt="" coords="153,5,363,32"/>
<area shape="rect" id="node4" href="main_8c.html#a49e8c66d5c632a692690342427171dd7" title="connection_in_array" alt="" coords="189,56,327,83"/>
<area shape="rect" id="node3" href="container_8c.html#abbb4ca13d840b2761ed4d70c63f0b2f4" title="smartlist_contains" alt="" coords="411,31,539,57"/>
</map>
</div>

</div>
</div>
<a id="a6e0262219d1afbc700eacae441599fb4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e0262219d1afbc700eacae441599fb4">&#9670;&nbsp;</a></span>MOCK_IMPL() <span class="overload">[2/8]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MOCK_IMPL </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">connection_mark_for_close_internal_&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">(<a class="el" href="structconnection__t.html">connection_t</a> *conn, int line, const char *file)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Mark <b>conn</b> to be closed next time we loop through conn_close_if_marked() in <a class="el" href="main_8c.html" title="Toplevel module. Handles signals, multiplexes between connections, implements main loop...">main.c</a>; the _internal version bypasses the CONN_TYPE_OR checks; this should be called when you either are sure that if this is an <a class="el" href="structor__connection__t.html">or_connection_t</a> the controlling channel has been notified (e.g. with <a class="el" href="connection__or_8c.html#a1782f56c8e2a13ef3db44eed29c83d28">connection_or_notify_error()</a>), or you actually are the connection_or_close_for_error() or <a class="el" href="connection__or_8c.html#af4d087b0c7ef9745ce0296b5e28160c7">connection_or_close_normally()</a> function. For all other cases, use connection_mark_and_flush() instead, which checks for <a class="el" href="structor__connection__t.html">or_connection_t</a> properly, instead. See below. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a6e0262219d1afbc700eacae441599fb4_cgraph.png" border="0" usemap="#connection_8c_a6e0262219d1afbc700eacae441599fb4_cgraph" alt=""/></div>
<map name="connection_8c_a6e0262219d1afbc700eacae441599fb4_cgraph" id="connection_8c_a6e0262219d1afbc700eacae441599fb4_cgraph">
<area shape="rect" id="node2" href="connection_8c.html#a738d9e7ef0c4a101c2adbd4cade35475" title="assert_connection_ok" alt="" coords="153,5,303,32"/>
</map>
</div>

</div>
</div>
<a id="a2d38cc1df37b7254ce759c39b7c550b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d38cc1df37b7254ce759c39b7c550b9">&#9670;&nbsp;</a></span>MOCK_IMPL() <span class="overload">[3/8]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MOCK_IMPL </td>
          <td>(</td>
          <td class="paramtype">STATIC&#160;</td>
          <td class="paramname"><em>int</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">connection_connect_sockaddr&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">(<a class="el" href="structconnection__t.html">connection_t</a> *conn, const struct sockaddr *sa, socklen_t sa_len, const struct sockaddr *bindaddr, socklen_t bindaddr_len, int *socket_error)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Take conn, make a nonblocking socket; try to connect to sa, binding to bindaddr if sa is not localhost. If fail, return -1 and if applicable put your best guess about errno into *<b>socket_error</b>. If connected return 1, if EAGAIN return 0. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a2d38cc1df37b7254ce759c39b7c550b9_cgraph.png" border="0" usemap="#connection_8c_a2d38cc1df37b7254ce759c39b7c550b9_cgraph" alt=""/></div>
<map name="connection_8c_a2d38cc1df37b7254ce759c39b7c550b9_cgraph" id="connection_8c_a2d38cc1df37b7254ce759c39b7c550b9_cgraph">
<area shape="rect" id="node2" href="router_8c.html#a1f26f7d8212be928f60b7daf0279f029" title="net_is_completely_disabled" alt="" coords="153,5,336,32"/>
</map>
</div>

</div>
</div>
<a id="aacd5b15598f9b3f9aa4e2695f38cd1f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aacd5b15598f9b3f9aa4e2695f38cd1f9">&#9670;&nbsp;</a></span>MOCK_IMPL() <span class="overload">[4/8]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MOCK_IMPL </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">connection_write_to_buf_impl_&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">(const char *string, size_t len, <a class="el" href="structconnection__t.html">connection_t</a> *conn, int zlib)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Append <b>len</b> bytes of <b>string</b> onto <b>conn</b>'s outbuf, and ask it to start writing.</p>
<p>If <b>zlib</b> is nonzero, this is a directory connection that should get its contents compressed or decompressed as they're written. If zlib is negative, this is the last data to be compressed, and the connection's zlib state should be flushed. </p>

</div>
</div>
<a id="a68efdfdae46e70fa479296ee69358e61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68efdfdae46e70fa479296ee69358e61">&#9670;&nbsp;</a></span>MOCK_IMPL() <span class="overload">[5/8]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MOCK_IMPL </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">connection_get_by_type_addr_port_purpose&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">(int type, const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *addr, uint16_t port, int purpose)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a connection with given type, address, port, and purpose; or NULL if no such connection exists (or if all such connections are marked for close). </p>

</div>
</div>
<a id="ac609b4da1d53630fa78d115ce15f3ef1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac609b4da1d53630fa78d115ce15f3ef1">&#9670;&nbsp;</a></span>MOCK_IMPL() <span class="overload">[6/8]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MOCK_IMPL </td>
          <td>(</td>
          <td class="paramtype">STATIC <a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pick_oos_victims&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">(int n)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Pick n victim connections for the OOS handler and return them in a smartlist. </p>

</div>
</div>
<a id="a7559009dae296c8d0cce9be7f3203660"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7559009dae296c8d0cce9be7f3203660">&#9670;&nbsp;</a></span>MOCK_IMPL() <span class="overload">[7/8]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MOCK_IMPL </td>
          <td>(</td>
          <td class="paramtype">STATIC&#160;</td>
          <td class="paramname"><em>void</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">kill_conn_list_for_oos&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">(<a class="el" href="structsmartlist__t.html">smartlist_t</a> *conns)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Kill a list of connections for the OOS handler. </p>

</div>
</div>
<a id="ab88cfc0f345a7adb709c58312e6ae462"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab88cfc0f345a7adb709c58312e6ae462">&#9670;&nbsp;</a></span>MOCK_IMPL() <span class="overload">[8/8]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MOCK_IMPL </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">clock_skew_warning&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">(const <a class="el" href="structconnection__t.html">connection_t</a> *conn, long apparent_skew, int trusted, <a class="el" href="torlog_8h.html#a3ea3afb80db88b6ccec80d80ac98cea1">log_domain_mask_t</a> domain, const char *received, const char *source)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Log a warning, and possibly emit a control event, that <b>received</b> came at a skewed time. <b>trusted</b> indicates that the <b>source</b> was one that we had more faith in and therefore the warning level should have higher severity. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_ab88cfc0f345a7adb709c58312e6ae462_cgraph.png" border="0" usemap="#connection_8c_ab88cfc0f345a7adb709c58312e6ae462_cgraph" alt=""/></div>
<map name="connection_8c_ab88cfc0f345a7adb709c58312e6ae462_cgraph" id="connection_8c_ab88cfc0f345a7adb709c58312e6ae462_cgraph">
<area shape="rect" id="node2" href="util_8c.html#a9a88be72c2d4775622cedbda5d76f833" title="format_time_interval" alt="" coords="153,5,293,32"/>
<area shape="rect" id="node5" href="compat_8c.html#ade97970c1d8a691241adac739c4f9b12" title="tor_asprintf" alt="" coords="180,56,267,83"/>
<area shape="rect" id="node3" href="compat_8c.html#af032ac661214ae28b4f205781a515290" title="tor_snprintf" alt="" coords="345,5,432,32"/>
<area shape="rect" id="node4" href="compat_8c.html#a1df7873b16ae8936d25dfedb706f4ea6" title="tor_vsnprintf" alt="" coords="484,5,579,32"/>
<area shape="rect" id="node6" href="compat_8c.html#a5ef7a08e8b543c0d61f9ef1081d4c1ea" title="tor_vasprintf" alt="" coords="341,56,436,83"/>
</map>
</div>

</div>
</div>
<a id="a0873faa8af99710bc36a3950b1bf68a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0873faa8af99710bc36a3950b1bf68a6">&#9670;&nbsp;</a></span>or_connection_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structor__connection__t.html">or_connection_t</a>* or_connection_new </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>socket_family</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate and return a new <a class="el" href="structor__connection__t.html">or_connection_t</a>, initialized as by connection_init().</p>
<p>Initialize active_circuit_pqueue.</p>
<p>Set active_circuit_pqueue_last_recalibrated to current cell_ewma tick. </p>

</div>
</div>
<a id="a70eb2da60775cc0bda58682470a752b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70eb2da60775cc0bda58682470a752b6">&#9670;&nbsp;</a></span>retry_all_listeners()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int retry_all_listeners </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>replaced_conns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>new_conns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>close_all_noncontrol</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Launch listeners for each port you should have open. Only launch listeners who are not already open, and only close listeners we no longer want.</p>
<p>Add all old conns that should be closed to <b>replaced_conns</b>. Add all new connections to <b>new_conns</b>.</p>
<p>If <b>close_all_noncontrol</b> is true, then we only open control listeners, and we close all other listeners. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8c_a70eb2da60775cc0bda58682470a752b6_cgraph.png" border="0" usemap="#connection_8c_a70eb2da60775cc0bda58682470a752b6_cgraph" alt=""/></div>
<map name="connection_8c_a70eb2da60775cc0bda58682470a752b6_cgraph" id="connection_8c_a70eb2da60775cc0bda58682470a752b6_cgraph">
<area shape="rect" id="node2" href="router_8c.html#a74a228ad9efff13643397a5c02d7bec7" title="router_get_advertised\l_or_port" alt="" coords="179,9,326,51"/>
<area shape="rect" id="node3" href="router_8c.html#a19b606096c7f385bb3db639b1a1c15fe" title="router_get_advertised\l_or_port_by_af" alt="" coords="376,39,523,80"/>
<area shape="rect" id="node6" href="router_8c.html#afc00fda5b227142768e650d169b3dd26" title="router_get_advertised\l_dir_port" alt="" coords="179,127,326,168"/>
<area shape="rect" id="node7" href="connection_8c.html#a1c3a40d68e869567e1a01d0e577534b2" title="connection_is_listener" alt="" coords="177,193,328,219"/>
<area shape="rect" id="node8" href="container_8c.html#accf59a8b7d39a4286ff99653b6878006" title="smartlist_add" alt="" coords="203,243,303,270"/>
<area shape="rect" id="node4" href="config_8c.html#a8b79c094d201fd02944aa463dcc6433c" title="get_first_advertised\l_port_by_type_af" alt="" coords="588,5,724,47"/>
<area shape="rect" id="node5" href="router_8c.html#a8bfae58f61a3329fd20f43c378bff0bb" title="router_get_active_listener\l_port_by_type_af" alt="" coords="571,71,741,112"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
