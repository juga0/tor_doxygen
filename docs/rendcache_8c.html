<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tor: /home/user/_my/code/bwauth-related/tor/src/or/rendcache.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tor
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97b64286d42c5ef1697cb5f17129db19.html">tor</a></li><li class="navelem"><a class="el" href="dir_3cb0ba3f4b82dbe34a1a06276e96bc8d.html">src</a></li><li class="navelem"><a class="el" href="dir_386635fabd7f6c74e9d9c7a8604514a0.html">or</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">rendcache.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Hidden service descriptor cache.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="rendcache_8h_source.html">rendcache.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="config_8h_source.html">config.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rephist_8h_source.html">rephist.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="routerlist_8h_source.html">routerlist.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="routerparse_8h_source.html">routerparse.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rendcommon_8h_source.html">rendcommon.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for rendcache.c:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2rendcache_8c" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2rendcache_8c" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2rendcache_8c">
<area shape="rect" id="node2" href="rendcache_8h.html" title="Header file for rendcache.c. " alt="" coords="2127,109,2220,136"/>
<area shape="rect" id="node42" href="rendcommon_8h.html" title="Header file for rendcommon.c. " alt="" coords="2141,184,2249,211"/>
<area shape="rect" id="node43" href="config_8h.html" title="Header file for config.c. " alt="" coords="2281,781,2349,808"/>
<area shape="rect" id="node44" href="rephist_8h.html" title="Header file for rephist.c. " alt="" coords="2396,109,2468,136"/>
<area shape="rect" id="node45" href="routerlist_8h.html" title="Header file for routerlist.c. " alt="" coords="2345,184,2428,211"/>
<area shape="rect" id="node46" href="routerparse_8h.html" title="Header file for routerparse.c. " alt="" coords="2492,109,2591,136"/>
<area shape="rect" id="node3" href="or_8h.html" title="Master header file for Tor&#45;specific functionality. " alt="" coords="1213,184,1257,211"/>
<area shape="rect" id="node4" href="orconfig_8h_source.html" title="orconfig.h" alt="" coords="439,1005,518,1032"/>
<area shape="rect" id="node5" href="torint_8h.html" title="Header file to define uint32_t and friends. " alt="" coords="1298,931,1361,957"/>
<area shape="rect" id="node7" href="crypto_8h.html" title="Headers for crypto.c. " alt="" coords="371,333,440,360"/>
<area shape="rect" id="node21" href="container_8h_source.html" title="container.h" alt="" coords="651,557,738,584"/>
<area shape="rect" id="node23" href="torlog_8h.html" title="Headers for log.c. " alt="" coords="1427,557,1493,584"/>
<area shape="rect" id="node24" href="crypto__format_8h_source.html" title="crypto_format.h" alt="" coords="1225,259,1338,285"/>
<area shape="rect" id="node25" href="crypto__ed25519_8h_source.html" title="crypto_ed25519.h" alt="" coords="1547,333,1672,360"/>
<area shape="rect" id="node26" href="crypto__curve25519_8h_source.html" title="crypto_curve25519.h" alt="" coords="1458,408,1601,435"/>
<area shape="rect" id="node29" href="tortls_8h.html" title="Headers for tortls.c. " alt="" coords="994,333,1057,360"/>
<area shape="rect" id="node32" href="compress_8h.html" title="Headers for compress.c. " alt="" coords="1363,259,1453,285"/>
<area shape="rect" id="node33" href="address_8h.html" title="Headers for address.h. " alt="" coords="494,483,573,509"/>
<area shape="rect" id="node34" href="compat__libevent_8h_source.html" title="compat_libevent.h" alt="" coords="144,856,272,883"/>
<area shape="rect" id="node35" href="ht_8h_source.html" title="ht.h" alt="" coords="1478,259,1522,285"/>
<area shape="rect" id="node36" href="confline_8h_source.html" title="confline.h" alt="" coords="794,333,873,360"/>
<area shape="rect" id="node37" href="replaycache_8h.html" title="Header file for replaycache.c. " alt="" coords="1546,259,1649,285"/>
<area shape="rect" id="node38" href="tor__queue_8h_source.html" title="tor_queue.h" alt="" coords="1673,259,1764,285"/>
<area shape="rect" id="node39" href="token__bucket_8h_source.html" title="token_bucket.h" alt="" coords="1671,856,1782,883"/>
<area shape="rect" id="node40" href="util__format_8h_source.html" title="util_format.h" alt="" coords="1806,856,1901,883"/>
<area shape="rect" id="node41" href="hs__circuitmap_8h.html" title="Header file for hs_circuitmap.c. " alt="" coords="1788,259,1903,285"/>
<area shape="rect" id="node9" href="compat_8h_source.html" title="compat.h" alt="" coords="919,781,995,808"/>
<area shape="rect" id="node15" href="util_8h.html" title="Headers for util.c. " alt="" coords="873,632,924,659"/>
<area shape="rect" id="node19" href="crypto__rsa_8h.html" title="Headers for crypto_rsa.c. " alt="" coords="877,408,971,435"/>
<area shape="rect" id="node10" href="testsupport_8h_source.html" title="testsupport.h" alt="" coords="1940,931,2039,957"/>
<area shape="rect" id="node12" href="compat__time_8h.html" title="Functions and types for monotonic times. " alt="" coords="782,931,890,957"/>
<area shape="rect" id="node14" href="compat__threads_8h_source.html" title="compat_threads.h" alt="" coords="1013,856,1139,883"/>
<area shape="rect" id="node16" href="di__ops_8h.html" title="Headers for di_ops.c. " alt="" coords="635,856,706,883"/>
<area shape="rect" id="node18" href="util__bug_8h.html" title="Macros to manage assertions, fatal and non&#45;fatal. " alt="" coords="942,707,1021,733"/>
<area shape="rect" id="node20" href="crypto__digest_8h.html" title="Headers for crypto_digest.c. " alt="" coords="750,483,861,509"/>
<area shape="rect" id="node22" href="siphash_8h_source.html" title="siphash.h" alt="" coords="655,632,734,659"/>
<area shape="rect" id="node27" href="crypto__openssl__mgt_8h_source.html" title="crypto_openssl_mgt.h" alt="" coords="1197,483,1347,509"/>
<area shape="rect" id="node30" href="compat__openssl_8h.html" title="compatibility definitions for working with different openssl forks " alt="" coords="1041,408,1169,435"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a236399736fb575ecb707c4eee2b50494"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#a236399736fb575ecb707c4eee2b50494">rend_cache_init</a> (void)</td></tr>
<tr class="separator:a236399736fb575ecb707c4eee2b50494"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98bc0e3e09bdcc28fe6f6a5dcf3648f2"><td class="memItemLeft" align="right" valign="top">STATIC size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#a98bc0e3e09bdcc28fe6f6a5dcf3648f2">rend_cache_entry_allocation</a> (const <a class="el" href="structrend__cache__entry__t.html">rend_cache_entry_t</a> *e)</td></tr>
<tr class="separator:a98bc0e3e09bdcc28fe6f6a5dcf3648f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16b71a6e83a85e91212db67293fcb52c"><td class="memItemLeft" align="right" valign="top"><a id="a16b71a6e83a85e91212db67293fcb52c"></a>
size_t&#160;</td><td class="memItemRight" valign="bottom"><b>rend_cache_get_total_allocation</b> (void)</td></tr>
<tr class="separator:a16b71a6e83a85e91212db67293fcb52c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4539ad1623f8861e4efe051f13c9fcb9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#a4539ad1623f8861e4efe051f13c9fcb9">rend_cache_decrement_allocation</a> (size_t n)</td></tr>
<tr class="separator:a4539ad1623f8861e4efe051f13c9fcb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3f8d9164ca6c57d8844f2776aaed294"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#aa3f8d9164ca6c57d8844f2776aaed294">rend_cache_increment_allocation</a> (size_t n)</td></tr>
<tr class="separator:aa3f8d9164ca6c57d8844f2776aaed294"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6501f6116d6d34024f932a8ebecc5d47"><td class="memItemLeft" align="right" valign="top">STATIC void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#a6501f6116d6d34024f932a8ebecc5d47">rend_cache_failure_intro_entry_free_</a> (<a class="el" href="structrend__cache__failure__intro__t.html">rend_cache_failure_intro_t</a> *entry)</td></tr>
<tr class="separator:a6501f6116d6d34024f932a8ebecc5d47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fcb974f5d0de00e8611297aa43a2979"><td class="memItemLeft" align="right" valign="top">STATIC <a class="el" href="structrend__cache__failure__intro__t.html">rend_cache_failure_intro_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#a4fcb974f5d0de00e8611297aa43a2979">rend_cache_failure_intro_entry_new</a> (rend_intro_point_failure_t failure)</td></tr>
<tr class="separator:a4fcb974f5d0de00e8611297aa43a2979"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa28cd965e269eeb43f4cc7a5848fd36c"><td class="memItemLeft" align="right" valign="top">STATIC void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#aa28cd965e269eeb43f4cc7a5848fd36c">rend_cache_failure_entry_free_</a> (<a class="el" href="structrend__cache__failure__t.html">rend_cache_failure_t</a> *entry)</td></tr>
<tr class="separator:aa28cd965e269eeb43f4cc7a5848fd36c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4958d02ca958f5127aa83395d9146011"><td class="memItemLeft" align="right" valign="top">STATIC void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#a4958d02ca958f5127aa83395d9146011">rend_cache_failure_entry_free_void</a> (void *entry)</td></tr>
<tr class="separator:a4958d02ca958f5127aa83395d9146011"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1129f843dc29e4d747bc378da1395d15"><td class="memItemLeft" align="right" valign="top">STATIC <a class="el" href="structrend__cache__failure__t.html">rend_cache_failure_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#a1129f843dc29e4d747bc378da1395d15">rend_cache_failure_entry_new</a> (void)</td></tr>
<tr class="separator:a1129f843dc29e4d747bc378da1395d15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b62337cd31ec86e2239ffbe6005adce"><td class="memItemLeft" align="right" valign="top">STATIC void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#a3b62337cd31ec86e2239ffbe6005adce">rend_cache_failure_remove</a> (<a class="el" href="structrend__service__descriptor__t.html">rend_service_descriptor_t</a> *desc)</td></tr>
<tr class="separator:a3b62337cd31ec86e2239ffbe6005adce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c71adefc4d624d1be3abf7d25dedd1d"><td class="memItemLeft" align="right" valign="top">STATIC void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#a9c71adefc4d624d1be3abf7d25dedd1d">rend_cache_entry_free_</a> (<a class="el" href="structrend__cache__entry__t.html">rend_cache_entry_t</a> *e)</td></tr>
<tr class="separator:a9c71adefc4d624d1be3abf7d25dedd1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31148f91462749991e9b7d974104e419"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#a31148f91462749991e9b7d974104e419">rend_cache_free_all</a> (void)</td></tr>
<tr class="separator:a31148f91462749991e9b7d974104e419"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab95357bc318649e8bbce982ecbae0d6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#aab95357bc318649e8bbce982ecbae0d6">rend_cache_failure_clean</a> (time_t now)</td></tr>
<tr class="separator:aab95357bc318649e8bbce982ecbae0d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62c6247e46d1998faf442813a557e0ad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#a62c6247e46d1998faf442813a557e0ad">rend_cache_clean</a> (time_t now, rend_cache_type_t cache_type)</td></tr>
<tr class="separator:a62c6247e46d1998faf442813a557e0ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd82dd000c55587eedbd5478cacda170"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#abd82dd000c55587eedbd5478cacda170">rend_cache_purge</a> (void)</td></tr>
<tr class="separator:abd82dd000c55587eedbd5478cacda170"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a0248d1f15bccd9f6c36aa0d52969ec"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#a2a0248d1f15bccd9f6c36aa0d52969ec">rend_cache_failure_purge</a> (void)</td></tr>
<tr class="separator:a2a0248d1f15bccd9f6c36aa0d52969ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5d4ae0f3f0e44df2209977d622b6a5c"><td class="memItemLeft" align="right" valign="top">STATIC int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#aa5d4ae0f3f0e44df2209977d622b6a5c">cache_failure_intro_lookup</a> (const uint8_t *identity, const char *service_id, <a class="el" href="structrend__cache__failure__intro__t.html">rend_cache_failure_intro_t</a> **intro_entry)</td></tr>
<tr class="separator:aa5d4ae0f3f0e44df2209977d622b6a5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29c3a627ad5064fa0df4d8ab96bad375"><td class="memItemLeft" align="right" valign="top">STATIC void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#a29c3a627ad5064fa0df4d8ab96bad375">cache_failure_intro_add</a> (const uint8_t *identity, const char *service_id, rend_intro_point_failure_t failure)</td></tr>
<tr class="separator:a29c3a627ad5064fa0df4d8ab96bad375"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6a91dc1e6d0693a166343e41b477e98"><td class="memItemLeft" align="right" valign="top">STATIC void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#ab6a91dc1e6d0693a166343e41b477e98">validate_intro_point_failure</a> (const <a class="el" href="structrend__service__descriptor__t.html">rend_service_descriptor_t</a> *desc, const char *service_id)</td></tr>
<tr class="separator:ab6a91dc1e6d0693a166343e41b477e98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa76d05e39fd88a59ab53062cc57d2625"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#aa76d05e39fd88a59ab53062cc57d2625">rend_cache_intro_failure_note</a> (rend_intro_point_failure_t failure, const uint8_t *identity, const char *service_id)</td></tr>
<tr class="separator:aa76d05e39fd88a59ab53062cc57d2625"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb504774c39f386719c13cef6854f693"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#aeb504774c39f386719c13cef6854f693">rend_cache_clean_v2_descs_as_dir</a> (time_t cutoff)</td></tr>
<tr class="separator:aeb504774c39f386719c13cef6854f693"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a367f96478b3d5bab8af7098b61fdafb4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#a367f96478b3d5bab8af7098b61fdafb4">rend_cache_lookup_entry</a> (const char *query, int version, <a class="el" href="structrend__cache__entry__t.html">rend_cache_entry_t</a> **e)</td></tr>
<tr class="separator:a367f96478b3d5bab8af7098b61fdafb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe090d09eea9c0ad1a4a9a6264aac654"><td class="memItemLeft" align="right" valign="top"><a id="abe090d09eea9c0ad1a4a9a6264aac654"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>rend_cache_lookup_v2_desc_as_service</b> (const char *query, <a class="el" href="structrend__cache__entry__t.html">rend_cache_entry_t</a> **e)</td></tr>
<tr class="separator:abe090d09eea9c0ad1a4a9a6264aac654"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28fafdade54254488fcb86ff22614f3e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#a28fafdade54254488fcb86ff22614f3e">rend_cache_lookup_v2_desc_as_dir</a> (const char *desc_id, const char **desc)</td></tr>
<tr class="separator:a28fafdade54254488fcb86ff22614f3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0029729f71187fd666fb549197645b7e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#a0029729f71187fd666fb549197645b7e">rend_cache_store_v2_desc_as_dir</a> (const char *desc)</td></tr>
<tr class="separator:a0029729f71187fd666fb549197645b7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a145529a71771c651bac51954ce10838e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#a145529a71771c651bac51954ce10838e">rend_cache_store_v2_desc_as_service</a> (const char *desc)</td></tr>
<tr class="separator:a145529a71771c651bac51954ce10838e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab763fe08f2a77e28d7aef75d9ccfad4a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#ab763fe08f2a77e28d7aef75d9ccfad4a">rend_cache_store_v2_desc_as_client</a> (const char *desc, const char *desc_id_base32, const <a class="el" href="structrend__data__t.html">rend_data_t</a> *rend_query, <a class="el" href="structrend__cache__entry__t.html">rend_cache_entry_t</a> **entry)</td></tr>
<tr class="separator:ab763fe08f2a77e28d7aef75d9ccfad4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a5dc2e99dda20fa83431a54216e578d41"><td class="memItemLeft" align="right" valign="top">STATIC strmap_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#a5dc2e99dda20fa83431a54216e578d41">rend_cache</a> = NULL</td></tr>
<tr class="separator:a5dc2e99dda20fa83431a54216e578d41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adcde1872e57dbb3ad1238ca59fd65129"><td class="memItemLeft" align="right" valign="top">STATIC digestmap_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#adcde1872e57dbb3ad1238ca59fd65129">rend_cache_v2_dir</a> = NULL</td></tr>
<tr class="separator:adcde1872e57dbb3ad1238ca59fd65129"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c2663af531bef15af4cc043337631f5"><td class="memItemLeft" align="right" valign="top">STATIC strmap_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rendcache_8c.html#a5c2663af531bef15af4cc043337631f5">rend_cache_failure</a> = NULL</td></tr>
<tr class="separator:a5c2663af531bef15af4cc043337631f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6d2716fa1abc359129d173e3682d621"><td class="memItemLeft" align="right" valign="top"><a id="ad6d2716fa1abc359129d173e3682d621"></a>
STATIC size_t&#160;</td><td class="memItemRight" valign="bottom"><b>rend_cache_total_allocation</b> = 0</td></tr>
<tr class="separator:ad6d2716fa1abc359129d173e3682d621"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Hidden service descriptor cache. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a29c3a627ad5064fa0df4d8ab96bad375"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29c3a627ad5064fa0df4d8ab96bad375">&#9670;&nbsp;</a></span>cache_failure_intro_add()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC void cache_failure_intro_add </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>identity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>service_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">rend_intro_point_failure_t&#160;</td>
          <td class="paramname"><em>failure</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add an intro point failure to the failure cache using the relay <b>identity</b> and service ID <b>service_id</b>. Record the <b>failure</b> in that object. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c_a29c3a627ad5064fa0df4d8ab96bad375_cgraph.png" border="0" usemap="#rendcache_8c_a29c3a627ad5064fa0df4d8ab96bad375_cgraph" alt=""/></div>
<map name="rendcache_8c_a29c3a627ad5064fa0df4d8ab96bad375_cgraph" id="rendcache_8c_a29c3a627ad5064fa0df4d8ab96bad375_cgraph">
<area shape="rect" id="node2" href="container_8c.html#a1406b823cb6088df755f1b81153d137e" title="strmap_get_lc" alt="" coords="225,5,329,32"/>
<area shape="rect" id="node3" href="rendcache_8c.html#a1129f843dc29e4d747bc378da1395d15" title="rend_cache_failure\l_entry_new" alt="" coords="212,57,343,98"/>
<area shape="rect" id="node4" href="container_8c.html#ab89b18ed07c18bdf4cb8d84bcc38f667" title="strmap_set_lc" alt="" coords="225,123,329,149"/>
<area shape="rect" id="node5" href="rendcache_8c.html#a4fcb974f5d0de00e8611297aa43a2979" title="rend_cache_failure\l_intro_entry_new" alt="" coords="212,174,343,215"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c_a29c3a627ad5064fa0df4d8ab96bad375_icgraph.png" border="0" usemap="#rendcache_8c_a29c3a627ad5064fa0df4d8ab96bad375_icgraph" alt=""/></div>
<map name="rendcache_8c_a29c3a627ad5064fa0df4d8ab96bad375_icgraph" id="rendcache_8c_a29c3a627ad5064fa0df4d8ab96bad375_icgraph">
<area shape="rect" id="node2" href="rendcache_8h.html#aa76d05e39fd88a59ab53062cc57d2625" title="rend_cache_intro_failure_note" alt="" coords="212,5,407,32"/>
</map>
</div>

</div>
</div>
<a id="aa5d4ae0f3f0e44df2209977d622b6a5c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa5d4ae0f3f0e44df2209977d622b6a5c">&#9670;&nbsp;</a></span>cache_failure_intro_lookup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC int cache_failure_intro_lookup </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>identity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>service_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structrend__cache__failure__intro__t.html">rend_cache_failure_intro_t</a> **&#160;</td>
          <td class="paramname"><em>intro_entry</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Lookup the rend failure cache using a relay identity digest in <b>identity</b> which has DIGEST_LEN bytes and service ID <b>service_id</b> which is a null-terminated string. If found, the intro failure is set in <b>intro_entry</b> else it stays untouched. Return 1 iff found else 0. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c_aa5d4ae0f3f0e44df2209977d622b6a5c_cgraph.png" border="0" usemap="#rendcache_8c_aa5d4ae0f3f0e44df2209977d622b6a5c_cgraph" alt=""/></div>
<map name="rendcache_8c_aa5d4ae0f3f0e44df2209977d622b6a5c_cgraph" id="rendcache_8c_aa5d4ae0f3f0e44df2209977d622b6a5c_cgraph">
<area shape="rect" id="node2" href="container_8c.html#a1406b823cb6088df755f1b81153d137e" title="strmap_get_lc" alt="" coords="184,13,288,39"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c_aa5d4ae0f3f0e44df2209977d622b6a5c_icgraph.png" border="0" usemap="#rendcache_8c_aa5d4ae0f3f0e44df2209977d622b6a5c_icgraph" alt=""/></div>
<map name="rendcache_8c_aa5d4ae0f3f0e44df2209977d622b6a5c_icgraph" id="rendcache_8c_aa5d4ae0f3f0e44df2209977d622b6a5c_icgraph">
<area shape="rect" id="node2" href="rendcache_8h.html#aa76d05e39fd88a59ab53062cc57d2625" title="rend_cache_intro_failure_note" alt="" coords="184,13,379,39"/>
</map>
</div>

</div>
</div>
<a id="a62c6247e46d1998faf442813a557e0ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62c6247e46d1998faf442813a557e0ad">&#9670;&nbsp;</a></span>rend_cache_clean()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rend_cache_clean </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">rend_cache_type_t&#160;</td>
          <td class="paramname"><em>cache_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Removes all old entries from the client or service descriptor cache. </p>

</div>
</div>
<a id="aeb504774c39f386719c13cef6854f693"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb504774c39f386719c13cef6854f693">&#9670;&nbsp;</a></span>rend_cache_clean_v2_descs_as_dir()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t rend_cache_clean_v2_descs_as_dir </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>cutoff</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove all old v2 descriptors and those for which this hidden service directory is not responsible for any more. The cutoff is the time limit for which we want to keep the cache entry. In other words, any entry created before will be removed. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c_aeb504774c39f386719c13cef6854f693_cgraph.png" border="0" usemap="#rendcache_8c_aeb504774c39f386719c13cef6854f693_cgraph" alt=""/></div>
<map name="rendcache_8c_aeb504774c39f386719c13cef6854f693_cgraph" id="rendcache_8c_aeb504774c39f386719c13cef6854f693_cgraph">
<area shape="rect" id="node2" href="util__format_8c.html#af100283587ab62e6645c900859f95c8e" title="base32_encode" alt="" coords="201,13,315,39"/>
</map>
</div>

</div>
</div>
<a id="a4539ad1623f8861e4efe051f13c9fcb9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4539ad1623f8861e4efe051f13c9fcb9">&#9670;&nbsp;</a></span>rend_cache_decrement_allocation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rend_cache_decrement_allocation </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Decrement the total bytes attributed to the rendezvous cache by n. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c_a4539ad1623f8861e4efe051f13c9fcb9_icgraph.png" border="0" usemap="#rendcache_8c_a4539ad1623f8861e4efe051f13c9fcb9_icgraph" alt=""/></div>
<map name="rendcache_8c_a4539ad1623f8861e4efe051f13c9fcb9_icgraph" id="rendcache_8c_a4539ad1623f8861e4efe051f13c9fcb9_icgraph">
<area shape="rect" id="node2" href="rendcache_8c.html#a9c71adefc4d624d1be3abf7d25dedd1d" title="rend_cache_entry_free_" alt="" coords="211,13,372,39"/>
</map>
</div>

</div>
</div>
<a id="a98bc0e3e09bdcc28fe6f6a5dcf3648f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98bc0e3e09bdcc28fe6f6a5dcf3648f2">&#9670;&nbsp;</a></span>rend_cache_entry_allocation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC size_t rend_cache_entry_allocation </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structrend__cache__entry__t.html">rend_cache_entry_t</a> *&#160;</td>
          <td class="paramname"><em>e</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the approximate number of bytes needed to hold <b>e</b>. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c_a98bc0e3e09bdcc28fe6f6a5dcf3648f2_icgraph.png" border="0" usemap="#rendcache_8c_a98bc0e3e09bdcc28fe6f6a5dcf3648f2_icgraph" alt=""/></div>
<map name="rendcache_8c_a98bc0e3e09bdcc28fe6f6a5dcf3648f2_icgraph" id="rendcache_8c_a98bc0e3e09bdcc28fe6f6a5dcf3648f2_icgraph">
<area shape="rect" id="node2" href="rendcache_8c.html#a9c71adefc4d624d1be3abf7d25dedd1d" title="rend_cache_entry_free_" alt="" coords="240,5,401,32"/>
</map>
</div>

</div>
</div>
<a id="a9c71adefc4d624d1be3abf7d25dedd1d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c71adefc4d624d1be3abf7d25dedd1d">&#9670;&nbsp;</a></span>rend_cache_entry_free_()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC void rend_cache_entry_free_ </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrend__cache__entry__t.html">rend_cache_entry_t</a> *&#160;</td>
          <td class="paramname"><em>e</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Helper: free storage held by a single service descriptor cache entry. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c_a9c71adefc4d624d1be3abf7d25dedd1d_cgraph.png" border="0" usemap="#rendcache_8c_a9c71adefc4d624d1be3abf7d25dedd1d_cgraph" alt=""/></div>
<map name="rendcache_8c_a9c71adefc4d624d1be3abf7d25dedd1d_cgraph" id="rendcache_8c_a9c71adefc4d624d1be3abf7d25dedd1d_cgraph">
<area shape="rect" id="node2" href="rendcache_8c.html#a4539ad1623f8861e4efe051f13c9fcb9" title="rend_cache_decrement\l_allocation" alt="" coords="229,5,387,47"/>
<area shape="rect" id="node3" href="rendcache_8c.html#a98bc0e3e09bdcc28fe6f6a5dcf3648f2" title="rend_cache_entry_allocation" alt="" coords="215,71,401,98"/>
<area shape="rect" id="node4" href="rendcache_8c.html#a3b62337cd31ec86e2239ffbe6005adce" title="rend_cache_failure\l_remove" alt="" coords="243,123,373,164"/>
<area shape="rect" id="node5" href="rendcommon_8c.html#abb619b1758ff82d476170d83fce49e77" title="rend_get_service_id" alt="" coords="449,79,588,106"/>
<area shape="rect" id="node9" href="container_8c.html#a1406b823cb6088df755f1b81153d137e" title="strmap_get_lc" alt="" coords="467,130,571,157"/>
<area shape="rect" id="node10" href="container_8c.html#a90e49bde1c4f424f5055b023da5c5393" title="strmap_remove_lc" alt="" coords="454,181,583,207"/>
<area shape="rect" id="node6" href="crypto__rsa_8c.html#a91336077a5062618ff895dae4e50079d" title="crypto_pk_get_digest" alt="" coords="636,54,783,81"/>
<area shape="rect" id="node8" href="util__format_8c.html#af100283587ab62e6645c900859f95c8e" title="base32_encode" alt="" coords="653,105,766,131"/>
<area shape="rect" id="node7" href="crypto__rsa_8c.html#a47b1080a7a68f04e0e745168075c235f" title="crypto_pk_keysize" alt="" coords="831,54,961,81"/>
</map>
</div>

</div>
</div>
<a id="aab95357bc318649e8bbce982ecbae0d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab95357bc318649e8bbce982ecbae0d6">&#9670;&nbsp;</a></span>rend_cache_failure_clean()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rend_cache_failure_clean </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove all entries that re REND_CACHE_FAILURE_MAX_AGE old. This is called every second.</p>
<p>We have to clean these regurlarly else if for whatever reasons an hidden service goes offline and a client tries to connect to it during that time, a failure entry is created and the client will be unable to connect for a while even though the service has return online. </p>

</div>
</div>
<a id="aa28cd965e269eeb43f4cc7a5848fd36c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa28cd965e269eeb43f4cc7a5848fd36c">&#9670;&nbsp;</a></span>rend_cache_failure_entry_free_()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC void rend_cache_failure_entry_free_ </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrend__cache__failure__t.html">rend_cache_failure_t</a> *&#160;</td>
          <td class="paramname"><em>entry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Helper: free a rend cache failure object. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c_aa28cd965e269eeb43f4cc7a5848fd36c_icgraph.png" border="0" usemap="#rendcache_8c_aa28cd965e269eeb43f4cc7a5848fd36c_icgraph" alt=""/></div>
<map name="rendcache_8c_aa28cd965e269eeb43f4cc7a5848fd36c_icgraph" id="rendcache_8c_aa28cd965e269eeb43f4cc7a5848fd36c_icgraph">
<area shape="rect" id="node2" href="rendcache_8c.html#a4958d02ca958f5127aa83395d9146011" title="rend_cache_failure\l_entry_free_void" alt="" coords="184,5,315,47"/>
</map>
</div>

</div>
</div>
<a id="a4958d02ca958f5127aa83395d9146011"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4958d02ca958f5127aa83395d9146011">&#9670;&nbsp;</a></span>rend_cache_failure_entry_free_void()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC void rend_cache_failure_entry_free_void </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>entry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Helper: deallocate a <a class="el" href="structrend__cache__failure__t.html">rend_cache_failure_t</a>. (Used with strmap_free(), which requires a function pointer whose argument is void*). </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c_a4958d02ca958f5127aa83395d9146011_cgraph.png" border="0" usemap="#rendcache_8c_a4958d02ca958f5127aa83395d9146011_cgraph" alt=""/></div>
<map name="rendcache_8c_a4958d02ca958f5127aa83395d9146011_cgraph" id="rendcache_8c_a4958d02ca958f5127aa83395d9146011_cgraph">
<area shape="rect" id="node2" href="rendcache_8c.html#aa28cd965e269eeb43f4cc7a5848fd36c" title="rend_cache_failure\l_entry_free_" alt="" coords="184,5,315,47"/>
</map>
</div>

</div>
</div>
<a id="a1129f843dc29e4d747bc378da1395d15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1129f843dc29e4d747bc378da1395d15">&#9670;&nbsp;</a></span>rend_cache_failure_entry_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC <a class="el" href="structrend__cache__failure__t.html">rend_cache_failure_t</a>* rend_cache_failure_entry_new </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate a rend cache failure object and return it. This function can not fail. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c_a1129f843dc29e4d747bc378da1395d15_icgraph.png" border="0" usemap="#rendcache_8c_a1129f843dc29e4d747bc378da1395d15_icgraph" alt=""/></div>
<map name="rendcache_8c_a1129f843dc29e4d747bc378da1395d15_icgraph" id="rendcache_8c_a1129f843dc29e4d747bc378da1395d15_icgraph">
<area shape="rect" id="node2" href="rendcache_8c.html#a29c3a627ad5064fa0df4d8ab96bad375" title="cache_failure_intro_add" alt="" coords="184,13,343,39"/>
<area shape="rect" id="node3" href="rendcache_8h.html#aa76d05e39fd88a59ab53062cc57d2625" title="rend_cache_intro_failure_note" alt="" coords="391,13,585,39"/>
</map>
</div>

</div>
</div>
<a id="a6501f6116d6d34024f932a8ebecc5d47"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6501f6116d6d34024f932a8ebecc5d47">&#9670;&nbsp;</a></span>rend_cache_failure_intro_entry_free_()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC void rend_cache_failure_intro_entry_free_ </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrend__cache__failure__intro__t.html">rend_cache_failure_intro_t</a> *&#160;</td>
          <td class="paramname"><em>entry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Helper: free a rend cache failure intro object. </p>

</div>
</div>
<a id="a4fcb974f5d0de00e8611297aa43a2979"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fcb974f5d0de00e8611297aa43a2979">&#9670;&nbsp;</a></span>rend_cache_failure_intro_entry_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC <a class="el" href="structrend__cache__failure__intro__t.html">rend_cache_failure_intro_t</a>* rend_cache_failure_intro_entry_new </td>
          <td>(</td>
          <td class="paramtype">rend_intro_point_failure_t&#160;</td>
          <td class="paramname"><em>failure</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate a rend cache failure intro object and return it. <b>failure</b> is set into the object. This function can not fail. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c_a4fcb974f5d0de00e8611297aa43a2979_icgraph.png" border="0" usemap="#rendcache_8c_a4fcb974f5d0de00e8611297aa43a2979_icgraph" alt=""/></div>
<map name="rendcache_8c_a4fcb974f5d0de00e8611297aa43a2979_icgraph" id="rendcache_8c_a4fcb974f5d0de00e8611297aa43a2979_icgraph">
<area shape="rect" id="node2" href="rendcache_8c.html#a29c3a627ad5064fa0df4d8ab96bad375" title="cache_failure_intro_add" alt="" coords="184,13,343,39"/>
<area shape="rect" id="node3" href="rendcache_8h.html#aa76d05e39fd88a59ab53062cc57d2625" title="rend_cache_intro_failure_note" alt="" coords="391,13,585,39"/>
</map>
</div>

</div>
</div>
<a id="a2a0248d1f15bccd9f6c36aa0d52969ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a0248d1f15bccd9f6c36aa0d52969ec">&#9670;&nbsp;</a></span>rend_cache_failure_purge()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rend_cache_failure_purge </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove ALL entries from the failure cache. This is also called when a NEWNYM signal is received. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c_a2a0248d1f15bccd9f6c36aa0d52969ec_icgraph.png" border="0" usemap="#rendcache_8c_a2a0248d1f15bccd9f6c36aa0d52969ec_icgraph" alt=""/></div>
<map name="rendcache_8c_a2a0248d1f15bccd9f6c36aa0d52969ec_icgraph" id="rendcache_8c_a2a0248d1f15bccd9f6c36aa0d52969ec_icgraph">
<area shape="rect" id="node2" href="rendclient_8h.html#af25d45137e5e3a3834edf201d47ea5ca" title="rend_client_purge_state" alt="" coords="184,13,344,39"/>
</map>
</div>

</div>
</div>
<a id="a3b62337cd31ec86e2239ffbe6005adce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b62337cd31ec86e2239ffbe6005adce">&#9670;&nbsp;</a></span>rend_cache_failure_remove()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC void rend_cache_failure_remove </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrend__service__descriptor__t.html">rend_service_descriptor_t</a> *&#160;</td>
          <td class="paramname"><em>desc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove failure cache entry for the service ID in the given descriptor <b>desc</b>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c_a3b62337cd31ec86e2239ffbe6005adce_cgraph.png" border="0" usemap="#rendcache_8c_a3b62337cd31ec86e2239ffbe6005adce_cgraph" alt=""/></div>
<map name="rendcache_8c_a3b62337cd31ec86e2239ffbe6005adce_cgraph" id="rendcache_8c_a3b62337cd31ec86e2239ffbe6005adce_cgraph">
<area shape="rect" id="node2" href="rendcommon_8c.html#abb619b1758ff82d476170d83fce49e77" title="rend_get_service_id" alt="" coords="184,31,323,57"/>
<area shape="rect" id="node6" href="container_8c.html#a1406b823cb6088df755f1b81153d137e" title="strmap_get_lc" alt="" coords="201,81,305,108"/>
<area shape="rect" id="node7" href="container_8c.html#a90e49bde1c4f424f5055b023da5c5393" title="strmap_remove_lc" alt="" coords="189,132,318,159"/>
<area shape="rect" id="node3" href="crypto__rsa_8c.html#a91336077a5062618ff895dae4e50079d" title="crypto_pk_get_digest" alt="" coords="371,5,517,32"/>
<area shape="rect" id="node5" href="util__format_8c.html#af100283587ab62e6645c900859f95c8e" title="base32_encode" alt="" coords="387,56,501,83"/>
<area shape="rect" id="node4" href="crypto__rsa_8c.html#a47b1080a7a68f04e0e745168075c235f" title="crypto_pk_keysize" alt="" coords="565,5,696,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c_a3b62337cd31ec86e2239ffbe6005adce_icgraph.png" border="0" usemap="#rendcache_8c_a3b62337cd31ec86e2239ffbe6005adce_icgraph" alt=""/></div>
<map name="rendcache_8c_a3b62337cd31ec86e2239ffbe6005adce_icgraph" id="rendcache_8c_a3b62337cd31ec86e2239ffbe6005adce_icgraph">
<area shape="rect" id="node2" href="rendcache_8c.html#a9c71adefc4d624d1be3abf7d25dedd1d" title="rend_cache_entry_free_" alt="" coords="184,13,345,39"/>
</map>
</div>

</div>
</div>
<a id="a31148f91462749991e9b7d974104e419"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31148f91462749991e9b7d974104e419">&#9670;&nbsp;</a></span>rend_cache_free_all()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rend_cache_free_all </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Free all storage held by the service descriptor cache. </p>

</div>
</div>
<a id="aa3f8d9164ca6c57d8844f2776aaed294"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3f8d9164ca6c57d8844f2776aaed294">&#9670;&nbsp;</a></span>rend_cache_increment_allocation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rend_cache_increment_allocation </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Increase the total bytes attributed to the rendezvous cache by n. </p>

</div>
</div>
<a id="a236399736fb575ecb707c4eee2b50494"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a236399736fb575ecb707c4eee2b50494">&#9670;&nbsp;</a></span>rend_cache_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rend_cache_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initializes the service descriptor cache. </p>

</div>
</div>
<a id="aa76d05e39fd88a59ab53062cc57d2625"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa76d05e39fd88a59ab53062cc57d2625">&#9670;&nbsp;</a></span>rend_cache_intro_failure_note()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rend_cache_intro_failure_note </td>
          <td>(</td>
          <td class="paramtype">rend_intro_point_failure_t&#160;</td>
          <td class="paramname"><em>failure</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>identity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>service_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Note down an intro failure in the rend failure cache using the type of failure in <b>failure</b> for the relay identity digest in <b>identity</b> and service ID <b>service_id</b>. If an entry already exists in the cache, the failure type is changed with <b>failure</b>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c_aa76d05e39fd88a59ab53062cc57d2625_cgraph.png" border="0" usemap="#rendcache_8c_aa76d05e39fd88a59ab53062cc57d2625_cgraph" alt=""/></div>
<map name="rendcache_8c_aa76d05e39fd88a59ab53062cc57d2625_cgraph" id="rendcache_8c_aa76d05e39fd88a59ab53062cc57d2625_cgraph">
<area shape="rect" id="node2" href="rendcache_8c.html#aa5d4ae0f3f0e44df2209977d622b6a5c" title="cache_failure_intro\l_lookup" alt="" coords="262,5,393,47"/>
<area shape="rect" id="node4" href="rendcache_8c.html#a29c3a627ad5064fa0df4d8ab96bad375" title="cache_failure_intro_add" alt="" coords="248,71,407,98"/>
<area shape="rect" id="node3" href="container_8c.html#a1406b823cb6088df755f1b81153d137e" title="strmap_get_lc" alt="" coords="468,13,572,39"/>
<area shape="rect" id="node5" href="rendcache_8c.html#a1129f843dc29e4d747bc378da1395d15" title="rend_cache_failure\l_entry_new" alt="" coords="455,64,585,105"/>
<area shape="rect" id="node6" href="container_8c.html#ab89b18ed07c18bdf4cb8d84bcc38f667" title="strmap_set_lc" alt="" coords="468,130,572,157"/>
<area shape="rect" id="node7" href="rendcache_8c.html#a4fcb974f5d0de00e8611297aa43a2979" title="rend_cache_failure\l_intro_entry_new" alt="" coords="455,181,585,223"/>
</map>
</div>

</div>
</div>
<a id="a367f96478b3d5bab8af7098b61fdafb4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a367f96478b3d5bab8af7098b61fdafb4">&#9670;&nbsp;</a></span>rend_cache_lookup_entry()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rend_cache_lookup_entry </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structrend__cache__entry__t.html">rend_cache_entry_t</a> **&#160;</td>
          <td class="paramname"><em>e</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Lookup in the client cache the given service ID <b>query</b> for <b>version</b>.</p>
<p>Return 0 if found and if <b>e</b> is non NULL, set it with the entry found. Else, a negative value is returned and <b>e</b> is untouched. -EINVAL means that <b>query</b> is not a valid service id. -ENOENT means that no entry in the cache was found. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c_a367f96478b3d5bab8af7098b61fdafb4_cgraph.png" border="0" usemap="#rendcache_8c_a367f96478b3d5bab8af7098b61fdafb4_cgraph" alt=""/></div>
<map name="rendcache_8c_a367f96478b3d5bab8af7098b61fdafb4_cgraph" id="rendcache_8c_a367f96478b3d5bab8af7098b61fdafb4_cgraph">
<area shape="rect" id="node2" href="rendcommon_8c.html#a07d97b83844365f0949fd9998269a5a9" title="rend_valid_v2_service_id" alt="" coords="224,5,392,32"/>
</map>
</div>

</div>
</div>
<a id="a28fafdade54254488fcb86ff22614f3e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28fafdade54254488fcb86ff22614f3e">&#9670;&nbsp;</a></span>rend_cache_lookup_v2_desc_as_dir()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rend_cache_lookup_v2_desc_as_dir </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>desc_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>desc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Lookup the v2 service descriptor with base32-encoded <b>desc_id</b> and copy the pointer to it to *<b>desc</b>. Return 1 on success, 0 on well-formed-but-not-found, and -1 on failure. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c_a28fafdade54254488fcb86ff22614f3e_cgraph.png" border="0" usemap="#rendcache_8c_a28fafdade54254488fcb86ff22614f3e_cgraph" alt=""/></div>
<map name="rendcache_8c_a28fafdade54254488fcb86ff22614f3e_cgraph" id="rendcache_8c_a28fafdade54254488fcb86ff22614f3e_cgraph">
<area shape="rect" id="node2" href="util__format_8c.html#a0db7bf387411ab548b7eaad28e6d7b28" title="base32_decode" alt="" coords="208,13,321,39"/>
</map>
</div>

</div>
</div>
<a id="abd82dd000c55587eedbd5478cacda170"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd82dd000c55587eedbd5478cacda170">&#9670;&nbsp;</a></span>rend_cache_purge()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rend_cache_purge </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove ALL entries from the rendezvous service descriptor cache. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c_abd82dd000c55587eedbd5478cacda170_icgraph.png" border="0" usemap="#rendcache_8c_abd82dd000c55587eedbd5478cacda170_icgraph" alt=""/></div>
<map name="rendcache_8c_abd82dd000c55587eedbd5478cacda170_icgraph" id="rendcache_8c_abd82dd000c55587eedbd5478cacda170_icgraph">
<area shape="rect" id="node2" href="rendclient_8h.html#af25d45137e5e3a3834edf201d47ea5ca" title="rend_client_purge_state" alt="" coords="181,5,341,32"/>
</map>
</div>

</div>
</div>
<a id="ab763fe08f2a77e28d7aef75d9ccfad4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab763fe08f2a77e28d7aef75d9ccfad4a">&#9670;&nbsp;</a></span>rend_cache_store_v2_desc_as_client()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rend_cache_store_v2_desc_as_client </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>desc_id_base32</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structrend__data__t.html">rend_data_t</a> *&#160;</td>
          <td class="paramname"><em>rend_query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structrend__cache__entry__t.html">rend_cache_entry_t</a> **&#160;</td>
          <td class="paramname"><em>entry</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Parse the v2 service descriptor in <b>desc</b>, decrypt the included list of introduction points with <b>descriptor_cookie</b> (which may also be <b>NULL</b> if decryption is not necessary), and store the descriptor to the local cache under its version and service id.</p>
<p>If we have a newer v2 descriptor with the same ID, ignore this one. If we have an older descriptor with the same ID, replace it. If the descriptor's service ID does not match <b>rend_query</b>-&gt;onion_address, reject it.</p>
<p>If the descriptor's descriptor ID doesn't match <b>desc_id_base32</b>, reject it.</p>
<p>Return 0 on success, or -1 if we rejected the descriptor. If entry is not NULL, set it with the cache entry pointer of the descriptor. </p>

</div>
</div>
<a id="a0029729f71187fd666fb549197645b7e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0029729f71187fd666fb549197645b7e">&#9670;&nbsp;</a></span>rend_cache_store_v2_desc_as_dir()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rend_cache_store_v2_desc_as_dir </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>desc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Parse the v2 service descriptor(s) in <b>desc</b> and store it/them to the local rend cache. Don't attempt to decrypt the included list of introduction points (as we don't have a descriptor cookie for it).</p>
<p>If we have a newer descriptor with the same ID, ignore this one. If we have an older descriptor with the same ID, replace it.</p>
<p>Return 0 on success, or -1 if we couldn't parse any of them.</p>
<p>We should only call this function for public (e.g. non bridge) relays. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="rendcache_8c_a0029729f71187fd666fb549197645b7e_cgraph.png" border="0" usemap="#rendcache_8c_a0029729f71187fd666fb549197645b7e_cgraph" alt=""/></div>
<map name="rendcache_8c_a0029729f71187fd666fb549197645b7e_cgraph" id="rendcache_8c_a0029729f71187fd666fb549197645b7e_cgraph">
<area shape="rect" id="node2" href="routerparse_8c.html#a2faba4db0eeeb6f97d9ba56983390b37" title="rend_parse_v2_service\l_descriptor" alt="" coords="200,5,356,47"/>
<area shape="rect" id="node3" href="util__format_8c.html#af100283587ab62e6645c900859f95c8e" title="base32_encode" alt="" coords="221,71,335,98"/>
</map>
</div>

</div>
</div>
<a id="a145529a71771c651bac51954ce10838e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a145529a71771c651bac51954ce10838e">&#9670;&nbsp;</a></span>rend_cache_store_v2_desc_as_service()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rend_cache_store_v2_desc_as_service </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>desc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Parse the v2 service descriptor in <b>desc</b> and store it to the local service rend cache. Don't attempt to decrypt the included list of introduction points.</p>
<p>If we have a newer descriptor with the same ID, ignore this one. If we have an older descriptor with the same ID, replace it.</p>
<p>Return 0 on success, or -1 if we couldn't understand the descriptor. </p>

</div>
</div>
<a id="ab6a91dc1e6d0693a166343e41b477e98"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab6a91dc1e6d0693a166343e41b477e98">&#9670;&nbsp;</a></span>validate_intro_point_failure()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC void validate_intro_point_failure </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structrend__service__descriptor__t.html">rend_service_descriptor_t</a> *&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>service_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Using a parsed descriptor <b>desc</b>, check if the introduction points are present in the failure cache and if so they are removed from the descriptor and kept into the failure cache. Then, each intro points that are NOT in the descriptor but in the failure cache for the given <b>service_id</b> are removed from the failure cache. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a5dc2e99dda20fa83431a54216e578d41"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5dc2e99dda20fa83431a54216e578d41">&#9670;&nbsp;</a></span>rend_cache</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC strmap_t* rend_cache = NULL</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Map from service id (as generated by rend_get_service_id) to <a class="el" href="structrend__cache__entry__t.html">rend_cache_entry_t</a>. </p>

</div>
</div>
<a id="a5c2663af531bef15af4cc043337631f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c2663af531bef15af4cc043337631f5">&#9670;&nbsp;</a></span>rend_cache_failure</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC strmap_t* rend_cache_failure = NULL</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>(Client side only) Map from service id to <a class="el" href="structrend__cache__failure__t.html">rend_cache_failure_t</a>. This cache is used to track intro point(IP) failures so we know when to keep or discard a new descriptor we just fetched. Here is a description of the cache behavior.</p>
<p>Everytime tor discards an IP (ex: receives a NACK), we add an entry to this cache noting the identity digest of the IP and it's failure type for the service ID. The reason we indexed this cache by service ID is to differentiate errors that can occur only for a specific service like a NACK for instance. It applies for one but maybe not for the others.</p>
<p>Once a service descriptor is fetched and considered valid, each IP is looked up in this cache and if present, it is discarded from the fetched descriptor. At the end, all IP(s) in the cache, for a specific service ID, that were NOT present in the descriptor are removed from this cache. Which means that if at least one IP was not in this cache, thus usuable, it's considered a new descriptor so we keep it. Else, if all IPs were in this cache, we discard the descriptor as it's considered unusable.</p>
<p>Once a descriptor is removed from the rend cache or expires, the entry in this cache is also removed for the service ID.</p>
<p>This scheme allows us to not rely on the descriptor's timestamp (which is rounded down to the hour) to know if we have a newer descriptor. We only rely on the usability of intro points from an internal state. </p>

</div>
</div>
<a id="adcde1872e57dbb3ad1238ca59fd65129"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adcde1872e57dbb3ad1238ca59fd65129">&#9670;&nbsp;</a></span>rend_cache_v2_dir</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC digestmap_t* rend_cache_v2_dir = NULL</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Map from descriptor id to <a class="el" href="structrend__cache__entry__t.html">rend_cache_entry_t</a>; only for hidden service directories. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
