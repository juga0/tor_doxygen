<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tor: /home/user/_my/code/bwauth-related/tor/src/or/onion_ntor.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tor
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97b64286d42c5ef1697cb5f17129db19.html">tor</a></li><li class="navelem"><a class="el" href="dir_3cb0ba3f4b82dbe34a1a06276e96bc8d.html">src</a></li><li class="navelem"><a class="el" href="dir_386635fabd7f6c74e9d9c7a8604514a0.html">or</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">onion_ntor.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implementation for the ntor handshake.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;orconfig.h&quot;</code><br />
<code>#include &quot;<a class="el" href="crypto_8h_source.html">crypto.h</a>&quot;</code><br />
<code>#include &quot;onion_ntor.h&quot;</code><br />
<code>#include &quot;<a class="el" href="torlog_8h_source.html">torlog.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="util_8h_source.html">util.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for onion_ntor.c:</div>
<div class="dyncontent">
<div class="center"><img src="onion__ntor_8c__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2onion__ntor_8c" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2onion__ntor_8c" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2onion__ntor_8c">
<area shape="rect" id="node2" href="orconfig_8h_source.html" title="orconfig.h" alt="" coords="568,483,647,509"/>
<area shape="rect" id="node3" href="crypto_8h.html" title="Headers for crypto.c. " alt="" coords="180,184,249,211"/>
<area shape="rect" id="node12" href="onion__ntor_8h_source.html" title="onion_ntor.h" alt="" coords="84,259,177,285"/>
<area shape="rect" id="node15" href="torlog_8h.html" title="Headers for log.c. " alt="" coords="1039,184,1104,211"/>
<area shape="rect" id="node16" href="util_8h.html" title="Headers for util.c. " alt="" coords="872,109,922,136"/>
<area shape="rect" id="node5" href="torint_8h.html" title="Header file to define uint32_t and friends. " alt="" coords="231,408,294,435"/>
<area shape="rect" id="node6" href="testsupport_8h_source.html" title="testsupport.h" alt="" coords="710,408,809,435"/>
<area shape="rect" id="node7" href="compat_8h_source.html" title="compat.h" alt="" coords="828,259,904,285"/>
<area shape="rect" id="node9" href="compat__time_8h.html" title="Functions and types for monotonic times. " alt="" coords="456,408,564,435"/>
<area shape="rect" id="node11" href="compat__threads_8h_source.html" title="compat_threads.h" alt="" coords="544,333,671,360"/>
<area shape="rect" id="node13" href="crypto__curve25519_8h_source.html" title="crypto_curve25519.h" alt="" coords="326,333,468,360"/>
<area shape="rect" id="node14" href="di__ops_8h.html" title="Headers for di_ops.c. " alt="" coords="27,333,98,360"/>
<area shape="rect" id="node18" href="util__bug_8h.html" title="util_bug.h" alt="" coords="1159,184,1238,211"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structtweakset__t.html">tweakset_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a76298213522c271963a81b606d40d062"><td class="memItemLeft" align="right" valign="top"><a id="a76298213522c271963a81b606d40d062"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ONION_NTOR_PRIVATE</b></td></tr>
<tr class="separator:a76298213522c271963a81b606d40d062"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa53093cdcf7f0ef335c56e04e31ea842"><td class="memItemLeft" align="right" valign="top"><a id="aa53093cdcf7f0ef335c56e04e31ea842"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>PROTOID</b>&#160;&#160;&#160;&quot;ntor-curve25519-sha256-1&quot;</td></tr>
<tr class="separator:aa53093cdcf7f0ef335c56e04e31ea842"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee61e79a10433482b82f2f6d80fcad21"><td class="memItemLeft" align="right" valign="top"><a id="aee61e79a10433482b82f2f6d80fcad21"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>PROTOID_LEN</b>&#160;&#160;&#160;24</td></tr>
<tr class="separator:aee61e79a10433482b82f2f6d80fcad21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6dcccd39d834780bb0c2002630105827"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="onion__ntor_8c.html#a6dcccd39d834780bb0c2002630105827">APPEND</a>(ptr,  inp,  len)</td></tr>
<tr class="separator:a6dcccd39d834780bb0c2002630105827"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad042e288bcd305a20ff70adc5c4b19fc"><td class="memItemLeft" align="right" valign="top"><a id="ad042e288bcd305a20ff70adc5c4b19fc"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SERVER_STR</b>&#160;&#160;&#160;&quot;Server&quot;</td></tr>
<tr class="separator:ad042e288bcd305a20ff70adc5c4b19fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62c951a2d9190f419342c359a097cdc4"><td class="memItemLeft" align="right" valign="top"><a id="a62c951a2d9190f419342c359a097cdc4"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SERVER_STR_LEN</b>&#160;&#160;&#160;6</td></tr>
<tr class="separator:a62c951a2d9190f419342c359a097cdc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05cc6c4216b50c313b9412216392b825"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>SECRET_INPUT_LEN</b></td></tr>
<tr class="separator:a05cc6c4216b50c313b9412216392b825"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a9cdd23bbd36508cf1d6783220fa572"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>AUTH_INPUT_LEN</b></td></tr>
<tr class="separator:a6a9cdd23bbd36508cf1d6783220fa572"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ae8c259df4a18a79f8c6685196e5213dd"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structtweakset__t.html">tweakset_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="onion__ntor_8c.html#ae8c259df4a18a79f8c6685196e5213dd">tweakset_t</a></td></tr>
<tr class="separator:ae8c259df4a18a79f8c6685196e5213dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a8fa2c57ed9d4853f66bba046754f7787"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="onion__ntor_8c.html#a8fa2c57ed9d4853f66bba046754f7787">ntor_handshake_state_free</a> (ntor_handshake_state_t *state)</td></tr>
<tr class="separator:a8fa2c57ed9d4853f66bba046754f7787"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5033e0e224249ea4c42b37ddd4937dd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="onion__ntor_8c.html#ad5033e0e224249ea4c42b37ddd4937dd">onion_skin_ntor_create</a> (const uint8_t *router_id, const <a class="el" href="structcurve25519__public__key__t.html">curve25519_public_key_t</a> *router_key, ntor_handshake_state_t **handshake_state_out, uint8_t *onion_skin_out)</td></tr>
<tr class="separator:ad5033e0e224249ea4c42b37ddd4937dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5251c28f884c978124716ebd807e3e56"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="onion__ntor_8c.html#a5251c28f884c978124716ebd807e3e56">onion_skin_ntor_server_handshake</a> (const uint8_t *onion_skin, const <a class="el" href="structdi__digest256__map__t.html">di_digest256_map_t</a> *private_keys, const <a class="el" href="structcurve25519__keypair__t.html">curve25519_keypair_t</a> *junk_keys, const uint8_t *my_node_id, uint8_t *handshake_reply_out, uint8_t *key_out, size_t key_out_len)</td></tr>
<tr class="separator:a5251c28f884c978124716ebd807e3e56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0eea51867a86daa1db5ac0eefee42eb0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="onion__ntor_8c.html#a0eea51867a86daa1db5ac0eefee42eb0">onion_skin_ntor_client_handshake</a> (const ntor_handshake_state_t *handshake_state, const uint8_t *handshake_reply, uint8_t *key_out, size_t key_out_len, const char **msg_out)</td></tr>
<tr class="separator:a0eea51867a86daa1db5ac0eefee42eb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation for the ntor handshake. </p>
<p>The ntor circuit-extension handshake was developed as a replacement for the old TAP handshake. It uses Elliptic-curve Diffie-Hellman and a hash function in order to perform a one-way authenticated key exchange. The ntor handshake is meant to replace the old "TAP" handshake.</p>
<p>We instantiate ntor with curve25519, HMAC-SHA256, and HKDF.</p>
<p>This handshake, like the other circuit-extension handshakes, is invoked from <a class="el" href="onion_8c.html" title="Functions to queue create cells, wrap the various onionskin types, and parse and create the CREATE ce...">onion.c</a>. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a6dcccd39d834780bb0c2002630105827"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6dcccd39d834780bb0c2002630105827">&#9670;&nbsp;</a></span>APPEND</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APPEND</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">ptr, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">inp, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">len&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">STMT_BEGIN {                                  \</div><div class="line">    memcpy(ptr, (inp), (len));                  \</div><div class="line">    ptr += len;                                 \</div><div class="line">  } STMT_END</div></div><!-- fragment --><p>Convenience macro: copy <b>len</b> bytes from <b>inp</b> to <b>ptr</b>, and advance <b>ptr</b> by the number of bytes copied. </p>

</div>
</div>
<a id="a6a9cdd23bbd36508cf1d6783220fa572"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a9cdd23bbd36508cf1d6783220fa572">&#9670;&nbsp;</a></span>AUTH_INPUT_LEN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AUTH_INPUT_LEN</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">(<a class="code" href="crypto_8h.html#a34e055abb21d9f47b5f3d821e4beb091">DIGEST256_LEN</a> + <a class="code" href="crypto_8h.html#a14aa0c95ad1775ec290dc69b1ada1f6b">DIGEST_LEN</a> +    \</div><div class="line">                        CURVE25519_PUBKEY_LEN*3 +       \</div><div class="line">                        PROTOID_LEN + SERVER_STR_LEN)</div><div class="ttc" id="crypto_8h_html_a14aa0c95ad1775ec290dc69b1ada1f6b"><div class="ttname"><a href="crypto_8h.html#a14aa0c95ad1775ec290dc69b1ada1f6b">DIGEST_LEN</a></div><div class="ttdeci">#define DIGEST_LEN</div><div class="ttdef"><b>Definition:</b> crypto.h:56</div></div>
<div class="ttc" id="crypto_8h_html_a34e055abb21d9f47b5f3d821e4beb091"><div class="ttname"><a href="crypto_8h.html#a34e055abb21d9f47b5f3d821e4beb091">DIGEST256_LEN</a></div><div class="ttdeci">#define DIGEST256_LEN</div><div class="ttdef"><b>Definition:</b> crypto.h:59</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a05cc6c4216b50c313b9412216392b825"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a05cc6c4216b50c313b9412216392b825">&#9670;&nbsp;</a></span>SECRET_INPUT_LEN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SECRET_INPUT_LEN</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">(CURVE25519_PUBKEY_LEN * 3 +   \</div><div class="line">                          CURVE25519_OUTPUT_LEN * 2 +   \</div><div class="line">                          DIGEST_LEN + PROTOID_LEN)</div></div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="ae8c259df4a18a79f8c6685196e5213dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8c259df4a18a79f8c6685196e5213dd">&#9670;&nbsp;</a></span>tweakset_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structtweakset__t.html">tweakset_t</a>  <a class="el" href="structtweakset__t.html">tweakset_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Wrapper around a set of tweak-values for use with the ntor handshake. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a8fa2c57ed9d4853f66bba046754f7787"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8fa2c57ed9d4853f66bba046754f7787">&#9670;&nbsp;</a></span>ntor_handshake_state_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ntor_handshake_state_free </td>
          <td>(</td>
          <td class="paramtype">ntor_handshake_state_t *&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Free storage held in an ntor handshake state. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="onion__ntor_8c_a8fa2c57ed9d4853f66bba046754f7787_cgraph.png" border="0" usemap="#onion__ntor_8c_a8fa2c57ed9d4853f66bba046754f7787_cgraph" alt=""/></div>
<map name="onion__ntor_8c_a8fa2c57ed9d4853f66bba046754f7787_cgraph" id="onion__ntor_8c_a8fa2c57ed9d4853f66bba046754f7787_cgraph">
<area shape="rect" id="node2" href="crypto_8c.html#a955f8d276e5213dd68600bf6dee0b9ae" title="memwipe" alt="" coords="232,5,311,32"/>
</map>
</div>

</div>
</div>
<a id="a0eea51867a86daa1db5ac0eefee42eb0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0eea51867a86daa1db5ac0eefee42eb0">&#9670;&nbsp;</a></span>onion_skin_ntor_client_handshake()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int onion_skin_ntor_client_handshake </td>
          <td>(</td>
          <td class="paramtype">const ntor_handshake_state_t *&#160;</td>
          <td class="paramname"><em>handshake_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>handshake_reply</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>key_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>key_out_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>msg_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Perform the final client side of the ntor handshake, using the state in <b>handshake_state</b> and the server's NTOR_REPLY_LEN-byte reply in <b>handshake_reply</b>. Generate <b>key_out_len</b> bytes of key material in <b>key_out</b>. Return 0 on success, -1 on failure. </p>

</div>
</div>
<a id="ad5033e0e224249ea4c42b37ddd4937dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5033e0e224249ea4c42b37ddd4937dd">&#9670;&nbsp;</a></span>onion_skin_ntor_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int onion_skin_ntor_create </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>router_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structcurve25519__public__key__t.html">curve25519_public_key_t</a> *&#160;</td>
          <td class="paramname"><em>router_key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ntor_handshake_state_t **&#160;</td>
          <td class="paramname"><em>handshake_state_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>onion_skin_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute the first client-side step of the ntor handshake for communicating with a server whose DIGEST_LEN-byte server identity is <b>router_id</b>, and whose onion key is <b>router_key</b>. Store the NTOR_ONIONSKIN_LEN-byte message in <b>onion_skin_out</b>, and store the handshake state in *<b>handshake_state_out</b>. Return 0 on success, -1 on failure. </p>

</div>
</div>
<a id="a5251c28f884c978124716ebd807e3e56"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5251c28f884c978124716ebd807e3e56">&#9670;&nbsp;</a></span>onion_skin_ntor_server_handshake()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int onion_skin_ntor_server_handshake </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>onion_skin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdi__digest256__map__t.html">di_digest256_map_t</a> *&#160;</td>
          <td class="paramname"><em>private_keys</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structcurve25519__keypair__t.html">curve25519_keypair_t</a> *&#160;</td>
          <td class="paramname"><em>junk_keys</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>my_node_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>handshake_reply_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>key_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>key_out_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Perform the server side of an ntor handshake. Given an NTOR_ONIONSKIN_LEN-byte message in <b>onion_skin</b>, our own identity fingerprint as <b>my_node_id</b>, and an associative array mapping public onion keys to <a class="el" href="structcurve25519__keypair__t.html">curve25519_keypair_t</a> in <b>private_keys</b>, attempt to perform the handshake. Use <b>junk_keys</b> if present if the handshake indicates an unrecognized public key. Write an NTOR_REPLY_LEN-byte message to send back to the client into <b>handshake_reply_out</b>, and generate <b>key_out_len</b> bytes of key material in <b>key_out</b>. Return 0 on success, -1 on failure. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
