<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tor: /home/user/_my/code/bwauth-related/tor/src/or/dirserv.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tor
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97b64286d42c5ef1697cb5f17129db19.html">tor</a></li><li class="navelem"><a class="el" href="dir_3cb0ba3f4b82dbe34a1a06276e96bc8d.html">src</a></li><li class="navelem"><a class="el" href="dir_386635fabd7f6c74e9d9c7a8604514a0.html">or</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">dirserv.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Directory server core implementation. Manages directory contents and generates directories.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="or_8h_source.html">or.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="buffers_8h_source.html">buffers.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="config_8h_source.html">config.h</a>&quot;</code><br />
<code>#include &quot;confparse.h&quot;</code><br />
<code>#include &quot;<a class="el" href="channel_8h_source.html">channel.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="channeltls_8h_source.html">channeltls.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="command_8h_source.html">command.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="connection_8h_source.html">connection.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="connection__or_8h_source.html">connection_or.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="control_8h_source.html">control.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="directory_8h_source.html">directory.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="dirserv_8h_source.html">dirserv.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="dirvote_8h_source.html">dirvote.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hibernate_8h_source.html">hibernate.h</a>&quot;</code><br />
<code>#include &quot;keypin.h&quot;</code><br />
<code>#include &quot;<a class="el" href="main_8h_source.html">main.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="microdesc_8h_source.html">microdesc.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="networkstatus_8h_source.html">networkstatus.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="nodelist_8h_source.html">nodelist.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="policies_8h_source.html">policies.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="protover_8h_source.html">protover.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rephist_8h_source.html">rephist.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="router_8h_source.html">router.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="routerlist_8h_source.html">routerlist.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="routerparse_8h_source.html">routerparse.h</a>&quot;</code><br />
<code>#include &quot;routerset.h&quot;</code><br />
<code>#include &quot;torcert.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for dirserv.c:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2dirserv_8c" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2dirserv_8c" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2dirserv_8c">
<area shape="rect" id="node2" href="or_8h.html" title="Master header file for Tor&#45;specific functionality. " alt="" coords="773,333,817,360"/>
<area shape="rect" id="node24" href="buffers_8h.html" title="Header file for buffers.c. " alt="" coords="1451,184,1525,211"/>
<area shape="rect" id="node25" href="config_8h.html" title="Header file for config.c. " alt="" coords="1549,184,1617,211"/>
<area shape="rect" id="node26" href="confparse_8h_source.html" title="confparse.h" alt="" coords="2057,109,2148,136"/>
<area shape="rect" id="node27" href="channel_8h.html" title="Header file for channel.c. " alt="" coords="1151,184,1230,211"/>
<area shape="rect" id="node29" href="channeltls_8h.html" title="Header file for channeltls.c. " alt="" coords="1087,109,1179,136"/>
<area shape="rect" id="node30" href="command_8h.html" title="Header file for command.c. " alt="" coords="1204,109,1295,136"/>
<area shape="rect" id="node31" href="connection_8h.html" title="Header file for connection.c. " alt="" coords="1420,109,1516,136"/>
<area shape="rect" id="node32" href="connection__or_8h.html" title="Header file for connection_or.c. " alt="" coords="2172,109,2287,136"/>
<area shape="rect" id="node33" href="control_8h.html" title="Header file for control.c. " alt="" coords="2311,109,2383,136"/>
<area shape="rect" id="node34" href="directory_8h.html" title="Header file for directory.c. " alt="" coords="2407,109,2489,136"/>
<area shape="rect" id="node35" href="dirserv_8h.html" title="Header file for dirserv.c. " alt="" coords="1604,259,1676,285"/>
<area shape="rect" id="node36" href="dirvote_8h.html" title="Header file for dirvote.c. " alt="" coords="1655,333,1727,360"/>
<area shape="rect" id="node37" href="hibernate_8h.html" title="Header file for hibernate.c. " alt="" coords="1743,184,1830,211"/>
<area shape="rect" id="node38" href="keypin_8h_source.html" title="keypin.h" alt="" coords="1803,259,1874,285"/>
<area shape="rect" id="node39" href="main_8h.html" title="Header file for main.c. " alt="" coords="2513,109,2575,136"/>
<area shape="rect" id="node40" href="microdesc_8h.html" title="Header file for microdesc.c. " alt="" coords="2599,109,2692,136"/>
<area shape="rect" id="node41" href="networkstatus_8h.html" title="Header file for networkstatus.c. " alt="" coords="1852,333,1967,360"/>
<area shape="rect" id="node42" href="nodelist_8h.html" title="Header file for nodelist.c. " alt="" coords="2717,109,2795,136"/>
<area shape="rect" id="node43" href="policies_8h.html" title="Header file for policies.c. " alt="" coords="2820,109,2897,136"/>
<area shape="rect" id="node44" href="protover_8h.html" title="Headers and type declarations for protover.c. " alt="" coords="329,333,409,360"/>
<area shape="rect" id="node45" href="rephist_8h.html" title="Header file for rephist.c. " alt="" coords="2921,109,2993,136"/>
<area shape="rect" id="node46" href="router_8h.html" title="Header file for router.c. " alt="" coords="1949,483,2016,509"/>
<area shape="rect" id="node47" href="routerlist_8h.html" title="Header file for routerlist.c. " alt="" coords="2012,184,2095,211"/>
<area shape="rect" id="node48" href="routerparse_8h.html" title="Header file for routerparse.c. " alt="" coords="3017,109,3116,136"/>
<area shape="rect" id="node49" href="routerset_8h_source.html" title="routerset.h" alt="" coords="3141,109,3225,136"/>
<area shape="rect" id="node50" href="torcert_8h_source.html" title="torcert.h" alt="" coords="1333,259,1403,285"/>
<area shape="rect" id="node3" href="orconfig_8h_source.html" title="orconfig.h" alt="" coords="378,781,457,808"/>
<area shape="rect" id="node4" href="torint_8h.html" title="Header file to define uint32_t and friends. " alt="" coords="479,707,542,733"/>
<area shape="rect" id="node5" href="crypto_8h.html" title="Headers for crypto.c. " alt="" coords="617,557,687,584"/>
<area shape="rect" id="node9" href="crypto__format_8h_source.html" title="crypto_format.h" alt="" coords="909,483,1022,509"/>
<area shape="rect" id="node10" href="crypto__ed25519_8h_source.html" title="crypto_ed25519.h" alt="" coords="903,557,1028,584"/>
<area shape="rect" id="node11" href="crypto__curve25519_8h_source.html" title="crypto_curve25519.h" alt="" coords="913,632,1055,659"/>
<area shape="rect" id="node12" href="tortls_8h.html" title="Headers for tortls.c. " alt="" coords="618,483,681,509"/>
<area shape="rect" id="node14" href="torlog_8h.html" title="Headers for log.c. " alt="" coords="762,557,827,584"/>
<area shape="rect" id="node15" href="container_8h_source.html" title="container.h" alt="" coords="53,483,139,509"/>
<area shape="rect" id="node17" href="torgzip_8h.html" title="Headers for torgzip.h. " alt="" coords="144,408,216,435"/>
<area shape="rect" id="node18" href="address_8h.html" title="Headers for address.h. " alt="" coords="551,408,630,435"/>
<area shape="rect" id="node19" href="compat__libevent_8h_source.html" title="compat_libevent.h" alt="" coords="1249,632,1377,659"/>
<area shape="rect" id="node20" href="ht_8h_source.html" title="ht.h" alt="" coords="241,408,285,435"/>
<area shape="rect" id="node21" href="replaycache_8h.html" title="Header file for replaycache.c. " alt="" coords="309,408,411,435"/>
<area shape="rect" id="node22" href="tor__queue_8h_source.html" title="tor_queue.h" alt="" coords="436,408,527,435"/>
<area shape="rect" id="node23" href="util__format_8h_source.html" title="util_format.h" alt="" coords="1079,632,1174,659"/>
<area shape="rect" id="node7" href="testsupport_8h_source.html" title="testsupport.h" alt="" coords="1391,707,1489,733"/>
<area shape="rect" id="node8" href="compat_8h_source.html" title="compat.h" alt="" coords="355,632,431,659"/>
<area shape="rect" id="node13" href="compat__openssl_8h.html" title="compatability definitions for working with different openssl forks " alt="" coords="415,557,543,584"/>
<area shape="rect" id="node16" href="util_8h.html" title="Headers for util.c. " alt="" coords="89,557,140,584"/>
<area shape="rect" id="node28" href="circuitmux_8h.html" title="Header file for circuitmux.c. " alt="" coords="1144,259,1237,285"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structauthdir__config__t.html">authdir_config_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmbw__cache__entry__s.html">mbw_cache_entry_s</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a633a34e566ccd86e4113aa6c7fbafd87"><td class="memItemLeft" align="right" valign="top"><a id="a633a34e566ccd86e4113aa6c7fbafd87"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DIRSERV_PRIVATE</b></td></tr>
<tr class="separator:a633a34e566ccd86e4113aa6c7fbafd87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40089a6368f815d5b0ce4c64d76c58bc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a40089a6368f815d5b0ce4c64d76c58bc">ROUTER_ALLOW_SKEW</a>&#160;&#160;&#160;(60*60*12)</td></tr>
<tr class="separator:a40089a6368f815d5b0ce4c64d76c58bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0049d4f5771d128bbb2e4ea1bc3e53b5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a0049d4f5771d128bbb2e4ea1bc3e53b5">DIR_REGEN_SLACK_TIME</a>&#160;&#160;&#160;30</td></tr>
<tr class="separator:a0049d4f5771d128bbb2e4ea1bc3e53b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73d9a28f2e359da879b69f1546452976"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a73d9a28f2e359da879b69f1546452976">MAX_UNTRUSTED_NETWORKSTATUSES</a>&#160;&#160;&#160;16</td></tr>
<tr class="separator:a73d9a28f2e359da879b69f1546452976"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bdfff30b1fad38f7dfd57a4cd4ab910"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a0bdfff30b1fad38f7dfd57a4cd4ab910">FP_INVALID</a>&#160;&#160;&#160;2</td></tr>
<tr class="separator:a0bdfff30b1fad38f7dfd57a4cd4ab910"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a52b99a8fad83305821fbf819a6013e57"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a52b99a8fad83305821fbf819a6013e57">FP_REJECT</a>&#160;&#160;&#160;4</td></tr>
<tr class="separator:a52b99a8fad83305821fbf819a6013e57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa47bc657ff956237080e3ee719b74e33"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#aa47bc657ff956237080e3ee719b74e33">FP_BADEXIT</a>&#160;&#160;&#160;16</td></tr>
<tr class="separator:aa47bc657ff956237080e3ee719b74e33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4566d1ea951e762c1e98dfe3764566e5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a4566d1ea951e762c1e98dfe3764566e5">REACHABLE_TIMEOUT</a>&#160;&#160;&#160;(45*60)</td></tr>
<tr class="separator:a4566d1ea951e762c1e98dfe3764566e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2440f69777d698378cb67a281ae84331"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a2440f69777d698378cb67a281ae84331">HIBERNATION_PUBLICATION_SKEW</a>&#160;&#160;&#160;(60*60)</td></tr>
<tr class="separator:a2440f69777d698378cb67a281ae84331"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9eee11219a10c2afee5e95f22edd87b9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a9eee11219a10c2afee5e95f22edd87b9">UPTIME_TO_GUARANTEE_STABLE</a>&#160;&#160;&#160;(3600*24*30)</td></tr>
<tr class="separator:a9eee11219a10c2afee5e95f22edd87b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0092539ff57247e1c3f9c26898dbbc5d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a0092539ff57247e1c3f9c26898dbbc5d">MTBF_TO_GUARANTEE_STABLE</a>&#160;&#160;&#160;(60*60*24*5)</td></tr>
<tr class="separator:a0092539ff57247e1c3f9c26898dbbc5d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0a9cb92d9dac80001adfb7924e46f0c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#ad0a9cb92d9dac80001adfb7924e46f0c">TIME_KNOWN_TO_GUARANTEE_FAMILIAR</a>&#160;&#160;&#160;(8*24*60*60)</td></tr>
<tr class="separator:ad0a9cb92d9dac80001adfb7924e46f0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a464a8661ce777968b0f4321170c2d004"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a464a8661ce777968b0f4321170c2d004">WFU_TO_GUARANTEE_GUARD</a>&#160;&#160;&#160;(0.98)</td></tr>
<tr class="separator:a464a8661ce777968b0f4321170c2d004"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2da7dce58174ef7faed432bdd8fab07e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a2da7dce58174ef7faed432bdd8fab07e">ABSOLUTE_MIN_BW_VALUE_TO_CONSIDER_KB</a>&#160;&#160;&#160;4</td></tr>
<tr class="separator:a2da7dce58174ef7faed432bdd8fab07e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a33599ffb995c35af21eff29d60f908fa"><td class="memItemLeft" align="right" valign="top"><a id="a33599ffb995c35af21eff29d60f908fa"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ABSOLUTE_MIN_VALUE_FOR_FAST_FLAG</b>&#160;&#160;&#160;4</td></tr>
<tr class="separator:a33599ffb995c35af21eff29d60f908fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a152b69763bab9d6559cfe92b8dae5d4f"><td class="memItemLeft" align="right" valign="top"><a id="a152b69763bab9d6559cfe92b8dae5d4f"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>V_LINE_OVERHEAD</b>&#160;&#160;&#160;7</td></tr>
<tr class="separator:a152b69763bab9d6559cfe92b8dae5d4f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd67fdcfb7d2b922f64e3797804d8e4a"><td class="memItemLeft" align="right" valign="top"><a id="afd67fdcfb7d2b922f64e3797804d8e4a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MAX_GUARDFRACTION_FILE_AGE</b>&#160;&#160;&#160;(7*24*60*60) /* approx a week */</td></tr>
<tr class="separator:afd67fdcfb7d2b922f64e3797804d8e4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f97d6c36771b93695bec92ff4ae5343"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a6f97d6c36771b93695bec92ff4ae5343">GUARDFRACTION_DATE_STR</a>&#160;&#160;&#160;&quot;written-at&quot;</td></tr>
<tr class="separator:a6f97d6c36771b93695bec92ff4ae5343"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63892b4e9293bd5279ce4470915e85cb"><td class="memItemLeft" align="right" valign="top"><a id="a63892b4e9293bd5279ce4470915e85cb"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>GUARDFRACTION_INPUTS</b>&#160;&#160;&#160;&quot;n-inputs&quot;</td></tr>
<tr class="separator:a63892b4e9293bd5279ce4470915e85cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af563ba082bca4eede0e53a6db118bd9b"><td class="memItemLeft" align="right" valign="top"><a id="af563ba082bca4eede0e53a6db118bd9b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>GUARDFRACTION_GUARD</b>&#160;&#160;&#160;&quot;guard-seen&quot;</td></tr>
<tr class="separator:af563ba082bca4eede0e53a6db118bd9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77a4c1df6d794c6d78b978af68ad63b0"><td class="memItemLeft" align="right" valign="top"><a id="a77a4c1df6d794c6d78b978af68ad63b0"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>GUARDFRACTION_VERSION</b>&#160;&#160;&#160;&quot;guardfraction-file-version&quot;</td></tr>
<tr class="separator:a77a4c1df6d794c6d78b978af68ad63b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76a9b40d2d3c37bc65ef15ad99340967"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a76a9b40d2d3c37bc65ef15ad99340967">DIRSERV_BUFFER_MIN</a>&#160;&#160;&#160;16384</td></tr>
<tr class="separator:a76a9b40d2d3c37bc65ef15ad99340967"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3de6e51827faaa866d31446b7ee8e9d6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>WORD</b>()</td></tr>
<tr class="separator:a3de6e51827faaa866d31446b7ee8e9d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a453c515453aa252487e73ed3d50d05af"><td class="memItemLeft" align="right" valign="top">typedef uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a453c515453aa252487e73ed3d50d05af">router_status_t</a></td></tr>
<tr class="separator:a453c515453aa252487e73ed3d50d05af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5b531996be2e42c0b3b2a7658adb722"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structauthdir__config__t.html">authdir_config_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#ae5b531996be2e42c0b3b2a7658adb722">authdir_config_t</a></td></tr>
<tr class="separator:ae5b531996be2e42c0b3b2a7658adb722"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89967d9ad8bead3a3f0711f37947c458"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structmbw__cache__entry__s.html">mbw_cache_entry_s</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a89967d9ad8bead3a3f0711f37947c458">mbw_cache_entry_t</a></td></tr>
<tr class="separator:a89967d9ad8bead3a3f0711f37947c458"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a95deb3d9d5367525bb51127b82269c87"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a95deb3d9d5367525bb51127b82269c87">dirserv_add_own_fingerprint</a> (<a class="el" href="structcrypto__pk__t.html">crypto_pk_t</a> *pk)</td></tr>
<tr class="separator:a95deb3d9d5367525bb51127b82269c87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a258a245ff1505a9ea50b06de2b3e490f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a258a245ff1505a9ea50b06de2b3e490f">dirserv_load_fingerprint_file</a> (void)</td></tr>
<tr class="separator:a258a245ff1505a9ea50b06de2b3e490f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95906070553304c94a590affb671223e"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a95906070553304c94a590affb671223e">dirserv_router_get_status</a> (const <a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *router, const char **msg, int severity)</td></tr>
<tr class="separator:a95906070553304c94a590affb671223e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abbb851f560879781b07f4b99762f45b3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#abbb851f560879781b07f4b99762f45b3">dirserv_would_reject_router</a> (const <a class="el" href="structrouterstatus__t.html">routerstatus_t</a> *rs)</td></tr>
<tr class="separator:abbb851f560879781b07f4b99762f45b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a952a2a3f8acd42cdebbae8631123cf1c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a952a2a3f8acd42cdebbae8631123cf1c">dirserv_free_fingerprint_list</a> (void)</td></tr>
<tr class="separator:a952a2a3f8acd42cdebbae8631123cf1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adaceacf408562b95dd1169799995bd6c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#adaceacf408562b95dd1169799995bd6c">authdir_wants_to_reject_router</a> (<a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *ri, const char **msg, int complain, int *valid_out)</td></tr>
<tr class="separator:adaceacf408562b95dd1169799995bd6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f2508c28e6b8a1d7b9ae921598a9860"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a5f2508c28e6b8a1d7b9ae921598a9860">dirserv_set_node_flags_from_authoritative_status</a> (<a class="el" href="structnode__t.html">node_t</a> *node, uint32_t authstatus)</td></tr>
<tr class="separator:a5f2508c28e6b8a1d7b9ae921598a9860"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6e1baef9d8542712a4018d365fa2215"><td class="memItemLeft" align="right" valign="top"><a class="el" href="or_8h.html#a7c96814e647f1b5b99e501ea5763842f">was_router_added_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#af6e1baef9d8542712a4018d365fa2215">dirserv_add_multiple_descriptors</a> (const char *desc, uint8_t purpose, const char *source, const char **msg)</td></tr>
<tr class="separator:af6e1baef9d8542712a4018d365fa2215"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5af480ce6b85c4740885e8a4965c5272"><td class="memItemLeft" align="right" valign="top"><a class="el" href="or_8h.html#a7c96814e647f1b5b99e501ea5763842f">was_router_added_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a5af480ce6b85c4740885e8a4965c5272">dirserv_add_descriptor</a> (<a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *ri, const char **msg, const char *source)</td></tr>
<tr class="separator:a5af480ce6b85c4740885e8a4965c5272"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1772dc2a4a12cc0eb181d1f52c5a54a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#ad1772dc2a4a12cc0eb181d1f52c5a54a">dirserv_set_router_is_running</a> (<a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *router, time_t now)</td></tr>
<tr class="separator:ad1772dc2a4a12cc0eb181d1f52c5a54a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c7009f040e0a812c40a6ae0fa6efd79"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a6c7009f040e0a812c40a6ae0fa6efd79">list_server_status_v1</a> (<a class="el" href="structsmartlist__t.html">smartlist_t</a> *routers, char **router_status_out, int for_controller)</td></tr>
<tr class="separator:a6c7009f040e0a812c40a6ae0fa6efd79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b84786e17352524036694baf1955167"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a0b84786e17352524036694baf1955167">directory_fetches_from_authorities</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:a0b84786e17352524036694baf1955167"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab38d643312052d4bfdb7d49dcba344a6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#ab38d643312052d4bfdb7d49dcba344a6">directory_fetches_dir_info_early</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:ab38d643312052d4bfdb7d49dcba344a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6172633152c7a88c49556085a2538f6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#ab6172633152c7a88c49556085a2538f6">directory_fetches_dir_info_later</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:ab6172633152c7a88c49556085a2538f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a9cf7f465217dbc8142aaf11384abbf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a5a9cf7f465217dbc8142aaf11384abbf">directory_caches_unknown_auth_certs</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:a5a9cf7f465217dbc8142aaf11384abbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57e2ff1ad2ea65abe9b969ad3d76a418"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a57e2ff1ad2ea65abe9b969ad3d76a418">directory_caches_dir_info</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:a57e2ff1ad2ea65abe9b969ad3d76a418"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7923860b3a8c27fa48c4dcec6ef6939f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a7923860b3a8c27fa48c4dcec6ef6939f">directory_permits_begindir_requests</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:a7923860b3a8c27fa48c4dcec6ef6939f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c5edbbd6883a33af3d72bfead4033db"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a2c5edbbd6883a33af3d72bfead4033db">directory_too_idle_to_fetch_descriptors</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options, time_t now)</td></tr>
<tr class="separator:a2c5edbbd6883a33af3d72bfead4033db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a079db5d58a49010fe8b2944ecb3189bd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a079db5d58a49010fe8b2944ecb3189bd">cached_dir_decref</a> (<a class="el" href="structcached__dir__t.html">cached_dir_t</a> *d)</td></tr>
<tr class="separator:a079db5d58a49010fe8b2944ecb3189bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f9b702470f577e3b47d852f664e7d2b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structcached__dir__t.html">cached_dir_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a1f9b702470f577e3b47d852f664e7d2b">new_cached_dir</a> (char *s, time_t published)</td></tr>
<tr class="separator:a1f9b702470f577e3b47d852f664e7d2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af60d63ae445884beb62813d3fd046c31"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#af60d63ae445884beb62813d3fd046c31">dirserv_set_cached_consensus_networkstatus</a> (const char *networkstatus, const char *flavor_name, const <a class="el" href="structcommon__digests__t.html">common_digests_t</a> *digests, time_t published)</td></tr>
<tr class="separator:af60d63ae445884beb62813d3fd046c31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f07c36cfc3121034f466d7cb6d27630"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structcached__dir__t.html">cached_dir_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a0f07c36cfc3121034f466d7cb6d27630">dirserv_get_consensus</a> (const char *flavor_name)</td></tr>
<tr class="separator:a0f07c36cfc3121034f466d7cb6d27630"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78aaa46964aad7d9769b54157d9814e1"><td class="memItemLeft" align="right" valign="top"><a id="a78aaa46964aad7d9769b54157d9814e1"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>dirserv_compute_bridge_flag_thresholds</b> (void)</td></tr>
<tr class="separator:a78aaa46964aad7d9769b54157d9814e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac19029821b6c2868fd554e3b38e1ab59"><td class="memItemLeft" align="right" valign="top">STATIC void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#ac19029821b6c2868fd554e3b38e1ab59">dirserv_cache_measured_bw</a> (const measured_bw_line_t *parsed_line, time_t as_of)</td></tr>
<tr class="separator:ac19029821b6c2868fd554e3b38e1ab59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affc919a1a21f4d10e5844a19531140d1"><td class="memItemLeft" align="right" valign="top">STATIC void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#affc919a1a21f4d10e5844a19531140d1">dirserv_clear_measured_bw_cache</a> (void)</td></tr>
<tr class="separator:affc919a1a21f4d10e5844a19531140d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab797c233e08456a060af12f1f85bbe88"><td class="memItemLeft" align="right" valign="top">STATIC void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#ab797c233e08456a060af12f1f85bbe88">dirserv_expire_measured_bw_cache</a> (time_t now)</td></tr>
<tr class="separator:ab797c233e08456a060af12f1f85bbe88"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05e0b9d58ea3e9d0bf6d68a3aa6d7a06"><td class="memItemLeft" align="right" valign="top">STATIC int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a05e0b9d58ea3e9d0bf6d68a3aa6d7a06">dirserv_get_measured_bw_cache_size</a> (void)</td></tr>
<tr class="separator:a05e0b9d58ea3e9d0bf6d68a3aa6d7a06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a93860d395d1c2d9d50a360d013f365"><td class="memItemLeft" align="right" valign="top">STATIC int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a4a93860d395d1c2d9d50a360d013f365">dirserv_query_measured_bw_cache_kb</a> (const char *node_id, long *bw_kb_out, time_t *as_of_out)</td></tr>
<tr class="separator:a4a93860d395d1c2d9d50a360d013f365"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21b4084acb1e20906fe38d1a0a905986"><td class="memItemLeft" align="right" valign="top">STATIC int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a21b4084acb1e20906fe38d1a0a905986">dirserv_has_measured_bw</a> (const char *node_id)</td></tr>
<tr class="separator:a21b4084acb1e20906fe38d1a0a905986"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5be126c4926e7257fa5fbe5463ff4a6a"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a5be126c4926e7257fa5fbe5463ff4a6a">dirserv_get_flag_thresholds_line</a> (void)</td></tr>
<tr class="separator:a5be126c4926e7257fa5fbe5463ff4a6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afeb9db63e957f2889d2c0b8bc3311107"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#afeb9db63e957f2889d2c0b8bc3311107">routerstatus_format_entry</a> (const <a class="el" href="structrouterstatus__t.html">routerstatus_t</a> *rs, const char *version, const char *protocols, <a class="el" href="or_8h.html#a46368555a0446803c7acfd3b8230adef">routerstatus_format_type_t</a> format, const <a class="el" href="structvote__routerstatus__t.html">vote_routerstatus_t</a> *vrs)</td></tr>
<tr class="separator:afeb9db63e957f2889d2c0b8bc3311107"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a441a08d3eefcfb08ff0c8ee680183490"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a441a08d3eefcfb08ff0c8ee680183490">set_routerstatus_from_routerinfo</a> (<a class="el" href="structrouterstatus__t.html">routerstatus_t</a> *rs, <a class="el" href="structnode__t.html">node_t</a> *node, <a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *ri, time_t now, int listbadexits)</td></tr>
<tr class="separator:a441a08d3eefcfb08ff0c8ee680183490"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1808f4f273d59d32f2e29b968165e251"><td class="memItemLeft" align="right" valign="top">STATIC void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a1808f4f273d59d32f2e29b968165e251">dirserv_set_routerstatus_testing</a> (<a class="el" href="structrouterstatus__t.html">routerstatus_t</a> *rs)</td></tr>
<tr class="separator:a1808f4f273d59d32f2e29b968165e251"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a321d38c3a8578f36a42cef18c507bc90"><td class="memItemLeft" align="right" valign="top">STATIC int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a321d38c3a8578f36a42cef18c507bc90">dirserv_read_guardfraction_file_from_str</a> (const char *guardfraction_file_str, <a class="el" href="structsmartlist__t.html">smartlist_t</a> *vote_routerstatuses)</td></tr>
<tr class="separator:a321d38c3a8578f36a42cef18c507bc90"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50e06fc916d8cbcc3ccfb7f919cb6928"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a50e06fc916d8cbcc3ccfb7f919cb6928">dirserv_read_guardfraction_file</a> (const char *fname, <a class="el" href="structsmartlist__t.html">smartlist_t</a> *vote_routerstatuses)</td></tr>
<tr class="separator:a50e06fc916d8cbcc3ccfb7f919cb6928"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4da6ee0ad98076b51a6009d1b4ea0833"><td class="memItemLeft" align="right" valign="top">STATIC int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a4da6ee0ad98076b51a6009d1b4ea0833">measured_bw_line_parse</a> (measured_bw_line_t *out, const char *orig_line)</td></tr>
<tr class="separator:a4da6ee0ad98076b51a6009d1b4ea0833"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9afa21451734581b626a94cb615375af"><td class="memItemLeft" align="right" valign="top">STATIC int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a9afa21451734581b626a94cb615375af">measured_bw_line_apply</a> (measured_bw_line_t *parsed_line, <a class="el" href="structsmartlist__t.html">smartlist_t</a> *routerstatuses)</td></tr>
<tr class="separator:a9afa21451734581b626a94cb615375af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af364b236821a07880cc8dc54e98ca999"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#af364b236821a07880cc8dc54e98ca999">dirserv_read_measured_bandwidths</a> (const char *from_file, <a class="el" href="structsmartlist__t.html">smartlist_t</a> *routerstatuses)</td></tr>
<tr class="separator:af364b236821a07880cc8dc54e98ca999"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae288382ee634aeb5099f263fa9af8c25"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structnetworkstatus__t.html">networkstatus_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#ae288382ee634aeb5099f263fa9af8c25">dirserv_generate_networkstatus_vote_obj</a> (<a class="el" href="structcrypto__pk__t.html">crypto_pk_t</a> *private_key, <a class="el" href="structauthority__cert__t.html">authority_cert_t</a> *cert)</td></tr>
<tr class="separator:ae288382ee634aeb5099f263fa9af8c25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a285fc71bfe2b99bc2b09b949d95ac1b9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a285fc71bfe2b99bc2b09b949d95ac1b9">dirserv_get_routerdesc_fingerprints</a> (<a class="el" href="structsmartlist__t.html">smartlist_t</a> *fps_out, const char *key, const char **msg, int for_unencrypted_conn, int is_extrainfo)</td></tr>
<tr class="separator:a285fc71bfe2b99bc2b09b949d95ac1b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8fca5a38cd000d8ccabe5bc73e296bb2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a8fca5a38cd000d8ccabe5bc73e296bb2">dirserv_get_routerdescs</a> (<a class="el" href="structsmartlist__t.html">smartlist_t</a> *descs_out, const char *key, const char **msg)</td></tr>
<tr class="separator:a8fca5a38cd000d8ccabe5bc73e296bb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8dd4c13ef93596eaa704393dbc6828e0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a8dd4c13ef93596eaa704393dbc6828e0">dirserv_orconn_tls_done</a> (const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *addr, uint16_t or_port, const char *digest_rcvd)</td></tr>
<tr class="separator:a8dd4c13ef93596eaa704393dbc6828e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c97fbc43a4398a45feb2fafa3d42fc1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a0c97fbc43a4398a45feb2fafa3d42fc1">dirserv_should_launch_reachability_test</a> (const <a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *ri, const <a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *ri_old)</td></tr>
<tr class="separator:a0c97fbc43a4398a45feb2fafa3d42fc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87235a887afe2a5f796bd9a88b474909"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a87235a887afe2a5f796bd9a88b474909">dirserv_single_reachability_test</a> (time_t now, <a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *router)</td></tr>
<tr class="separator:a87235a887afe2a5f796bd9a88b474909"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac91a65fca7d877c033a594a96203ad7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#aac91a65fca7d877c033a594a96203ad7">dirserv_test_reachability</a> (time_t now)</td></tr>
<tr class="separator:aac91a65fca7d877c033a594a96203ad7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af00dc463b7670924195592f7922afdfc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#af00dc463b7670924195592f7922afdfc">dirserv_remove_old_statuses</a> (<a class="el" href="structsmartlist__t.html">smartlist_t</a> *fps, time_t cutoff)</td></tr>
<tr class="separator:af00dc463b7670924195592f7922afdfc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c84a4724e9a8934918c2c8dcc927f0c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a7c84a4724e9a8934918c2c8dcc927f0c">dirserv_have_any_serverdesc</a> (<a class="el" href="structsmartlist__t.html">smartlist_t</a> *fps, int spool_src)</td></tr>
<tr class="separator:a7c84a4724e9a8934918c2c8dcc927f0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89dcb27b45f04c12e789dee837b90fdc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a89dcb27b45f04c12e789dee837b90fdc">dirserv_have_any_microdesc</a> (const <a class="el" href="structsmartlist__t.html">smartlist_t</a> *fps)</td></tr>
<tr class="separator:a89dcb27b45f04c12e789dee837b90fdc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8563ff795e78b4677acaec59712726bb"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a8563ff795e78b4677acaec59712726bb">dirserv_estimate_data_size</a> (<a class="el" href="structsmartlist__t.html">smartlist_t</a> *fps, int is_serverdescs, int compressed)</td></tr>
<tr class="separator:a8563ff795e78b4677acaec59712726bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48cee7ff92f2da41f67b8f2a332ffa5a"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#a48cee7ff92f2da41f67b8f2a332ffa5a">dirserv_estimate_microdesc_size</a> (const <a class="el" href="structsmartlist__t.html">smartlist_t</a> *fps, int compressed)</td></tr>
<tr class="separator:a48cee7ff92f2da41f67b8f2a332ffa5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb9b2ed7234ed40438a3a5406c823c36"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#acb9b2ed7234ed40438a3a5406c823c36">connection_dirserv_flushed_some</a> (<a class="el" href="structdir__connection__t.html">dir_connection_t</a> *conn)</td></tr>
<tr class="separator:acb9b2ed7234ed40438a3a5406c823c36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4f82bd716ec94f012312bf508728269"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#ae4f82bd716ec94f012312bf508728269">validate_recommended_package_line</a> (const char *line)</td></tr>
<tr class="separator:ae4f82bd716ec94f012312bf508728269"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa86c752d8d8f446eba40db2d0c2269a7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dirserv_8c.html#aa86c752d8d8f446eba40db2d0c2269a7">dirserv_free_all</a> (void)</td></tr>
<tr class="separator:aa86c752d8d8f446eba40db2d0c2269a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Directory server core implementation. Manages directory contents and generates directories. </p>
<p>This module implements most of directory cache functionality, and some of the directory authority functionality. The <a class="el" href="directory_8c.html" title="Code to send and fetch directories and router descriptors via HTTP. Directories use dirserv...">directory.c</a> module delegates here in order to handle incoming requests from clients, via <a class="el" href="dirserv_8c.html#acb9b2ed7234ed40438a3a5406c823c36">connection_dirserv_flushed_some()</a> and its kin. In order to save RAM, this module is reponsible for spooling directory objects (in whole or in part) onto buf_t instances, and then closing the <a class="el" href="structdir__connection__t.html">dir_connection_t</a> once the objects are totally flushed.</p>
<p>The <a class="el" href="directory_8c.html" title="Code to send and fetch directories and router descriptors via HTTP. Directories use dirserv...">directory.c</a> module also delegates here for handling descriptor uploads via <a class="el" href="dirserv_8c.html#af6e1baef9d8542712a4018d365fa2215">dirserv_add_multiple_descriptors()</a>.</p>
<p>Additionally, this module handles some aspects of voting, including: deciding how to vote on individual flags (based on decisions reached in <a class="el" href="rephist_8c.html" title="Basic history and performance-tracking functionality. ">rephist.c</a>), of formatting routerstatus lines, and deciding what relays to include in an authority's vote. (TODO: Those functions could profitably be split off. They only live in this file because historically they were shared among the v1, v2, and v3 directory code.) </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a2da7dce58174ef7faed432bdd8fab07e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2da7dce58174ef7faed432bdd8fab07e">&#9670;&nbsp;</a></span>ABSOLUTE_MIN_BW_VALUE_TO_CONSIDER_KB</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ABSOLUTE_MIN_BW_VALUE_TO_CONSIDER_KB&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Don't consider routers with less bandwidth than this when computing thresholds. </p>

</div>
</div>
<a id="a0049d4f5771d128bbb2e4ea1bc3e53b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0049d4f5771d128bbb2e4ea1bc3e53b5">&#9670;&nbsp;</a></span>DIR_REGEN_SLACK_TIME</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DIR_REGEN_SLACK_TIME&#160;&#160;&#160;30</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>How many seconds do we wait before regenerating the directory? </p>

</div>
</div>
<a id="a76a9b40d2d3c37bc65ef15ad99340967"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a76a9b40d2d3c37bc65ef15ad99340967">&#9670;&nbsp;</a></span>DIRSERV_BUFFER_MIN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DIRSERV_BUFFER_MIN&#160;&#160;&#160;16384</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>When we're spooling data onto our outbuf, add more whenever we dip below this threshold. </p>

</div>
</div>
<a id="aa47bc657ff956237080e3ee719b74e33"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa47bc657ff956237080e3ee719b74e33">&#9670;&nbsp;</a></span>FP_BADEXIT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FP_BADEXIT&#160;&#160;&#160;16</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>We'll tell clients not to use this as an exit. </p>

</div>
</div>
<a id="a0bdfff30b1fad38f7dfd57a4cd4ab910"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0bdfff30b1fad38f7dfd57a4cd4ab910">&#9670;&nbsp;</a></span>FP_INVALID</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FP_INVALID&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Believed invalid. </p>

</div>
</div>
<a id="a52b99a8fad83305821fbf819a6013e57"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a52b99a8fad83305821fbf819a6013e57">&#9670;&nbsp;</a></span>FP_REJECT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FP_REJECT&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>We will not publish this router. </p>

</div>
</div>
<a id="a6f97d6c36771b93695bec92ff4ae5343"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f97d6c36771b93695bec92ff4ae5343">&#9670;&nbsp;</a></span>GUARDFRACTION_DATE_STR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define GUARDFRACTION_DATE_STR&#160;&#160;&#160;&quot;written-at&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Static strings of guardfraction files. </p>

</div>
</div>
<a id="a2440f69777d698378cb67a281ae84331"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2440f69777d698378cb67a281ae84331">&#9670;&nbsp;</a></span>HIBERNATION_PUBLICATION_SKEW</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HIBERNATION_PUBLICATION_SKEW&#160;&#160;&#160;(60*60)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If we tested a router and found it reachable <em>at least this long</em> after it declared itself hibernating, it is probably done hibernating and we just missed a descriptor from it. </p>

</div>
</div>
<a id="a73d9a28f2e359da879b69f1546452976"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73d9a28f2e359da879b69f1546452976">&#9670;&nbsp;</a></span>MAX_UNTRUSTED_NETWORKSTATUSES</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_UNTRUSTED_NETWORKSTATUSES&#160;&#160;&#160;16</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If we're a cache, keep this many networkstatuses around from non-trusted directory authorities. </p>

</div>
</div>
<a id="a0092539ff57247e1c3f9c26898dbbc5d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0092539ff57247e1c3f9c26898dbbc5d">&#9670;&nbsp;</a></span>MTBF_TO_GUARANTEE_STABLE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MTBF_TO_GUARANTEE_STABLE&#160;&#160;&#160;(60*60*24*5)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If a router's MTBF is at least this value, then it is always stable. See above. (Corresponds to about 7 days for current decay rates.) </p>

</div>
</div>
<a id="a4566d1ea951e762c1e98dfe3764566e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4566d1ea951e762c1e98dfe3764566e5">&#9670;&nbsp;</a></span>REACHABLE_TIMEOUT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define REACHABLE_TIMEOUT&#160;&#160;&#160;(45*60)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Each server needs to have passed a reachability test no more than this number of seconds ago, or it is listed as down in the directory. </p>

</div>
</div>
<a id="a40089a6368f815d5b0ce4c64d76c58bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40089a6368f815d5b0ce4c64d76c58bc">&#9670;&nbsp;</a></span>ROUTER_ALLOW_SKEW</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ROUTER_ALLOW_SKEW&#160;&#160;&#160;(60*60*12)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>How far in the future do we allow a router to get? (seconds) </p>

</div>
</div>
<a id="ad0a9cb92d9dac80001adfb7924e46f0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad0a9cb92d9dac80001adfb7924e46f0c">&#9670;&nbsp;</a></span>TIME_KNOWN_TO_GUARANTEE_FAMILIAR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TIME_KNOWN_TO_GUARANTEE_FAMILIAR&#160;&#160;&#160;(8*24*60*60)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Similarly, every node with at least this much weighted time known can be considered familiar enough to be a guard. Corresponds to about 20 days for current decay rates. </p>

</div>
</div>
<a id="a9eee11219a10c2afee5e95f22edd87b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9eee11219a10c2afee5e95f22edd87b9">&#9670;&nbsp;</a></span>UPTIME_TO_GUARANTEE_STABLE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define UPTIME_TO_GUARANTEE_STABLE&#160;&#160;&#160;(3600*24*30)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If a router's uptime is at least this value, then it is always considered stable, regardless of the rest of the network. This way we resist attacks where an attacker doubles the size of the network using allegedly high-uptime nodes, displacing all the current guards. </p>

</div>
</div>
<a id="a464a8661ce777968b0f4321170c2d004"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a464a8661ce777968b0f4321170c2d004">&#9670;&nbsp;</a></span>WFU_TO_GUARANTEE_GUARD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WFU_TO_GUARANTEE_GUARD&#160;&#160;&#160;(0.98)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Similarly, every node with sufficient WFU is around enough to be a guard. </p>

</div>
</div>
<a id="a3de6e51827faaa866d31446b7ee8e9d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3de6e51827faaa866d31446b7ee8e9d6">&#9670;&nbsp;</a></span>WORD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WORD</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> {                                          \</div><div class="line">    if (*cp == <span class="charliteral">&#39; &#39;</span>)                             \</div><div class="line">      return 0;                                 \</div><div class="line">    cp = strchr(cp, <span class="charliteral">&#39; &#39;</span>);                       \</div><div class="line">    if (!cp)                                    \</div><div class="line">      return 0;                                 \</div><div class="line">  } <span class="keywordflow">while</span> (0)</div></div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="ae5b531996be2e42c0b3b2a7658adb722"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae5b531996be2e42c0b3b2a7658adb722">&#9670;&nbsp;</a></span>authdir_config_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structauthdir__config__t.html">authdir_config_t</a>  <a class="el" href="structauthdir__config__t.html">authdir_config_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>List of nickname-&gt;identity fingerprint mappings for all the routers that we name. Used to prevent router impersonation. </p>

</div>
</div>
<a id="a89967d9ad8bead3a3f0711f37947c458"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a89967d9ad8bead3a3f0711f37947c458">&#9670;&nbsp;</a></span>mbw_cache_entry_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structmbw__cache__entry__s.html">mbw_cache_entry_s</a>  <a class="el" href="dirserv_8c.html#a89967d9ad8bead3a3f0711f37947c458">mbw_cache_entry_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Measured bandwidth cache entry </p>

</div>
</div>
<a id="a453c515453aa252487e73ed3d50d05af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a453c515453aa252487e73ed3d50d05af">&#9670;&nbsp;</a></span>router_status_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef uint32_t <a class="el" href="dirserv_8c.html#a453c515453aa252487e73ed3d50d05af">router_status_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Target of status_by_digest map. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="adaceacf408562b95dd1169799995bd6c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adaceacf408562b95dd1169799995bd6c">&#9670;&nbsp;</a></span>authdir_wants_to_reject_router()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int authdir_wants_to_reject_router </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>complain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>valid_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Check whether we, as a directory server, want to accept <b>ri</b>. If so, set its is_valid,running fields and return 0. Otherwise, return -1.</p>
<p>If the router is rejected, set *<b>msg</b> to an explanation of why.</p>
<p>If <b>complain</b> then explain at log-level 'notice' why we refused a descriptor; else explain at log-level 'info'. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_adaceacf408562b95dd1169799995bd6c_cgraph.png" border="0" usemap="#dirserv_8c_adaceacf408562b95dd1169799995bd6c_cgraph" alt=""/></div>
<map name="dirserv_8c_adaceacf408562b95dd1169799995bd6c_cgraph" id="dirserv_8c_adaceacf408562b95dd1169799995bd6c_cgraph">
<area shape="rect" id="node2" href="dirserv_8c.html#a95906070553304c94a590affb671223e" title="dirserv_router_get\l_status" alt="" coords="213,49,340,90"/>
<area shape="rect" id="node5" href="router_8c.html#a4d59ce576eb8716561e1bc6be6f88de1" title="router_describe" alt="" coords="221,115,332,141"/>
<area shape="rect" id="node16" href="routerlist_8c.html#afd620fb5cbc29f6895ae016c0240d9a6" title="esc_router_info" alt="" coords="221,165,332,192"/>
<area shape="rect" id="node3" href="crypto_8c.html#a91336077a5062618ff895dae4e50079d" title="crypto_pk_get_digest" alt="" coords="390,56,537,83"/>
<area shape="rect" id="node4" href="crypto_8c.html#adc1609ea0f9d65a1f60225cb001eeb15" title="crypto_digest" alt="" coords="619,56,719,83"/>
<area shape="rect" id="node6" href="router_8c.html#ac97f03d757d76cc0e684e58d4dfea035" title="router_get_description" alt="" coords="388,115,539,141"/>
<area shape="rect" id="node7" href="router_8c.html#ab0380dfe3cb20aa1aa730b929e888aba" title="format_node_description" alt="" coords="587,107,751,133"/>
<area shape="rect" id="node13" href="routerlist_8c.html#a8b764a3362e4c3245d5e430925e380f1" title="router_is_named" alt="" coords="609,165,728,192"/>
<area shape="rect" id="node8" href="util__format_8c.html#a8b8940b2ef607928eb3dca4850567ea5" title="base16_encode" alt="" coords="827,5,940,32"/>
<area shape="rect" id="node9" href="address_8c.html#a2de0e7c83f59d6235f74e76147db6e29" title="tor_addr_to_str" alt="" coords="829,56,938,83"/>
<area shape="rect" id="node10" href="address_8c.html#a78e7adae7e6b4e12cff810f6bd3a4e71" title="tor_inet_ntoa" alt="" coords="835,107,932,133"/>
<area shape="rect" id="node11" href="compat_8c.html#af032ac661214ae28b4f205781a515290" title="tor_snprintf" alt="" coords="1016,107,1103,133"/>
<area shape="rect" id="node12" href="compat_8c.html#a1df7873b16ae8936d25dfedb706f4ea6" title="tor_vsnprintf" alt="" coords="1151,107,1245,133"/>
<area shape="rect" id="node14" href="networkstatus_8c.html#af663020b40e6b122a43b26aa62ca4ed4" title="networkstatus_get_router\l_digest_by_nickname" alt="" coords="799,158,968,199"/>
<area shape="rect" id="node15" href="di__ops_8c.html#a473334ee93cca0aea10523321a444ea3" title="tor_memeq" alt="" coords="840,224,927,251"/>
<area shape="rect" id="node17" href="util_8c.html#ac152e18c6deb4f05823053bb2980a8e4" title="esc_for_log" alt="" coords="419,165,508,192"/>
<area shape="rect" id="node18" href="compat_8c.html#ade97970c1d8a691241adac739c4f9b12" title="tor_asprintf" alt="" coords="420,216,507,243"/>
<area shape="rect" id="node19" href="compat_8c.html#a5ef7a08e8b543c0d61f9ef1081d4c1ea" title="tor_vasprintf" alt="" coords="621,216,716,243"/>
</map>
</div>

</div>
</div>
<a id="a079db5d58a49010fe8b2944ecb3189bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a079db5d58a49010fe8b2944ecb3189bd">&#9670;&nbsp;</a></span>cached_dir_decref()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cached_dir_decref </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structcached__dir__t.html">cached_dir_t</a> *&#160;</td>
          <td class="paramname"><em>d</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Decrement the reference count on <b>d</b>, and free it if it no longer has any references. </p>

</div>
</div>
<a id="acb9b2ed7234ed40438a3a5406c823c36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb9b2ed7234ed40438a3a5406c823c36">&#9670;&nbsp;</a></span>connection_dirserv_flushed_some()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_dirserv_flushed_some </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdir__connection__t.html">dir_connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Called whenever we have flushed some directory data in state SERVER_WRITING. </p>

</div>
</div>
<a id="a57e2ff1ad2ea65abe9b969ad3d76a418"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57e2ff1ad2ea65abe9b969ad3d76a418">&#9670;&nbsp;</a></span>directory_caches_dir_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int directory_caches_dir_info </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if we want to keep descriptors, networkstatuses, etc around. Else return 0. Check options-&gt;DirPort_set and <a class="el" href="dirserv_8c.html#a7923860b3a8c27fa48c4dcec6ef6939f">directory_permits_begindir_requests()</a> to see if we are willing to serve these directory documents to others via the DirPort and begindir-over-ORPort, respectively. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a57e2ff1ad2ea65abe9b969ad3d76a418_cgraph.png" border="0" usemap="#dirserv_8c_a57e2ff1ad2ea65abe9b969ad3d76a418_cgraph" alt=""/></div>
<map name="dirserv_8c_a57e2ff1ad2ea65abe9b969ad3d76a418_cgraph" id="dirserv_8c_a57e2ff1ad2ea65abe9b969ad3d76a418_cgraph">
<area shape="rect" id="node2" href="router_8c.html#ab23297b12b098da9eac98126a587aa3b" title="dir_server_mode" alt="" coords="246,5,365,32"/>
<area shape="rect" id="node3" href="router_8c.html#afa75de94186fffc8f373de610ae4cab3" title="should_refuse_unknown\l_exits" alt="" coords="224,57,387,98"/>
<area shape="rect" id="node4" href="networkstatus_8c.html#aba1790be4b1cea243c3dac989ad1b05c" title="networkstatus_get_param" alt="" coords="435,64,607,91"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a57e2ff1ad2ea65abe9b969ad3d76a418_icgraph.png" border="0" usemap="#dirserv_8c_a57e2ff1ad2ea65abe9b969ad3d76a418_icgraph" alt=""/></div>
<map name="dirserv_8c_a57e2ff1ad2ea65abe9b969ad3d76a418_icgraph" id="dirserv_8c_a57e2ff1ad2ea65abe9b969ad3d76a418_icgraph">
<area shape="rect" id="node2" href="dirserv_8h.html#a2c5edbbd6883a33af3d72bfead4033db" title="directory_too_idle\l_to_fetch_descriptors" alt="" coords="240,28,387,69"/>
<area shape="rect" id="node8" href="microdesc_8h.html#ad9c983a76a2f31a6a843f4df9be7de1d" title="we_fetch_microdescriptors" alt="" coords="224,95,403,122"/>
<area shape="rect" id="node9" href="microdesc_8h.html#a2667d23ef05f514b5bf916791b4a6bbd" title="we_fetch_router_descriptors" alt="" coords="451,151,637,178"/>
<area shape="rect" id="node3" href="main_8h.html#ac64189cc036980dc5785f76d85db9fa6" title="directory_info_has\l_arrived" alt="" coords="1124,5,1252,47"/>
<area shape="rect" id="node4" href="microdesc_8h.html#aad7f413d899b72e58bed8efc0162d8bd" title="update_microdesc_downloads" alt="" coords="685,34,883,61"/>
<area shape="rect" id="node6" href="routerlist_8h.html#a1a7cfda729e27cf26089db2112d21965" title="update_consensus_router\l_descriptor_downloads" alt="" coords="459,85,629,127"/>
<area shape="rect" id="node5" href="routerlist_8h.html#afe7f2c6bcc3135272bc6aa66ec09cd76" title="update_all_descriptor\l_downloads" alt="" coords="931,35,1076,76"/>
<area shape="rect" id="node7" href="routerlist_8h.html#a8b67f737b9ea614297414b26eb3b784c" title="update_router_descriptor\l_downloads" alt="" coords="701,85,867,127"/>
</map>
</div>

</div>
</div>
<a id="a5a9cf7f465217dbc8142aaf11384abbf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a9cf7f465217dbc8142aaf11384abbf">&#9670;&nbsp;</a></span>directory_caches_unknown_auth_certs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int directory_caches_unknown_auth_certs </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff we want to fetch and keep certificates for authorities that we don't acknowledge as authorities ourself. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a5a9cf7f465217dbc8142aaf11384abbf_cgraph.png" border="0" usemap="#dirserv_8c_a5a9cf7f465217dbc8142aaf11384abbf_cgraph" alt=""/></div>
<map name="dirserv_8c_a5a9cf7f465217dbc8142aaf11384abbf_cgraph" id="dirserv_8c_a5a9cf7f465217dbc8142aaf11384abbf_cgraph">
<area shape="rect" id="node2" href="router_8c.html#ab23297b12b098da9eac98126a587aa3b" title="dir_server_mode" alt="" coords="233,13,352,39"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a5a9cf7f465217dbc8142aaf11384abbf_icgraph.png" border="0" usemap="#dirserv_8c_a5a9cf7f465217dbc8142aaf11384abbf_icgraph" alt=""/></div>
<map name="dirserv_8c_a5a9cf7f465217dbc8142aaf11384abbf_icgraph" id="dirserv_8c_a5a9cf7f465217dbc8142aaf11384abbf_icgraph">
<area shape="rect" id="node2" href="routerlist_8h.html#a91f37bda7b9149b1da0f1abfff66ab23" title="authority_certs_fetch\l_missing" alt="" coords="233,5,377,47"/>
<area shape="rect" id="node3" href="networkstatus_8h.html#aac5e0a37016a04c309a791ae15ecc86a" title="update_certificate\l_downloads" alt="" coords="425,5,551,47"/>
</map>
</div>

</div>
</div>
<a id="ab38d643312052d4bfdb7d49dcba344a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab38d643312052d4bfdb7d49dcba344a6">&#9670;&nbsp;</a></span>directory_fetches_dir_info_early()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int directory_fetches_dir_info_early </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if we should fetch new networkstatuses, descriptors, etc on the "mirror" schedule rather than the "client" schedule. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_ab38d643312052d4bfdb7d49dcba344a6_cgraph.png" border="0" usemap="#dirserv_8c_ab38d643312052d4bfdb7d49dcba344a6_cgraph" alt=""/></div>
<map name="dirserv_8c_ab38d643312052d4bfdb7d49dcba344a6_cgraph" id="dirserv_8c_ab38d643312052d4bfdb7d49dcba344a6_cgraph">
<area shape="rect" id="node2" href="dirserv_8c.html#a0b84786e17352524036694baf1955167" title="directory_fetches_from\l_authorities" alt="" coords="196,35,351,76"/>
<area shape="rect" id="node3" href="router_8c.html#afa75de94186fffc8f373de610ae4cab3" title="should_refuse_unknown\l_exits" alt="" coords="399,5,561,47"/>
<area shape="rect" id="node5" href="router_8c.html#ab23297b12b098da9eac98126a587aa3b" title="dir_server_mode" alt="" coords="421,71,539,98"/>
<area shape="rect" id="node4" href="networkstatus_8c.html#aba1790be4b1cea243c3dac989ad1b05c" title="networkstatus_get_param" alt="" coords="609,13,781,39"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_ab38d643312052d4bfdb7d49dcba344a6_icgraph.png" border="0" usemap="#dirserv_8c_ab38d643312052d4bfdb7d49dcba344a6_icgraph" alt=""/></div>
<map name="dirserv_8c_ab38d643312052d4bfdb7d49dcba344a6_icgraph" id="dirserv_8c_ab38d643312052d4bfdb7d49dcba344a6_icgraph">
<area shape="rect" id="node2" href="routerlist_8h.html#a33e8618001c42bd50575051362aaffa2" title="launch_descriptor_downloads" alt="" coords="196,13,389,39"/>
</map>
</div>

</div>
</div>
<a id="ab6172633152c7a88c49556085a2538f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab6172633152c7a88c49556085a2538f6">&#9670;&nbsp;</a></span>directory_fetches_dir_info_later()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int directory_fetches_dir_info_later </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if we should fetch new networkstatuses, descriptors, etc on a very passive schedule &ndash; waiting long enough for ordinary clients to probably have the info we want. These would include bridge users, and maybe others in the future e.g. if a Tor client uses another Tor client as a directory guard. </p>

</div>
</div>
<a id="a0b84786e17352524036694baf1955167"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b84786e17352524036694baf1955167">&#9670;&nbsp;</a></span>directory_fetches_from_authorities()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int directory_fetches_from_authorities </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if we fetch our directory material directly from the authorities, rather than from a mirror. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a0b84786e17352524036694baf1955167_cgraph.png" border="0" usemap="#dirserv_8c_a0b84786e17352524036694baf1955167_cgraph" alt=""/></div>
<map name="dirserv_8c_a0b84786e17352524036694baf1955167_cgraph" id="dirserv_8c_a0b84786e17352524036694baf1955167_cgraph">
<area shape="rect" id="node2" href="router_8c.html#afa75de94186fffc8f373de610ae4cab3" title="should_refuse_unknown\l_exits" alt="" coords="208,5,371,47"/>
<area shape="rect" id="node4" href="router_8c.html#ab23297b12b098da9eac98126a587aa3b" title="dir_server_mode" alt="" coords="230,71,349,98"/>
<area shape="rect" id="node3" href="networkstatus_8c.html#aba1790be4b1cea243c3dac989ad1b05c" title="networkstatus_get_param" alt="" coords="419,13,591,39"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a0b84786e17352524036694baf1955167_icgraph.png" border="0" usemap="#dirserv_8c_a0b84786e17352524036694baf1955167_icgraph" alt=""/></div>
<map name="dirserv_8c_a0b84786e17352524036694baf1955167_icgraph" id="dirserv_8c_a0b84786e17352524036694baf1955167_icgraph">
<area shape="rect" id="node2" href="directory_8c.html#a2dcb34e25124200a8694ef07275a50b2" title="MOCK_IMPL" alt="" coords="229,5,329,32"/>
<area shape="rect" id="node3" href="dirserv_8h.html#ab38d643312052d4bfdb7d49dcba344a6" title="directory_fetches_dir\l_info_early" alt="" coords="208,57,351,98"/>
<area shape="rect" id="node5" href="main_8h.html#ac64189cc036980dc5785f76d85db9fa6" title="directory_info_has\l_arrived" alt="" coords="215,122,343,163"/>
<area shape="rect" id="node4" href="routerlist_8h.html#a33e8618001c42bd50575051362aaffa2" title="launch_descriptor_downloads" alt="" coords="399,64,592,91"/>
</map>
</div>

</div>
</div>
<a id="a7923860b3a8c27fa48c4dcec6ef6939f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7923860b3a8c27fa48c4dcec6ef6939f">&#9670;&nbsp;</a></span>directory_permits_begindir_requests()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int directory_permits_begindir_requests </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if we want to allow remote people to ask us directory requests via the "begin_dir" interface, which doesn't require having any separate port open. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a7923860b3a8c27fa48c4dcec6ef6939f_cgraph.png" border="0" usemap="#dirserv_8c_a7923860b3a8c27fa48c4dcec6ef6939f_cgraph" alt=""/></div>
<map name="dirserv_8c_a7923860b3a8c27fa48c4dcec6ef6939f_cgraph" id="dirserv_8c_a7923860b3a8c27fa48c4dcec6ef6939f_cgraph">
<area shape="rect" id="node2" href="router_8c.html#ab23297b12b098da9eac98126a587aa3b" title="dir_server_mode" alt="" coords="228,13,347,39"/>
</map>
</div>

</div>
</div>
<a id="a2c5edbbd6883a33af3d72bfead4033db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c5edbbd6883a33af3d72bfead4033db">&#9670;&nbsp;</a></span>directory_too_idle_to_fetch_descriptors()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int directory_too_idle_to_fetch_descriptors </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if we have no need to fetch new descriptors. This generally happens when we're not a dir cache and we haven't built any circuits lately. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a2c5edbbd6883a33af3d72bfead4033db_cgraph.png" border="0" usemap="#dirserv_8c_a2c5edbbd6883a33af3d72bfead4033db_cgraph" alt=""/></div>
<map name="dirserv_8c_a2c5edbbd6883a33af3d72bfead4033db_cgraph" id="dirserv_8c_a2c5edbbd6883a33af3d72bfead4033db_cgraph">
<area shape="rect" id="node2" href="dirserv_8c.html#a57e2ff1ad2ea65abe9b969ad3d76a418" title="directory_caches_dir_info" alt="" coords="200,64,371,91"/>
<area shape="rect" id="node6" href="rephist_8c.html#a890009e83c2e90292a435526b8111727" title="rep_hist_circbuilding\l_dormant" alt="" coords="215,174,355,215"/>
<area shape="rect" id="node3" href="router_8c.html#ab23297b12b098da9eac98126a587aa3b" title="dir_server_mode" alt="" coords="441,5,559,32"/>
<area shape="rect" id="node4" href="router_8c.html#afa75de94186fffc8f373de610ae4cab3" title="should_refuse_unknown\l_exits" alt="" coords="419,57,581,98"/>
<area shape="rect" id="node5" href="networkstatus_8c.html#aba1790be4b1cea243c3dac989ad1b05c" title="networkstatus_get_param" alt="" coords="629,64,801,91"/>
<area shape="rect" id="node7" href="rephist_8c.html#ae234f5b5dcf88ea65ef20ff5c3512327" title="any_predicted_circuits" alt="" coords="424,123,576,149"/>
<area shape="rect" id="node8" href="router_8c.html#a8b917b11fb2945b314286a6a567e34c3" title="check_whether_orport\l_reachable" alt="" coords="425,174,575,215"/>
<area shape="rect" id="node9" href="circuituse_8c.html#ac6c1a2c715351d85ef6747ca1a4db958" title="circuit_enough_testing\l_circs" alt="" coords="424,239,576,281"/>
<area shape="rect" id="node10" href="router_8c.html#a98317a030cb30700f60c8444d676087b" title="check_whether_dirport\l_reachable" alt="" coords="423,305,577,346"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a2c5edbbd6883a33af3d72bfead4033db_icgraph.png" border="0" usemap="#dirserv_8c_a2c5edbbd6883a33af3d72bfead4033db_icgraph" alt=""/></div>
<map name="dirserv_8c_a2c5edbbd6883a33af3d72bfead4033db_icgraph" id="dirserv_8c_a2c5edbbd6883a33af3d72bfead4033db_icgraph">
<area shape="rect" id="node2" href="main_8h.html#ac64189cc036980dc5785f76d85db9fa6" title="directory_info_has\l_arrived" alt="" coords="857,5,985,47"/>
<area shape="rect" id="node3" href="microdesc_8h.html#aad7f413d899b72e58bed8efc0162d8bd" title="update_microdesc_downloads" alt="" coords="419,34,616,61"/>
<area shape="rect" id="node5" href="routerlist_8h.html#a1a7cfda729e27cf26089db2112d21965" title="update_consensus_router\l_descriptor_downloads" alt="" coords="200,85,371,127"/>
<area shape="rect" id="node4" href="routerlist_8h.html#afe7f2c6bcc3135272bc6aa66ec09cd76" title="update_all_descriptor\l_downloads" alt="" coords="664,35,809,76"/>
<area shape="rect" id="node6" href="routerlist_8h.html#a8b67f737b9ea614297414b26eb3b784c" title="update_router_descriptor\l_downloads" alt="" coords="435,85,600,127"/>
</map>
</div>

</div>
</div>
<a id="a5af480ce6b85c4740885e8a4965c5272"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5af480ce6b85c4740885e8a4965c5272">&#9670;&nbsp;</a></span>dirserv_add_descriptor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="or_8h.html#a7c96814e647f1b5b99e501ea5763842f">was_router_added_t</a> dirserv_add_descriptor </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>source</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Examine the parsed server descriptor in <b>ri</b> and maybe insert it into the list of server descriptors. Set *<b>msg</b> to a message that should be passed back to the origin of this descriptor, or NULL if there is no such message. Use <b>source</b> to produce better log messages.</p>
<p>If <b>ri</b> is not added to the list of server descriptors, free it. That means the caller must not access <b>ri</b> after this function returns, since it might have been freed.</p>
<p>Return the status of the operation.</p>
<p>This function is only called when fresh descriptors are posted, not when we re-load the cache. </p>

</div>
</div>
<a id="af6e1baef9d8542712a4018d365fa2215"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af6e1baef9d8542712a4018d365fa2215">&#9670;&nbsp;</a></span>dirserv_add_multiple_descriptors()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="or_8h.html#a7c96814e647f1b5b99e501ea5763842f">was_router_added_t</a> dirserv_add_multiple_descriptors </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>purpose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>As for <a class="el" href="dirserv_8c.html#a5af480ce6b85c4740885e8a4965c5272">dirserv_add_descriptor()</a>, but accepts multiple documents, and returns the most severe error that occurred for any one of them. </p>

</div>
</div>
<a id="a95deb3d9d5367525bb51127b82269c87"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95deb3d9d5367525bb51127b82269c87">&#9670;&nbsp;</a></span>dirserv_add_own_fingerprint()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_add_own_fingerprint </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structcrypto__pk__t.html">crypto_pk_t</a> *&#160;</td>
          <td class="paramname"><em>pk</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add the fingerprint for this OR to the global list of recognized identity key fingerprints. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a95deb3d9d5367525bb51127b82269c87_cgraph.png" border="0" usemap="#dirserv_8c_a95deb3d9d5367525bb51127b82269c87_cgraph" alt=""/></div>
<map name="dirserv_8c_a95deb3d9d5367525bb51127b82269c87_cgraph" id="dirserv_8c_a95deb3d9d5367525bb51127b82269c87_cgraph">
<area shape="rect" id="node2" href="crypto_8c.html#a10149de1598ad3852fa49aa2c708371b" title="crypto_pk_get_fingerprint" alt="" coords="237,56,405,83"/>
<area shape="rect" id="node3" href="crypto_8c.html#a91336077a5062618ff895dae4e50079d" title="crypto_pk_get_digest" alt="" coords="465,5,612,32"/>
<area shape="rect" id="node5" href="util__format_8c.html#a8b8940b2ef607928eb3dca4850567ea5" title="base16_encode" alt="" coords="482,56,595,83"/>
<area shape="rect" id="node6" href="crypto_8c.html#aba85ade6ff380d6321263ca9363cb0ce" title="crypto_add_spaces_to_fp" alt="" coords="453,107,624,133"/>
<area shape="rect" id="node4" href="crypto_8c.html#adc1609ea0f9d65a1f60225cb001eeb15" title="crypto_digest" alt="" coords="672,5,772,32"/>
</map>
</div>

</div>
</div>
<a id="ac19029821b6c2868fd554e3b38e1ab59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac19029821b6c2868fd554e3b38e1ab59">&#9670;&nbsp;</a></span>dirserv_cache_measured_bw()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC void dirserv_cache_measured_bw </td>
          <td>(</td>
          <td class="paramtype">const measured_bw_line_t *&#160;</td>
          <td class="paramname"><em>parsed_line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>as_of</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Store a measured bandwidth cache entry when reading the measured bandwidths file. </p>

</div>
</div>
<a id="affc919a1a21f4d10e5844a19531140d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affc919a1a21f4d10e5844a19531140d1">&#9670;&nbsp;</a></span>dirserv_clear_measured_bw_cache()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC void dirserv_clear_measured_bw_cache </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Clear and free the measured bandwidth cache </p>

</div>
</div>
<a id="a8563ff795e78b4677acaec59712726bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8563ff795e78b4677acaec59712726bb">&#9670;&nbsp;</a></span>dirserv_estimate_data_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t dirserv_estimate_data_size </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>fps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>is_serverdescs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>compressed</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return an approximate estimate of the number of bytes that will be needed to transmit the server descriptors (if is_serverdescs &ndash; they can be either d/ or fp/ queries) or networkstatus objects (if !is_serverdescs) listed in <b>fps</b>. If <b>compressed</b> is set, we guess how large the data will be after compression.</p>
<p>The return value is an estimate; it might be larger or smaller. </p>

</div>
</div>
<a id="a48cee7ff92f2da41f67b8f2a332ffa5a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48cee7ff92f2da41f67b8f2a332ffa5a">&#9670;&nbsp;</a></span>dirserv_estimate_microdesc_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t dirserv_estimate_microdesc_size </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>fps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>compressed</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given a list of microdescriptor hashes, guess how many bytes will be needed to transmit them, and return the guess. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a48cee7ff92f2da41f67b8f2a332ffa5a_cgraph.png" border="0" usemap="#dirserv_8c_a48cee7ff92f2da41f67b8f2a332ffa5a_cgraph" alt=""/></div>
<map name="dirserv_8c_a48cee7ff92f2da41f67b8f2a332ffa5a_cgraph" id="dirserv_8c_a48cee7ff92f2da41f67b8f2a332ffa5a_cgraph">
<area shape="rect" id="node2" href="microdesc_8c.html#a9ed7132c4abf5af5ba74ec1cd090878d" title="microdesc_average_size" alt="" coords="269,5,436,32"/>
<area shape="rect" id="node3" href="microdesc_8c.html#aa39bb77fb19ca888eb8d2bedac93c75d" title="get_microdesc_cache" alt="" coords="484,5,633,32"/>
</map>
</div>

</div>
</div>
<a id="ab797c233e08456a060af12f1f85bbe88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab797c233e08456a060af12f1f85bbe88">&#9670;&nbsp;</a></span>dirserv_expire_measured_bw_cache()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC void dirserv_expire_measured_bw_cache </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Scan the measured bandwidth cache and remove expired entries </p>

</div>
</div>
<a id="aa86c752d8d8f446eba40db2d0c2269a7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa86c752d8d8f446eba40db2d0c2269a7">&#9670;&nbsp;</a></span>dirserv_free_all()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_free_all </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Release all storage used by the directory server. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_aa86c752d8d8f446eba40db2d0c2269a7_cgraph.png" border="0" usemap="#dirserv_8c_aa86c752d8d8f446eba40db2d0c2269a7_cgraph" alt=""/></div>
<map name="dirserv_8c_aa86c752d8d8f446eba40db2d0c2269a7_cgraph" id="dirserv_8c_aa86c752d8d8f446eba40db2d0c2269a7_cgraph">
<area shape="rect" id="node2" href="dirserv_8c.html#a952a2a3f8acd42cdebbae8631123cf1c" title="dirserv_free_fingerprint_list" alt="" coords="164,5,343,32"/>
<area shape="rect" id="node3" href="util_8c.html#a40d94cc20afc38582c65aa418919ebed" title="tor_free_" alt="" coords="391,5,464,32"/>
</map>
</div>

</div>
</div>
<a id="a952a2a3f8acd42cdebbae8631123cf1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a952a2a3f8acd42cdebbae8631123cf1c">&#9670;&nbsp;</a></span>dirserv_free_fingerprint_list()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_free_fingerprint_list </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Clear the current fingerprint list. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a952a2a3f8acd42cdebbae8631123cf1c_cgraph.png" border="0" usemap="#dirserv_8c_a952a2a3f8acd42cdebbae8631123cf1c_cgraph" alt=""/></div>
<map name="dirserv_8c_a952a2a3f8acd42cdebbae8631123cf1c_cgraph" id="dirserv_8c_a952a2a3f8acd42cdebbae8631123cf1c_cgraph">
<area shape="rect" id="node2" href="util_8c.html#a40d94cc20afc38582c65aa418919ebed" title="tor_free_" alt="" coords="232,5,305,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a952a2a3f8acd42cdebbae8631123cf1c_icgraph.png" border="0" usemap="#dirserv_8c_a952a2a3f8acd42cdebbae8631123cf1c_icgraph" alt=""/></div>
<map name="dirserv_8c_a952a2a3f8acd42cdebbae8631123cf1c_icgraph" id="dirserv_8c_a952a2a3f8acd42cdebbae8631123cf1c_icgraph">
<area shape="rect" id="node2" href="dirserv_8h.html#aa86c752d8d8f446eba40db2d0c2269a7" title="dirserv_free_all" alt="" coords="232,5,343,32"/>
</map>
</div>

</div>
</div>
<a id="ae288382ee634aeb5099f263fa9af8c25"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae288382ee634aeb5099f263fa9af8c25">&#9670;&nbsp;</a></span>dirserv_generate_networkstatus_vote_obj()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structnetworkstatus__t.html">networkstatus_t</a>* dirserv_generate_networkstatus_vote_obj </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structcrypto__pk__t.html">crypto_pk_t</a> *&#160;</td>
          <td class="paramname"><em>private_key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structauthority__cert__t.html">authority_cert_t</a> *&#160;</td>
          <td class="paramname"><em>cert</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a new networkstatus_t* containing our current opinion. (For v3 authorities) </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_ae288382ee634aeb5099f263fa9af8c25_cgraph.png" border="0" usemap="#dirserv_8c_ae288382ee634aeb5099f263fa9af8c25_cgraph" alt=""/></div>
<map name="dirserv_8c_ae288382ee634aeb5099f263fa9af8c25_cgraph" id="dirserv_8c_ae288382ee634aeb5099f263fa9af8c25_cgraph">
<area shape="rect" id="node2" href="routerlist_8c.html#a9181bbed0ee6ff8088a7c53fc8c446f1" title="router_get_routerlist" alt="" coords="260,13,397,39"/>
</map>
</div>

</div>
</div>
<a id="a0f07c36cfc3121034f466d7cb6d27630"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f07c36cfc3121034f466d7cb6d27630">&#9670;&nbsp;</a></span>dirserv_get_consensus()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structcached__dir__t.html">cached_dir_t</a>* dirserv_get_consensus </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>flavor_name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the latest downloaded consensus networkstatus in encoded, signed, optionally compressed format, suitable for sending to clients. </p>

</div>
</div>
<a id="a5be126c4926e7257fa5fbe5463ff4a6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5be126c4926e7257fa5fbe5463ff4a6a">&#9670;&nbsp;</a></span>dirserv_get_flag_thresholds_line()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* dirserv_get_flag_thresholds_line </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Give a statement of our current performance thresholds for inclusion in a vote document. </p>

</div>
</div>
<a id="a05e0b9d58ea3e9d0bf6d68a3aa6d7a06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a05e0b9d58ea3e9d0bf6d68a3aa6d7a06">&#9670;&nbsp;</a></span>dirserv_get_measured_bw_cache_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC int dirserv_get_measured_bw_cache_size </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get the current size of the measured bandwidth cache </p>

</div>
</div>
<a id="a285fc71bfe2b99bc2b09b949d95ac1b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a285fc71bfe2b99bc2b09b949d95ac1b9">&#9670;&nbsp;</a></span>dirserv_get_routerdesc_fingerprints()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_get_routerdesc_fingerprints </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>fps_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>for_unencrypted_conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>is_extrainfo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>As <a class="el" href="dirserv_8c.html#a8fca5a38cd000d8ccabe5bc73e296bb2">dirserv_get_routerdescs()</a>, but instead of getting <a class="el" href="structsigned__descriptor__t.html">signed_descriptor_t</a> pointers, adds copies of digests to fps_out, and doesn't use the /tor/server/ prefix. For a /d/ request, adds descriptor digests; for other requests, adds identity digests. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a285fc71bfe2b99bc2b09b949d95ac1b9_cgraph.png" border="0" usemap="#dirserv_8c_a285fc71bfe2b99bc2b09b949d95ac1b9_cgraph" alt=""/></div>
<map name="dirserv_8c_a285fc71bfe2b99bc2b09b949d95ac1b9_cgraph" id="dirserv_8c_a285fc71bfe2b99bc2b09b949d95ac1b9_cgraph">
<area shape="rect" id="node2" href="routerlist_8c.html#a9181bbed0ee6ff8088a7c53fc8c446f1" title="router_get_routerlist" alt="" coords="208,5,345,32"/>
<area shape="rect" id="node3" href="container_8c.html#accf59a8b7d39a4286ff99653b6878006" title="smartlist_add" alt="" coords="227,56,327,83"/>
</map>
</div>

</div>
</div>
<a id="a8fca5a38cd000d8ccabe5bc73e296bb2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8fca5a38cd000d8ccabe5bc73e296bb2">&#9670;&nbsp;</a></span>dirserv_get_routerdescs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_get_routerdescs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>descs_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add a <a class="el" href="structsigned__descriptor__t.html">signed_descriptor_t</a> to <b>descs_out</b> for each router matching <b>key</b>. The key should be either</p><ul>
<li>"/tor/server/authority" for our own routerinfo;</li>
<li>"/tor/server/all" for all the routerinfos we have, concatenated;</li>
<li>"/tor/server/fp/FP" where FP is a plus-separated sequence of hex identity digests; or</li>
<li>"/tor/server/d/D" where D is a plus-separated sequence of server descriptor digests, in hex.</li>
</ul>
<p>Return 0 if we found some matching descriptors, or -1 if we do not have any descriptors, no matching descriptors, or if we did not recognize the key (URL). If -1 is returned *<b>msg</b> will be set to an appropriate error message.</p>
<p>XXXX rename this function. It's only called from the controller. XXXX in fact, refactor this function, merging as much as possible. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a8fca5a38cd000d8ccabe5bc73e296bb2_cgraph.png" border="0" usemap="#dirserv_8c_a8fca5a38cd000d8ccabe5bc73e296bb2_cgraph" alt=""/></div>
<map name="dirserv_8c_a8fca5a38cd000d8ccabe5bc73e296bb2_cgraph" id="dirserv_8c_a8fca5a38cd000d8ccabe5bc73e296bb2_cgraph">
<area shape="rect" id="node2" href="routerlist_8c.html#a9181bbed0ee6ff8088a7c53fc8c446f1" title="router_get_routerlist" alt="" coords="215,5,352,32"/>
<area shape="rect" id="node3" href="container_8c.html#accf59a8b7d39a4286ff99653b6878006" title="smartlist_add" alt="" coords="233,56,333,83"/>
<area shape="rect" id="node4" href="util_8c.html#a245aaefd9d8715af06ce0f7b7355fd0d" title="strcmpstart" alt="" coords="239,107,327,133"/>
<area shape="rect" id="node5" href="directory_8c.html#ab3cd3a5081cf507805b4b01c907dd168" title="dir_split_resource\l_into_fingerprints" alt="" coords="221,158,345,199"/>
</map>
</div>

</div>
</div>
<a id="a21b4084acb1e20906fe38d1a0a905986"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21b4084acb1e20906fe38d1a0a905986">&#9670;&nbsp;</a></span>dirserv_has_measured_bw()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC int dirserv_has_measured_bw </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>node_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Predicate wrapper for dirserv_query_measured_bw_cache() </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a21b4084acb1e20906fe38d1a0a905986_cgraph.png" border="0" usemap="#dirserv_8c_a21b4084acb1e20906fe38d1a0a905986_cgraph" alt=""/></div>
<map name="dirserv_8c_a21b4084acb1e20906fe38d1a0a905986_cgraph" id="dirserv_8c_a21b4084acb1e20906fe38d1a0a905986_cgraph">
<area shape="rect" id="node2" href="dirserv_8c.html#a4a93860d395d1c2d9d50a360d013f365" title="dirserv_query_measured\l_bw_cache_kb" alt="" coords="231,5,395,47"/>
</map>
</div>

</div>
</div>
<a id="a89dcb27b45f04c12e789dee837b90fdc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a89dcb27b45f04c12e789dee837b90fdc">&#9670;&nbsp;</a></span>dirserv_have_any_microdesc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_have_any_microdesc </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>fps</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff any of the 256-bit elements in <b>fps</b> is the digest of a microdescriptor we have. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a89dcb27b45f04c12e789dee837b90fdc_cgraph.png" border="0" usemap="#dirserv_8c_a89dcb27b45f04c12e789dee837b90fdc_cgraph" alt=""/></div>
<map name="dirserv_8c_a89dcb27b45f04c12e789dee837b90fdc_cgraph" id="dirserv_8c_a89dcb27b45f04c12e789dee837b90fdc_cgraph">
<area shape="rect" id="node2" href="microdesc_8c.html#aa39bb77fb19ca888eb8d2bedac93c75d" title="get_microdesc_cache" alt="" coords="461,5,611,32"/>
<area shape="rect" id="node3" href="microdesc_8c.html#a7c169d48c50e48e8fe1306765f319b61" title="microdesc_cache_lookup\l_by_digest256" alt="" coords="244,27,413,69"/>
</map>
</div>

</div>
</div>
<a id="a7c84a4724e9a8934918c2c8dcc927f0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c84a4724e9a8934918c2c8dcc927f0c">&#9670;&nbsp;</a></span>dirserv_have_any_serverdesc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_have_any_serverdesc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>fps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>spool_src</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff we have any of the documents (extrainfo or routerdesc) specified by the fingerprints in <b>fps</b> and <b>spool_src</b>. Used to decide whether to send a 404. </p>

</div>
</div>
<a id="a258a245ff1505a9ea50b06de2b3e490f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a258a245ff1505a9ea50b06de2b3e490f">&#9670;&nbsp;</a></span>dirserv_load_fingerprint_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_load_fingerprint_file </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Load the nickname-&gt;fingerprint mappings stored in the approved-routers file. The file format is line-based, with each non-blank holding one nickname, some space, and a fingerprint for that nickname. On success, replace the current fingerprint list with the new list and return 0. On failure, leave the current fingerprint list untouched, and return -1. </p>

</div>
</div>
<a id="a8dd4c13ef93596eaa704393dbc6828e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8dd4c13ef93596eaa704393dbc6828e0">&#9670;&nbsp;</a></span>dirserv_orconn_tls_done()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_orconn_tls_done </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>or_port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>digest_rcvd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Called when a TLS handshake has completed successfully with a router listening at <b>address</b>:<b>or_port</b>, and has yielded a certificate with digest <b>digest_rcvd</b>.</p>
<p>Inform the reachability checker that we could get to this relay. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a8dd4c13ef93596eaa704393dbc6828e0_cgraph.png" border="0" usemap="#dirserv_8c_a8dd4c13ef93596eaa704393dbc6828e0_cgraph" alt=""/></div>
<map name="dirserv_8c_a8dd4c13ef93596eaa704393dbc6828e0_cgraph" id="dirserv_8c_a8dd4c13ef93596eaa704393dbc6828e0_cgraph">
<area shape="rect" id="node2" href="nodelist_8c.html#a114f706e8f9039f1dce0137619807581" title="node_get_mutable_by_id" alt="" coords="216,5,383,32"/>
<area shape="rect" id="node3" href="address_8c.html#a139ff425c957e4eed3a766cb48f55f93" title="tor_addr_copy" alt="" coords="247,56,351,83"/>
</map>
</div>

</div>
</div>
<a id="a4a93860d395d1c2d9d50a360d013f365"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a93860d395d1c2d9d50a360d013f365">&#9670;&nbsp;</a></span>dirserv_query_measured_bw_cache_kb()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC int dirserv_query_measured_bw_cache_kb </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>node_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long *&#160;</td>
          <td class="paramname"><em>bw_kb_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t *&#160;</td>
          <td class="paramname"><em>as_of_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Query the cache by identity digest, return value indicates whether we found it. The bw_out and as_of_out pointers receive the cached bandwidth value and the time it was cached if not NULL. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a4a93860d395d1c2d9d50a360d013f365_icgraph.png" border="0" usemap="#dirserv_8c_a4a93860d395d1c2d9d50a360d013f365_icgraph" alt=""/></div>
<map name="dirserv_8c_a4a93860d395d1c2d9d50a360d013f365_icgraph" id="dirserv_8c_a4a93860d395d1c2d9d50a360d013f365_icgraph">
<area shape="rect" id="node2" href="dirserv_8c.html#a21b4084acb1e20906fe38d1a0a905986" title="dirserv_has_measured_bw" alt="" coords="217,13,395,39"/>
</map>
</div>

</div>
</div>
<a id="a50e06fc916d8cbcc3ccfb7f919cb6928"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50e06fc916d8cbcc3ccfb7f919cb6928">&#9670;&nbsp;</a></span>dirserv_read_guardfraction_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_read_guardfraction_file </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>vote_routerstatuses</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read a guardfraction file at <b>fname</b> and load all its information to <b>vote_routerstatuses</b>. </p>

</div>
</div>
<a id="a321d38c3a8578f36a42cef18c507bc90"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a321d38c3a8578f36a42cef18c507bc90">&#9670;&nbsp;</a></span>dirserv_read_guardfraction_file_from_str()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC int dirserv_read_guardfraction_file_from_str </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>guardfraction_file_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>vote_routerstatuses</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given a guardfraction file in a string, parse it and register the guardfraction information to the provided vote routerstatuses.</p>
<p>This is the rough format of the guardfraction file: </p><pre class="fragment">guardfraction-file-version 1
written-at &lt;date and time&gt;
n-inputs &lt;number of consesuses parsed&gt; &lt;number of days considered&gt;

guard-seen &lt;fpr 1&gt; &lt;guardfraction percentage&gt; &lt;consensus appearances&gt;
guard-seen &lt;fpr 2&gt; &lt;guardfraction percentage&gt; &lt;consensus appearances&gt;
guard-seen &lt;fpr 3&gt; &lt;guardfraction percentage&gt; &lt;consensus appearances&gt;
guard-seen &lt;fpr 4&gt; &lt;guardfraction percentage&gt; &lt;consensus appearances&gt;
guard-seen &lt;fpr 5&gt; &lt;guardfraction percentage&gt; &lt;consensus appearances&gt;
...
</pre><p>Return -1 if the parsing failed and 0 if it went smoothly. Parsing should tolerate errors in all lines but the written-at header. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a321d38c3a8578f36a42cef18c507bc90_cgraph.png" border="0" usemap="#dirserv_8c_a321d38c3a8578f36a42cef18c507bc90_cgraph" alt=""/></div>
<map name="dirserv_8c_a321d38c3a8578f36a42cef18c507bc90_cgraph" id="dirserv_8c_a321d38c3a8578f36a42cef18c507bc90_cgraph">
<area shape="rect" id="node2" href="confparse_8c.html#ae9877f561b70fd9bf085e57c9547da9d" title="config_get_lines" alt="" coords="228,13,344,39"/>
<area shape="rect" id="node3" href="util_8c.html#aabb29a0799fb54c87b3f6a4e7c252cb1" title="parse_config_line_from\l_str_verbose" alt="" coords="392,5,548,47"/>
</map>
</div>

</div>
</div>
<a id="af364b236821a07880cc8dc54e98ca999"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af364b236821a07880cc8dc54e98ca999">&#9670;&nbsp;</a></span>dirserv_read_measured_bandwidths()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_read_measured_bandwidths </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>from_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>routerstatuses</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read the measured bandwidth file and apply it to the list of <a class="el" href="structvote__routerstatus__t.html">vote_routerstatus_t</a>. Returns -1 on error, 0 otherwise. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_af364b236821a07880cc8dc54e98ca999_cgraph.png" border="0" usemap="#dirserv_8c_af364b236821a07880cc8dc54e98ca999_cgraph" alt=""/></div>
<map name="dirserv_8c_af364b236821a07880cc8dc54e98ca999_cgraph" id="dirserv_8c_af364b236821a07880cc8dc54e98ca999_cgraph">
<area shape="rect" id="node2" href="compat_8c.html#a99ee17f8317be48a2391c20e31e8a7b8" title="tor_fopen_cloexec" alt="" coords="211,13,339,39"/>
</map>
</div>

</div>
</div>
<a id="af00dc463b7670924195592f7922afdfc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af00dc463b7670924195592f7922afdfc">&#9670;&nbsp;</a></span>dirserv_remove_old_statuses()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_remove_old_statuses </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>fps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>cutoff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove from <b>fps</b> every networkstatus key where both a) we have a networkstatus document and b) it is not newer than <b>cutoff</b>.</p>
<p>Return 1 if any items were present at all; else return 0. </p>

</div>
</div>
<a id="a95906070553304c94a590affb671223e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95906070553304c94a590affb671223e">&#9670;&nbsp;</a></span>dirserv_router_get_status()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t dirserv_router_get_status </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *&#160;</td>
          <td class="paramname"><em>router</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>severity</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Check whether <b>router</b> has a nickname/identity key combination that we recognize from the fingerprint list, or an IP we automatically act on according to our configuration. Return the appropriate router status.</p>
<p>If the status is 'FP_REJECT' and <b>msg</b> is provided, set *<b>msg</b> to an explanation of why. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a95906070553304c94a590affb671223e_cgraph.png" border="0" usemap="#dirserv_8c_a95906070553304c94a590affb671223e_cgraph" alt=""/></div>
<map name="dirserv_8c_a95906070553304c94a590affb671223e_cgraph" id="dirserv_8c_a95906070553304c94a590affb671223e_cgraph">
<area shape="rect" id="node2" href="crypto_8c.html#a91336077a5062618ff895dae4e50079d" title="crypto_pk_get_digest" alt="" coords="180,13,327,39"/>
<area shape="rect" id="node3" href="crypto_8c.html#adc1609ea0f9d65a1f60225cb001eeb15" title="crypto_digest" alt="" coords="375,13,475,39"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a95906070553304c94a590affb671223e_icgraph.png" border="0" usemap="#dirserv_8c_a95906070553304c94a590affb671223e_icgraph" alt=""/></div>
<map name="dirserv_8c_a95906070553304c94a590affb671223e_icgraph" id="dirserv_8c_a95906070553304c94a590affb671223e_icgraph">
<area shape="rect" id="node2" href="dirserv_8h.html#adaceacf408562b95dd1169799995bd6c" title="authdir_wants_to_reject\l_router" alt="" coords="180,5,340,47"/>
</map>
</div>

</div>
</div>
<a id="af60d63ae445884beb62813d3fd046c31"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af60d63ae445884beb62813d3fd046c31">&#9670;&nbsp;</a></span>dirserv_set_cached_consensus_networkstatus()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_set_cached_consensus_networkstatus </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>networkstatus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>flavor_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structcommon__digests__t.html">common_digests_t</a> *&#160;</td>
          <td class="paramname"><em>digests</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>published</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Replace the v3 consensus networkstatus of type <b>flavor_name</b> that we're serving with <b>networkstatus</b>, published at <b>published</b>. No validation is performed. </p>

</div>
</div>
<a id="a5f2508c28e6b8a1d7b9ae921598a9860"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f2508c28e6b8a1d7b9ae921598a9860">&#9670;&nbsp;</a></span>dirserv_set_node_flags_from_authoritative_status()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_set_node_flags_from_authoritative_status </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structnode__t.html">node_t</a> *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>authstatus</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Update the relevant flags of <b>node</b> based on our opinion as a directory authority in <b>authstatus</b>, as returned by dirserv_router_get_status or equivalent. </p>

</div>
</div>
<a id="ad1772dc2a4a12cc0eb181d1f52c5a54a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad1772dc2a4a12cc0eb181d1f52c5a54a">&#9670;&nbsp;</a></span>dirserv_set_router_is_running()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_set_router_is_running </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *&#160;</td>
          <td class="paramname"><em>router</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Treat a router as alive if</p><ul>
<li>It's me, and I'm not hibernating. or - We've found it reachable recently. </li>
</ul>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_ad1772dc2a4a12cc0eb181d1f52c5a54a_cgraph.png" border="0" usemap="#dirserv_8c_ad1772dc2a4a12cc0eb181d1f52c5a54a_cgraph" alt=""/></div>
<map name="dirserv_8c_ad1772dc2a4a12cc0eb181d1f52c5a54a_cgraph" id="dirserv_8c_ad1772dc2a4a12cc0eb181d1f52c5a54a_cgraph">
<area shape="rect" id="node2" href="nodelist_8c.html#a114f706e8f9039f1dce0137619807581" title="node_get_mutable_by_id" alt="" coords="180,5,347,32"/>
<area shape="rect" id="node3" href="router_8c.html#adcfdecf66a4aa5e6d09a702784c8197f" title="router_is_me" alt="" coords="215,56,312,83"/>
<area shape="rect" id="node6" href="address_8c.html#a6ecc12236743caf7527376436791c75e" title="tor_addr_is_null" alt="" coords="207,107,320,133"/>
<area shape="rect" id="node4" href="router_8c.html#abeb0f38915a46f77352900604075d82f" title="router_digest_is_me" alt="" coords="395,56,533,83"/>
<area shape="rect" id="node5" href="di__ops_8c.html#a473334ee93cca0aea10523321a444ea3" title="tor_memeq" alt="" coords="581,56,668,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_ad1772dc2a4a12cc0eb181d1f52c5a54a_icgraph.png" border="0" usemap="#dirserv_8c_ad1772dc2a4a12cc0eb181d1f52c5a54a_icgraph" alt=""/></div>
<map name="dirserv_8c_ad1772dc2a4a12cc0eb181d1f52c5a54a_icgraph" id="dirserv_8c_ad1772dc2a4a12cc0eb181d1f52c5a54a_icgraph">
<area shape="rect" id="node2" href="dirserv_8h.html#a6c7009f040e0a812c40a6ae0fa6efd79" title="list_server_status_v1" alt="" coords="180,13,327,39"/>
</map>
</div>

</div>
</div>
<a id="a1808f4f273d59d32f2e29b968165e251"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1808f4f273d59d32f2e29b968165e251">&#9670;&nbsp;</a></span>dirserv_set_routerstatus_testing()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC void dirserv_set_routerstatus_testing </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrouterstatus__t.html">routerstatus_t</a> *&#160;</td>
          <td class="paramname"><em>rs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Use TestingDirAuthVoteExit, TestingDirAuthVoteGuard, and TestingDirAuthVoteHSDir to give out the Exit, Guard, and HSDir flags, respectively. But don't set the corresponding node flags. Should only be called if TestingTorNetwork is set. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a1808f4f273d59d32f2e29b968165e251_cgraph.png" border="0" usemap="#dirserv_8c_a1808f4f273d59d32f2e29b968165e251_cgraph" alt=""/></div>
<map name="dirserv_8c_a1808f4f273d59d32f2e29b968165e251_cgraph" id="dirserv_8c_a1808f4f273d59d32f2e29b968165e251_cgraph">
<area shape="rect" id="node2" href="routerset_8c.html#a46e8468ce37722ff71b91efd9d2f7ff0" title="routerset_contains\l_routerstatus" alt="" coords="216,5,345,47"/>
<area shape="rect" id="node3" href="routerset_8c.html#a1eda4526d656d042e5143ec79ee66be2" title="routerset_contains" alt="" coords="393,13,523,39"/>
<area shape="rect" id="node4" href="container_8c.html#a1406b823cb6088df755f1b81153d137e" title="strmap_get_lc" alt="" coords="571,13,675,39"/>
</map>
</div>

</div>
</div>
<a id="a0c97fbc43a4398a45feb2fafa3d42fc1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c97fbc43a4398a45feb2fafa3d42fc1">&#9670;&nbsp;</a></span>dirserv_should_launch_reachability_test()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_should_launch_reachability_test </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *&#160;</td>
          <td class="paramname"><em>ri_old</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Called when we, as an authority, receive a new router descriptor either as an upload or a download. Used to decide whether to relaunch reachability testing for the server. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a0c97fbc43a4398a45feb2fafa3d42fc1_cgraph.png" border="0" usemap="#dirserv_8c_a0c97fbc43a4398a45feb2fafa3d42fc1_cgraph" alt=""/></div>
<map name="dirserv_8c_a0c97fbc43a4398a45feb2fafa3d42fc1_cgraph" id="dirserv_8c_a0c97fbc43a4398a45feb2fafa3d42fc1_cgraph">
<area shape="rect" id="node2" href="router_8c.html#a8522dfca1851365846ddef293a416656" title="authdir_mode_handles\l_descs" alt="" coords="205,23,357,65"/>
<area shape="rect" id="node5" href="routerlist_8c.html#a9b25dd842df15283a342bb77cf5935a8" title="routers_have_same_or\l_addrs" alt="" coords="204,89,359,130"/>
<area shape="rect" id="node3" href="router_8c.html#a9bcde98c72c7ec1b15a6c0837c6bec26" title="authdir_mode_any_nonhidserv" alt="" coords="407,5,605,32"/>
<area shape="rect" id="node4" href="router_8c.html#aab8dc47aca12ebfdd7c4a01d7fc4290b" title="authdir_mode_any_main" alt="" coords="653,31,816,57"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a0c97fbc43a4398a45feb2fafa3d42fc1_icgraph.png" border="0" usemap="#dirserv_8c_a0c97fbc43a4398a45feb2fafa3d42fc1_icgraph" alt=""/></div>
<map name="dirserv_8c_a0c97fbc43a4398a45feb2fafa3d42fc1_icgraph" id="dirserv_8c_a0c97fbc43a4398a45feb2fafa3d42fc1_icgraph">
<area shape="rect" id="node2" href="networkstatus_8h.html#afcfacad25b94db6f21e0df2f7897a3cf" title="routers_update_status\l_from_consensus_networkstatus" alt="" coords="204,5,419,47"/>
<area shape="rect" id="node3" href="routerlist_8h.html#ae08c5697c58be20a7bb11b34ca9aba5e" title="router_load_routers\l_from_string" alt="" coords="467,5,600,47"/>
</map>
</div>

</div>
</div>
<a id="a87235a887afe2a5f796bd9a88b474909"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87235a887afe2a5f796bd9a88b474909">&#9670;&nbsp;</a></span>dirserv_single_reachability_test()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_single_reachability_test </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *&#160;</td>
          <td class="paramname"><em>router</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Helper function for <a class="el" href="dirserv_8c.html#aac91a65fca7d877c033a594a96203ad7">dirserv_test_reachability()</a>. Start a TLS connection to <b>router</b>, and annotate it with when we started the test. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a87235a887afe2a5f796bd9a88b474909_cgraph.png" border="0" usemap="#dirserv_8c_a87235a887afe2a5f796bd9a88b474909_cgraph" alt=""/></div>
<map name="dirserv_8c_a87235a887afe2a5f796bd9a88b474909_cgraph" id="dirserv_8c_a87235a887afe2a5f796bd9a88b474909_cgraph">
<area shape="rect" id="node2" href="nodelist_8c.html#a114f706e8f9039f1dce0137619807581" title="node_get_mutable_by_id" alt="" coords="257,5,424,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a87235a887afe2a5f796bd9a88b474909_icgraph.png" border="0" usemap="#dirserv_8c_a87235a887afe2a5f796bd9a88b474909_icgraph" alt=""/></div>
<map name="dirserv_8c_a87235a887afe2a5f796bd9a88b474909_icgraph" id="dirserv_8c_a87235a887afe2a5f796bd9a88b474909_icgraph">
<area shape="rect" id="node2" href="dirserv_8h.html#aac91a65fca7d877c033a594a96203ad7" title="dirserv_test_reachability" alt="" coords="257,5,420,32"/>
<area shape="rect" id="node3" href="routerlist_8h.html#ad0e00a6f0df9aace49976da496902957" title="routerlist_descriptors\l_added" alt="" coords="267,57,410,98"/>
</map>
</div>

</div>
</div>
<a id="aac91a65fca7d877c033a594a96203ad7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac91a65fca7d877c033a594a96203ad7">&#9670;&nbsp;</a></span>dirserv_test_reachability()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dirserv_test_reachability </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Auth dir server only: load balance such that we only try a few connections per call.</p>
<p>The load balancing is such that if we get called once every ten seconds, we will cycle through all the tests in REACHABILITY_TEST_CYCLE_PERIOD seconds (a bit over 20 minutes). </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_aac91a65fca7d877c033a594a96203ad7_cgraph.png" border="0" usemap="#dirserv_8c_aac91a65fca7d877c033a594a96203ad7_cgraph" alt=""/></div>
<map name="dirserv_8c_aac91a65fca7d877c033a594a96203ad7_cgraph" id="dirserv_8c_aac91a65fca7d877c033a594a96203ad7_cgraph">
<area shape="rect" id="node2" href="routerlist_8c.html#a9181bbed0ee6ff8088a7c53fc8c446f1" title="router_get_routerlist" alt="" coords="249,5,387,32"/>
<area shape="rect" id="node3" href="router_8c.html#aabab68011cc297e16ad83af25c521bf6" title="authdir_mode_bridge" alt="" coords="247,56,389,83"/>
<area shape="rect" id="node5" href="router_8c.html#adcfdecf66a4aa5e6d09a702784c8197f" title="router_is_me" alt="" coords="269,107,367,133"/>
<area shape="rect" id="node8" href="dirserv_8c.html#a87235a887afe2a5f796bd9a88b474909" title="dirserv_single_reachability_test" alt="" coords="216,157,420,184"/>
<area shape="rect" id="node4" href="router_8c.html#a2d62b1eeaa990670a04de8dfbb42ab8f" title="authdir_mode" alt="" coords="501,56,601,83"/>
<area shape="rect" id="node6" href="router_8c.html#abeb0f38915a46f77352900604075d82f" title="router_digest_is_me" alt="" coords="482,107,621,133"/>
<area shape="rect" id="node7" href="di__ops_8c.html#a473334ee93cca0aea10523321a444ea3" title="tor_memeq" alt="" coords="683,107,769,133"/>
<area shape="rect" id="node9" href="nodelist_8c.html#a114f706e8f9039f1dce0137619807581" title="node_get_mutable_by_id" alt="" coords="468,157,635,184"/>
</map>
</div>

</div>
</div>
<a id="abbb851f560879781b07f4b99762f45b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abbb851f560879781b07f4b99762f45b3">&#9670;&nbsp;</a></span>dirserv_would_reject_router()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dirserv_would_reject_router </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structrouterstatus__t.html">routerstatus_t</a> *&#160;</td>
          <td class="paramname"><em>rs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true if there is no point in downloading the router described by <b>rs</b> because this directory would reject it. </p>

</div>
</div>
<a id="a6c7009f040e0a812c40a6ae0fa6efd79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c7009f040e0a812c40a6ae0fa6efd79">&#9670;&nbsp;</a></span>list_server_status_v1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int list_server_status_v1 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>routers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>router_status_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>for_controller</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Based on the routerinfo_ts in <b>routers</b>, allocate the contents of a v1-style router-status line, and store it in *<b>router_status_out</b>. Return 0 on success, -1 on failure.</p>
<p>If for_controller is true, include the routers with very old descriptors. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a6c7009f040e0a812c40a6ae0fa6efd79_cgraph.png" border="0" usemap="#dirserv_8c_a6c7009f040e0a812c40a6ae0fa6efd79_cgraph" alt=""/></div>
<map name="dirserv_8c_a6c7009f040e0a812c40a6ae0fa6efd79_cgraph" id="dirserv_8c_a6c7009f040e0a812c40a6ae0fa6efd79_cgraph">
<area shape="rect" id="node2" href="router_8c.html#aea820da6141eaf03649558d4ec6d5872" title="authdir_mode_publishes\l_statuses" alt="" coords="200,49,363,90"/>
<area shape="rect" id="node7" href="dirserv_8c.html#ad1772dc2a4a12cc0eb181d1f52c5a54a" title="dirserv_set_router\l_is_running" alt="" coords="218,167,345,209"/>
<area shape="rect" id="node13" href="router_8c.html#a2f3a022f2ddb8fb15047fb91522000eb" title="router_get_verbose\l_nickname" alt="" coords="215,251,348,293"/>
<area shape="rect" id="node16" href="container_8c.html#accf59a8b7d39a4286ff99653b6878006" title="smartlist_add" alt="" coords="231,317,331,344"/>
<area shape="rect" id="node3" href="router_8c.html#aabab68011cc297e16ad83af25c521bf6" title="authdir_mode_bridge" alt="" coords="439,5,581,32"/>
<area shape="rect" id="node5" href="router_8c.html#a9bcde98c72c7ec1b15a6c0837c6bec26" title="authdir_mode_any_nonhidserv" alt="" coords="411,56,609,83"/>
<area shape="rect" id="node4" href="router_8c.html#a2d62b1eeaa990670a04de8dfbb42ab8f" title="authdir_mode" alt="" coords="689,5,789,32"/>
<area shape="rect" id="node6" href="router_8c.html#aab8dc47aca12ebfdd7c4a01d7fc4290b" title="authdir_mode_any_main" alt="" coords="657,56,820,83"/>
<area shape="rect" id="node8" href="nodelist_8c.html#a114f706e8f9039f1dce0137619807581" title="node_get_mutable_by_id" alt="" coords="427,107,593,133"/>
<area shape="rect" id="node9" href="router_8c.html#adcfdecf66a4aa5e6d09a702784c8197f" title="router_is_me" alt="" coords="461,157,559,184"/>
<area shape="rect" id="node12" href="address_8c.html#a6ecc12236743caf7527376436791c75e" title="tor_addr_is_null" alt="" coords="453,208,567,235"/>
<area shape="rect" id="node10" href="router_8c.html#abeb0f38915a46f77352900604075d82f" title="router_digest_is_me" alt="" coords="669,183,808,209"/>
<area shape="rect" id="node11" href="di__ops_8c.html#a473334ee93cca0aea10523321a444ea3" title="tor_memeq" alt="" coords="868,221,955,248"/>
<area shape="rect" id="node14" href="networkstatus_8c.html#af663020b40e6b122a43b26aa62ca4ed4" title="networkstatus_get_router\l_digest_by_nickname" alt="" coords="425,310,595,351"/>
<area shape="rect" id="node15" href="util__format_8c.html#a8b8940b2ef607928eb3dca4850567ea5" title="base16_encode" alt="" coords="453,376,567,403"/>
</map>
</div>

</div>
</div>
<a id="a9afa21451734581b626a94cb615375af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9afa21451734581b626a94cb615375af">&#9670;&nbsp;</a></span>measured_bw_line_apply()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC int measured_bw_line_apply </td>
          <td>(</td>
          <td class="paramtype">measured_bw_line_t *&#160;</td>
          <td class="paramname"><em>parsed_line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>routerstatuses</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Helper function to apply a parsed measurement line to a list of bandwidth statuses. Returns true if a line is found, false otherwise. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_a9afa21451734581b626a94cb615375af_cgraph.png" border="0" usemap="#dirserv_8c_a9afa21451734581b626a94cb615375af_cgraph" alt=""/></div>
<map name="dirserv_8c_a9afa21451734581b626a94cb615375af_cgraph" id="dirserv_8c_a9afa21451734581b626a94cb615375af_cgraph">
<area shape="rect" id="node2" href="container_8c.html#a6722b8c6ca501b524958b3cdac2bc70c" title="smartlist_bsearch" alt="" coords="241,5,366,32"/>
<area shape="rect" id="node4" href="networkstatus_8c.html#a208b46da9e333aa2712950089d0a2f54" title="compare_digest_to_vote\l_routerstatus_entry" alt="" coords="221,57,385,98"/>
<area shape="rect" id="node3" href="container_8c.html#af0f195f396d7f97e7f2f2367453da119" title="smartlist_bsearch_idx" alt="" coords="433,5,583,32"/>
<area shape="rect" id="node5" href="di__ops_8c.html#a47393c6ace65b9b2173d60ac6ae119aa" title="tor_memcmp" alt="" coords="459,64,557,91"/>
</map>
</div>

</div>
</div>
<a id="a4da6ee0ad98076b51a6009d1b4ea0833"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4da6ee0ad98076b51a6009d1b4ea0833">&#9670;&nbsp;</a></span>measured_bw_line_parse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC int measured_bw_line_parse </td>
          <td>(</td>
          <td class="paramtype">measured_bw_line_t *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>orig_line</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Helper function to parse out a line in the measured bandwidth file into a measured_bw_line_t output structure. Returns -1 on failure or 0 on success. </p>

</div>
</div>
<a id="a1f9b702470f577e3b47d852f664e7d2b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f9b702470f577e3b47d852f664e7d2b">&#9670;&nbsp;</a></span>new_cached_dir()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structcached__dir__t.html">cached_dir_t</a>* new_cached_dir </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>published</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate and return a new <a class="el" href="structcached__dir__t.html">cached_dir_t</a> containing the string <b>s</b>, published at <b>published</b>. </p>

</div>
</div>
<a id="afeb9db63e957f2889d2c0b8bc3311107"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afeb9db63e957f2889d2c0b8bc3311107">&#9670;&nbsp;</a></span>routerstatus_format_entry()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* routerstatus_format_entry </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structrouterstatus__t.html">routerstatus_t</a> *&#160;</td>
          <td class="paramname"><em>rs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>protocols</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="or_8h.html#a46368555a0446803c7acfd3b8230adef">routerstatus_format_type_t</a>&#160;</td>
          <td class="paramname"><em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structvote__routerstatus__t.html">vote_routerstatus_t</a> *&#160;</td>
          <td class="paramname"><em>vrs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Helper: write the router-status information in <b>rs</b> into a newly allocated character buffer. Use the same format as in network-status documents. If <b>version</b> is non-NULL, add a "v" line for the platform. Return 0 on success, -1 on failure.</p>
<p>The format argument has one of the following values: NS_V2 - Output an entry suitable for a V2 NS opinion document NS_V3_CONSENSUS - Output the first portion of a V3 NS consensus entry NS_V3_CONSENSUS_MICRODESC - Output the first portion of a V3 microdesc consensus entry. NS_V3_VOTE - Output a complete V3 NS vote. If <b>vrs</b> is present, it contains additional information for the vote. NS_CONTROL_PORT - Output a NS document for the control port </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_afeb9db63e957f2889d2c0b8bc3311107_icgraph.png" border="0" usemap="#dirserv_8c_afeb9db63e957f2889d2c0b8bc3311107_icgraph" alt=""/></div>
<map name="dirserv_8c_afeb9db63e957f2889d2c0b8bc3311107_icgraph" id="dirserv_8c_afeb9db63e957f2889d2c0b8bc3311107_icgraph">
<area shape="rect" id="node2" href="networkstatus_8h.html#a07b2840d2a72326847e2e68152402dcf" title="networkstatus_getinfo\l_helper_single" alt="" coords="188,5,339,47"/>
</map>
</div>

</div>
</div>
<a id="a441a08d3eefcfb08ff0c8ee680183490"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a441a08d3eefcfb08ff0c8ee680183490">&#9670;&nbsp;</a></span>set_routerstatus_from_routerinfo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_routerstatus_from_routerinfo </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrouterstatus__t.html">routerstatus_t</a> *&#160;</td>
          <td class="paramname"><em>rs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structnode__t.html">node_t</a> *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structrouterinfo__t.html">routerinfo_t</a> *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>listbadexits</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Extract status information from <b>ri</b> and from other authority functions and store it in <b>rs</b>&gt;.</p>
<p>We assume that ri-&gt;is_running has already been set, e.g. by dirserv_set_router_is_running(ri, now); </p>

</div>
</div>
<a id="ae4f82bd716ec94f012312bf508728269"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae4f82bd716ec94f012312bf508728269">&#9670;&nbsp;</a></span>validate_recommended_package_line()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int validate_recommended_package_line </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>line</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff <b>line</b> is a valid RecommendedPackages line. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dirserv_8c_ae4f82bd716ec94f012312bf508728269_icgraph.png" border="0" usemap="#dirserv_8c_ae4f82bd716ec94f012312bf508728269_icgraph" alt=""/></div>
<map name="dirserv_8c_ae4f82bd716ec94f012312bf508728269_icgraph" id="dirserv_8c_ae4f82bd716ec94f012312bf508728269_icgraph">
<area shape="rect" id="node2" href="dirvote_8c.html#ab876fd37d49b88c5ce095d93e458ff10" title="compute_consensus_package\l_lines" alt="" coords="209,5,408,47"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
