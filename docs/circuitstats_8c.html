<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tor: /home/user/_my/code/bwauth-related/tor/src/or/circuitstats.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tor
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97b64286d42c5ef1697cb5f17129db19.html">tor</a></li><li class="navelem"><a class="el" href="dir_3cb0ba3f4b82dbe34a1a06276e96bc8d.html">src</a></li><li class="navelem"><a class="el" href="dir_386635fabd7f6c74e9d9c7a8604514a0.html">or</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">circuitstats.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Maintains and analyzes statistics about circuit built times, so we can tell how long we may need to wait for a fast circuit to be constructed.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="or_8h_source.html">or.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="circuitbuild_8h_source.html">circuitbuild.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="circuitstats_8h_source.html">circuitstats.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="config_8h_source.html">config.h</a>&quot;</code><br />
<code>#include &quot;confparse.h&quot;</code><br />
<code>#include &quot;<a class="el" href="control_8h_source.html">control.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="main_8h_source.html">main.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="networkstatus_8h_source.html">networkstatus.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rendclient_8h_source.html">rendclient.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rendservice_8h_source.html">rendservice.h</a>&quot;</code><br />
<code>#include &quot;statefile.h&quot;</code><br />
<code>#include &lt;math.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for circuitstats.c:</div>
<div class="dyncontent">
<div class="center"><img src="circuitstats_8c__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2circuitstats_8c" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2circuitstats_8c" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2circuitstats_8c">
<area shape="rect" id="node2" href="or_8h.html" title="Master header file for Tor&#45;specific functionality. " alt="" coords="1386,259,1430,285"/>
<area shape="rect" id="node34" href="circuitbuild_8h.html" title="Header file for circuitbuild.c. " alt="" coords="1409,109,1503,136"/>
<area shape="rect" id="node35" href="circuitstats_8h.html" title="Header file for circuitstats.c. " alt="" coords="1527,109,1625,136"/>
<area shape="rect" id="node36" href="config_8h.html" title="Header file for config.c. " alt="" coords="690,184,758,211"/>
<area shape="rect" id="node37" href="confparse_8h_source.html" title="confparse.h" alt="" coords="1649,109,1740,136"/>
<area shape="rect" id="node38" href="control_8h.html" title="Header file for control.c. " alt="" coords="1764,109,1836,136"/>
<area shape="rect" id="node39" href="main_8h.html" title="Header file for main.c. " alt="" coords="1860,109,1921,136"/>
<area shape="rect" id="node40" href="networkstatus_8h.html" title="Header file for networkstatus.c. " alt="" coords="5,408,120,435"/>
<area shape="rect" id="node41" href="rendclient_8h.html" title="Header file for rendclient.c. " alt="" coords="1193,109,1282,136"/>
<area shape="rect" id="node44" href="rendservice_8h.html" title="Header file for rendservice.c. " alt="" coords="1358,184,1458,211"/>
<area shape="rect" id="node45" href="statefile_8h_source.html" title="statefile.h" alt="" coords="1946,109,2025,136"/>
<area shape="rect" id="node3" href="orconfig_8h_source.html" title="orconfig.h" alt="" coords="1457,856,1535,883"/>
<area shape="rect" id="node4" href="torint_8h.html" title="Header file to define uint32_t and friends. " alt="" coords="1726,781,1789,808"/>
<area shape="rect" id="node5" href="crypto_8h.html" title="Headers for crypto.c. " alt="" coords="565,557,635,584"/>
<area shape="rect" id="node13" href="crypto__format_8h_source.html" title="crypto_format.h" alt="" coords="1562,557,1675,584"/>
<area shape="rect" id="node14" href="crypto__ed25519_8h_source.html" title="crypto_ed25519.h" alt="" coords="1556,632,1681,659"/>
<area shape="rect" id="node15" href="crypto__curve25519_8h_source.html" title="crypto_curve25519.h" alt="" coords="1534,707,1677,733"/>
<area shape="rect" id="node16" href="tortls_8h.html" title="Headers for tortls.c. " alt="" coords="569,483,631,509"/>
<area shape="rect" id="node19" href="torlog_8h.html" title="Headers for log.c. " alt="" coords="421,557,486,584"/>
<area shape="rect" id="node20" href="container_8h_source.html" title="container.h" alt="" coords="1494,408,1581,435"/>
<area shape="rect" id="node26" href="torgzip_8h.html" title="Headers for torgzip.h. " alt="" coords="1132,333,1204,360"/>
<area shape="rect" id="node27" href="address_8h.html" title="Headers for address.h. " alt="" coords="1918,333,1997,360"/>
<area shape="rect" id="node28" href="compat__libevent_8h_source.html" title="compat_libevent.h" alt="" coords="17,707,145,733"/>
<area shape="rect" id="node30" href="ht_8h_source.html" title="ht.h" alt="" coords="1229,333,1273,360"/>
<area shape="rect" id="node31" href="replaycache_8h.html" title="Header file for replaycache.c. " alt="" coords="1297,333,1399,360"/>
<area shape="rect" id="node32" href="tor__queue_8h_source.html" title="tor_queue.h" alt="" coords="1424,333,1515,360"/>
<area shape="rect" id="node33" href="util__format_8h_source.html" title="util_format.h" alt="" coords="1753,707,1847,733"/>
<area shape="rect" id="node7" href="testsupport_8h_source.html" title="testsupport.h" alt="" coords="640,781,739,808"/>
<area shape="rect" id="node8" href="compat_8h_source.html" title="compat.h" alt="" coords="965,632,1041,659"/>
<area shape="rect" id="node10" href="compat__time_8h.html" title="Functions and types for monotonic times. " alt="" coords="1321,781,1429,808"/>
<area shape="rect" id="node12" href="compat__threads_8h_source.html" title="compat_threads.h" alt="" coords="1179,707,1306,733"/>
<area shape="rect" id="node17" href="compat__openssl_8h.html" title="compatability definitions for working with different openssl forks " alt="" coords="259,557,387,584"/>
<area shape="rect" id="node21" href="util_8h.html" title="Headers for util.c. " alt="" coords="1397,483,1448,509"/>
<area shape="rect" id="node25" href="siphash_8h_source.html" title="siphash.h" alt="" coords="1498,483,1577,509"/>
<area shape="rect" id="node22" href="di__ops_8h.html" title="Headers for di_ops.c. " alt="" coords="1974,707,2045,733"/>
<area shape="rect" id="node24" href="util__bug_8h.html" title="util_bug.h" alt="" coords="1217,557,1295,584"/>
<area shape="rect" id="node42" href="rendcache_8h.html" title="Header file for rendcache.c. " alt="" coords="1189,184,1283,211"/>
<area shape="rect" id="node43" href="rendcommon_8h.html" title="Header file for rendcommon.c. " alt="" coords="1182,259,1290,285"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a5fb67ba6291e6078a564793b13d63aff"><td class="memItemLeft" align="right" valign="top"><a id="a5fb67ba6291e6078a564793b13d63aff"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CIRCUITSTATS_PRIVATE</b></td></tr>
<tr class="separator:a5fb67ba6291e6078a564793b13d63aff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fa2618ec5e970d8f8a257bcb0b74931"><td class="memItemLeft" align="right" valign="top"><a id="a1fa2618ec5e970d8f8a257bcb0b74931"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CBT_BIN_TO_MS</b>(bin)&#160;&#160;&#160;((bin)*<a class="el" href="or_8h.html#a19e75aed2cecd8ec695f106d271fe7ed">CBT_BIN_WIDTH</a> + (<a class="el" href="or_8h.html#a19e75aed2cecd8ec695f106d271fe7ed">CBT_BIN_WIDTH</a>/2))</td></tr>
<tr class="separator:a1fa2618ec5e970d8f8a257bcb0b74931"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a052a33c9ef80be5d4f9fd68ef219ed40"><td class="memItemLeft" align="right" valign="top"><a id="a052a33c9ef80be5d4f9fd68ef219ed40"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>unit_tests</b>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a052a33c9ef80be5d4f9fd68ef219ed40"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2739bdae9cc278e246bfb4146e64ceae"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#a2739bdae9cc278e246bfb4146e64ceae">CIRCUIT_TIMEOUT_BEFORE_RECHECK_IP</a>&#160;&#160;&#160;(60*3)</td></tr>
<tr class="separator:a2739bdae9cc278e246bfb4146e64ceae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85fda3522e69a1bf85f7dcd97b6023a1"><td class="memItemLeft" align="right" valign="top"><a id="a85fda3522e69a1bf85f7dcd97b6023a1"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MAX_TIMEOUT</b>&#160;&#160;&#160;((int32_t) (INT32_MAX/2))</td></tr>
<tr class="separator:a85fda3522e69a1bf85f7dcd97b6023a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a60132df70f749a68de14d2993d593787"><td class="memItemLeft" align="right" valign="top">const circuit_build_times_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#a60132df70f749a68de14d2993d593787">get_circuit_build_times</a> (void)</td></tr>
<tr class="separator:a60132df70f749a68de14d2993d593787"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6607aa51a9503278d8f893f8092aabc"><td class="memItemLeft" align="right" valign="top">circuit_build_times_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#ab6607aa51a9503278d8f893f8092aabc">get_circuit_build_times_mutable</a> (void)</td></tr>
<tr class="separator:ab6607aa51a9503278d8f893f8092aabc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a612d7d345a4328b8dd4d1079fb0bc9b2"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#a612d7d345a4328b8dd4d1079fb0bc9b2">get_circuit_build_close_time_ms</a> (void)</td></tr>
<tr class="separator:a612d7d345a4328b8dd4d1079fb0bc9b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a33097eebbc8865c466107e5588f357ec"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#a33097eebbc8865c466107e5588f357ec">get_circuit_build_timeout_ms</a> (void)</td></tr>
<tr class="separator:a33097eebbc8865c466107e5588f357ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab883ccb58a956f9f308b80249cee790d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#ab883ccb58a956f9f308b80249cee790d">circuit_build_times_disabled</a> (void)</td></tr>
<tr class="separator:ab883ccb58a956f9f308b80249cee790d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3e86bd1570419757d3e1cdc577395a3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#aa3e86bd1570419757d3e1cdc577395a3">circuit_build_times_enough_to_compute</a> (const circuit_build_times_t *cbt)</td></tr>
<tr class="separator:aa3e86bd1570419757d3e1cdc577395a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abacdfcf8553c8ea4d5a8f1d7a813b452"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#abacdfcf8553c8ea4d5a8f1d7a813b452">circuit_build_times_quantile_cutoff</a> (void)</td></tr>
<tr class="separator:abacdfcf8553c8ea4d5a8f1d7a813b452"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87ed860e6a61b5983e93e1f6ce6509f2"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#a87ed860e6a61b5983e93e1f6ce6509f2">circuit_build_times_initial_timeout</a> (void)</td></tr>
<tr class="separator:a87ed860e6a61b5983e93e1f6ce6509f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbfb286d45e72331adbc9eea6f92a30a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#afbfb286d45e72331adbc9eea6f92a30a">circuit_build_times_new_consensus_params</a> (circuit_build_times_t *cbt, <a class="el" href="structnetworkstatus__t.html">networkstatus_t</a> *ns)</td></tr>
<tr class="separator:afbfb286d45e72331adbc9eea6f92a30a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab559ba41c624c4355722fff87716b322"><td class="memItemLeft" align="right" valign="top">STATIC void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#ab559ba41c624c4355722fff87716b322">circuit_build_times_reset</a> (circuit_build_times_t *cbt)</td></tr>
<tr class="separator:ab559ba41c624c4355722fff87716b322"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a783722d9622ae552e3f3d117163dd67a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#a783722d9622ae552e3f3d117163dd67a">circuit_build_times_init</a> (circuit_build_times_t *cbt)</td></tr>
<tr class="separator:a783722d9622ae552e3f3d117163dd67a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12b65f2272f5751108d7eaa1554ab830"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#a12b65f2272f5751108d7eaa1554ab830">circuit_build_times_free_timeouts</a> (circuit_build_times_t *cbt)</td></tr>
<tr class="separator:a12b65f2272f5751108d7eaa1554ab830"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade5765738bf2517d207fc123305b54e0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#ade5765738bf2517d207fc123305b54e0">circuit_build_times_add_time</a> (circuit_build_times_t *cbt, <a class="el" href="or_8h.html#a45411da7d117ffaaf83b8fe4d4274bb8">build_time_t</a> btime)</td></tr>
<tr class="separator:ade5765738bf2517d207fc123305b54e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cd11af3008cdeec3065dee7bed4cc88"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#a6cd11af3008cdeec3065dee7bed4cc88">circuit_build_times_update_state</a> (const circuit_build_times_t *cbt, <a class="el" href="structor__state__t.html">or_state_t</a> *state)</td></tr>
<tr class="separator:a6cd11af3008cdeec3065dee7bed4cc88"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3698f5cf00759e40798b2dcb4097976c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#a3698f5cf00759e40798b2dcb4097976c">circuit_build_times_parse_state</a> (circuit_build_times_t *cbt, <a class="el" href="structor__state__t.html">or_state_t</a> *state)</td></tr>
<tr class="separator:a3698f5cf00759e40798b2dcb4097976c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ec8917956d8e6979387268481bbee3f"><td class="memItemLeft" align="right" valign="top">STATIC int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#a9ec8917956d8e6979387268481bbee3f">circuit_build_times_update_alpha</a> (circuit_build_times_t *cbt)</td></tr>
<tr class="separator:a9ec8917956d8e6979387268481bbee3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a341fbd9cebffb2dae555f32e719bc27b"><td class="memItemLeft" align="right" valign="top">STATIC double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#a341fbd9cebffb2dae555f32e719bc27b">circuit_build_times_calculate_timeout</a> (circuit_build_times_t *cbt, double quantile)</td></tr>
<tr class="separator:a341fbd9cebffb2dae555f32e719bc27b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af926b84dc328f71fcccdaa4df5e418b5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#af926b84dc328f71fcccdaa4df5e418b5">circuit_build_times_needs_circuits</a> (const circuit_build_times_t *cbt)</td></tr>
<tr class="separator:af926b84dc328f71fcccdaa4df5e418b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a078e35bc3a938238e3eac4eb29a076ce"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#a078e35bc3a938238e3eac4eb29a076ce">circuit_build_times_needs_circuits_now</a> (const circuit_build_times_t *cbt)</td></tr>
<tr class="separator:a078e35bc3a938238e3eac4eb29a076ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b95a37e26723de09e38d46549c9fba0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#a2b95a37e26723de09e38d46549c9fba0">circuit_build_times_network_is_live</a> (circuit_build_times_t *cbt)</td></tr>
<tr class="separator:a2b95a37e26723de09e38d46549c9fba0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c61cd815e5afe00297676109450aa6d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#a9c61cd815e5afe00297676109450aa6d">circuit_build_times_network_circ_success</a> (circuit_build_times_t *cbt)</td></tr>
<tr class="separator:a9c61cd815e5afe00297676109450aa6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c0ef1a1c2f4ee597394a8dc694e8e21"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#a3c0ef1a1c2f4ee597394a8dc694e8e21">circuit_build_times_network_check_live</a> (const circuit_build_times_t *cbt)</td></tr>
<tr class="separator:a3c0ef1a1c2f4ee597394a8dc694e8e21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4769116ba3c739de9deb558fb39470b7"><td class="memItemLeft" align="right" valign="top">STATIC int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#a4769116ba3c739de9deb558fb39470b7">circuit_build_times_network_check_changed</a> (circuit_build_times_t *cbt)</td></tr>
<tr class="separator:a4769116ba3c739de9deb558fb39470b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a685329d97770111282850e80b499d864"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#a685329d97770111282850e80b499d864">circuit_build_times_timeout_rate</a> (const circuit_build_times_t *cbt)</td></tr>
<tr class="separator:a685329d97770111282850e80b499d864"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af87293fa8cf6ca85a97c8d9202bda698"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#af87293fa8cf6ca85a97c8d9202bda698">circuit_build_times_close_rate</a> (const circuit_build_times_t *cbt)</td></tr>
<tr class="separator:af87293fa8cf6ca85a97c8d9202bda698"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae7a1d37f778a6e4e25443ec8a9b2c45"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#aae7a1d37f778a6e4e25443ec8a9b2c45">circuit_build_times_count_close</a> (circuit_build_times_t *cbt, int did_onehop, time_t start_time)</td></tr>
<tr class="separator:aae7a1d37f778a6e4e25443ec8a9b2c45"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b7fc99dce125bfe7037769c7f300ed1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#a5b7fc99dce125bfe7037769c7f300ed1">circuit_build_times_count_timeout</a> (circuit_build_times_t *cbt, int did_onehop)</td></tr>
<tr class="separator:a5b7fc99dce125bfe7037769c7f300ed1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a321ec5d0efe5196955be8140397bba91"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuitstats_8c.html#a321ec5d0efe5196955be8140397bba91">circuit_build_times_set_timeout</a> (circuit_build_times_t *cbt)</td></tr>
<tr class="separator:a321ec5d0efe5196955be8140397bba91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aedc5c23b75049ef442f574713c61bc7d"><td class="memItemLeft" align="right" valign="top"><a id="aedc5c23b75049ef442f574713c61bc7d"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>circuit_build_times_update_last_circ</b> (circuit_build_times_t *cbt)</td></tr>
<tr class="separator:aedc5c23b75049ef442f574713c61bc7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Maintains and analyzes statistics about circuit built times, so we can tell how long we may need to wait for a fast circuit to be constructed. </p>
<p>By keeping these statistics, a client learns when it should time out a slow circuit for being too slow, and when it should keep a circuit open in order to wait for it to complete.</p>
<p>The information here is kept in a circuit_built_times_t structure, which is currently a singleton, but doesn't need to be. It's updated by calls to <a class="el" href="circuitstats_8c.html#a5b7fc99dce125bfe7037769c7f300ed1">circuit_build_times_count_timeout()</a> from <a class="el" href="circuituse_8c.html" title="Launch the right sort of circuits and attach streams to them. ">circuituse.c</a>, <a class="el" href="circuitstats_8c.html#aae7a1d37f778a6e4e25443ec8a9b2c45">circuit_build_times_count_close()</a> from <a class="el" href="circuituse_8c.html" title="Launch the right sort of circuits and attach streams to them. ">circuituse.c</a>, and <a class="el" href="circuitstats_8c.html#ade5765738bf2517d207fc123305b54e0">circuit_build_times_add_time()</a> from <a class="el" href="circuitbuild_8c.html" title="Implements the details of building circuits (by chosing paths, constructing/sending create/extend cel...">circuitbuild.c</a>, and inspected by other calls into this module, mostly from <a class="el" href="circuitlist_8c.html" title="Manage the global circuit list, and looking up circuits within it. ">circuitlist.c</a>. Observations are persisted to disk via the or_state_t-related calls. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a2739bdae9cc278e246bfb4146e64ceae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2739bdae9cc278e246bfb4146e64ceae">&#9670;&nbsp;</a></span>CIRCUIT_TIMEOUT_BEFORE_RECHECK_IP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CIRCUIT_TIMEOUT_BEFORE_RECHECK_IP&#160;&#160;&#160;(60*3)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>How long should we be unreachable before we think we need to check if our published IP address has changed. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ade5765738bf2517d207fc123305b54e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade5765738bf2517d207fc123305b54e0">&#9670;&nbsp;</a></span>circuit_build_times_add_time()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int circuit_build_times_add_time </td>
          <td>(</td>
          <td class="paramtype">circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="or_8h.html#a45411da7d117ffaaf83b8fe4d4274bb8">build_time_t</a>&#160;</td>
          <td class="paramname"><em>btime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add a new build time value <b>time</b> to the set of build times. Time units are milliseconds.</p>
<p>circuit_build_times <b>cbt</b> is a circular array, so loop around when array is full. </p>

</div>
</div>
<a id="a341fbd9cebffb2dae555f32e719bc27b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a341fbd9cebffb2dae555f32e719bc27b">&#9670;&nbsp;</a></span>circuit_build_times_calculate_timeout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC double circuit_build_times_calculate_timeout </td>
          <td>(</td>
          <td class="paramtype">circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>quantile</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This is the Pareto Quantile Function. It calculates the point x in the distribution such that F(x) = quantile (ie quantile*100% of the mass of the density function is below x on the curve).</p>
<p>We use it to calculate the timeout and also to generate synthetic values of time for circuits that timeout before completion.</p>
<p>See <a href="http://en.wikipedia.org/wiki/Quantile_function,">http://en.wikipedia.org/wiki/Quantile_function,</a> <a href="http://en.wikipedia.org/wiki/Inverse_transform_sampling">http://en.wikipedia.org/wiki/Inverse_transform_sampling</a> and <a href="http://en.wikipedia.org/wiki/Pareto_distribution#Generating_a_">http://en.wikipedia.org/wiki/Pareto_distribution#Generating_a_</a> random_sample_from_Pareto_distribution That's right. I'll cite wikipedia all day long.</p>
<p>Return value is in milliseconds, clamped to INT32_MAX. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuitstats_8c_a341fbd9cebffb2dae555f32e719bc27b_cgraph.png" border="0" usemap="#circuitstats_8c_a341fbd9cebffb2dae555f32e719bc27b_cgraph" alt=""/></div>
<map name="circuitstats_8c_a341fbd9cebffb2dae555f32e719bc27b_cgraph" id="circuitstats_8c_a341fbd9cebffb2dae555f32e719bc27b_cgraph">
<area shape="rect" id="node2" href="crypto_8c.html#aba9d90b89a922bffd44210a996daf38e" title="crypto_rand_double" alt="" coords="184,5,319,32"/>
<area shape="rect" id="node3" href="util_8c.html#a44cb339836df0bbfcf8416209976f6db" title="tor_lround" alt="" coords="212,56,291,83"/>
<area shape="rect" id="node4" href="util_8c.html#a439eb5ebebe45181a077082b5f5ec598" title="tor_mathlog" alt="" coords="206,107,297,133"/>
</map>
</div>

</div>
</div>
<a id="af87293fa8cf6ca85a97c8d9202bda698"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af87293fa8cf6ca85a97c8d9202bda698">&#9670;&nbsp;</a></span>circuit_build_times_close_rate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double circuit_build_times_close_rate </td>
          <td>(</td>
          <td class="paramtype">const circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Count the number of closed circuits in a set of cbt data. </p>

</div>
</div>
<a id="aae7a1d37f778a6e4e25443ec8a9b2c45"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae7a1d37f778a6e4e25443ec8a9b2c45">&#9670;&nbsp;</a></span>circuit_build_times_count_close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int circuit_build_times_count_close </td>
          <td>(</td>
          <td class="paramtype">circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>did_onehop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>start_time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Store a timeout as a synthetic value.</p>
<p>Returns true if the store was successful and we should possibly update our timeout estimate. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuitstats_8c_aae7a1d37f778a6e4e25443ec8a9b2c45_cgraph.png" border="0" usemap="#circuitstats_8c_aae7a1d37f778a6e4e25443ec8a9b2c45_cgraph" alt=""/></div>
<map name="circuitstats_8c_aae7a1d37f778a6e4e25443ec8a9b2c45_cgraph" id="circuitstats_8c_aae7a1d37f778a6e4e25443ec8a9b2c45_cgraph">
<area shape="rect" id="node2" href="circuitstats_8c.html#ab883ccb58a956f9f308b80249cee790d" title="circuit_build_times\l_disabled" alt="" coords="184,5,315,47"/>
</map>
</div>

</div>
</div>
<a id="a5b7fc99dce125bfe7037769c7f300ed1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5b7fc99dce125bfe7037769c7f300ed1">&#9670;&nbsp;</a></span>circuit_build_times_count_timeout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_build_times_count_timeout </td>
          <td>(</td>
          <td class="paramtype">circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>did_onehop</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Update timeout counts to determine if we need to expire our build time history due to excessive timeouts.</p>
<p>We do not record any actual time values at this stage; we are only interested in recording the fact that a timeout happened. We record the time values via <a class="el" href="circuitstats_8c.html#aae7a1d37f778a6e4e25443ec8a9b2c45">circuit_build_times_count_close()</a> and <a class="el" href="circuitstats_8c.html#ade5765738bf2517d207fc123305b54e0">circuit_build_times_add_time()</a>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuitstats_8c_a5b7fc99dce125bfe7037769c7f300ed1_cgraph.png" border="0" usemap="#circuitstats_8c_a5b7fc99dce125bfe7037769c7f300ed1_cgraph" alt=""/></div>
<map name="circuitstats_8c_a5b7fc99dce125bfe7037769c7f300ed1_cgraph" id="circuitstats_8c_a5b7fc99dce125bfe7037769c7f300ed1_cgraph">
<area shape="rect" id="node2" href="circuitstats_8c.html#ab883ccb58a956f9f308b80249cee790d" title="circuit_build_times\l_disabled" alt="" coords="184,5,315,47"/>
</map>
</div>

</div>
</div>
<a id="ab883ccb58a956f9f308b80249cee790d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab883ccb58a956f9f308b80249cee790d">&#9670;&nbsp;</a></span>circuit_build_times_disabled()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int circuit_build_times_disabled </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function decides if CBT learning should be disabled. It returns true if one or more of the following conditions are met:</p>
<ol type="1">
<li>If the cbtdisabled consensus parameter is set.</li>
<li>If the torrc option LearnCircuitBuildTimeout is false.</li>
<li>If we are a directory authority</li>
<li>If we fail to write circuit build time history to our state file.</li>
<li>If we are compiled or configured in Tor2web mode</li>
<li>If we are configured in Single Onion mode </li>
</ol>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuitstats_8c_ab883ccb58a956f9f308b80249cee790d_icgraph.png" border="0" usemap="#circuitstats_8c_ab883ccb58a956f9f308b80249cee790d_icgraph" alt=""/></div>
<map name="circuitstats_8c_ab883ccb58a956f9f308b80249cee790d_icgraph" id="circuitstats_8c_ab883ccb58a956f9f308b80249cee790d_icgraph">
<area shape="rect" id="node2" href="circuitstats_8h.html#afbfb286d45e72331adbc9eea6f92a30a" title="circuit_build_times\l_new_consensus_params" alt="" coords="184,5,357,47"/>
<area shape="rect" id="node3" href="circuitstats_8h.html#a783722d9622ae552e3f3d117163dd67a" title="circuit_build_times_init" alt="" coords="193,71,348,98"/>
<area shape="rect" id="node4" href="circuitstats_8h.html#a3698f5cf00759e40798b2dcb4097976c" title="circuit_build_times\l_parse_state" alt="" coords="405,89,536,131"/>
<area shape="rect" id="node5" href="circuitstats_8h.html#aae7a1d37f778a6e4e25443ec8a9b2c45" title="circuit_build_times\l_count_close" alt="" coords="205,173,336,215"/>
<area shape="rect" id="node6" href="circuitstats_8h.html#a5b7fc99dce125bfe7037769c7f300ed1" title="circuit_build_times\l_count_timeout" alt="" coords="205,239,336,280"/>
<area shape="rect" id="node7" href="circuitstats_8h.html#a321ec5d0efe5196955be8140397bba91" title="circuit_build_times\l_set_timeout" alt="" coords="205,304,336,345"/>
</map>
</div>

</div>
</div>
<a id="aa3e86bd1570419757d3e1cdc577395a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3e86bd1570419757d3e1cdc577395a3">&#9670;&nbsp;</a></span>circuit_build_times_enough_to_compute()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int circuit_build_times_enough_to_compute </td>
          <td>(</td>
          <td class="paramtype">const circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff <b>cbt</b> has recorded enough build times that we want to start acting on the timeout it implies. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuitstats_8c_aa3e86bd1570419757d3e1cdc577395a3_icgraph.png" border="0" usemap="#circuitstats_8c_aa3e86bd1570419757d3e1cdc577395a3_icgraph" alt=""/></div>
<map name="circuitstats_8c_aa3e86bd1570419757d3e1cdc577395a3_icgraph" id="circuitstats_8c_aa3e86bd1570419757d3e1cdc577395a3_icgraph">
<area shape="rect" id="node2" href="circuitstats_8h.html#af926b84dc328f71fcccdaa4df5e418b5" title="circuit_build_times\l_needs_circuits" alt="" coords="200,5,331,47"/>
<area shape="rect" id="node3" href="circuitstats_8h.html#a078e35bc3a938238e3eac4eb29a076ce" title="circuit_build_times\l_needs_circuits_now" alt="" coords="379,5,523,47"/>
</map>
</div>

</div>
</div>
<a id="a12b65f2272f5751108d7eaa1554ab830"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12b65f2272f5751108d7eaa1554ab830">&#9670;&nbsp;</a></span>circuit_build_times_free_timeouts()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_build_times_free_timeouts </td>
          <td>(</td>
          <td class="paramtype">circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Free the saved timeouts, if the cbtdisabled consensus parameter got turned on or something. </p>

</div>
</div>
<a id="a783722d9622ae552e3f3d117163dd67a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a783722d9622ae552e3f3d117163dd67a">&#9670;&nbsp;</a></span>circuit_build_times_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_build_times_init </td>
          <td>(</td>
          <td class="paramtype">circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize the buildtimes structure for first use.</p>
<p>Sets the initial timeout values based on either the config setting, the consensus param, or the default (CBT_DEFAULT_TIMEOUT_INITIAL_VALUE). </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuitstats_8c_a783722d9622ae552e3f3d117163dd67a_cgraph.png" border="0" usemap="#circuitstats_8c_a783722d9622ae552e3f3d117163dd67a_cgraph" alt=""/></div>
<map name="circuitstats_8c_a783722d9622ae552e3f3d117163dd67a_cgraph" id="circuitstats_8c_a783722d9622ae552e3f3d117163dd67a_cgraph">
<area shape="rect" id="node2" href="circuitstats_8c.html#ab883ccb58a956f9f308b80249cee790d" title="circuit_build_times\l_disabled" alt="" coords="208,5,339,47"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuitstats_8c_a783722d9622ae552e3f3d117163dd67a_icgraph.png" border="0" usemap="#circuitstats_8c_a783722d9622ae552e3f3d117163dd67a_icgraph" alt=""/></div>
<map name="circuitstats_8c_a783722d9622ae552e3f3d117163dd67a_icgraph" id="circuitstats_8c_a783722d9622ae552e3f3d117163dd67a_icgraph">
<area shape="rect" id="node2" href="circuitstats_8h.html#a3698f5cf00759e40798b2dcb4097976c" title="circuit_build_times\l_parse_state" alt="" coords="208,5,339,47"/>
</map>
</div>

</div>
</div>
<a id="a87ed860e6a61b5983e93e1f6ce6509f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87ed860e6a61b5983e93e1f6ce6509f2">&#9670;&nbsp;</a></span>circuit_build_times_initial_timeout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t circuit_build_times_initial_timeout </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Retrieve and bounds-check the cbtinitialtimeout consensus paramter.</p>
<p>Effect: This is the timeout value to use before computing a timeout, in milliseconds. </p>

</div>
</div>
<a id="af926b84dc328f71fcccdaa4df5e418b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af926b84dc328f71fcccdaa4df5e418b5">&#9670;&nbsp;</a></span>circuit_build_times_needs_circuits()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int circuit_build_times_needs_circuits </td>
          <td>(</td>
          <td class="paramtype">const circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns true if we need circuits to be built </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuitstats_8c_af926b84dc328f71fcccdaa4df5e418b5_cgraph.png" border="0" usemap="#circuitstats_8c_af926b84dc328f71fcccdaa4df5e418b5_cgraph" alt=""/></div>
<map name="circuitstats_8c_af926b84dc328f71fcccdaa4df5e418b5_cgraph" id="circuitstats_8c_af926b84dc328f71fcccdaa4df5e418b5_cgraph">
<area shape="rect" id="node2" href="circuitstats_8c.html#aa3e86bd1570419757d3e1cdc577395a3" title="circuit_build_times\l_enough_to_compute" alt="" coords="184,5,331,47"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuitstats_8c_af926b84dc328f71fcccdaa4df5e418b5_icgraph.png" border="0" usemap="#circuitstats_8c_af926b84dc328f71fcccdaa4df5e418b5_icgraph" alt=""/></div>
<map name="circuitstats_8c_af926b84dc328f71fcccdaa4df5e418b5_icgraph" id="circuitstats_8c_af926b84dc328f71fcccdaa4df5e418b5_icgraph">
<area shape="rect" id="node2" href="circuitstats_8h.html#a078e35bc3a938238e3eac4eb29a076ce" title="circuit_build_times\l_needs_circuits_now" alt="" coords="184,5,328,47"/>
</map>
</div>

</div>
</div>
<a id="a078e35bc3a938238e3eac4eb29a076ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a078e35bc3a938238e3eac4eb29a076ce">&#9670;&nbsp;</a></span>circuit_build_times_needs_circuits_now()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int circuit_build_times_needs_circuits_now </td>
          <td>(</td>
          <td class="paramtype">const circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns true if we should build a timeout test circuit right now. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuitstats_8c_a078e35bc3a938238e3eac4eb29a076ce_cgraph.png" border="0" usemap="#circuitstats_8c_a078e35bc3a938238e3eac4eb29a076ce_cgraph" alt=""/></div>
<map name="circuitstats_8c_a078e35bc3a938238e3eac4eb29a076ce_cgraph" id="circuitstats_8c_a078e35bc3a938238e3eac4eb29a076ce_cgraph">
<area shape="rect" id="node2" href="circuitstats_8c.html#af926b84dc328f71fcccdaa4df5e418b5" title="circuit_build_times\l_needs_circuits" alt="" coords="197,5,328,47"/>
<area shape="rect" id="node4" href="util_8c.html#aca03d8cb6a22d540b13b92ea5945df33" title="approx_time" alt="" coords="216,71,309,98"/>
<area shape="rect" id="node3" href="circuitstats_8c.html#aa3e86bd1570419757d3e1cdc577395a3" title="circuit_build_times\l_enough_to_compute" alt="" coords="376,5,523,47"/>
</map>
</div>

</div>
</div>
<a id="a4769116ba3c739de9deb558fb39470b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4769116ba3c739de9deb558fb39470b7">&#9670;&nbsp;</a></span>circuit_build_times_network_check_changed()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC int circuit_build_times_network_check_changed </td>
          <td>(</td>
          <td class="paramtype">circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns true if we have seen more than MAX_RECENT_TIMEOUT_COUNT of the past RECENT_CIRCUITS time out after the first hop. Used to detect if the network connection has changed significantly, and if so, resets our circuit build timeout to the default.</p>
<p>Also resets the entire timeout history in this case and causes us to restart the process of building test circuits and estimating a new timeout. </p>

</div>
</div>
<a id="a3c0ef1a1c2f4ee597394a8dc694e8e21"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c0ef1a1c2f4ee597394a8dc694e8e21">&#9670;&nbsp;</a></span>circuit_build_times_network_check_live()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int circuit_build_times_network_check_live </td>
          <td>(</td>
          <td class="paramtype">const circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>When the network is not live, we do not record circuit build times.</p>
<p>The network is considered not live if there has been at least one circuit build that began and ended (had its close_ms measurement period expire) since we last received a cell.</p>
<p>Also has the side effect of rewinding the circuit time history in the case of recent liveness changes. </p>

</div>
</div>
<a id="a9c61cd815e5afe00297676109450aa6d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c61cd815e5afe00297676109450aa6d">&#9670;&nbsp;</a></span>circuit_build_times_network_circ_success()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_build_times_network_circ_success </td>
          <td>(</td>
          <td class="paramtype">circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Called to indicate that we completed a circuit. Because this circuit succeeded, it doesn't count as a timeout-after-the-first-hop.</p>
<p>This is used by <a class="el" href="circuitstats_8c.html#a4769116ba3c739de9deb558fb39470b7">circuit_build_times_network_check_changed()</a> to determine if we had too many recent timeouts and need to reset our learned timeout to something higher. </p>

</div>
</div>
<a id="a2b95a37e26723de09e38d46549c9fba0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b95a37e26723de09e38d46549c9fba0">&#9670;&nbsp;</a></span>circuit_build_times_network_is_live()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_build_times_network_is_live </td>
          <td>(</td>
          <td class="paramtype">circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Called to indicate that the network showed some signs of liveness, i.e. we received a cell.</p>
<p>This is used by <a class="el" href="circuitstats_8c.html#a3c0ef1a1c2f4ee597394a8dc694e8e21">circuit_build_times_network_check_live()</a> to decide if we should record the circuit build timeout or not.</p>
<p>This function is called every time we receive a cell. Avoid syscalls, events, and other high-intensity work. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuitstats_8c_a2b95a37e26723de09e38d46549c9fba0_cgraph.png" border="0" usemap="#circuitstats_8c_a2b95a37e26723de09e38d46549c9fba0_cgraph" alt=""/></div>
<map name="circuitstats_8c_a2b95a37e26723de09e38d46549c9fba0_cgraph" id="circuitstats_8c_a2b95a37e26723de09e38d46549c9fba0_cgraph">
<area shape="rect" id="node2" href="util_8c.html#aca03d8cb6a22d540b13b92ea5945df33" title="approx_time" alt="" coords="184,13,277,39"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuitstats_8c_a2b95a37e26723de09e38d46549c9fba0_icgraph.png" border="0" usemap="#circuitstats_8c_a2b95a37e26723de09e38d46549c9fba0_icgraph" alt=""/></div>
<map name="circuitstats_8c_a2b95a37e26723de09e38d46549c9fba0_icgraph" id="circuitstats_8c_a2b95a37e26723de09e38d46549c9fba0_icgraph">
<area shape="rect" id="node2" href="channel_8c.html#a4bb9524073333e156da271ca623a772d" title="channel_do_open_actions" alt="" coords="184,13,356,39"/>
</map>
</div>

</div>
</div>
<a id="afbfb286d45e72331adbc9eea6f92a30a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afbfb286d45e72331adbc9eea6f92a30a">&#9670;&nbsp;</a></span>circuit_build_times_new_consensus_params()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_build_times_new_consensus_params </td>
          <td>(</td>
          <td class="paramtype">circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structnetworkstatus__t.html">networkstatus_t</a> *&#160;</td>
          <td class="paramname"><em>ns</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function is called when we get a consensus update.</p>
<p>It checks to see if we have changed any consensus parameters that require reallocation or discard of previous stats. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuitstats_8c_afbfb286d45e72331adbc9eea6f92a30a_cgraph.png" border="0" usemap="#circuitstats_8c_afbfb286d45e72331adbc9eea6f92a30a_cgraph" alt=""/></div>
<map name="circuitstats_8c_afbfb286d45e72331adbc9eea6f92a30a_cgraph" id="circuitstats_8c_afbfb286d45e72331adbc9eea6f92a30a_cgraph">
<area shape="rect" id="node2" href="circuitstats_8c.html#ab883ccb58a956f9f308b80249cee790d" title="circuit_build_times\l_disabled" alt="" coords="227,5,357,47"/>
</map>
</div>

</div>
</div>
<a id="a3698f5cf00759e40798b2dcb4097976c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3698f5cf00759e40798b2dcb4097976c">&#9670;&nbsp;</a></span>circuit_build_times_parse_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int circuit_build_times_parse_state </td>
          <td>(</td>
          <td class="paramtype">circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structor__state__t.html">or_state_t</a> *&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Load histogram from <b>state</b>, shuffling the resulting array after we do so. Use this result to estimate parameters and calculate the timeout.</p>
<p>Return -1 on error. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuitstats_8c_a3698f5cf00759e40798b2dcb4097976c_cgraph.png" border="0" usemap="#circuitstats_8c_a3698f5cf00759e40798b2dcb4097976c_cgraph" alt=""/></div>
<map name="circuitstats_8c_a3698f5cf00759e40798b2dcb4097976c_cgraph" id="circuitstats_8c_a3698f5cf00759e40798b2dcb4097976c_cgraph">
<area shape="rect" id="node2" href="circuitstats_8c.html#a783722d9622ae552e3f3d117163dd67a" title="circuit_build_times_init" alt="" coords="184,5,339,32"/>
<area shape="rect" id="node3" href="circuitstats_8c.html#ab883ccb58a956f9f308b80249cee790d" title="circuit_build_times\l_disabled" alt="" coords="387,23,517,65"/>
</map>
</div>

</div>
</div>
<a id="abacdfcf8553c8ea4d5a8f1d7a813b452"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abacdfcf8553c8ea4d5a8f1d7a813b452">&#9670;&nbsp;</a></span>circuit_build_times_quantile_cutoff()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double circuit_build_times_quantile_cutoff </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Retrieve and bounds-check the cbtquantile consensus paramter.</p>
<p>Effect: This is the position on the quantile curve to use to set the timeout value. It is a percent (10-99). </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuitstats_8c_abacdfcf8553c8ea4d5a8f1d7a813b452_cgraph.png" border="0" usemap="#circuitstats_8c_abacdfcf8553c8ea4d5a8f1d7a813b452_cgraph" alt=""/></div>
<map name="circuitstats_8c_abacdfcf8553c8ea4d5a8f1d7a813b452_cgraph" id="circuitstats_8c_abacdfcf8553c8ea4d5a8f1d7a813b452_cgraph">
<area shape="rect" id="node2" href="networkstatus_8c.html#aba1790be4b1cea243c3dac989ad1b05c" title="networkstatus_get_param" alt="" coords="184,13,356,39"/>
</map>
</div>

</div>
</div>
<a id="ab559ba41c624c4355722fff87716b322"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab559ba41c624c4355722fff87716b322">&#9670;&nbsp;</a></span>circuit_build_times_reset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC void circuit_build_times_reset </td>
          <td>(</td>
          <td class="paramtype">circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reset the build time state.</p>
<p>Leave estimated parameters, timeout and network liveness intact for future use. </p>

</div>
</div>
<a id="a321ec5d0efe5196955be8140397bba91"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a321ec5d0efe5196955be8140397bba91">&#9670;&nbsp;</a></span>circuit_build_times_set_timeout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_build_times_set_timeout </td>
          <td>(</td>
          <td class="paramtype">circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Exposed function to compute a new timeout. Dispatches events and also filters out extremely high timeout values. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuitstats_8c_a321ec5d0efe5196955be8140397bba91_cgraph.png" border="0" usemap="#circuitstats_8c_a321ec5d0efe5196955be8140397bba91_cgraph" alt=""/></div>
<map name="circuitstats_8c_a321ec5d0efe5196955be8140397bba91_cgraph" id="circuitstats_8c_a321ec5d0efe5196955be8140397bba91_cgraph">
<area shape="rect" id="node2" href="util_8c.html#a44cb339836df0bbfcf8416209976f6db" title="tor_lround" alt="" coords="210,5,289,32"/>
<area shape="rect" id="node3" href="circuitstats_8c.html#ab883ccb58a956f9f308b80249cee790d" title="circuit_build_times\l_disabled" alt="" coords="184,57,315,98"/>
</map>
</div>

</div>
</div>
<a id="a685329d97770111282850e80b499d864"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a685329d97770111282850e80b499d864">&#9670;&nbsp;</a></span>circuit_build_times_timeout_rate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double circuit_build_times_timeout_rate </td>
          <td>(</td>
          <td class="paramtype">const circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Count the number of timeouts in a set of cbt data. </p>

</div>
</div>
<a id="a9ec8917956d8e6979387268481bbee3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ec8917956d8e6979387268481bbee3f">&#9670;&nbsp;</a></span>circuit_build_times_update_alpha()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC int circuit_build_times_update_alpha </td>
          <td>(</td>
          <td class="paramtype">circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Estimates the Xm and Alpha parameters using <a href="http://en.wikipedia.org/wiki/Pareto_distribution#Parameter_estimation">http://en.wikipedia.org/wiki/Pareto_distribution#Parameter_estimation</a></p>
<p>The notable difference is that we use mode instead of min to estimate Xm. This is because our distribution is frechet-like. We claim this is an acceptable approximation because we are only concerned with the accuracy of the CDF of the tail. </p>

</div>
</div>
<a id="a6cd11af3008cdeec3065dee7bed4cc88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6cd11af3008cdeec3065dee7bed4cc88">&#9670;&nbsp;</a></span>circuit_build_times_update_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_build_times_update_state </td>
          <td>(</td>
          <td class="paramtype">const circuit_build_times_t *&#160;</td>
          <td class="paramname"><em>cbt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structor__state__t.html">or_state_t</a> *&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Output a histogram of current circuit build times to the <a class="el" href="structor__state__t.html">or_state_t</a> state structure. </p>

</div>
</div>
<a id="a612d7d345a4328b8dd4d1079fb0bc9b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a612d7d345a4328b8dd4d1079fb0bc9b2">&#9670;&nbsp;</a></span>get_circuit_build_close_time_ms()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double get_circuit_build_close_time_ms </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the time to wait before actually closing an under-construction, in milliseconds. </p>

</div>
</div>
<a id="a33097eebbc8865c466107e5588f357ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a33097eebbc8865c466107e5588f357ec">&#9670;&nbsp;</a></span>get_circuit_build_timeout_ms()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double get_circuit_build_timeout_ms </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the time to wait before giving up on an under-construction circuit, in milliseconds. </p>

</div>
</div>
<a id="a60132df70f749a68de14d2993d593787"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60132df70f749a68de14d2993d593787">&#9670;&nbsp;</a></span>get_circuit_build_times()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const circuit_build_times_t* get_circuit_build_times </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a pointer to the data structure describing our current circuit build time history and computations. </p>

</div>
</div>
<a id="ab6607aa51a9503278d8f893f8092aabc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab6607aa51a9503278d8f893f8092aabc">&#9670;&nbsp;</a></span>get_circuit_build_times_mutable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">circuit_build_times_t* get_circuit_build_times_mutable </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>As get_circuit_build_times, but return a mutable pointer. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuitstats_8c_ab6607aa51a9503278d8f893f8092aabc_icgraph.png" border="0" usemap="#circuitstats_8c_ab6607aa51a9503278d8f893f8092aabc_icgraph" alt=""/></div>
<map name="circuitstats_8c_ab6607aa51a9503278d8f893f8092aabc_icgraph" id="circuitstats_8c_ab6607aa51a9503278d8f893f8092aabc_icgraph">
<area shape="rect" id="node2" href="channel_8c.html#a4bb9524073333e156da271ca623a772d" title="channel_do_open_actions" alt="" coords="208,13,380,39"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
