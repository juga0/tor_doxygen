<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tor: /home/user/_my/code/bwauth-related/tor/src/or/circuituse.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tor
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97b64286d42c5ef1697cb5f17129db19.html">tor</a></li><li class="navelem"><a class="el" href="dir_3cb0ba3f4b82dbe34a1a06276e96bc8d.html">src</a></li><li class="navelem"><a class="el" href="dir_386635fabd7f6c74e9d9c7a8604514a0.html">or</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">circuituse.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Launch the right sort of circuits and attach the right streams to them.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="or_8h_source.html">or.h</a>&quot;</code><br />
<code>#include &quot;addressmap.h&quot;</code><br />
<code>#include &quot;<a class="el" href="bridges_8h_source.html">bridges.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="channel_8h_source.html">channel.h</a>&quot;</code><br />
<code>#include &quot;circpathbias.h&quot;</code><br />
<code>#include &quot;<a class="el" href="circuitbuild_8h_source.html">circuitbuild.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="circuitlist_8h_source.html">circuitlist.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="circuitstats_8h_source.html">circuitstats.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="circuituse_8h_source.html">circuituse.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="config_8h_source.html">config.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="connection_8h_source.html">connection.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="connection__edge_8h_source.html">connection_edge.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="control_8h_source.html">control.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="entrynodes_8h_source.html">entrynodes.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hs__common_8h_source.html">hs_common.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hs__client_8h_source.html">hs_client.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hs__circuit_8h_source.html">hs_circuit.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hs__ident_8h_source.html">hs_ident.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="hs__stats_8h_source.html">hs_stats.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="nodelist_8h_source.html">nodelist.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="networkstatus_8h_source.html">networkstatus.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="policies_8h_source.html">policies.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rendclient_8h_source.html">rendclient.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rendcommon_8h_source.html">rendcommon.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rendservice_8h_source.html">rendservice.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rephist_8h_source.html">rephist.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="router_8h_source.html">router.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="routerlist_8h_source.html">routerlist.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for circuituse.c:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2circuituse_8c" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2circuituse_8c" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2circuituse_8c">
<area shape="rect" id="node2" href="or_8h.html" title="Master header file for Tor&#45;specific functionality. " alt="" coords="923,333,967,360"/>
<area shape="rect" id="node23" href="addressmap_8h_source.html" title="addressmap.h" alt="" coords="1816,333,1920,360"/>
<area shape="rect" id="node24" href="bridges_8h.html" title="Header file for circuitbuild.c. " alt="" coords="2013,109,2088,136"/>
<area shape="rect" id="node25" href="channel_8h.html" title="Header file for channel.c. " alt="" coords="1240,184,1319,211"/>
<area shape="rect" id="node27" href="circpathbias_8h_source.html" title="circpathbias.h" alt="" coords="2112,109,2215,136"/>
<area shape="rect" id="node28" href="circuitbuild_8h.html" title="Header file for circuitbuild.c. " alt="" coords="2239,109,2334,136"/>
<area shape="rect" id="node29" href="circuitlist_8h.html" title="Header file for circuitlist.c. " alt="" coords="1549,109,1634,136"/>
<area shape="rect" id="node30" href="hs__ident_8h.html" title="Header file containing circuit and connection identifier data for the whole HS subsytem. " alt="" coords="1344,184,1426,211"/>
<area shape="rect" id="node31" href="hs__common_8h.html" title="Header file containing common data for the whole HS subsytem. " alt="" coords="1086,259,1190,285"/>
<area shape="rect" id="node32" href="circuitstats_8h.html" title="Header file for circuitstats.c. " alt="" coords="2358,109,2455,136"/>
<area shape="rect" id="node33" href="circuituse_8h.html" title="Header file for circuituse.c. " alt="" coords="2479,109,2568,136"/>
<area shape="rect" id="node34" href="config_8h.html" title="Header file for config.c. " alt="" coords="1882,184,1950,211"/>
<area shape="rect" id="node35" href="connection_8h.html" title="Header file for connection.c. " alt="" coords="2593,109,2689,136"/>
<area shape="rect" id="node36" href="connection__edge_8h.html" title="Header file for connection_edge.c. " alt="" coords="1994,333,2125,360"/>
<area shape="rect" id="node37" href="control_8h.html" title="Header file for control.c. " alt="" coords="2713,109,2785,136"/>
<area shape="rect" id="node38" href="entrynodes_8h.html" title="Header file for circuitbuild.c. " alt="" coords="2810,109,2907,136"/>
<area shape="rect" id="node39" href="hs__client_8h.html" title="Header file containing client data for the HS subsytem. " alt="" coords="1422,109,1508,136"/>
<area shape="rect" id="node40" href="hs__circuit_8h.html" title="Header file containing circuit data for the whole HS subsytem. " alt="" coords="1490,259,1579,285"/>
<area shape="rect" id="node41" href="hs__stats_8h.html" title="Header file for hs_stats.c. " alt="" coords="2932,109,3014,136"/>
<area shape="rect" id="node42" href="nodelist_8h.html" title="Header file for nodelist.c. " alt="" coords="3039,109,3118,136"/>
<area shape="rect" id="node43" href="networkstatus_8h.html" title="Header file for networkstatus.c. " alt="" coords="2069,184,2184,211"/>
<area shape="rect" id="node44" href="policies_8h.html" title="Header file for policies.c. " alt="" coords="3142,109,3220,136"/>
<area shape="rect" id="node45" href="rendclient_8h.html" title="Header file for rendclient.c. " alt="" coords="3244,109,3334,136"/>
<area shape="rect" id="node46" href="rendcommon_8h.html" title="Header file for rendcommon.c. " alt="" coords="3358,109,3466,136"/>
<area shape="rect" id="node47" href="rendservice_8h.html" title="Header file for rendservice.c. " alt="" coords="996,184,1096,211"/>
<area shape="rect" id="node48" href="rephist_8h.html" title="Header file for rephist.c. " alt="" coords="3490,109,3562,136"/>
<area shape="rect" id="node49" href="router_8h.html" title="Header file for router.c. " alt="" coords="1664,259,1730,285"/>
<area shape="rect" id="node50" href="routerlist_8h.html" title="Header file for routerlist.c. " alt="" coords="1709,333,1792,360"/>
<area shape="rect" id="node3" href="orconfig_8h_source.html" title="orconfig.h" alt="" coords="640,707,719,733"/>
<area shape="rect" id="node4" href="torint_8h.html" title="Header file to define uint32_t and friends. " alt="" coords="648,632,711,659"/>
<area shape="rect" id="node5" href="crypto_8h.html" title="Headers for crypto.c. " alt="" coords="254,557,324,584"/>
<area shape="rect" id="node6" href="crypto__format_8h_source.html" title="crypto_format.h" alt="" coords="983,408,1096,435"/>
<area shape="rect" id="node8" href="crypto__ed25519_8h_source.html" title="crypto_ed25519.h" alt="" coords="1280,483,1405,509"/>
<area shape="rect" id="node9" href="crypto__curve25519_8h_source.html" title="crypto_curve25519.h" alt="" coords="1243,557,1386,584"/>
<area shape="rect" id="node10" href="tortls_8h.html" title="Headers for tortls.c. " alt="" coords="1190,483,1252,509"/>
<area shape="rect" id="node11" href="torlog_8h.html" title="Headers for log.c. " alt="" coords="1500,483,1566,509"/>
<area shape="rect" id="node12" href="container_8h_source.html" title="container.h" alt="" coords="146,483,232,509"/>
<area shape="rect" id="node13" href="compress_8h.html" title="Headers for compress.c. " alt="" coords="1273,408,1364,435"/>
<area shape="rect" id="node14" href="address_8h.html" title="Headers for address.h. " alt="" coords="676,408,755,435"/>
<area shape="rect" id="node15" href="compat__libevent_8h_source.html" title="compat_libevent.h" alt="" coords="896,557,1024,584"/>
<area shape="rect" id="node16" href="ht_8h_source.html" title="ht.h" alt="" coords="227,408,271,435"/>
<area shape="rect" id="node17" href="confline_8h_source.html" title="confline.h" alt="" coords="72,408,151,435"/>
<area shape="rect" id="node18" href="replaycache_8h.html" title="Header file for replaycache.c. " alt="" coords="295,408,398,435"/>
<area shape="rect" id="node19" href="tor__queue_8h_source.html" title="tor_queue.h" alt="" coords="422,408,513,435"/>
<area shape="rect" id="node20" href="token__bucket_8h_source.html" title="token_bucket.h" alt="" coords="760,557,871,584"/>
<area shape="rect" id="node21" href="util__format_8h_source.html" title="util_format.h" alt="" coords="590,557,684,584"/>
<area shape="rect" id="node22" href="hs__circuitmap_8h.html" title="Header file for hs_circuitmap.c. " alt="" coords="537,408,652,435"/>
<area shape="rect" id="node7" href="testsupport_8h_source.html" title="testsupport.h" alt="" coords="1524,632,1622,659"/>
<area shape="rect" id="node26" href="circuitmux_8h.html" title="Header file for circuitmux.c. " alt="" coords="1265,259,1358,285"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a25db39459283a544fc5b5fc148cf51a5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>SET_CUTOFF</b>(target,  msec)</td></tr>
<tr class="separator:a25db39459283a544fc5b5fc148cf51a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e49c5b724878053096b30b45c5a9541"><td class="memItemLeft" align="right" valign="top"><a id="a9e49c5b724878053096b30b45c5a9541"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MAX_ANCIENT_ONEHOP_CIRCUITS_TO_LOG</b>&#160;&#160;&#160;10</td></tr>
<tr class="separator:a9e49c5b724878053096b30b45c5a9541"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab69cb6132a3140acab128efcc01e64e9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#ab69cb6132a3140acab128efcc01e64e9">MAX_UNUSED_OPEN_CIRCUITS</a>&#160;&#160;&#160;14</td></tr>
<tr class="separator:ab69cb6132a3140acab128efcc01e64e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa1f4f89e93b3d9f646926d4c7180ab5"><td class="memItemLeft" align="right" valign="top"><a id="afa1f4f89e93b3d9f646926d4c7180ab5"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SUFFICIENT_UPTIME_INTERNAL_HS_SERVERS</b>&#160;&#160;&#160;3</td></tr>
<tr class="separator:afa1f4f89e93b3d9f646926d4c7180ab5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31b5fa6ddfae7bf691cee50cc5242e1d"><td class="memItemLeft" align="right" valign="top"><a id="a31b5fa6ddfae7bf691cee50cc5242e1d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SUFFICIENT_INTERNAL_HS_CLIENTS</b>&#160;&#160;&#160;3</td></tr>
<tr class="separator:a31b5fa6ddfae7bf691cee50cc5242e1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59944bb6bf35c38de43ad41663097f68"><td class="memItemLeft" align="right" valign="top"><a id="a59944bb6bf35c38de43ad41663097f68"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SUFFICIENT_UPTIME_INTERNAL_HS_CLIENTS</b>&#160;&#160;&#160;2</td></tr>
<tr class="separator:a59944bb6bf35c38de43ad41663097f68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb414943bcca975ac4e5636b12884456"><td class="memItemLeft" align="right" valign="top"><a id="adb414943bcca975ac4e5636b12884456"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DFLT_CBT_UNUSED_OPEN_CIRCS</b>&#160;&#160;&#160;(10)</td></tr>
<tr class="separator:adb414943bcca975ac4e5636b12884456"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82f34ca08f26b1f2e1cd71a785739de2"><td class="memItemLeft" align="right" valign="top"><a id="a82f34ca08f26b1f2e1cd71a785739de2"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MIN_CBT_UNUSED_OPEN_CIRCS</b>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a82f34ca08f26b1f2e1cd71a785739de2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab466aa5e2a0012bf24ffa42fac0cc666"><td class="memItemLeft" align="right" valign="top"><a id="ab466aa5e2a0012bf24ffa42fac0cc666"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MAX_CBT_UNUSED_OPEN_CIRCS</b>&#160;&#160;&#160;<a class="el" href="circuituse_8c.html#ab69cb6132a3140acab128efcc01e64e9">MAX_UNUSED_OPEN_CIRCUITS</a></td></tr>
<tr class="separator:ab466aa5e2a0012bf24ffa42fac0cc666"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aedcff2be8530879d041547e2dec0f4fc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#aedcff2be8530879d041547e2dec0f4fc">TESTING_CIRCUIT_INTERVAL</a>&#160;&#160;&#160;300</td></tr>
<tr class="separator:aedcff2be8530879d041547e2dec0f4fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90e03463e7d0c47a8769249905cf7a78"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#a90e03463e7d0c47a8769249905cf7a78">IDLE_ONE_HOP_CIRC_TIMEOUT</a>&#160;&#160;&#160;60</td></tr>
<tr class="separator:a90e03463e7d0c47a8769249905cf7a78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae053d05a27e3dc1c10c3404e58a9aada"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#ae053d05a27e3dc1c10c3404e58a9aada">NUM_PARALLEL_TESTING_CIRCS</a>&#160;&#160;&#160;4</td></tr>
<tr class="separator:ae053d05a27e3dc1c10c3404e58a9aada"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7770c50352b6d27fdfa5e3cf12ca87ca"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#a7770c50352b6d27fdfa5e3cf12ca87ca">MAX_CIRCUIT_FAILURES</a>&#160;&#160;&#160;5</td></tr>
<tr class="separator:a7770c50352b6d27fdfa5e3cf12ca87ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a857005b7512302feee182107aed11121"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#a857005b7512302feee182107aed11121">circuit_expire_building</a> (void)</td></tr>
<tr class="separator:a857005b7512302feee182107aed11121"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4be6726f65e9f2c81ad77a9c70002ad1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#a4be6726f65e9f2c81ad77a9c70002ad1">circuit_expire_waiting_for_better_guard</a> (void)</td></tr>
<tr class="separator:a4be6726f65e9f2c81ad77a9c70002ad1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31768fdff079617503ff37e96181c8d4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#a31768fdff079617503ff37e96181c8d4">circuit_log_ancient_one_hop_circuits</a> (int age)</td></tr>
<tr class="separator:a31768fdff079617503ff37e96181c8d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0941a9dc5da7825f107d1d4bf028063"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#ac0941a9dc5da7825f107d1d4bf028063">circuit_remove_handled_ports</a> (<a class="el" href="structsmartlist__t.html">smartlist_t</a> *needed_ports)</td></tr>
<tr class="separator:ac0941a9dc5da7825f107d1d4bf028063"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9c9e6111de126ec1c3ca4dd17f4091c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#aa9c9e6111de126ec1c3ca4dd17f4091c">circuit_stream_is_being_handled</a> (<a class="el" href="structentry__connection__t.html">entry_connection_t</a> *conn, uint16_t port, int min)</td></tr>
<tr class="separator:aa9c9e6111de126ec1c3ca4dd17f4091c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97e2564fad1420a15ab6395b9d781b1c"><td class="memItemLeft" align="right" valign="top"><a id="a97e2564fad1420a15ab6395b9d781b1c"></a>
STATIC int&#160;</td><td class="memItemRight" valign="bottom"><b>circuit_is_available_for_use</b> (const <a class="el" href="structcircuit__t.html">circuit_t</a> *circ)</td></tr>
<tr class="separator:a97e2564fad1420a15ab6395b9d781b1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e37921f0fbb9629575e5080d50f7718"><td class="memItemLeft" align="right" valign="top"><a id="a8e37921f0fbb9629575e5080d50f7718"></a>
STATIC int&#160;</td><td class="memItemRight" valign="bottom"><b>needs_exit_circuits</b> (time_t now, int *needs_uptime, int *needs_capacity)</td></tr>
<tr class="separator:a8e37921f0fbb9629575e5080d50f7718"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc43f02245606fb62a757ab8e194f19d"><td class="memItemLeft" align="right" valign="top"><a id="acc43f02245606fb62a757ab8e194f19d"></a>
STATIC int&#160;</td><td class="memItemRight" valign="bottom"><b>needs_hs_server_circuits</b> (time_t now, int num_uptime_internal)</td></tr>
<tr class="separator:acc43f02245606fb62a757ab8e194f19d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ccb58c402f3c00525ff31c5ed9dd582"><td class="memItemLeft" align="right" valign="top"><a id="a8ccb58c402f3c00525ff31c5ed9dd582"></a>
STATIC int&#160;</td><td class="memItemRight" valign="bottom"><b>needs_hs_client_circuits</b> (time_t now, int *needs_uptime, int *needs_capacity, int num_internal, int num_uptime_internal)</td></tr>
<tr class="separator:a8ccb58c402f3c00525ff31c5ed9dd582"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc6ecf6e88415ec7d1805e20961be308"><td class="memItemLeft" align="right" valign="top"><a id="adc6ecf6e88415ec7d1805e20961be308"></a>
STATIC int&#160;</td><td class="memItemRight" valign="bottom"><b>needs_circuits_for_build</b> (int num)</td></tr>
<tr class="separator:adc6ecf6e88415ec7d1805e20961be308"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a882afdac4876448ae1b5eda08db9a66f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#a882afdac4876448ae1b5eda08db9a66f">circuit_build_needed_circs</a> (time_t now)</td></tr>
<tr class="separator:a882afdac4876448ae1b5eda08db9a66f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5474432e0dd7549eb766af37bebb37ed"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#a5474432e0dd7549eb766af37bebb37ed">circuit_expire_old_circs_as_needed</a> (time_t now)</td></tr>
<tr class="separator:a5474432e0dd7549eb766af37bebb37ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1159f471577ebff888f0133714903fb2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#a1159f471577ebff888f0133714903fb2">circuit_detach_stream</a> (<a class="el" href="structcircuit__t.html">circuit_t</a> *circ, <a class="el" href="structedge__connection__t.html">edge_connection_t</a> *conn)</td></tr>
<tr class="separator:a1159f471577ebff888f0133714903fb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10961db035e74aaaf4791c7606873ce6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#a10961db035e74aaaf4791c7606873ce6">circuit_expire_old_circuits_serverside</a> (time_t now)</td></tr>
<tr class="separator:a10961db035e74aaaf4791c7606873ce6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62c92926e67f1674290aff0d08bac948"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#a62c92926e67f1674290aff0d08bac948">reset_bandwidth_test</a> (void)</td></tr>
<tr class="separator:a62c92926e67f1674290aff0d08bac948"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6c1a2c715351d85ef6747ca1a4db958"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#ac6c1a2c715351d85ef6747ca1a4db958">circuit_enough_testing_circs</a> (void)</td></tr>
<tr class="separator:ac6c1a2c715351d85ef6747ca1a4db958"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78a23775279a45daabbdc354310a9e1f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#a78a23775279a45daabbdc354310a9e1f">circuit_has_opened</a> (<a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *circ)</td></tr>
<tr class="separator:a78a23775279a45daabbdc354310a9e1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4abb529971723bed7226e327b8326c3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#af4abb529971723bed7226e327b8326c3">circuit_try_attaching_streams</a> (<a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *circ)</td></tr>
<tr class="separator:af4abb529971723bed7226e327b8326c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bd87fd29ee842fc8518b17c9f7cb9ac"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#a0bd87fd29ee842fc8518b17c9f7cb9ac">circuit_build_failed</a> (<a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *circ)</td></tr>
<tr class="separator:a0bd87fd29ee842fc8518b17c9f7cb9ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18a1d7e9015582c550d0d3eb7710efc9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#a18a1d7e9015582c550d0d3eb7710efc9">circuit_launch</a> (uint8_t purpose, int flags)</td></tr>
<tr class="separator:a18a1d7e9015582c550d0d3eb7710efc9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff875d76fff1f49cbbf561415216f3b3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#aff875d76fff1f49cbbf561415216f3b3">circuit_purpose_is_hidden_service</a> (uint8_t purpose)</td></tr>
<tr class="separator:aff875d76fff1f49cbbf561415216f3b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e8e36fe1fa5af29eb3595f31e0e01db"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#a5e8e36fe1fa5af29eb3595f31e0e01db">circuit_should_use_vanguards</a> (uint8_t purpose)</td></tr>
<tr class="separator:a5e8e36fe1fa5af29eb3595f31e0e01db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca38c91870b66d7a0e495f2cd775e403"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#aca38c91870b66d7a0e495f2cd775e403">circuit_launch_by_extend_info</a> (uint8_t purpose, <a class="el" href="structextend__info__t.html">extend_info_t</a> *extend_info, int flags)</td></tr>
<tr class="separator:aca38c91870b66d7a0e495f2cd775e403"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f03827edb583ab1e727def243a42be1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#a8f03827edb583ab1e727def243a42be1">circuit_reset_failure_count</a> (int <a class="el" href="structtimeout.html">timeout</a>)</td></tr>
<tr class="separator:a8f03827edb583ab1e727def243a42be1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6552c3467492a702a37f75ffd9a7676b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#a6552c3467492a702a37f75ffd9a7676b">hostname_in_track_host_exits</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options, const char *address)</td></tr>
<tr class="separator:a6552c3467492a702a37f75ffd9a7676b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa95a48009b429befccf14ebce9d13a97"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#aa95a48009b429befccf14ebce9d13a97">connection_ap_handshake_attach_chosen_circuit</a> (<a class="el" href="structentry__connection__t.html">entry_connection_t</a> *conn, <a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *circ, <a class="el" href="structcrypt__path__t.html">crypt_path_t</a> *cpath)</td></tr>
<tr class="separator:aa95a48009b429befccf14ebce9d13a97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d5c81bf7d6238331123b1e8753597f1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#a8d5c81bf7d6238331123b1e8753597f1">connection_ap_handshake_attach_circuit</a> (<a class="el" href="structentry__connection__t.html">entry_connection_t</a> *conn)</td></tr>
<tr class="separator:a8d5c81bf7d6238331123b1e8753597f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a407966b13bb02eb365910ea9f07e08be"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#a407966b13bb02eb365910ea9f07e08be">circuit_change_purpose</a> (<a class="el" href="structcircuit__t.html">circuit_t</a> *circ, uint8_t new_purpose)</td></tr>
<tr class="separator:a407966b13bb02eb365910ea9f07e08be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf36645f7a473ad622918668f2f5ba33"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#adf36645f7a473ad622918668f2f5ba33">mark_circuit_unusable_for_new_conns</a> (<a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *circ)</td></tr>
<tr class="separator:adf36645f7a473ad622918668f2f5ba33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d6a7e9b1c6232b77b578b70cfd06ea2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#a0d6a7e9b1c6232b77b578b70cfd06ea2">circuit_sent_valid_data</a> (<a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *circ, uint16_t relay_body_len)</td></tr>
<tr class="separator:a0d6a7e9b1c6232b77b578b70cfd06ea2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a261eac7653f37eb62e5ce20cadf156"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circuituse_8c.html#a2a261eac7653f37eb62e5ce20cadf156">circuit_read_valid_data</a> (<a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *circ, uint16_t relay_body_len)</td></tr>
<tr class="separator:a2a261eac7653f37eb62e5ce20cadf156"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Launch the right sort of circuits and attach the right streams to them. </p>
<p>As distinct from <a class="el" href="circuitlist_8c.html" title="Manage global structures that list and index circuits, and look up circuits within them...">circuitlist.c</a>, which manages lookups to find circuits, and <a class="el" href="circuitbuild_8c.html" title="Implements the details of building circuits (by chosing paths, constructing/sending create/extend cel...">circuitbuild.c</a>, which handles the logistics of circuit construction, this module keeps track of which streams can be attached to which circuits (in circuit_get_best()), and attaches streams to circuits (with <a class="el" href="circuituse_8c.html#af4abb529971723bed7226e327b8326c3">circuit_try_attaching_streams()</a>, <a class="el" href="circuituse_8c.html#a8d5c81bf7d6238331123b1e8753597f1">connection_ap_handshake_attach_circuit()</a>, and <a class="el" href="circuituse_8c.html#aa95a48009b429befccf14ebce9d13a97">connection_ap_handshake_attach_chosen_circuit()</a> ).</p>
<p>This module also makes sure that we are building circuits for all of the predicted ports, using <a class="el" href="circuituse_8c.html#ac0941a9dc5da7825f107d1d4bf028063">circuit_remove_handled_ports()</a>, <a class="el" href="circuituse_8c.html#aa9c9e6111de126ec1c3ca4dd17f4091c">circuit_stream_is_being_handled()</a>, and circuit_build_needed_cirs(). It handles launching circuits for specific targets using <a class="el" href="circuituse_8c.html#aca38c91870b66d7a0e495f2cd775e403">circuit_launch_by_extend_info()</a>.</p>
<p>This is also where we handle expiring circuits that have been around for too long without actually completing, along with the circuit_build_timeout logic in <a class="el" href="circuitstats_8c.html" title="Maintains and analyzes statistics about circuit built times, so we can tell how long we may need to w...">circuitstats.c</a>. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a90e03463e7d0c47a8769249905cf7a78"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90e03463e7d0c47a8769249905cf7a78">&#9670;&nbsp;</a></span>IDLE_ONE_HOP_CIRC_TIMEOUT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IDLE_ONE_HOP_CIRC_TIMEOUT&#160;&#160;&#160;60</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>How long do we wait before killing circuits with the properties described below?</p>
<p>Probably we could choose a number here as low as 5 to 10 seconds, since these circs are used for begindir, and a) generally you either ask another begindir question right after or you don't for a long time, b) clients at least through 0.2.1.x choose from the whole set of directory mirrors at each choice, and c) re-establishing a one-hop circuit via create-fast is a light operation assuming the TLS conn is still there.</p>
<p>I expect "b" to go away one day when we move to using directory guards, but I think "a" and "c" are good enough reasons that a low number is safe even then. </p>

</div>
</div>
<a id="a7770c50352b6d27fdfa5e3cf12ca87ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7770c50352b6d27fdfa5e3cf12ca87ca">&#9670;&nbsp;</a></span>MAX_CIRCUIT_FAILURES</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_CIRCUIT_FAILURES&#160;&#160;&#160;5</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Don't retry launching a new circuit if we try this many times with no success. </p>

</div>
</div>
<a id="ab69cb6132a3140acab128efcc01e64e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab69cb6132a3140acab128efcc01e64e9">&#9670;&nbsp;</a></span>MAX_UNUSED_OPEN_CIRCUITS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_UNUSED_OPEN_CIRCUITS&#160;&#160;&#160;14</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Don't keep more than this many unused open circuits around. </p>

</div>
</div>
<a id="ae053d05a27e3dc1c10c3404e58a9aada"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae053d05a27e3dc1c10c3404e58a9aada">&#9670;&nbsp;</a></span>NUM_PARALLEL_TESTING_CIRCS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NUM_PARALLEL_TESTING_CIRCS&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Number of testing circuits we want open before testing our bandwidth. </p>

</div>
</div>
<a id="a25db39459283a544fc5b5fc148cf51a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25db39459283a544fc5b5fc148cf51a5">&#9670;&nbsp;</a></span>SET_CUTOFF</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SET_CUTOFF</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">target, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">msec&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> {                       \</div><div class="line">    long ms = <a class="code" href="util_8c.html#a44cb339836df0bbfcf8416209976f6db">tor_lround</a>(msec);                             \</div><div class="line">    struct <a class="code" href="structtimeval.html">timeval</a> diff;                                    \</div><div class="line">    diff.tv_sec = ms / 1000;                                \</div><div class="line">    diff.tv_usec = (int)((ms % 1000) * 1000);               \</div><div class="line">    timersub(&amp;now, &amp;diff, &amp;target);                         \</div><div class="line">  } <span class="keywordflow">while</span> (0)</div><div class="ttc" id="util_8c_html_a44cb339836df0bbfcf8416209976f6db"><div class="ttname"><a href="util_8c.html#a44cb339836df0bbfcf8416209976f6db">tor_lround</a></div><div class="ttdeci">long tor_lround(double d)</div><div class="ttdef"><b>Definition:</b> util.c:396</div></div>
<div class="ttc" id="structtimeval_html"><div class="ttname"><a href="structtimeval.html">timeval</a></div><div class="ttdef"><b>Definition:</b> compat_time.h:33</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aedcff2be8530879d041547e2dec0f4fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aedcff2be8530879d041547e2dec0f4fc">&#9670;&nbsp;</a></span>TESTING_CIRCUIT_INTERVAL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TESTING_CIRCUIT_INTERVAL&#160;&#160;&#160;300</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Build a new test circuit every 5 minutes </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a0bd87fd29ee842fc8518b17c9f7cb9ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0bd87fd29ee842fc8518b17c9f7cb9ac">&#9670;&nbsp;</a></span>circuit_build_failed()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_build_failed </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *&#160;</td>
          <td class="paramname"><em>circ</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Called whenever a circuit could not be successfully built. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_a0bd87fd29ee842fc8518b17c9f7cb9ac_cgraph.png" border="0" usemap="#circuituse_8c_a0bd87fd29ee842fc8518b17c9f7cb9ac_cgraph" alt=""/></div>
<map name="circuituse_8c_a0bd87fd29ee842fc8518b17c9f7cb9ac_cgraph" id="circuituse_8c_a0bd87fd29ee842fc8518b17c9f7cb9ac_cgraph">
<area shape="rect" id="node2" href="circuitlist_8c.html#a8cbb4360c5100b6b2ab735449a21fb2e" title="circuit_get_cpath_len" alt="" coords="183,5,328,32"/>
</map>
</div>

</div>
</div>
<a id="a882afdac4876448ae1b5eda08db9a66f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a882afdac4876448ae1b5eda08db9a66f">&#9670;&nbsp;</a></span>circuit_build_needed_circs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_build_needed_circs </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function is called once a second, if router_have_minimum_dir_info() is true. Its job is to make sure all services we offer have enough circuits available. Some services just want enough circuits for current tasks, whereas others want a minimum set of idle circuits hanging around. </p>

</div>
</div>
<a id="a407966b13bb02eb365910ea9f07e08be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a407966b13bb02eb365910ea9f07e08be">&#9670;&nbsp;</a></span>circuit_change_purpose()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_change_purpose </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structcircuit__t.html">circuit_t</a> *&#160;</td>
          <td class="paramname"><em>circ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>new_purpose</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Change <b>circ</b>'s purpose to <b>new_purpose</b>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_a407966b13bb02eb365910ea9f07e08be_cgraph.png" border="0" usemap="#circuituse_8c_a407966b13bb02eb365910ea9f07e08be_cgraph" alt=""/></div>
<map name="circuituse_8c_a407966b13bb02eb365910ea9f07e08be_cgraph" id="circuituse_8c_a407966b13bb02eb365910ea9f07e08be_cgraph">
<area shape="rect" id="node2" href="circuitlist_8c.html#a6c79060856f98208dbdbf81c4f5ed336" title="circuit_purpose_to\l_string" alt="" coords="212,5,340,47"/>
<area shape="rect" id="node3" href="compat_8c.html#af032ac661214ae28b4f205781a515290" title="tor_snprintf" alt="" coords="388,13,475,39"/>
<area shape="rect" id="node4" href="compat_8c.html#a1df7873b16ae8936d25dfedb706f4ea6" title="tor_vsnprintf" alt="" coords="523,13,617,39"/>
</map>
</div>

</div>
</div>
<a id="a1159f471577ebff888f0133714903fb2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1159f471577ebff888f0133714903fb2">&#9670;&nbsp;</a></span>circuit_detach_stream()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_detach_stream </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structcircuit__t.html">circuit_t</a> *&#160;</td>
          <td class="paramname"><em>circ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structedge__connection__t.html">edge_connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If the stream <b>conn</b> is a member of any of the linked lists of <b>circ</b>, then remove it from the list. </p>

</div>
</div>
<a id="ac6c1a2c715351d85ef6747ca1a4db958"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6c1a2c715351d85ef6747ca1a4db958">&#9670;&nbsp;</a></span>circuit_enough_testing_circs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int circuit_enough_testing_circs </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if we've already exercised our bandwidth, or if we have fewer than NUM_PARALLEL_TESTING_CIRCS testing circuits established or on the way. Else return 0. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_ac6c1a2c715351d85ef6747ca1a4db958_icgraph.png" border="0" usemap="#circuituse_8c_ac6c1a2c715351d85ef6747ca1a4db958_icgraph" alt=""/></div>
<map name="circuituse_8c_ac6c1a2c715351d85ef6747ca1a4db958_icgraph" id="circuituse_8c_ac6c1a2c715351d85ef6747ca1a4db958_icgraph">
<area shape="rect" id="node2" href="rephist_8h.html#a890009e83c2e90292a435526b8111727" title="rep_hist_circbuilding\l_dormant" alt="" coords="205,27,345,68"/>
<area shape="rect" id="node3" href="dirserv_8h.html#a2c5edbbd6883a33af3d72bfead4033db" title="directory_too_idle\l_to_fetch_descriptors" alt="" coords="393,27,540,68"/>
<area shape="rect" id="node4" href="main_8h.html#ac64189cc036980dc5785f76d85db9fa6" title="directory_info_has\l_arrived" alt="" coords="1245,5,1373,47"/>
<area shape="rect" id="node5" href="microdesc_8h.html#aad7f413d899b72e58bed8efc0162d8bd" title="update_microdesc_downloads" alt="" coords="807,34,1004,61"/>
<area shape="rect" id="node7" href="routerlist_8h.html#a1a7cfda729e27cf26089db2112d21965" title="update_consensus_router\l_descriptor_downloads" alt="" coords="588,85,759,127"/>
<area shape="rect" id="node6" href="routerlist_8h.html#afe7f2c6bcc3135272bc6aa66ec09cd76" title="update_all_descriptor\l_downloads" alt="" coords="1052,35,1197,76"/>
<area shape="rect" id="node8" href="routerlist_8h.html#a8b67f737b9ea614297414b26eb3b784c" title="update_router_descriptor\l_downloads" alt="" coords="823,85,988,127"/>
</map>
</div>

</div>
</div>
<a id="a857005b7512302feee182107aed11121"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a857005b7512302feee182107aed11121">&#9670;&nbsp;</a></span>circuit_expire_building()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_expire_building </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Close all circuits that start at us, aren't open, and were born at least CircuitBuildTimeout seconds ago.</p>
<p>TODO: This function is now partially redundant to <a class="el" href="circuitstats_8c.html#a306615a489277731398dbd19065f7b2b">circuit_build_times_handle_completed_hop()</a>, but that function only covers circuits up to and including 3 hops that are still actually completing hops. However, <a class="el" href="circuituse_8c.html#a857005b7512302feee182107aed11121">circuit_expire_building()</a> also handles longer circuits, as well as circuits that are completely stalled. In the future (after prop247/other path selection revamping), we probably want to eliminate this rats nest in favor of a simpler approach. </p>
<p>Because circuit build timeout is calculated only based on 3 hop general purpose circuit construction, we need to scale the timeout to make it properly apply to longer circuits, and circuits of certain usage types. The following diagram illustrates how we derive the scaling below. In short, we calculate the number of times our telescoping-based circuit construction causes cells to traverse each link for the circuit purpose types in question, and then assume each link is equivalent.</p>
<p>OP &ndash;a&ndash;&gt; A &ndash;b&ndash;&gt; B &ndash;c&ndash;&gt; C OP &ndash;a&ndash;&gt; A &ndash;b&ndash;&gt; B &ndash;c&ndash;&gt; C &ndash;d&ndash;&gt; D</p>
<p>Let h = a = b = c = d</p>
<p>Three hops (general_cutoff) RTTs = 3a + 2b + c RTTs = 6h Cannibalized: RTTs = a+b+c+d RTTs = 4h Four hops: RTTs = 4a + 3b + 2c + d RTTs = 10h Client INTRODUCE1+ACK: // XXX: correct? RTTs = 5a + 4b + 3c + 2d RTTs = 14h Server intro: RTTs = 4a + 3b + 2c RTTs = 9h</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_a857005b7512302feee182107aed11121_cgraph.png" border="0" usemap="#circuituse_8c_a857005b7512302feee182107aed11121_cgraph" alt=""/></div>
<map name="circuituse_8c_a857005b7512302feee182107aed11121_cgraph" id="circuituse_8c_a857005b7512302feee182107aed11121_cgraph">
<area shape="rect" id="node2" href="circuitlist_8c.html#a7c20bc469ef67338216bb762b661b0ac" title="circuit_any_opened\l_circuits" alt="" coords="204,39,339,80"/>
<area shape="rect" id="node3" href="circuitlist_8c.html#ab526f33075e1edd4dd62437af9ef6c43" title="circuit_get_global\l_origin_circuit_list" alt="" coords="397,5,524,47"/>
<area shape="rect" id="node4" href="circuitlist_8c.html#ac4fb133db6217d7f5fa19a5dee77ca19" title="circuit_cache_opened\l_circuit_state" alt="" coords="387,71,535,112"/>
</map>
</div>

</div>
</div>
<a id="a5474432e0dd7549eb766af37bebb37ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5474432e0dd7549eb766af37bebb37ed">&#9670;&nbsp;</a></span>circuit_expire_old_circs_as_needed()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_expire_old_circs_as_needed </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Called once a second either directly or from <a class="el" href="circuituse_8c.html#a882afdac4876448ae1b5eda08db9a66f">circuit_build_needed_circs()</a>. As appropriate (once per NewCircuitPeriod) resets failure counts and expires old circuits. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_a5474432e0dd7549eb766af37bebb37ed_cgraph.png" border="0" usemap="#circuituse_8c_a5474432e0dd7549eb766af37bebb37ed_cgraph" alt=""/></div>
<map name="circuituse_8c_a5474432e0dd7549eb766af37bebb37ed_cgraph" id="circuituse_8c_a5474432e0dd7549eb766af37bebb37ed_cgraph">
<area shape="rect" id="node2" href="circuituse_8c.html#a8f03827edb583ab1e727def243a42be1" title="circuit_reset_failure\l_count" alt="" coords="180,5,315,47"/>
<area shape="rect" id="node3" href="router_8c.html#aaa263ba55448946fedc8475b3d9b34b8" title="proxy_mode" alt="" coords="201,71,294,98"/>
<area shape="rect" id="node4" href="addressmap_8c.html#a72c5cdc19a414853d92897aefdc95b66" title="addressmap_clean" alt="" coords="182,122,313,149"/>
<area shape="rect" id="node5" href="addressmap_8c.html#a578c622b1ec403e3029606d35a80b261" title="addressmap_get_mappings" alt="" coords="363,122,544,149"/>
</map>
</div>

</div>
</div>
<a id="a10961db035e74aaaf4791c7606873ce6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10961db035e74aaaf4791c7606873ce6">&#9670;&nbsp;</a></span>circuit_expire_old_circuits_serverside()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_expire_old_circuits_serverside </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Find each non-origin circuit that has been unused for too long, has no streams on it, came from a client, and ends here: mark it for close. </p>

</div>
</div>
<a id="a4be6726f65e9f2c81ad77a9c70002ad1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4be6726f65e9f2c81ad77a9c70002ad1">&#9670;&nbsp;</a></span>circuit_expire_waiting_for_better_guard()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_expire_waiting_for_better_guard </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Mark for close all circuits that start here, that were built through a guard we weren't sure if we wanted to use, and that have been waiting around for way too long. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_a4be6726f65e9f2c81ad77a9c70002ad1_cgraph.png" border="0" usemap="#circuituse_8c_a4be6726f65e9f2c81ad77a9c70002ad1_cgraph" alt=""/></div>
<map name="circuituse_8c_a4be6726f65e9f2c81ad77a9c70002ad1_cgraph" id="circuituse_8c_a4be6726f65e9f2c81ad77a9c70002ad1_cgraph">
<area shape="rect" id="node2" href="circuitlist_8c.html#ab526f33075e1edd4dd62437af9ef6c43" title="circuit_get_global\l_origin_circuit_list" alt="" coords="222,5,349,47"/>
<area shape="rect" id="node3" href="entrynodes_8c.html#aa42b6de85549bfc96f56f89cab179042" title="entry_guard_state_should\l_expire" alt="" coords="200,71,371,112"/>
<area shape="rect" id="node4" href="util_8c.html#aca03d8cb6a22d540b13b92ea5945df33" title="approx_time" alt="" coords="447,49,541,75"/>
<area shape="rect" id="node5" href="entrynodes_8c.html#a2c7ec361faf235b7a77e9b73314046c5" title="get_nonprimary_guard\l_idle_timeout" alt="" coords="419,100,569,141"/>
</map>
</div>

</div>
</div>
<a id="a78a23775279a45daabbdc354310a9e1f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78a23775279a45daabbdc354310a9e1f">&#9670;&nbsp;</a></span>circuit_has_opened()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_has_opened </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *&#160;</td>
          <td class="paramname"><em>circ</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The circuit <b>circ</b> has just become open. Take the next step: for rendezvous circuits, we pass circ to the appropriate function in rendclient or rendservice. For general circuits, we call connection_ap_attach_pending, which looks for pending streams that could use circ. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_a78a23775279a45daabbdc354310a9e1f_cgraph.png" border="0" usemap="#circuituse_8c_a78a23775279a45daabbdc354310a9e1f_cgraph" alt=""/></div>
<map name="circuituse_8c_a78a23775279a45daabbdc354310a9e1f_cgraph" id="circuituse_8c_a78a23775279a45daabbdc354310a9e1f_cgraph">
<area shape="rect" id="node2" href="control_8c.html#a5fcccb8799c3633567989fd4560cf8a3" title="control_event_circuit\l_status" alt="" coords="188,5,331,47"/>
</map>
</div>

</div>
</div>
<a id="a18a1d7e9015582c550d0d3eb7710efc9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a18a1d7e9015582c550d0d3eb7710efc9">&#9670;&nbsp;</a></span>circuit_launch()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a>* circuit_launch </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>purpose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Launch a new circuit; see <a class="el" href="circuituse_8c.html#aca38c91870b66d7a0e495f2cd775e403">circuit_launch_by_extend_info()</a> for details on arguments. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_a18a1d7e9015582c550d0d3eb7710efc9_cgraph.png" border="0" usemap="#circuituse_8c_a18a1d7e9015582c550d0d3eb7710efc9_cgraph" alt=""/></div>
<map name="circuituse_8c_a18a1d7e9015582c550d0d3eb7710efc9_cgraph" id="circuituse_8c_a18a1d7e9015582c550d0d3eb7710efc9_cgraph">
<area shape="rect" id="node2" href="circuituse_8c.html#aca38c91870b66d7a0e495f2cd775e403" title="circuit_launch_by_extend_info" alt="" coords="156,5,353,32"/>
</map>
</div>

</div>
</div>
<a id="aca38c91870b66d7a0e495f2cd775e403"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca38c91870b66d7a0e495f2cd775e403">&#9670;&nbsp;</a></span>circuit_launch_by_extend_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a>* circuit_launch_by_extend_info </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>purpose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structextend__info__t.html">extend_info_t</a> *&#160;</td>
          <td class="paramname"><em>extend_info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Launch a new circuit with purpose <b>purpose</b> and exit node <b>extend_info</b> (or NULL to select a random exit node). If flags contains CIRCLAUNCH_NEED_UPTIME, choose among routers with high uptime. If CIRCLAUNCH_NEED_CAPACITY is set, choose among routers with high bandwidth. If CIRCLAUNCH_IS_INTERNAL is true, the last hop need not be an exit node. If CIRCLAUNCH_ONEHOP_TUNNEL is set, the circuit will have only one hop. Return the newly allocated circuit on success, or NULL on failure. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_aca38c91870b66d7a0e495f2cd775e403_icgraph.png" border="0" usemap="#circuituse_8c_aca38c91870b66d7a0e495f2cd775e403_icgraph" alt=""/></div>
<map name="circuituse_8c_aca38c91870b66d7a0e495f2cd775e403_icgraph" id="circuituse_8c_aca38c91870b66d7a0e495f2cd775e403_icgraph">
<area shape="rect" id="node2" href="circuituse_8h.html#a18a1d7e9015582c550d0d3eb7710efc9" title="circuit_launch" alt="" coords="251,5,353,32"/>
</map>
</div>

</div>
</div>
<a id="a31768fdff079617503ff37e96181c8d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31768fdff079617503ff37e96181c8d4">&#9670;&nbsp;</a></span>circuit_log_ancient_one_hop_circuits()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_log_ancient_one_hop_circuits </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>age</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>As a diagnostic for bug 8387, log information about how many one-hop circuits we have around that have been there for at least <b>age</b> seconds. Log a few of them. Ignores Single Onion Service intro and Tor2web redezvous circuits, they are expected to be long-term one-hop circuits. </p>

</div>
</div>
<a id="aff875d76fff1f49cbbf561415216f3b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff875d76fff1f49cbbf561415216f3b3">&#9670;&nbsp;</a></span>circuit_purpose_is_hidden_service()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int circuit_purpose_is_hidden_service </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>purpose</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Tell us if a circuit is a hidden service circuit. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_aff875d76fff1f49cbbf561415216f3b3_icgraph.png" border="0" usemap="#circuituse_8c_aff875d76fff1f49cbbf561415216f3b3_icgraph" alt=""/></div>
<map name="circuituse_8c_aff875d76fff1f49cbbf561415216f3b3_icgraph" id="circuituse_8c_aff875d76fff1f49cbbf561415216f3b3_icgraph">
<area shape="rect" id="node2" href="circuituse_8h.html#ad79b2fe849cb51f0c707188b3b470c59" title="circuit_should_use\l_vanguards" alt="" coords="180,23,311,65"/>
<area shape="rect" id="node3" href="circuitbuild_8h.html#a48d96af7c68a635f9734d0aa0271ac7c" title="route_len_for_purpose" alt="" coords="359,5,509,32"/>
<area shape="rect" id="node5" href="entrynodes_8h.html#ab71ff8062c99e9722afef949590df2da" title="guards_choose_guard" alt="" coords="359,56,509,83"/>
<area shape="rect" id="node4" href="circuitbuild_8c.html#a77d283b19c68e94c4a306fd09c6a0e7f" title="new_route_len" alt="" coords="557,5,664,32"/>
</map>
</div>

</div>
</div>
<a id="a2a261eac7653f37eb62e5ce20cadf156"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a261eac7653f37eb62e5ce20cadf156">&#9670;&nbsp;</a></span>circuit_read_valid_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_read_valid_data </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *&#160;</td>
          <td class="paramname"><em>circ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>relay_body_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add relay_body_len and RELAY_PAYLOAD_SIZE-relay_body_len to the valid delivered read field and the overhead field, respectively. </p>

</div>
</div>
<a id="ac0941a9dc5da7825f107d1d4bf028063"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0941a9dc5da7825f107d1d4bf028063">&#9670;&nbsp;</a></span>circuit_remove_handled_ports()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_remove_handled_ports </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>needed_ports</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove any elements in <b>needed_ports</b> that are handled by an open or in-progress circuit. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_ac0941a9dc5da7825f107d1d4bf028063_cgraph.png" border="0" usemap="#circuituse_8c_ac0941a9dc5da7825f107d1d4bf028063_cgraph" alt=""/></div>
<map name="circuituse_8c_ac0941a9dc5da7825f107d1d4bf028063_cgraph" id="circuituse_8c_ac0941a9dc5da7825f107d1d4bf028063_cgraph">
<area shape="rect" id="node2" href="circuituse_8c.html#aa9c9e6111de126ec1c3ca4dd17f4091c" title="circuit_stream_is_being\l_handled" alt="" coords="212,27,371,69"/>
<area shape="rect" id="node3" href="container_8c.html#a9060e1f019093c294f1a076b6f0226da" title="smartlist_contains\l_int_as_string" alt="" coords="419,27,547,69"/>
<area shape="rect" id="node4" href="compat_8c.html#af032ac661214ae28b4f205781a515290" title="tor_snprintf" alt="" coords="615,5,702,32"/>
<area shape="rect" id="node6" href="container_8c.html#ac33bb0aa376a138f6ca81d6e8ea25e60" title="smartlist_contains\l_string" alt="" coords="595,57,723,98"/>
<area shape="rect" id="node5" href="compat_8c.html#a1df7873b16ae8936d25dfedb706f4ea6" title="tor_vsnprintf" alt="" coords="771,5,865,32"/>
</map>
</div>

</div>
</div>
<a id="a8f03827edb583ab1e727def243a42be1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f03827edb583ab1e727def243a42be1">&#9670;&nbsp;</a></span>circuit_reset_failure_count()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_reset_failure_count </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>timeout</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reset the failure count for opening general circuits. This means we will try MAX_CIRCUIT_FAILURES times more (if necessary) before stopping again. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_a8f03827edb583ab1e727def243a42be1_icgraph.png" border="0" usemap="#circuituse_8c_a8f03827edb583ab1e727def243a42be1_icgraph" alt=""/></div>
<map name="circuituse_8c_a8f03827edb583ab1e727def243a42be1_icgraph" id="circuituse_8c_a8f03827edb583ab1e727def243a42be1_icgraph">
<area shape="rect" id="node2" href="circuituse_8h.html#a5474432e0dd7549eb766af37bebb37ed" title="circuit_expire_old\l_circs_as_needed" alt="" coords="188,5,315,47"/>
</map>
</div>

</div>
</div>
<a id="a0d6a7e9b1c6232b77b578b70cfd06ea2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d6a7e9b1c6232b77b578b70cfd06ea2">&#9670;&nbsp;</a></span>circuit_sent_valid_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_sent_valid_data </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *&#160;</td>
          <td class="paramname"><em>circ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>relay_body_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add relay_body_len and RELAY_PAYLOAD_SIZE-relay_body_len to the valid delivered written fields and the overhead field, respectively. </p>

</div>
</div>
<a id="a5e8e36fe1fa5af29eb3595f31e0e01db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e8e36fe1fa5af29eb3595f31e0e01db">&#9670;&nbsp;</a></span>circuit_should_use_vanguards()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int circuit_should_use_vanguards </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>purpose</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true if this circuit purpose should use vanguards or pinned Layer2 or Layer3 guards.</p>
<p>This function takes both the circuit purpose and the torrc options for pinned middles/vanguards into account (ie: the circuit must be a hidden service circuit and vanguards/pinned middles must be enabled for it to return true). </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_a5e8e36fe1fa5af29eb3595f31e0e01db_cgraph.png" border="0" usemap="#circuituse_8c_a5e8e36fe1fa5af29eb3595f31e0e01db_cgraph" alt=""/></div>
<map name="circuituse_8c_a5e8e36fe1fa5af29eb3595f31e0e01db_cgraph" id="circuituse_8c_a5e8e36fe1fa5af29eb3595f31e0e01db_cgraph">
<area shape="rect" id="node2" href="circuituse_8c.html#aff875d76fff1f49cbbf561415216f3b3" title="circuit_purpose_is\l_hidden_service" alt="" coords="184,5,311,47"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_a5e8e36fe1fa5af29eb3595f31e0e01db_icgraph.png" border="0" usemap="#circuituse_8c_a5e8e36fe1fa5af29eb3595f31e0e01db_icgraph" alt=""/></div>
<map name="circuituse_8c_a5e8e36fe1fa5af29eb3595f31e0e01db_icgraph" id="circuituse_8c_a5e8e36fe1fa5af29eb3595f31e0e01db_icgraph">
<area shape="rect" id="node2" href="circuitbuild_8h.html#a48d96af7c68a635f9734d0aa0271ac7c" title="route_len_for_purpose" alt="" coords="184,5,335,32"/>
<area shape="rect" id="node4" href="entrynodes_8h.html#ab71ff8062c99e9722afef949590df2da" title="guards_choose_guard" alt="" coords="185,56,334,83"/>
<area shape="rect" id="node3" href="circuitbuild_8c.html#a77d283b19c68e94c4a306fd09c6a0e7f" title="new_route_len" alt="" coords="383,5,489,32"/>
</map>
</div>

</div>
</div>
<a id="aa9c9e6111de126ec1c3ca4dd17f4091c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9c9e6111de126ec1c3ca4dd17f4091c">&#9670;&nbsp;</a></span>circuit_stream_is_being_handled()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int circuit_stream_is_being_handled </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structentry__connection__t.html">entry_connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>min</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if at least <b>min</b> general-purpose non-internal circuits will have an acceptable exit node for exit stream <b>conn</b> if it is defined, else for "*:port". Else return 0. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_aa9c9e6111de126ec1c3ca4dd17f4091c_cgraph.png" border="0" usemap="#circuituse_8c_aa9c9e6111de126ec1c3ca4dd17f4091c_cgraph" alt=""/></div>
<map name="circuituse_8c_aa9c9e6111de126ec1c3ca4dd17f4091c_cgraph" id="circuituse_8c_aa9c9e6111de126ec1c3ca4dd17f4091c_cgraph">
<area shape="rect" id="node2" href="container_8c.html#a9060e1f019093c294f1a076b6f0226da" title="smartlist_contains\l_int_as_string" alt="" coords="212,27,340,69"/>
<area shape="rect" id="node3" href="compat_8c.html#af032ac661214ae28b4f205781a515290" title="tor_snprintf" alt="" coords="409,5,495,32"/>
<area shape="rect" id="node5" href="container_8c.html#ac33bb0aa376a138f6ca81d6e8ea25e60" title="smartlist_contains\l_string" alt="" coords="388,57,516,98"/>
<area shape="rect" id="node4" href="compat_8c.html#a1df7873b16ae8936d25dfedb706f4ea6" title="tor_vsnprintf" alt="" coords="564,5,659,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_aa9c9e6111de126ec1c3ca4dd17f4091c_icgraph.png" border="0" usemap="#circuituse_8c_aa9c9e6111de126ec1c3ca4dd17f4091c_icgraph" alt=""/></div>
<map name="circuituse_8c_aa9c9e6111de126ec1c3ca4dd17f4091c_icgraph" id="circuituse_8c_aa9c9e6111de126ec1c3ca4dd17f4091c_icgraph">
<area shape="rect" id="node2" href="circuituse_8h.html#ac0941a9dc5da7825f107d1d4bf028063" title="circuit_remove_handled\l_ports" alt="" coords="212,5,371,47"/>
</map>
</div>

</div>
</div>
<a id="af4abb529971723bed7226e327b8326c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4abb529971723bed7226e327b8326c3">&#9670;&nbsp;</a></span>circuit_try_attaching_streams()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void circuit_try_attaching_streams </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *&#160;</td>
          <td class="paramname"><em>circ</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Called when a circuit becomes ready for streams to be attached to it. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_af4abb529971723bed7226e327b8326c3_cgraph.png" border="0" usemap="#circuituse_8c_af4abb529971723bed7226e327b8326c3_cgraph" alt=""/></div>
<map name="circuituse_8c_af4abb529971723bed7226e327b8326c3_cgraph" id="circuituse_8c_af4abb529971723bed7226e327b8326c3_cgraph">
<area shape="rect" id="node2" href="connection__edge_8c.html#ab5ca7733ddbd1bd01ea51010bf0b792a" title="connection_ap_attach\l_pending" alt="" coords="192,5,341,47"/>
</map>
</div>

</div>
</div>
<a id="aa95a48009b429befccf14ebce9d13a97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa95a48009b429befccf14ebce9d13a97">&#9670;&nbsp;</a></span>connection_ap_handshake_attach_chosen_circuit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_ap_handshake_attach_chosen_circuit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structentry__connection__t.html">entry_connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *&#160;</td>
          <td class="paramname"><em>circ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structcrypt__path__t.html">crypt_path_t</a> *&#160;</td>
          <td class="paramname"><em>cpath</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Attempt to attach the connection <b>conn</b> to <b>circ</b>, and send a begin or resolve cell as appropriate. Return values are as for connection_ap_handshake_attach_circuit. The stream will exit from the hop indicated by <b>cpath</b>, or from the last hop in circ's cpath if <b>cpath</b> is NULL. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_aa95a48009b429befccf14ebce9d13a97_cgraph.png" border="0" usemap="#circuituse_8c_aa95a48009b429befccf14ebce9d13a97_cgraph" alt=""/></div>
<map name="circuituse_8c_aa95a48009b429befccf14ebce9d13a97_cgraph" id="circuituse_8c_aa95a48009b429befccf14ebce9d13a97_cgraph">
<area shape="rect" id="node2" href="util_8c.html#aca03d8cb6a22d540b13b92ea5945df33" title="approx_time" alt="" coords="252,5,345,32"/>
<area shape="rect" id="node3" href="circpathbias_8c.html#a04c00e2d517558281c27352537222639" title="pathbias_count_use\l_attempt" alt="" coords="229,57,368,98"/>
</map>
</div>

</div>
</div>
<a id="a8d5c81bf7d6238331123b1e8753597f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d5c81bf7d6238331123b1e8753597f1">&#9670;&nbsp;</a></span>connection_ap_handshake_attach_circuit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_ap_handshake_attach_circuit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structentry__connection__t.html">entry_connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Try to find a safe live circuit for stream <b>conn</b>. If we find one, attach the stream, send appropriate cells, and return 1. Otherwise, try to launch new circuit(s) for the stream. If we can launch circuits, return 0. Otherwise, if we simply can't proceed with this stream, return -1. (conn needs to die, and is maybe already marked). </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_a8d5c81bf7d6238331123b1e8753597f1_cgraph.png" border="0" usemap="#circuituse_8c_a8d5c81bf7d6238331123b1e8753597f1_cgraph" alt=""/></div>
<map name="circuituse_8c_a8d5c81bf7d6238331123b1e8753597f1_cgraph" id="circuituse_8c_a8d5c81bf7d6238331123b1e8753597f1_cgraph">
<area shape="rect" id="node2" href="address_8c.html#a6ecc12236743caf7527376436791c75e" title="tor_addr_is_null" alt="" coords="244,5,357,32"/>
<area shape="rect" id="node3" href="config_8c.html#a7e31046631b0cc0f5d01c8d411b886e6" title="safe_str_client" alt="" coords="247,56,354,83"/>
<area shape="rect" id="node4" href="connection__edge_8c.html#ab9c45f4cb77108e9d095daecb6ab1700" title="connection_edge_is\l_rendezvous_stream" alt="" coords="229,107,372,149"/>
</map>
</div>

</div>
</div>
<a id="a6552c3467492a702a37f75ffd9a7676b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6552c3467492a702a37f75ffd9a7676b">&#9670;&nbsp;</a></span>hostname_in_track_host_exits()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int hostname_in_track_host_exits </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>address</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff <b>address</b> is matched by one of the entries in TrackHostExits. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_a6552c3467492a702a37f75ffd9a7676b_cgraph.png" border="0" usemap="#circuituse_8c_a6552c3467492a702a37f75ffd9a7676b_cgraph" alt=""/></div>
<map name="circuituse_8c_a6552c3467492a702a37f75ffd9a7676b_cgraph" id="circuituse_8c_a6552c3467492a702a37f75ffd9a7676b_cgraph">
<area shape="rect" id="node2" href="util_8c.html#a595e5e722adc3f46c2d27bced61a8a18" title="strcasecmpend" alt="" coords="217,13,328,39"/>
</map>
</div>

</div>
</div>
<a id="adf36645f7a473ad622918668f2f5ba33"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf36645f7a473ad622918668f2f5ba33">&#9670;&nbsp;</a></span>mark_circuit_unusable_for_new_conns()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mark_circuit_unusable_for_new_conns </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *&#160;</td>
          <td class="paramname"><em>circ</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Mark <b>circ</b> so that no more connections can be attached to it. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_adf36645f7a473ad622918668f2f5ba33_cgraph.png" border="0" usemap="#circuituse_8c_adf36645f7a473ad622918668f2f5ba33_cgraph" alt=""/></div>
<map name="circuituse_8c_adf36645f7a473ad622918668f2f5ba33_cgraph" id="circuituse_8c_adf36645f7a473ad622918668f2f5ba33_cgraph">
<area shape="rect" id="node2" href="util_8c.html#aca03d8cb6a22d540b13b92ea5945df33" title="approx_time" alt="" coords="205,13,299,39"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circuituse_8c_adf36645f7a473ad622918668f2f5ba33_icgraph.png" border="0" usemap="#circuituse_8c_adf36645f7a473ad622918668f2f5ba33_icgraph" alt=""/></div>
<map name="circuituse_8c_adf36645f7a473ad622918668f2f5ba33_icgraph" id="circuituse_8c_adf36645f7a473ad622918668f2f5ba33_icgraph">
<area shape="rect" id="node2" href="circuitlist_8h.html#a52c4991dce45efd8d927b6092e3c85be" title="circuit_mark_all_dirty\l_circs_as_unusable" alt="" coords="205,39,351,80"/>
<area shape="rect" id="node3" href="circuitbuild_8h.html#ad0daecc03b3062716a6845b8a522d3da" title="circuit_note_clock\l_jumped" alt="" coords="399,5,526,47"/>
<area shape="rect" id="node4" href="main_8h.html#ac64189cc036980dc5785f76d85db9fa6" title="directory_info_has\l_arrived" alt="" coords="399,71,527,112"/>
</map>
</div>

</div>
</div>
<a id="a62c92926e67f1674290aff0d08bac948"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62c92926e67f1674290aff0d08bac948">&#9670;&nbsp;</a></span>reset_bandwidth_test()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void reset_bandwidth_test </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reset have_performed_bandwidth_test, so we'll start building testing circuits again so we can exercise our bandwidth. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
