<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tor: /home/user/_my/code/bwauth-related/tor/src/or/circpathbias.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tor
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97b64286d42c5ef1697cb5f17129db19.html">tor</a></li><li class="navelem"><a class="el" href="dir_3cb0ba3f4b82dbe34a1a06276e96bc8d.html">src</a></li><li class="navelem"><a class="el" href="dir_386635fabd7f6c74e9d9c7a8604514a0.html">or</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">circpathbias.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Code to track success/failure rates of circuits built through different tor nodes, in an attempt to detect attacks where an attacker deliberately causes circuits to fail until the client choses a path they like.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="or_8h_source.html">or.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="channel_8h_source.html">channel.h</a>&quot;</code><br />
<code>#include &quot;circpathbias.h&quot;</code><br />
<code>#include &quot;<a class="el" href="circuitbuild_8h_source.html">circuitbuild.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="circuitlist_8h_source.html">circuitlist.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="circuituse_8h_source.html">circuituse.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="circuitstats_8h_source.html">circuitstats.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="connection__edge_8h_source.html">connection_edge.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="config_8h_source.html">config.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="entrynodes_8h_source.html">entrynodes.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="networkstatus_8h_source.html">networkstatus.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="relay_8h_source.html">relay.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for circpathbias.c:</div>
<div class="dyncontent">
<div class="center"><img src="circpathbias_8c__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2circpathbias_8c" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2circpathbias_8c" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2circpathbias_8c">
<area shape="rect" id="node2" href="or_8h.html" title="Master header file for Tor&#45;specific functionality. " alt="" coords="1435,259,1479,285"/>
<area shape="rect" id="node34" href="channel_8h.html" title="Header file for channel.c. " alt="" coords="1501,109,1579,136"/>
<area shape="rect" id="node36" href="circpathbias_8h_source.html" title="circpathbias.h" alt="" coords="1603,109,1706,136"/>
<area shape="rect" id="node37" href="circuitbuild_8h.html" title="Header file for circuitbuild.c. " alt="" coords="1730,109,1825,136"/>
<area shape="rect" id="node38" href="circuitlist_8h.html" title="Header file for circuitlist.c. " alt="" coords="1885,184,1971,211"/>
<area shape="rect" id="node39" href="circuituse_8h.html" title="Header file for circuituse.c. " alt="" coords="1901,109,1990,136"/>
<area shape="rect" id="node40" href="circuitstats_8h.html" title="Header file for circuitstats.c. " alt="" coords="2014,109,2111,136"/>
<area shape="rect" id="node41" href="connection__edge_8h.html" title="Header file for connection_edge.c. " alt="" coords="2032,259,2163,285"/>
<area shape="rect" id="node42" href="config_8h.html" title="Header file for config.c. " alt="" coords="2129,408,2197,435"/>
<area shape="rect" id="node43" href="entrynodes_8h.html" title="Header file for circuitbuild.c. " alt="" coords="2238,109,2335,136"/>
<area shape="rect" id="node44" href="networkstatus_8h.html" title="Header file for networkstatus.c. " alt="" coords="2276,184,2391,211"/>
<area shape="rect" id="node45" href="relay_8h.html" title="Header file for relay.c. " alt="" coords="2411,109,2472,136"/>
<area shape="rect" id="node3" href="orconfig_8h_source.html" title="orconfig.h" alt="" coords="265,856,343,883"/>
<area shape="rect" id="node4" href="torint_8h.html" title="Header file to define uint32_t and friends. " alt="" coords="850,781,913,808"/>
<area shape="rect" id="node5" href="crypto_8h.html" title="Headers for crypto.c. " alt="" coords="936,557,1005,584"/>
<area shape="rect" id="node13" href="crypto__format_8h_source.html" title="crypto_format.h" alt="" coords="1619,557,1733,584"/>
<area shape="rect" id="node14" href="crypto__ed25519_8h_source.html" title="crypto_ed25519.h" alt="" coords="1456,632,1581,659"/>
<area shape="rect" id="node15" href="crypto__curve25519_8h_source.html" title="crypto_curve25519.h" alt="" coords="1489,707,1631,733"/>
<area shape="rect" id="node16" href="tortls_8h.html" title="Headers for tortls.c. " alt="" coords="1054,483,1117,509"/>
<area shape="rect" id="node19" href="torlog_8h.html" title="Headers for log.c. " alt="" coords="1478,557,1543,584"/>
<area shape="rect" id="node20" href="container_8h_source.html" title="container.h" alt="" coords="561,408,647,435"/>
<area shape="rect" id="node26" href="torgzip_8h.html" title="Headers for torgzip.h. " alt="" coords="1123,333,1195,360"/>
<area shape="rect" id="node27" href="address_8h.html" title="Headers for address.h. " alt="" coords="255,333,334,360"/>
<area shape="rect" id="node28" href="compat__libevent_8h_source.html" title="compat_libevent.h" alt="" coords="2233,707,2361,733"/>
<area shape="rect" id="node30" href="ht_8h_source.html" title="ht.h" alt="" coords="1321,333,1365,360"/>
<area shape="rect" id="node31" href="replaycache_8h.html" title="Header file for replaycache.c. " alt="" coords="1389,333,1491,360"/>
<area shape="rect" id="node32" href="tor__queue_8h_source.html" title="tor_queue.h" alt="" coords="1516,333,1607,360"/>
<area shape="rect" id="node33" href="util__format_8h_source.html" title="util_format.h" alt="" coords="1065,707,1159,733"/>
<area shape="rect" id="node7" href="testsupport_8h_source.html" title="testsupport.h" alt="" coords="1671,781,1769,808"/>
<area shape="rect" id="node8" href="compat_8h_source.html" title="compat.h" alt="" coords="650,632,726,659"/>
<area shape="rect" id="node10" href="compat__time_8h.html" title="Functions and types for monotonic times. " alt="" coords="342,781,450,808"/>
<area shape="rect" id="node12" href="compat__threads_8h_source.html" title="compat_threads.h" alt="" coords="726,707,853,733"/>
<area shape="rect" id="node17" href="compat__openssl_8h.html" title="compatability definitions for working with different openssl forks " alt="" coords="1047,557,1175,584"/>
<area shape="rect" id="node21" href="util_8h.html" title="Headers for util.c. " alt="" coords="624,483,675,509"/>
<area shape="rect" id="node25" href="siphash_8h_source.html" title="siphash.h" alt="" coords="521,483,599,509"/>
<area shape="rect" id="node22" href="di__ops_8h.html" title="Headers for di_ops.c. " alt="" coords="145,707,215,733"/>
<area shape="rect" id="node24" href="util__bug_8h.html" title="util_bug.h" alt="" coords="571,557,650,584"/>
<area shape="rect" id="node35" href="circuitmux_8h.html" title="Header file for circuitmux.c. " alt="" coords="1545,184,1639,211"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a8a7a893551fe28195155184593d5d000"><td class="memItemLeft" align="right" valign="top"><a id="a8a7a893551fe28195155184593d5d000"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DFLT_PATH_BIAS_MIN_CIRC</b>&#160;&#160;&#160;150</td></tr>
<tr class="separator:a8a7a893551fe28195155184593d5d000"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a074a0cce5c29843f79b09c5122d16c"><td class="memItemLeft" align="right" valign="top"><a id="a1a074a0cce5c29843f79b09c5122d16c"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DFLT_PATH_BIAS_NOTICE_PCT</b>&#160;&#160;&#160;70</td></tr>
<tr class="separator:a1a074a0cce5c29843f79b09c5122d16c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a591be2a84427dd02b3c825292b9f86c3"><td class="memItemLeft" align="right" valign="top"><a id="a591be2a84427dd02b3c825292b9f86c3"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DFLT_PATH_BIAS_WARN_PCT</b>&#160;&#160;&#160;50</td></tr>
<tr class="separator:a591be2a84427dd02b3c825292b9f86c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f773a23bc7cda35bf83c0f495f7dcce"><td class="memItemLeft" align="right" valign="top"><a id="a6f773a23bc7cda35bf83c0f495f7dcce"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DFLT_PATH_BIAS_EXTREME_PCT</b>&#160;&#160;&#160;30</td></tr>
<tr class="separator:a6f773a23bc7cda35bf83c0f495f7dcce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99ac77b89b12e05c5faec517da3ceb69"><td class="memItemLeft" align="right" valign="top"><a id="a99ac77b89b12e05c5faec517da3ceb69"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DFLT_PATH_BIAS_DROP_GUARDS</b>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a99ac77b89b12e05c5faec517da3ceb69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a868efb85f51ae176a0727513f84c5275"><td class="memItemLeft" align="right" valign="top"><a id="a868efb85f51ae176a0727513f84c5275"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DFLT_PATH_BIAS_SCALE_THRESHOLD</b>&#160;&#160;&#160;300</td></tr>
<tr class="separator:a868efb85f51ae176a0727513f84c5275"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b0e9130bd6e33563274e68d7d14eb2a"><td class="memItemLeft" align="right" valign="top"><a id="a0b0e9130bd6e33563274e68d7d14eb2a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DFLT_PATH_BIAS_MIN_USE</b>&#160;&#160;&#160;20</td></tr>
<tr class="separator:a0b0e9130bd6e33563274e68d7d14eb2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7447cb65ccf8a6fa8702918a2ecbcfa8"><td class="memItemLeft" align="right" valign="top"><a id="a7447cb65ccf8a6fa8702918a2ecbcfa8"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DFLT_PATH_BIAS_NOTICE_USE_PCT</b>&#160;&#160;&#160;80</td></tr>
<tr class="separator:a7447cb65ccf8a6fa8702918a2ecbcfa8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a089cd3f927af73755aeee2801e7f1e4b"><td class="memItemLeft" align="right" valign="top"><a id="a089cd3f927af73755aeee2801e7f1e4b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DFLT_PATH_BIAS_EXTREME_USE_PCT</b>&#160;&#160;&#160;60</td></tr>
<tr class="separator:a089cd3f927af73755aeee2801e7f1e4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad573465303e7943adca1d6d90713d1cf"><td class="memItemLeft" align="right" valign="top"><a id="ad573465303e7943adca1d6d90713d1cf"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DFLT_PATH_BIAS_SCALE_USE_THRESHOLD</b>&#160;&#160;&#160;100</td></tr>
<tr class="separator:ad573465303e7943adca1d6d90713d1cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2639258f384ca8ae38af8ee81b4c57c4"><td class="memItemLeft" align="right" valign="top"><a id="a2639258f384ca8ae38af8ee81b4c57c4"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>N2N_TAGGING_IS_POSSIBLE</b></td></tr>
<tr class="separator:a2639258f384ca8ae38af8ee81b4c57c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a0b3a1081036cae8673d8da4bfad67d"><td class="memItemLeft" align="right" valign="top"><a id="a1a0b3a1081036cae8673d8da4bfad67d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>PATHBIAS_COUNT_INTERVAL</b>&#160;&#160;&#160;(600)</td></tr>
<tr class="separator:a1a0b3a1081036cae8673d8da4bfad67d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adece5feb632c9728bca0900060ce7070"><td class="memItemLeft" align="right" valign="top"><a id="adece5feb632c9728bca0900060ce7070"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CIRC_ATTEMPT_NOTICE_INTERVAL</b>&#160;&#160;&#160;(600)</td></tr>
<tr class="separator:adece5feb632c9728bca0900060ce7070"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f8fa79de06fd118773ef15c07849413"><td class="memItemLeft" align="right" valign="top"><a id="a4f8fa79de06fd118773ef15c07849413"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SUCCESS_NOTICE_INTERVAL</b>&#160;&#160;&#160;(600)</td></tr>
<tr class="separator:a4f8fa79de06fd118773ef15c07849413"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4a34b780cfd22bf4b72e37aaf6e0e2c0"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circpathbias_8c.html#a4a34b780cfd22bf4b72e37aaf6e0e2c0">pathbias_get_extreme_rate</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:a4a34b780cfd22bf4b72e37aaf6e0e2c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac18b8c5463815ebbcb9aa440e59b2f83"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circpathbias_8c.html#ac18b8c5463815ebbcb9aa440e59b2f83">pathbias_get_dropguards</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:ac18b8c5463815ebbcb9aa440e59b2f83"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01c97964a06ef3c2ef14e6f45eb957c7"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circpathbias_8c.html#a01c97964a06ef3c2ef14e6f45eb957c7">pathbias_get_extreme_use_rate</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:a01c97964a06ef3c2ef14e6f45eb957c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4e8b363264a01ece70cef86be5ecd1b"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circpathbias_8c.html#af4e8b363264a01ece70cef86be5ecd1b">pathbias_state_to_string</a> (<a class="el" href="or_8h.html#af80a11a4a183036a52b66a1b48c61ac9">path_state_t</a> state)</td></tr>
<tr class="separator:af4e8b363264a01ece70cef86be5ecd1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00fd2b6603a29cad6519b1fe052ef813"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circpathbias_8c.html#a00fd2b6603a29cad6519b1fe052ef813">pathbias_count_build_attempt</a> (<a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *circ)</td></tr>
<tr class="separator:a00fd2b6603a29cad6519b1fe052ef813"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae80a35983a4f83ce744b518640c39111"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circpathbias_8c.html#ae80a35983a4f83ce744b518640c39111">pathbias_count_build_success</a> (<a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *circ)</td></tr>
<tr class="separator:ae80a35983a4f83ce744b518640c39111"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04c00e2d517558281c27352537222639"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circpathbias_8c.html#a04c00e2d517558281c27352537222639">pathbias_count_use_attempt</a> (<a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *circ)</td></tr>
<tr class="separator:a04c00e2d517558281c27352537222639"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8601bd2aa563ab891cc79deb600b11a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circpathbias_8c.html#ad8601bd2aa563ab891cc79deb600b11a">pathbias_mark_use_success</a> (<a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *circ)</td></tr>
<tr class="separator:ad8601bd2aa563ab891cc79deb600b11a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63c2834db15608a12bc7e17d6368469c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circpathbias_8c.html#a63c2834db15608a12bc7e17d6368469c">pathbias_mark_use_rollback</a> (<a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *circ)</td></tr>
<tr class="separator:a63c2834db15608a12bc7e17d6368469c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab44fa8cdd717742b879cd263c50a5a7f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circpathbias_8c.html#ab44fa8cdd717742b879cd263c50a5a7f">pathbias_check_probe_response</a> (<a class="el" href="structcircuit__t.html">circuit_t</a> *circ, const <a class="el" href="structcell__t.html">cell_t</a> *cell)</td></tr>
<tr class="separator:ab44fa8cdd717742b879cd263c50a5a7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29f4dbbb0c9b624910fc74fbb399dde4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circpathbias_8c.html#a29f4dbbb0c9b624910fc74fbb399dde4">pathbias_check_close</a> (<a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *ocirc, int reason)</td></tr>
<tr class="separator:a29f4dbbb0c9b624910fc74fbb399dde4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4176722d670efca21d265bc4a1e44ba4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circpathbias_8c.html#a4176722d670efca21d265bc4a1e44ba4">pathbias_count_timeout</a> (<a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *circ)</td></tr>
<tr class="separator:a4176722d670efca21d265bc4a1e44ba4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe9ef8d49fc04454e5c3cf61b7c5667f"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circpathbias_8c.html#afe9ef8d49fc04454e5c3cf61b7c5667f">pathbias_get_close_success_count</a> (<a class="el" href="structentry__guard__t.html">entry_guard_t</a> *guard)</td></tr>
<tr class="separator:afe9ef8d49fc04454e5c3cf61b7c5667f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65437bc034e2202eb60d5cffd285fd48"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="circpathbias_8c.html#a65437bc034e2202eb60d5cffd285fd48">pathbias_get_use_success_count</a> (<a class="el" href="structentry__guard__t.html">entry_guard_t</a> *guard)</td></tr>
<tr class="separator:a65437bc034e2202eb60d5cffd285fd48"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Code to track success/failure rates of circuits built through different tor nodes, in an attempt to detect attacks where an attacker deliberately causes circuits to fail until the client choses a path they like. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a29f4dbbb0c9b624910fc74fbb399dde4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29f4dbbb0c9b624910fc74fbb399dde4">&#9670;&nbsp;</a></span>pathbias_check_close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pathbias_check_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *&#160;</td>
          <td class="paramname"><em>ocirc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>reason</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Check if a circuit was used and/or closed successfully.</p>
<p>If we attempted to use the circuit to carry a stream but failed for whatever reason, or if the circuit mysteriously died before we could attach any streams, record these two cases.</p>
<p>If we <em>have</em> successfully used the circuit, or it appears to have been closed by us locally, count it as a success.</p>
<p>Returns 0 if we're done making decisions with the circ, or -1 if we want to probe it first. </p>

</div>
</div>
<a id="ab44fa8cdd717742b879cd263c50a5a7f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab44fa8cdd717742b879cd263c50a5a7f">&#9670;&nbsp;</a></span>pathbias_check_probe_response()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pathbias_check_probe_response </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structcircuit__t.html">circuit_t</a> *&#160;</td>
          <td class="paramname"><em>circ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structcell__t.html">cell_t</a> *&#160;</td>
          <td class="paramname"><em>cell</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Check the response to a pathbias probe, to ensure the cell is recognized and the nonce and other probe characteristics are as expected.</p>
<p>If the response is valid, return 0. Otherwise return &lt; 0. </p>

</div>
</div>
<a id="a00fd2b6603a29cad6519b1fe052ef813"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00fd2b6603a29cad6519b1fe052ef813">&#9670;&nbsp;</a></span>pathbias_count_build_attempt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pathbias_count_build_attempt </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *&#160;</td>
          <td class="paramname"><em>circ</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Check our circuit state to see if this is a successful circuit attempt. If so, record it in the current guard's path bias circ_attempt count.</p>
<p>Also check for several potential error cases for bug #6475. </p>

</div>
</div>
<a id="ae80a35983a4f83ce744b518640c39111"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae80a35983a4f83ce744b518640c39111">&#9670;&nbsp;</a></span>pathbias_count_build_success()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pathbias_count_build_success </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *&#160;</td>
          <td class="paramname"><em>circ</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Check our circuit state to see if this is a successful circuit completion. If so, record it in the current guard's path bias success count.</p>
<p>Also check for several potential error cases for bug #6475. </p>

</div>
</div>
<a id="a4176722d670efca21d265bc4a1e44ba4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4176722d670efca21d265bc4a1e44ba4">&#9670;&nbsp;</a></span>pathbias_count_timeout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pathbias_count_timeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *&#160;</td>
          <td class="paramname"><em>circ</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Count timeouts for path bias log messages.</p>
<p>These counts are purely informational. </p>

</div>
</div>
<a id="a04c00e2d517558281c27352537222639"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04c00e2d517558281c27352537222639">&#9670;&nbsp;</a></span>pathbias_count_use_attempt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pathbias_count_use_attempt </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *&#160;</td>
          <td class="paramname"><em>circ</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Record an attempt to use a circuit. Changes the circuit's path state and update its guard's usage counter.</p>
<p>Used for path bias usage accounting. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circpathbias_8c_a04c00e2d517558281c27352537222639_icgraph.png" border="0" usemap="#circpathbias_8c_a04c00e2d517558281c27352537222639_icgraph" alt=""/></div>
<map name="circpathbias_8c_a04c00e2d517558281c27352537222639_icgraph" id="circpathbias_8c_a04c00e2d517558281c27352537222639_icgraph">
<area shape="rect" id="node2" href="circuituse_8h.html#aa95a48009b429befccf14ebce9d13a97" title="connection_ap_handshake\l_attach_chosen_circuit" alt="" coords="192,5,368,47"/>
</map>
</div>

</div>
</div>
<a id="afe9ef8d49fc04454e5c3cf61b7c5667f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe9ef8d49fc04454e5c3cf61b7c5667f">&#9670;&nbsp;</a></span>pathbias_get_close_success_count()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double pathbias_get_close_success_count </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structentry__guard__t.html">entry_guard_t</a> *&#160;</td>
          <td class="paramname"><em>guard</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the number of circuits counted as successfully closed for this guard.</p>
<p>Also add in the currently open circuits to give them the benefit of the doubt. </p>

</div>
</div>
<a id="ac18b8c5463815ebbcb9aa440e59b2f83"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac18b8c5463815ebbcb9aa440e59b2f83">&#9670;&nbsp;</a></span>pathbias_get_dropguards()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pathbias_get_dropguards </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If 1, we actually disable use of guards that fall below the extreme_pct. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circpathbias_8c_ac18b8c5463815ebbcb9aa440e59b2f83_cgraph.png" border="0" usemap="#circpathbias_8c_ac18b8c5463815ebbcb9aa440e59b2f83_cgraph" alt=""/></div>
<map name="circpathbias_8c_ac18b8c5463815ebbcb9aa440e59b2f83_cgraph" id="circpathbias_8c_ac18b8c5463815ebbcb9aa440e59b2f83_cgraph">
<area shape="rect" id="node2" href="networkstatus_8c.html#aba1790be4b1cea243c3dac989ad1b05c" title="networkstatus_get_param" alt="" coords="220,5,392,32"/>
</map>
</div>

</div>
</div>
<a id="a4a34b780cfd22bf4b72e37aaf6e0e2c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a34b780cfd22bf4b72e37aaf6e0e2c0">&#9670;&nbsp;</a></span>pathbias_get_extreme_rate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double pathbias_get_extreme_rate </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The extreme rate is the rate at which we would drop the guard, if pb_dropguard is also set. Otherwise we just warn. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circpathbias_8c_a4a34b780cfd22bf4b72e37aaf6e0e2c0_cgraph.png" border="0" usemap="#circpathbias_8c_a4a34b780cfd22bf4b72e37aaf6e0e2c0_cgraph" alt=""/></div>
<map name="circpathbias_8c_a4a34b780cfd22bf4b72e37aaf6e0e2c0_cgraph" id="circpathbias_8c_a4a34b780cfd22bf4b72e37aaf6e0e2c0_cgraph">
<area shape="rect" id="node2" href="networkstatus_8c.html#aba1790be4b1cea243c3dac989ad1b05c" title="networkstatus_get_param" alt="" coords="232,5,404,32"/>
</map>
</div>

</div>
</div>
<a id="a01c97964a06ef3c2ef14e6f45eb957c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01c97964a06ef3c2ef14e6f45eb957c7">&#9670;&nbsp;</a></span>pathbias_get_extreme_use_rate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double pathbias_get_extreme_use_rate </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The extreme use rate is the rate at which we would drop the guard, if pb_dropguard is also set. Otherwise we just warn. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="circpathbias_8c_a01c97964a06ef3c2ef14e6f45eb957c7_cgraph.png" border="0" usemap="#circpathbias_8c_a01c97964a06ef3c2ef14e6f45eb957c7_cgraph" alt=""/></div>
<map name="circpathbias_8c_a01c97964a06ef3c2ef14e6f45eb957c7_cgraph" id="circpathbias_8c_a01c97964a06ef3c2ef14e6f45eb957c7_cgraph">
<area shape="rect" id="node2" href="networkstatus_8c.html#aba1790be4b1cea243c3dac989ad1b05c" title="networkstatus_get_param" alt="" coords="204,13,376,39"/>
</map>
</div>

</div>
</div>
<a id="a65437bc034e2202eb60d5cffd285fd48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a65437bc034e2202eb60d5cffd285fd48">&#9670;&nbsp;</a></span>pathbias_get_use_success_count()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double pathbias_get_use_success_count </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structentry__guard__t.html">entry_guard_t</a> *&#160;</td>
          <td class="paramname"><em>guard</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the number of circuits counted as successfully used this guard.</p>
<p>Also add in the currently open circuits that we are attempting to use to give them the benefit of the doubt. </p>

</div>
</div>
<a id="a63c2834db15608a12bc7e17d6368469c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a63c2834db15608a12bc7e17d6368469c">&#9670;&nbsp;</a></span>pathbias_mark_use_rollback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pathbias_mark_use_rollback </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *&#160;</td>
          <td class="paramname"><em>circ</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If a stream ever detatches from a circuit in a retriable way, we need to mark this circuit as still needing either another successful stream, or in need of a probe.</p>
<p>An adversary could let the first stream request succeed (ie the resolve), but then tag and timeout the remainder (via cell dropping), forcing them on new circuits.</p>
<p>Rolling back the state will cause us to probe such circuits, which should lead to probe failures in the event of such tagging due to either unrecognized cells coming in while we wait for the probe, or the cipher state getting out of sync in the case of dropped cells. </p>

</div>
</div>
<a id="ad8601bd2aa563ab891cc79deb600b11a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad8601bd2aa563ab891cc79deb600b11a">&#9670;&nbsp;</a></span>pathbias_mark_use_success()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pathbias_mark_use_success </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structorigin__circuit__t.html">origin_circuit_t</a> *&#160;</td>
          <td class="paramname"><em>circ</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Check the circuit's path state is appropriate and mark it as successfully used. Used for path bias usage accounting.</p>
<p>We don't actually increment the guard's counters until <a class="el" href="circpathbias_8c.html#a29f4dbbb0c9b624910fc74fbb399dde4">pathbias_check_close()</a>, because the circuit can still transition back to PATH_STATE_USE_ATTEMPTED if a stream fails later (this is done so we can probe the circuit for liveness at close). </p>

</div>
</div>
<a id="af4e8b363264a01ece70cef86be5ecd1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4e8b363264a01ece70cef86be5ecd1b">&#9670;&nbsp;</a></span>pathbias_state_to_string()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* pathbias_state_to_string </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="or_8h.html#af80a11a4a183036a52b66a1b48c61ac9">path_state_t</a>&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Convert a Guard's path state to string. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
