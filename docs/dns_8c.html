<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tor: /home/user/_my/code/bwauth-related/tor/src/or/dns.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tor
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97b64286d42c5ef1697cb5f17129db19.html">tor</a></li><li class="navelem"><a class="el" href="dir_3cb0ba3f4b82dbe34a1a06276e96bc8d.html">src</a></li><li class="navelem"><a class="el" href="dir_386635fabd7f6c74e9d9c7a8604514a0.html">or</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">dns.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implements a local cache for DNS results for Tor servers. This is implemented as a wrapper around Adam Langley's eventdns.c code. (We can't just use gethostbyname() and friends because we really need to be nonblocking.)  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="or_8h_source.html">or.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="circuitlist_8h_source.html">circuitlist.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="circuituse_8h_source.html">circuituse.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="config_8h_source.html">config.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="connection_8h_source.html">connection.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="connection__edge_8h_source.html">connection_edge.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="control_8h_source.html">control.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="crypto__rand_8h_source.html">crypto_rand.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="dns_8h_source.html">dns.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="main_8h_source.html">main.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="policies_8h_source.html">policies.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="relay_8h_source.html">relay.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="router_8h_source.html">router.h</a>&quot;</code><br />
<code>#include &quot;ht.h&quot;</code><br />
<code>#include &quot;<a class="el" href="sandbox_8h_source.html">sandbox.h</a>&quot;</code><br />
<code>#include &lt;event2/event.h&gt;</code><br />
<code>#include &lt;event2/dns.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for dns.c:</div>
<div class="dyncontent">
<div class="center"><img src="dns_8c__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2dns_8c" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2dns_8c" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2dns_8c">
<area shape="rect" id="node2" href="or_8h.html" title="Master header file for Tor&#45;specific functionality. " alt="" coords="1423,333,1467,360"/>
<area shape="rect" id="node26" href="ht_8h_source.html" title="ht.h" alt="" coords="5,408,49,435"/>
<area shape="rect" id="node33" href="circuitlist_8h.html" title="Header file for circuitlist.c. " alt="" coords="2069,109,2154,136"/>
<area shape="rect" id="node36" href="circuituse_8h.html" title="Header file for circuituse.c. " alt="" coords="2179,109,2268,136"/>
<area shape="rect" id="node37" href="config_8h.html" title="Header file for config.c. " alt="" coords="2415,184,2483,211"/>
<area shape="rect" id="node38" href="connection_8h.html" title="Header file for connection.c. " alt="" coords="2506,259,2602,285"/>
<area shape="rect" id="node40" href="connection__edge_8h.html" title="Header file for connection_edge.c. " alt="" coords="2706,333,2837,360"/>
<area shape="rect" id="node41" href="control_8h.html" title="Header file for control.c. " alt="" coords="2445,109,2517,136"/>
<area shape="rect" id="node42" href="crypto__rand_8h.html" title="Common functions for using (pseudo&#45;)random number generators. " alt="" coords="1925,707,2026,733"/>
<area shape="rect" id="node43" href="dns_8h.html" title="Header file for dns.c. " alt="" coords="2592,109,2647,136"/>
<area shape="rect" id="node44" href="main_8h.html" title="Header file for main.c. " alt="" coords="2671,109,2733,136"/>
<area shape="rect" id="node45" href="policies_8h.html" title="Header file for policies.c. " alt="" coords="2757,109,2834,136"/>
<area shape="rect" id="node46" href="relay_8h.html" title="Header file for relay.c. " alt="" coords="2858,109,2919,136"/>
<area shape="rect" id="node47" href="router_8h.html" title="Header file for router.c. " alt="" coords="2994,184,3061,211"/>
<area shape="rect" id="node48" href="sandbox_8h.html" title="Header file for sandbox.c. " alt="" coords="2455,856,2538,883"/>
<area shape="rect" id="node3" href="orconfig_8h_source.html" title="orconfig.h" alt="" coords="895,1005,973,1032"/>
<area shape="rect" id="node4" href="torint_8h.html" title="Header file to define uint32_t and friends. " alt="" coords="1219,931,1281,957"/>
<area shape="rect" id="node6" href="crypto_8h.html" title="Headers for crypto.c. " alt="" coords="714,483,783,509"/>
<area shape="rect" id="node14" href="container_8h_source.html" title="container.h" alt="" coords="168,707,255,733"/>
<area shape="rect" id="node16" href="torlog_8h.html" title="Headers for log.c. " alt="" coords="1391,632,1456,659"/>
<area shape="rect" id="node17" href="crypto__format_8h_source.html" title="crypto_format.h" alt="" coords="1685,408,1799,435"/>
<area shape="rect" id="node18" href="crypto__ed25519_8h_source.html" title="crypto_ed25519.h" alt="" coords="1585,483,1710,509"/>
<area shape="rect" id="node19" href="crypto__curve25519_8h_source.html" title="crypto_curve25519.h" alt="" coords="1264,557,1407,584"/>
<area shape="rect" id="node21" href="tortls_8h.html" title="Headers for tortls.c. " alt="" coords="1155,483,1217,509"/>
<area shape="rect" id="node23" href="compress_8h.html" title="Headers for compress.c. " alt="" coords="74,408,165,435"/>
<area shape="rect" id="node24" href="address_8h.html" title="Headers for address.h. " alt="" coords="277,632,356,659"/>
<area shape="rect" id="node25" href="compat__libevent_8h_source.html" title="compat_libevent.h" alt="" coords="1287,856,1415,883"/>
<area shape="rect" id="node27" href="confline_8h_source.html" title="confline.h" alt="" coords="227,483,305,509"/>
<area shape="rect" id="node28" href="replaycache_8h.html" title="Header file for replaycache.c. " alt="" coords="949,408,1052,435"/>
<area shape="rect" id="node29" href="tor__queue_8h_source.html" title="tor_queue.h" alt="" coords="1077,408,1167,435"/>
<area shape="rect" id="node30" href="token__bucket_8h_source.html" title="token_bucket.h" alt="" coords="2117,856,2228,883"/>
<area shape="rect" id="node31" href="util__format_8h_source.html" title="util_format.h" alt="" coords="1795,856,1889,883"/>
<area shape="rect" id="node32" href="hs__circuitmap_8h.html" title="Header file for hs_circuitmap.c. " alt="" coords="1293,408,1407,435"/>
<area shape="rect" id="node8" href="compat_8h_source.html" title="compat.h" alt="" coords="984,856,1060,883"/>
<area shape="rect" id="node10" href="util_8h.html" title="Headers for util.c. " alt="" coords="949,781,999,808"/>
<area shape="rect" id="node12" href="crypto__rsa_8h.html" title="Headers for crypto_rsa.c. " alt="" coords="919,557,1013,584"/>
<area shape="rect" id="node9" href="testsupport_8h_source.html" title="testsupport.h" alt="" coords="2005,931,2103,957"/>
<area shape="rect" id="node11" href="di__ops_8h.html" title="Headers for di_ops.c. " alt="" coords="837,856,908,883"/>
<area shape="rect" id="node13" href="crypto__digest_8h.html" title="Headers for crypto_digest.c. " alt="" coords="888,632,999,659"/>
<area shape="rect" id="node15" href="siphash_8h_source.html" title="siphash.h" alt="" coords="172,781,251,808"/>
<area shape="rect" id="node20" href="crypto__openssl__mgt_8h_source.html" title="crypto_openssl_mgt.h" alt="" coords="989,707,1140,733"/>
<area shape="rect" id="node22" href="compat__openssl_8h.html" title="compatibility definitions for working with different openssl forks " alt="" coords="1061,557,1189,584"/>
<area shape="rect" id="node34" href="hs__ident_8h.html" title="Header file containing circuit and connection identifier data for the whole HS subsytem. " alt="" coords="1606,184,1689,211"/>
<area shape="rect" id="node35" href="hs__common_8h.html" title="Header file containing common data for the whole HS subsytem. " alt="" coords="1499,259,1603,285"/>
<area shape="rect" id="node39" href="buffers_8h.html" title="Header file for buffers.c. " alt="" coords="1889,781,1963,808"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:add96c4e8342c581d687f8e0eceb27c74"><td class="memItemLeft" align="right" valign="top"><a id="add96c4e8342c581d687f8e0eceb27c74"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DNS_PRIVATE</b></td></tr>
<tr class="separator:add96c4e8342c581d687f8e0eceb27c74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f4fbaf3b9d88e32c2bd4bff9eaadbe7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a4f4fbaf3b9d88e32c2bd4bff9eaadbe7">RESOLVE_MAX_TIMEOUT</a>&#160;&#160;&#160;300</td></tr>
<tr class="separator:a4f4fbaf3b9d88e32c2bd4bff9eaadbe7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25a25647bf03314ee1213719a5e85124"><td class="memItemLeft" align="right" valign="top"><a id="a25a25647bf03314ee1213719a5e85124"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>assert_cache_ok</b>()&#160;&#160;&#160;STMT_NIL</td></tr>
<tr class="separator:a25a25647bf03314ee1213719a5e85124"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3ee8e636a90d1625d0ce43c2f1f84cc"><td class="memItemLeft" align="right" valign="top"><a id="ab3ee8e636a90d1625d0ce43c2f1f84cc"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>RESOLVED_TYPE_AUTO</b>&#160;&#160;&#160;0xff</td></tr>
<tr class="separator:ab3ee8e636a90d1625d0ce43c2f1f84cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5977e6f3cbed50aa74576be03d96803"><td class="memItemLeft" align="right" valign="top"><a id="ab5977e6f3cbed50aa74576be03d96803"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SET</b>(k,  v)&#160;&#160;&#160;evdns_base_set_option(the_evdns_base, (k), (v))</td></tr>
<tr class="separator:ab5977e6f3cbed50aa74576be03d96803"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0086e4a756e579376f2446020dffeb42"><td class="memItemLeft" align="right" valign="top"><a id="a0086e4a756e579376f2446020dffeb42"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>N_WILDCARD_CHECKS</b>&#160;&#160;&#160;2</td></tr>
<tr class="separator:a0086e4a756e579376f2446020dffeb42"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a9d9998b8c60f2ea2ebbec0e240850ecc"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a9d9998b8c60f2ea2ebbec0e240850ecc">HT_PROTOTYPE</a> (HT_GENERATE2(cache_map, HT_GENERATE2(<a class="el" href="structcached__resolve__t.html">cached_resolve_t</a>, HT_GENERATE2(node, HT_GENERATE2(cached_resolve_hash, HT_GENERATE2(cached_resolves_eq)</td></tr>
<tr class="separator:a9d9998b8c60f2ea2ebbec0e240850ecc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a100ddc42d1f3411bc6cfbc6185af76ae"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a100ddc42d1f3411bc6cfbc6185af76ae">dns_init</a> (void)</td></tr>
<tr class="separator:a100ddc42d1f3411bc6cfbc6185af76ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc88406c6e9c82925d506b30b1e42c14"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#abc88406c6e9c82925d506b30b1e42c14">dns_reset</a> (void)</td></tr>
<tr class="separator:abc88406c6e9c82925d506b30b1e42c14"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78d2ffb374ea9661ae7940dd63266892"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a78d2ffb374ea9661ae7940dd63266892">has_dns_init_failed</a> (void)</td></tr>
<tr class="separator:a78d2ffb374ea9661ae7940dd63266892"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adae55d1d541c43481d02de8254a805ec"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#adae55d1d541c43481d02de8254a805ec">dns_clip_ttl</a> (uint32_t ttl)</td></tr>
<tr class="separator:adae55d1d541c43481d02de8254a805ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87870a99d044d10adab219c61f4185a4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a87870a99d044d10adab219c61f4185a4">dns_free_all</a> (void)</td></tr>
<tr class="separator:a87870a99d044d10adab219c61f4185a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2616ee15d1faf206a7bd39a7a4c81e2c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a2616ee15d1faf206a7bd39a7a4c81e2c">MOCK_IMPL</a> (STATIC void, send_resolved_cell,(<a class="el" href="structedge__connection__t.html">edge_connection_t</a> *conn, uint8_t answer_type, const <a class="el" href="structcached__resolve__t.html">cached_resolve_t</a> *resolved))</td></tr>
<tr class="separator:a2616ee15d1faf206a7bd39a7a4c81e2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0ebff7a0b3f4a11fe87b9e70afae499"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#ab0ebff7a0b3f4a11fe87b9e70afae499">MOCK_IMPL</a> (STATIC void, send_resolved_hostname_cell,(<a class="el" href="structedge__connection__t.html">edge_connection_t</a> *conn, const char *hostname))</td></tr>
<tr class="separator:ab0ebff7a0b3f4a11fe87b9e70afae499"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1ffeb643093b409c75573a27574afbc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#aa1ffeb643093b409c75573a27574afbc">dns_resolve</a> (<a class="el" href="structedge__connection__t.html">edge_connection_t</a> *exitconn)</td></tr>
<tr class="separator:aa1ffeb643093b409c75573a27574afbc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a224ce234dfdd68cbfe885138b40e1dfd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a224ce234dfdd68cbfe885138b40e1dfd">MOCK_IMPL</a> (STATIC int, dns_resolve_impl,(<a class="el" href="structedge__connection__t.html">edge_connection_t</a> *exitconn, int is_resolve, <a class="el" href="structor__circuit__t.html">or_circuit_t</a> *oncirc, char **hostname_out, int *made_connection_pending_out, <a class="el" href="structcached__resolve__t.html">cached_resolve_t</a> **resolve_out))</td></tr>
<tr class="separator:a224ce234dfdd68cbfe885138b40e1dfd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4e5269113b9e470fedaf89274faef8a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#af4e5269113b9e470fedaf89274faef8a">MOCK_IMPL</a> (STATIC int, set_exitconn_info_from_resolve,(<a class="el" href="structedge__connection__t.html">edge_connection_t</a> *exitconn, const <a class="el" href="structcached__resolve__t.html">cached_resolve_t</a> *resolve, char **hostname_out))</td></tr>
<tr class="separator:af4e5269113b9e470fedaf89274faef8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afafa1598de954f7679e42a141e29adc3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#afafa1598de954f7679e42a141e29adc3">assert_connection_edge_not_dns_pending</a> (<a class="el" href="structedge__connection__t.html">edge_connection_t</a> *conn)</td></tr>
<tr class="separator:afafa1598de954f7679e42a141e29adc3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abab9ee4ae98eafd0454adef2477f1a76"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#abab9ee4ae98eafd0454adef2477f1a76">assert_all_pending_dns_resolves_ok</a> (void)</td></tr>
<tr class="separator:abab9ee4ae98eafd0454adef2477f1a76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a761da0f544b95dc87b5522f49d9866"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a6a761da0f544b95dc87b5522f49d9866">connection_dns_remove</a> (<a class="el" href="structedge__connection__t.html">edge_connection_t</a> *conn)</td></tr>
<tr class="separator:a6a761da0f544b95dc87b5522f49d9866"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bf01fdba32884382bcc62177cafaae6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a4bf01fdba32884382bcc62177cafaae6">MOCK_IMPL</a> (void, dns_cancel_pending_resolve,(const char *address))</td></tr>
<tr class="separator:a4bf01fdba32884382bcc62177cafaae6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54580f3c6a1aa8cb61ba34ea2d4086b2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a54580f3c6a1aa8cb61ba34ea2d4086b2">MOCK_IMPL</a> (STATIC int, launch_resolve,(<a class="el" href="structcached__resolve__t.html">cached_resolve_t</a> *resolve))</td></tr>
<tr class="separator:a54580f3c6a1aa8cb61ba34ea2d4086b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf46fd8cafe93cc99a378d292b852c46"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#adf46fd8cafe93cc99a378d292b852c46">dns_launch_correctness_checks</a> (void)</td></tr>
<tr class="separator:adf46fd8cafe93cc99a378d292b852c46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b819cc48d2e8107d9679acb409a5e10"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a2b819cc48d2e8107d9679acb409a5e10">dns_seems_to_be_broken</a> (void)</td></tr>
<tr class="separator:a2b819cc48d2e8107d9679acb409a5e10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e4cbe37fe053a171b05c21230dac9d9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a9e4cbe37fe053a171b05c21230dac9d9">dns_seems_to_be_broken_for_ipv6</a> (void)</td></tr>
<tr class="separator:a9e4cbe37fe053a171b05c21230dac9d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a307a827eed6277f5125f6503da3ddbe2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a307a827eed6277f5125f6503da3ddbe2">dns_reset_correctness_checks</a> (void)</td></tr>
<tr class="separator:a307a827eed6277f5125f6503da3ddbe2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a810cf2d60d161a15ffada266dcddf3a4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a810cf2d60d161a15ffada266dcddf3a4">dump_dns_mem_usage</a> (int severity)</td></tr>
<tr class="separator:a810cf2d60d161a15ffada266dcddf3a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75a8a5d2156128037108dfa039e3d141"><td class="memItemLeft" align="right" valign="top"><a id="a75a8a5d2156128037108dfa039e3d141"></a>
<a class="el" href="structcached__resolve__t.html">cached_resolve_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>dns_get_cache_entry</b> (<a class="el" href="structcached__resolve__t.html">cached_resolve_t</a> *query)</td></tr>
<tr class="separator:a75a8a5d2156128037108dfa039e3d141"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79733be17d110c760b9b70d0fb57f322"><td class="memItemLeft" align="right" valign="top"><a id="a79733be17d110c760b9b70d0fb57f322"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>dns_insert_cache_entry</b> (<a class="el" href="structcached__resolve__t.html">cached_resolve_t</a> *new_entry)</td></tr>
<tr class="separator:a79733be17d110c760b9b70d0fb57f322"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implements a local cache for DNS results for Tor servers. This is implemented as a wrapper around Adam Langley's eventdns.c code. (We can't just use gethostbyname() and friends because we really need to be nonblocking.) </p>
<p>There are three main cases when a Tor relay uses <a class="el" href="dns_8c.html" title="Implements a local cache for DNS results for Tor servers. This is implemented as a wrapper around Ada...">dns.c</a> to launch a DNS request: </p><ol>
<li>
To check whether the DNS server is working more or less correctly. This happens via <a class="el" href="dns_8c.html#adf46fd8cafe93cc99a378d292b852c46">dns_launch_correctness_checks()</a>. The answer is reported in the return value from later calls to <a class="el" href="dns_8c.html#a2b819cc48d2e8107d9679acb409a5e10">dns_seems_to_be_broken()</a>. </li>
<li>
When a client has asked the relay, in a RELAY_BEGIN cell, to connect to a given server by hostname. This happens via <a class="el" href="dns_8c.html#aa1ffeb643093b409c75573a27574afbc">dns_resolve()</a>. </li>
<li>
When a client has asked the relay, in a RELAY_RESOLVE cell, to look up a given server's IP address(es) by hostname. This also happens via <a class="el" href="dns_8c.html#aa1ffeb643093b409c75573a27574afbc">dns_resolve()</a>. </li>
</ol>
<p>Each of these gets handled a little differently.</p>
<p>To check for correctness, we look up some hostname we expect to exist and have real entries, some hostnames which we expect to definitely not exist, and some hostnames that we expect to probably not exist. If too many of the hostnames that shouldn't exist do exist, that's a DNS hijacking attempt. If too many of the hostnames that should exist have the same addresses as the ones that shouldn't exist, that's a very bad DNS hijacking attempt, or a very naughty captive portal. And if the hostnames that should exist simply don't exist, we probably have a broken nameserver.</p>
<p>To handle client requests, we first check our cache for answers. If there isn't something up-to-date, we've got to launch A or AAAA requests as appropriate. How we handle responses to those in particular is a bit complex; see dns_lookup() and set_exitconn_info_from_resolve().</p>
<p>When a lookup is finally complete, the inform_pending_connections() function will tell all of the streams that have been waiting for the resolve, by calling <a class="el" href="connection__edge_8c.html#a64bdbd8f1352e1101d8a9a409049a057">connection_exit_connect()</a> if the client sent a RELAY_BEGIN cell, and by calling send_resolved_cell() or send_hostname_cell() if the client sent a RELAY_RESOLVE cell. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a4f4fbaf3b9d88e32c2bd4bff9eaadbe7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f4fbaf3b9d88e32c2bd4bff9eaadbe7">&#9670;&nbsp;</a></span>RESOLVE_MAX_TIMEOUT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RESOLVE_MAX_TIMEOUT&#160;&#160;&#160;300</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>How long will we wait for an answer from the resolver before we decide that the resolver is wedged? </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="abab9ee4ae98eafd0454adef2477f1a76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abab9ee4ae98eafd0454adef2477f1a76">&#9670;&nbsp;</a></span>assert_all_pending_dns_resolves_ok()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void assert_all_pending_dns_resolves_ok </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Log an error and abort if any connection waiting for a DNS resolve is corrupted. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dns_8c_abab9ee4ae98eafd0454adef2477f1a76_cgraph.png" border="0" usemap="#dns_8c_abab9ee4ae98eafd0454adef2477f1a76_cgraph" alt=""/></div>
<map name="dns_8c_abab9ee4ae98eafd0454adef2477f1a76_cgraph" id="dns_8c_abab9ee4ae98eafd0454adef2477f1a76_cgraph">
<area shape="rect" id="node2" href="connection_8c.html#a738d9e7ef0c4a101c2adbd4cade35475" title="assert_connection_ok" alt="" coords="184,5,333,32"/>
<area shape="rect" id="node3" href="main_8c.html#a49e8c66d5c632a692690342427171dd7" title="connection_in_array" alt="" coords="189,56,328,83"/>
<area shape="rect" id="node4" href="container_8c.html#abbb4ca13d840b2761ed4d70c63f0b2f4" title="smartlist_contains" alt="" coords="381,56,509,83"/>
</map>
</div>

</div>
</div>
<a id="afafa1598de954f7679e42a141e29adc3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afafa1598de954f7679e42a141e29adc3">&#9670;&nbsp;</a></span>assert_connection_edge_not_dns_pending()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void assert_connection_edge_not_dns_pending </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structedge__connection__t.html">edge_connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Log an error and abort if conn is waiting for a DNS resolve. </p>

</div>
</div>
<a id="a6a761da0f544b95dc87b5522f49d9866"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a761da0f544b95dc87b5522f49d9866">&#9670;&nbsp;</a></span>connection_dns_remove()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_dns_remove </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structedge__connection__t.html">edge_connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove <b>conn</b> from the list of connections waiting for conn-&gt;address. </p>

</div>
</div>
<a id="adae55d1d541c43481d02de8254a805ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adae55d1d541c43481d02de8254a805ec">&#9670;&nbsp;</a></span>dns_clip_ttl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t dns_clip_ttl </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ttl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Helper: Given a TTL from a DNS response, determine what TTL to give the OP that asked us to resolve it, and how long to cache that record ourselves. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dns_8c_adae55d1d541c43481d02de8254a805ec_icgraph.png" border="0" usemap="#dns_8c_adae55d1d541c43481d02de8254a805ec_icgraph" alt=""/></div>
<map name="dns_8c_adae55d1d541c43481d02de8254a805ec_icgraph" id="dns_8c_adae55d1d541c43481d02de8254a805ec_icgraph">
<area shape="rect" id="node2" href="dns_8c.html#a2616ee15d1faf206a7bd39a7a4c81e2c" title="MOCK_IMPL" alt="" coords="141,5,241,32"/>
</map>
</div>

</div>
</div>
<a id="a87870a99d044d10adab219c61f4185a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87870a99d044d10adab219c61f4185a4">&#9670;&nbsp;</a></span>dns_free_all()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dns_free_all </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Free all storage held in the DNS cache and related structures. </p>

</div>
</div>
<a id="a100ddc42d1f3411bc6cfbc6185af76ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a100ddc42d1f3411bc6cfbc6185af76ae">&#9670;&nbsp;</a></span>dns_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dns_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize the DNS subsystem; called by the OR process. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dns_8c_a100ddc42d1f3411bc6cfbc6185af76ae_icgraph.png" border="0" usemap="#dns_8c_a100ddc42d1f3411bc6cfbc6185af76ae_icgraph" alt=""/></div>
<map name="dns_8c_a100ddc42d1f3411bc6cfbc6185af76ae_icgraph" id="dns_8c_a100ddc42d1f3411bc6cfbc6185af76ae_icgraph">
<area shape="rect" id="node2" href="main_8h.html#a842d938cd262fb19c7c4d6177ccaa6fb" title="do_main_loop" alt="" coords="120,5,223,32"/>
</map>
</div>

</div>
</div>
<a id="adf46fd8cafe93cc99a378d292b852c46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf46fd8cafe93cc99a378d292b852c46">&#9670;&nbsp;</a></span>dns_launch_correctness_checks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dns_launch_correctness_checks </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If appropriate, start testing whether our DNS servers tend to lie to us. </p>

</div>
</div>
<a id="abc88406c6e9c82925d506b30b1e42c14"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc88406c6e9c82925d506b30b1e42c14">&#9670;&nbsp;</a></span>dns_reset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dns_reset </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Called when DNS-related options change (or may have changed). Returns -1 on failure, 0 on success. </p>

</div>
</div>
<a id="a307a827eed6277f5125f6503da3ddbe2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a307a827eed6277f5125f6503da3ddbe2">&#9670;&nbsp;</a></span>dns_reset_correctness_checks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dns_reset_correctness_checks </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Forget what we've previously learned about our DNS servers' correctness. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dns_8c_a307a827eed6277f5125f6503da3ddbe2_cgraph.png" border="0" usemap="#dns_8c_a307a827eed6277f5125f6503da3ddbe2_cgraph" alt=""/></div>
<map name="dns_8c_a307a827eed6277f5125f6503da3ddbe2_cgraph" id="dns_8c_a307a827eed6277f5125f6503da3ddbe2_cgraph">
<area shape="rect" id="node2" href="util_8c.html#a40d94cc20afc38582c65aa418919ebed" title="tor_free_" alt="" coords="225,5,298,32"/>
<area shape="rect" id="node3" href="container_8c.html#ad24500d61ff1dbb6c845a8a70f6d2f14" title="smartlist_clear" alt="" coords="208,56,315,83"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dns_8c_a307a827eed6277f5125f6503da3ddbe2_icgraph.png" border="0" usemap="#dns_8c_a307a827eed6277f5125f6503da3ddbe2_icgraph" alt=""/></div>
<map name="dns_8c_a307a827eed6277f5125f6503da3ddbe2_icgraph" id="dns_8c_a307a827eed6277f5125f6503da3ddbe2_icgraph">
<area shape="rect" id="node2" href="main_8h.html#a1725c3c7eee555118c2f19cebe1ca00d" title="dns_servers_relaunch\l_checks" alt="" coords="208,5,357,47"/>
</map>
</div>

</div>
</div>
<a id="aa1ffeb643093b409c75573a27574afbc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1ffeb643093b409c75573a27574afbc">&#9670;&nbsp;</a></span>dns_resolve()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dns_resolve </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structedge__connection__t.html">edge_connection_t</a> *&#160;</td>
          <td class="paramname"><em>exitconn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>See if we have a cache entry for <b>exitconn</b>-&gt;address. If so, if resolve valid, put it into <b>exitconn</b>-&gt;addr and return 1. If resolve failed, free exitconn and return -1.</p>
<p>(For EXIT_PURPOSE_RESOLVE connections, send back a RESOLVED error cell on returning -1. For EXIT_PURPOSE_CONNECT connections, there's no need to send back an END cell, since connection_exit_begin_conn will do that for us.)</p>
<p>If we have a cached answer, send the answer back along <b>exitconn</b>'s circuit.</p>
<p>Else, if seen before and pending, add conn to the pending list, and return 0.</p>
<p>Else, if not seen before, add conn to pending list, hand to dns farm, and return 0.</p>
<p>Exitconn's on_circuit field must be set, but exitconn should not yet be linked onto the n_streams/resolving_streams list of that circuit. On success, link the connection to n_streams if it's an exit connection. On "pending", link the connection to resolving streams. Otherwise, clear its on_circuit field. </p>

</div>
</div>
<a id="a2b819cc48d2e8107d9679acb409a5e10"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b819cc48d2e8107d9679acb409a5e10">&#9670;&nbsp;</a></span>dns_seems_to_be_broken()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dns_seems_to_be_broken </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff our DNS servers lie to us too much to be trusted. </p>

</div>
</div>
<a id="a9e4cbe37fe053a171b05c21230dac9d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e4cbe37fe053a171b05c21230dac9d9">&#9670;&nbsp;</a></span>dns_seems_to_be_broken_for_ipv6()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dns_seems_to_be_broken_for_ipv6 </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff we think that IPv6 hostname lookup is broken </p>

</div>
</div>
<a id="a810cf2d60d161a15ffada266dcddf3a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a810cf2d60d161a15ffada266dcddf3a4">&#9670;&nbsp;</a></span>dump_dns_mem_usage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dump_dns_mem_usage </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>severity</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Log memory information about our internal DNS cache at level 'severity'. </p>

</div>
</div>
<a id="a78d2ffb374ea9661ae7940dd63266892"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78d2ffb374ea9661ae7940dd63266892">&#9670;&nbsp;</a></span>has_dns_init_failed()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int has_dns_init_failed </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff the most recent attempt to initialize the DNS subsystem failed. </p>

</div>
</div>
<a id="a9d9998b8c60f2ea2ebbec0e240850ecc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d9998b8c60f2ea2ebbec0e240850ecc">&#9670;&nbsp;</a></span>HT_PROTOTYPE()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HT_PROTOTYPE </td>
          <td>(</td>
          <td class="paramtype">HT_GENERATE2(&#160;</td>
          <td class="paramname"><em>cache_map</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HT_GENERATE2(&#160;</td>
          <td class="paramname"><em>cached_resolve_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HT_GENERATE2(&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HT_GENERATE2(&#160;</td>
          <td class="paramname"><em>cached_resolve_hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HT_GENERATE2(&#160;</td>
          <td class="paramname"><em>cached_resolves_eq</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize the DNS cache. </p>

</div>
</div>
<a id="a2616ee15d1faf206a7bd39a7a4c81e2c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2616ee15d1faf206a7bd39a7a4c81e2c">&#9670;&nbsp;</a></span>MOCK_IMPL() <span class="overload">[1/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MOCK_IMPL </td>
          <td>(</td>
          <td class="paramtype">STATIC&#160;</td>
          <td class="paramname"><em>void</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">send_resolved_cell&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">(<a class="el" href="structedge__connection__t.html">edge_connection_t</a> *conn, uint8_t answer_type, const <a class="el" href="structcached__resolve__t.html">cached_resolve_t</a> *resolved)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Send a response to the RESOLVE request of a connection. <b>answer_type</b> must be one of RESOLVED_TYPE_(AUTO|ERROR|ERROR_TRANSIENT|).</p>
<p>If <b>circ</b> is provided, and we have a cached answer, send the answer back along circ; otherwise, send the answer back along <b>conn</b>'s attached circuit. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dns_8c_a2616ee15d1faf206a7bd39a7a4c81e2c_cgraph.png" border="0" usemap="#dns_8c_a2616ee15d1faf206a7bd39a7a4c81e2c_cgraph" alt=""/></div>
<map name="dns_8c_a2616ee15d1faf206a7bd39a7a4c81e2c_cgraph" id="dns_8c_a2616ee15d1faf206a7bd39a7a4c81e2c_cgraph">
<area shape="rect" id="node2" href="dns_8c.html#adae55d1d541c43481d02de8254a805ec" title="dns_clip_ttl" alt="" coords="153,5,241,32"/>
</map>
</div>

</div>
</div>
<a id="ab0ebff7a0b3f4a11fe87b9e70afae499"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0ebff7a0b3f4a11fe87b9e70afae499">&#9670;&nbsp;</a></span>MOCK_IMPL() <span class="overload">[2/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MOCK_IMPL </td>
          <td>(</td>
          <td class="paramtype">STATIC&#160;</td>
          <td class="paramname"><em>void</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">send_resolved_hostname_cell&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">(<a class="el" href="structedge__connection__t.html">edge_connection_t</a> *conn, const char *hostname)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Send a response to the RESOLVE request of a connection for an in-addr.arpa address on connection <b>conn</b> which yielded the result <b>hostname</b>. The answer type will be RESOLVED_HOSTNAME.</p>
<p>If <b>circ</b> is provided, and we have a cached answer, send the answer back along circ; otherwise, send the answer back along <b>conn</b>'s attached circuit. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dns_8c_ab0ebff7a0b3f4a11fe87b9e70afae499_cgraph.png" border="0" usemap="#dns_8c_ab0ebff7a0b3f4a11fe87b9e70afae499_cgraph" alt=""/></div>
<map name="dns_8c_ab0ebff7a0b3f4a11fe87b9e70afae499_cgraph" id="dns_8c_ab0ebff7a0b3f4a11fe87b9e70afae499_cgraph">
<area shape="rect" id="node2" href="dns_8c.html#adae55d1d541c43481d02de8254a805ec" title="dns_clip_ttl" alt="" coords="153,5,241,32"/>
</map>
</div>

</div>
</div>
<a id="a224ce234dfdd68cbfe885138b40e1dfd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a224ce234dfdd68cbfe885138b40e1dfd">&#9670;&nbsp;</a></span>MOCK_IMPL() <span class="overload">[3/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MOCK_IMPL </td>
          <td>(</td>
          <td class="paramtype">STATIC&#160;</td>
          <td class="paramname"><em>int</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">dns_resolve_impl&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">(<a class="el" href="structedge__connection__t.html">edge_connection_t</a> *exitconn, int is_resolve, <a class="el" href="structor__circuit__t.html">or_circuit_t</a> *oncirc, char **hostname_out, int *made_connection_pending_out, <a class="el" href="structcached__resolve__t.html">cached_resolve_t</a> **resolve_out)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Helper function for dns_resolve: same functionality, but does not handle:</p><ul>
<li>marking connections on error and clearing their on_circuit</li>
<li>linking connections to n_streams/resolving_streams,</li>
<li>sending resolved cells if we have an answer/error right away,</li>
</ul>
<p>Return -2 on a transient error. If it's a reverse resolve and it's successful, sets *<b>hostname_out</b> to a newly allocated string holding the cached reverse DNS value.</p>
<p>Set *<b>made_connection_pending_out</b> to true if we have placed <b>exitconn</b> on the list of pending connections for some resolve; set it to false otherwise.</p>
<p>Set *<b>resolve_out</b> to a cached resolve, if we found one. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dns_8c_a224ce234dfdd68cbfe885138b40e1dfd_cgraph.png" border="0" usemap="#dns_8c_a224ce234dfdd68cbfe885138b40e1dfd_cgraph" alt=""/></div>
<map name="dns_8c_a224ce234dfdd68cbfe885138b40e1dfd_cgraph" id="dns_8c_a224ce234dfdd68cbfe885138b40e1dfd_cgraph">
<area shape="rect" id="node2" href="connection_8c.html#a738d9e7ef0c4a101c2adbd4cade35475" title="assert_connection_ok" alt="" coords="153,5,303,32"/>
</map>
</div>

</div>
</div>
<a id="af4e5269113b9e470fedaf89274faef8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4e5269113b9e470fedaf89274faef8a">&#9670;&nbsp;</a></span>MOCK_IMPL() <span class="overload">[4/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MOCK_IMPL </td>
          <td>(</td>
          <td class="paramtype">STATIC&#160;</td>
          <td class="paramname"><em>int</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">set_exitconn_info_from_resolve&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">(<a class="el" href="structedge__connection__t.html">edge_connection_t</a> *exitconn, const <a class="el" href="structcached__resolve__t.html">cached_resolve_t</a> *resolve, char **hostname_out)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given an exit connection <b>exitconn</b>, and a <a class="el" href="structcached__resolve__t.html">cached_resolve_t</a> <b>resolve</b> whose DNS lookups have all either succeeded or failed, update the appropriate fields (address_ttl and addr) of <b>exitconn</b>.</p>
<p>The logic can be complicated here, since we might have launched both an A lookup and an AAAA lookup, and since either of those might have succeeded or failed, and since we want to answer a RESOLVE cell with a full answer but answer a BEGIN cell with whatever answer the client would accept <em>and</em> we could still connect to.</p>
<p>If this is a reverse lookup, set *<b>hostname_out</b> to a newly allocated copy of the name resulting hostname.</p>
<p>Return -2 on a transient error, -1 on a permenent error, and 1 on a successful lookup. </p>

</div>
</div>
<a id="a4bf01fdba32884382bcc62177cafaae6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4bf01fdba32884382bcc62177cafaae6">&#9670;&nbsp;</a></span>MOCK_IMPL() <span class="overload">[5/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MOCK_IMPL </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">dns_cancel_pending_resolve&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">(const char *address)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Mark all connections waiting for <b>address</b> for close. Then cancel the resolve for <b>address</b> itself, and remove any cached results for <b>address</b> from the cache. </p>

</div>
</div>
<a id="a54580f3c6a1aa8cb61ba34ea2d4086b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54580f3c6a1aa8cb61ba34ea2d4086b2">&#9670;&nbsp;</a></span>MOCK_IMPL() <span class="overload">[6/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MOCK_IMPL </td>
          <td>(</td>
          <td class="paramtype">STATIC&#160;</td>
          <td class="paramname"><em>int</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">launch_resolve&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">(<a class="el" href="structcached__resolve__t.html">cached_resolve_t</a> *resolve)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>For eventdns: start resolving as necessary to find the target for <b>exitconn</b>. Returns -1 on error, -2 on transient error, 0 on "resolve launched." </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dns_8c_a54580f3c6a1aa8cb61ba34ea2d4086b2_cgraph.png" border="0" usemap="#dns_8c_a54580f3c6a1aa8cb61ba34ea2d4086b2_cgraph" alt=""/></div>
<map name="dns_8c_a54580f3c6a1aa8cb61ba34ea2d4086b2_cgraph" id="dns_8c_a54580f3c6a1aa8cb61ba34ea2d4086b2_cgraph">
<area shape="rect" id="node2" href="router_8c.html#a0b7d8b358c0cdb6359916151f1863e36" title="net_is_disabled" alt="" coords="153,5,265,32"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
