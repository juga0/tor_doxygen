<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tor: /home/user/_my/code/bwauth-related/tor/src/or/geoip.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tor
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97b64286d42c5ef1697cb5f17129db19.html">tor</a></li><li class="navelem"><a class="el" href="dir_3cb0ba3f4b82dbe34a1a06276e96bc8d.html">src</a></li><li class="navelem"><a class="el" href="dir_386635fabd7f6c74e9d9c7a8604514a0.html">or</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">geoip.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Functions related to maintaining an IP-to-country database; to summarizing client connections by country to entry guards, bridges, and directory servers; and for statistics on answering network status requests.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="or_8h_source.html">or.h</a>&quot;</code><br />
<code>#include &quot;ht.h&quot;</code><br />
<code>#include &quot;<a class="el" href="buffers_8h_source.html">buffers.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="config_8h_source.html">config.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="control_8h_source.html">control.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="dnsserv_8h_source.html">dnsserv.h</a>&quot;</code><br />
<code>#include &quot;dos.h&quot;</code><br />
<code>#include &quot;<a class="el" href="geoip_8h_source.html">geoip.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="routerlist_8h_source.html">routerlist.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for geoip.c:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8c__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2geoip_8c" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2geoip_8c" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2geoip_8c">
<area shape="rect" id="node2" href="or_8h.html" title="Master header file for Tor&#45;specific functionality. " alt="" coords="1530,109,1574,136"/>
<area shape="rect" id="node34" href="ht_8h_source.html" title="ht.h" alt="" coords="2258,184,2302,211"/>
<area shape="rect" id="node41" href="buffers_8h.html" title="Header file for buffers.c. " alt="" coords="1331,632,1405,659"/>
<area shape="rect" id="node42" href="config_8h.html" title="Header file for config.c. " alt="" coords="25,707,93,733"/>
<area shape="rect" id="node43" href="control_8h.html" title="Header file for control.c. " alt="" coords="2124,109,2196,136"/>
<area shape="rect" id="node44" href="dnsserv_8h.html" title="Header file for dnsserv.c. " alt="" coords="2221,109,2299,136"/>
<area shape="rect" id="node45" href="dos_8h_source.html" title="dos.h" alt="" coords="2378,184,2433,211"/>
<area shape="rect" id="node46" href="geoip_8h.html" title="Header file for geoip.c. " alt="" coords="1985,109,2049,136"/>
<area shape="rect" id="node47" href="routerlist_8h.html" title="Header file for routerlist.c. " alt="" coords="120,557,203,584"/>
<area shape="rect" id="node3" href="orconfig_8h_source.html" title="orconfig.h" alt="" coords="1133,931,1211,957"/>
<area shape="rect" id="node4" href="torint_8h.html" title="Header file to define uint32_t and friends. " alt="" coords="1985,856,2047,883"/>
<area shape="rect" id="node6" href="crypto_8h.html" title="Headers for crypto.c. " alt="" coords="1593,259,1663,285"/>
<area shape="rect" id="node20" href="container_8h_source.html" title="container.h" alt="" coords="1774,483,1861,509"/>
<area shape="rect" id="node22" href="torlog_8h.html" title="Headers for log.c. " alt="" coords="601,483,666,509"/>
<area shape="rect" id="node23" href="crypto__format_8h_source.html" title="crypto_format.h" alt="" coords="829,184,942,211"/>
<area shape="rect" id="node24" href="crypto__ed25519_8h_source.html" title="crypto_ed25519.h" alt="" coords="843,259,968,285"/>
<area shape="rect" id="node25" href="crypto__curve25519_8h_source.html" title="crypto_curve25519.h" alt="" coords="879,333,1022,360"/>
<area shape="rect" id="node28" href="tortls_8h.html" title="Headers for tortls.c. " alt="" coords="1506,259,1569,285"/>
<area shape="rect" id="node31" href="compress_8h.html" title="Headers for compress.c. " alt="" coords="1017,184,1108,211"/>
<area shape="rect" id="node32" href="address_8h.html" title="Headers for address.h. " alt="" coords="1875,408,1954,435"/>
<area shape="rect" id="node33" href="compat__libevent_8h_source.html" title="compat_libevent.h" alt="" coords="75,781,203,808"/>
<area shape="rect" id="node35" href="confline_8h_source.html" title="confline.h" alt="" coords="1738,259,1817,285"/>
<area shape="rect" id="node36" href="replaycache_8h.html" title="Header file for replaycache.c. " alt="" coords="1133,184,1235,211"/>
<area shape="rect" id="node37" href="tor__queue_8h_source.html" title="tor_queue.h" alt="" coords="1260,184,1351,211"/>
<area shape="rect" id="node38" href="token__bucket_8h_source.html" title="token_bucket.h" alt="" coords="2025,781,2135,808"/>
<area shape="rect" id="node39" href="util__format_8h_source.html" title="util_format.h" alt="" coords="1906,781,2001,808"/>
<area shape="rect" id="node40" href="hs__circuitmap_8h.html" title="Header file for hs_circuitmap.c. " alt="" coords="1375,184,1489,211"/>
<area shape="rect" id="node8" href="compat_8h_source.html" title="compat.h" alt="" coords="1238,707,1314,733"/>
<area shape="rect" id="node14" href="util_8h.html" title="Headers for util.c. " alt="" coords="989,557,1040,584"/>
<area shape="rect" id="node18" href="crypto__rsa_8h.html" title="Headers for crypto_rsa.c. " alt="" coords="1346,333,1441,360"/>
<area shape="rect" id="node9" href="testsupport_8h_source.html" title="testsupport.h" alt="" coords="495,856,593,883"/>
<area shape="rect" id="node11" href="compat__time_8h.html" title="Functions and types for monotonic times. " alt="" coords="1073,856,1181,883"/>
<area shape="rect" id="node13" href="compat__threads_8h_source.html" title="compat_threads.h" alt="" coords="1123,781,1250,808"/>
<area shape="rect" id="node15" href="di__ops_8h.html" title="Headers for di_ops.c. " alt="" coords="1455,781,1526,808"/>
<area shape="rect" id="node17" href="util__bug_8h.html" title="Macros to manage assertions, fatal and non&#45;fatal. " alt="" coords="835,632,914,659"/>
<area shape="rect" id="node19" href="crypto__digest_8h.html" title="Headers for crypto_digest.c. " alt="" coords="1385,408,1495,435"/>
<area shape="rect" id="node21" href="siphash_8h_source.html" title="siphash.h" alt="" coords="1778,557,1857,584"/>
<area shape="rect" id="node26" href="crypto__openssl__mgt_8h_source.html" title="crypto_openssl_mgt.h" alt="" coords="846,408,997,435"/>
<area shape="rect" id="node29" href="compat__openssl_8h.html" title="compatibility definitions for working with different openssl forks " alt="" coords="1076,333,1204,360"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structgeoip__ipv4__entry__t.html">geoip_ipv4_entry_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structgeoip__ipv6__entry__t.html">geoip_ipv6_entry_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structgeoip__country__t.html">geoip_country_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structc__hist__t.html">c_hist_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdirreq__map__entry__t.html">dirreq_map_entry_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aa2063df459b14e3d622fd443823c241d"><td class="memItemLeft" align="right" valign="top"><a id="aa2063df459b14e3d622fd443823c241d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>GEOIP_PRIVATE</b></td></tr>
<tr class="separator:aa2063df459b14e3d622fd443823c241d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8c16fe272a372fd29067461f5bbbb6d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#af8c16fe272a372fd29067461f5bbbb6d">MAX_LAST_SEEN_IN_MINUTES</a>&#160;&#160;&#160;0X3FFFFFFFu</td></tr>
<tr class="separator:af8c16fe272a372fd29067461f5bbbb6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ba9a2cf68e73b0e6348358b515db516"><td class="memItemLeft" align="right" valign="top"><a id="a2ba9a2cf68e73b0e6348358b515db516"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>clientmap_entry_free</b>(ent)&#160;&#160;&#160;FREE_AND_NULL(<a class="el" href="structclientmap__entry__t.html">clientmap_entry_t</a>, clientmap_entry_free_, ent)</td></tr>
<tr class="separator:a2ba9a2cf68e73b0e6348358b515db516"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cf40242b1e7c58903b2bc270bda706f"><td class="memItemLeft" align="right" valign="top"><a id="a6cf40242b1e7c58903b2bc270bda706f"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>GEOIP_CLIENT_CACHE_OOM_MIN_CUTOFF</b>&#160;&#160;&#160;(4 * 60 * 60)</td></tr>
<tr class="separator:a6cf40242b1e7c58903b2bc270bda706f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14416281ca4bf32e65237f3d1218a3d0"><td class="memItemLeft" align="right" valign="top"><a id="a14416281ca4bf32e65237f3d1218a3d0"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>GEOIP_CLIENT_CACHE_OOM_STEP</b>&#160;&#160;&#160;(15 * 50)</td></tr>
<tr class="separator:a14416281ca4bf32e65237f3d1218a3d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a328bfc24d8be5f4d53b58fce42e55ecb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a328bfc24d8be5f4d53b58fce42e55ecb">MIN_IPS_TO_NOTE_COUNTRY</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a328bfc24d8be5f4d53b58fce42e55ecb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f421171343412953eca477bcbd13c96"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a9f421171343412953eca477bcbd13c96">MIN_IPS_TO_NOTE_ANYTHING</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a9f421171343412953eca477bcbd13c96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a562ce73ce3f55f278ebe7d77cf1b5e70"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a562ce73ce3f55f278ebe7d77cf1b5e70">IP_GRANULARITY</a>&#160;&#160;&#160;8</td></tr>
<tr class="separator:a562ce73ce3f55f278ebe7d77cf1b5e70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0977c6b4766f2c4addf9b9e6d3c0d91a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a0977c6b4766f2c4addf9b9e6d3c0d91a">DIRREQ_TIMEOUT</a>&#160;&#160;&#160;(10*60)</td></tr>
<tr class="separator:a0977c6b4766f2c4addf9b9e6d3c0d91a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36441dd2fb31d37bc0cf1104bb8210b2"><td class="memItemLeft" align="right" valign="top"><a id="a36441dd2fb31d37bc0cf1104bb8210b2"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DIR_REQ_GRANULARITY</b>&#160;&#160;&#160;4</td></tr>
<tr class="separator:a36441dd2fb31d37bc0cf1104bb8210b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad595bb2845d6aea670dd0e7ca1d3034a"><td class="memItemLeft" align="right" valign="top"><a id="ad595bb2845d6aea670dd0e7ca1d3034a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MIN_DIR_REQ_RESPONSES</b>&#160;&#160;&#160;16</td></tr>
<tr class="separator:ad595bb2845d6aea670dd0e7ca1d3034a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5edb03f67b604fc5ba46568b7f28f72"><td class="memItemLeft" align="right" valign="top"><a id="ac5edb03f67b604fc5ba46568b7f28f72"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>RESPONSE_GRANULARITY</b>&#160;&#160;&#160;8</td></tr>
<tr class="separator:ac5edb03f67b604fc5ba46568b7f28f72"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:abbb63097cde0b016bbc5c411b8c0c51f"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structgeoip__ipv4__entry__t.html">geoip_ipv4_entry_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#abbb63097cde0b016bbc5c411b8c0c51f">geoip_ipv4_entry_t</a></td></tr>
<tr class="separator:abbb63097cde0b016bbc5c411b8c0c51f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a42c91aece560626936b89b6dce2d4b"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structgeoip__ipv6__entry__t.html">geoip_ipv6_entry_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a3a42c91aece560626936b89b6dce2d4b">geoip_ipv6_entry_t</a></td></tr>
<tr class="separator:a3a42c91aece560626936b89b6dce2d4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1eba31b5ae5f1ca268303cc8a592e427"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structgeoip__country__t.html">geoip_country_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a1eba31b5ae5f1ca268303cc8a592e427">geoip_country_t</a></td></tr>
<tr class="separator:a1eba31b5ae5f1ca268303cc8a592e427"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1075d9b1ad7d499095e2328332467e4b"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structc__hist__t.html">c_hist_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a1075d9b1ad7d499095e2328332467e4b">c_hist_t</a></td></tr>
<tr class="separator:a1075d9b1ad7d499095e2328332467e4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92eed8cbb9f36383ef63d8b8b4313a62"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structdirreq__map__entry__t.html">dirreq_map_entry_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a92eed8cbb9f36383ef63d8b8b4313a62">dirreq_map_entry_t</a></td></tr>
<tr class="separator:a92eed8cbb9f36383ef63d8b8b4313a62"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a46be57db01b2507fb5efb601c903374f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a46be57db01b2507fb5efb601c903374f">MOCK_IMPL</a> (<a class="el" href="or_8h.html#a1b74a0e9c6772fcfcc7facf26a11a213">country_t</a>, geoip_get_country,(const char *country))</td></tr>
<tr class="separator:a46be57db01b2507fb5efb601c903374f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0f4c2f1c6dbbfd076007488f8d8aa99"><td class="memItemLeft" align="right" valign="top">STATIC int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#ab0f4c2f1c6dbbfd076007488f8d8aa99">geoip_parse_entry</a> (const char *line, sa_family_t family)</td></tr>
<tr class="separator:ab0f4c2f1c6dbbfd076007488f8d8aa99"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aecc961d6ac7cd75ec8593321d51d909a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#aecc961d6ac7cd75ec8593321d51d909a">should_record_bridge_info</a> (const <a class="el" href="structor__options__t.html">or_options_t</a> *options)</td></tr>
<tr class="separator:aecc961d6ac7cd75ec8593321d51d909a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99613dd6eb7666bd2e5fe481f15ec301"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a99613dd6eb7666bd2e5fe481f15ec301">geoip_load_file</a> (sa_family_t family, const char *filename)</td></tr>
<tr class="separator:a99613dd6eb7666bd2e5fe481f15ec301"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8db18a0728871a50a20c43d1ebef6be0"><td class="memItemLeft" align="right" valign="top">STATIC int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a8db18a0728871a50a20c43d1ebef6be0">geoip_get_country_by_ipv4</a> (uint32_t ipaddr)</td></tr>
<tr class="separator:a8db18a0728871a50a20c43d1ebef6be0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a002ed21d53f77e11e84879ff14650564"><td class="memItemLeft" align="right" valign="top">STATIC int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a002ed21d53f77e11e84879ff14650564">geoip_get_country_by_ipv6</a> (const struct <a class="el" href="structin6__addr.html">in6_addr</a> *addr)</td></tr>
<tr class="separator:a002ed21d53f77e11e84879ff14650564"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6652649f42dbfeae49682ce0d1c3fa26"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a6652649f42dbfeae49682ce0d1c3fa26">MOCK_IMPL</a> (int, geoip_get_country_by_addr,(const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *addr))</td></tr>
<tr class="separator:a6652649f42dbfeae49682ce0d1c3fa26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab35c84e4681c5b673f9fbfaa49e0e339"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#ab35c84e4681c5b673f9fbfaa49e0e339">MOCK_IMPL</a> (int, geoip_get_n_countries,(void))</td></tr>
<tr class="separator:ab35c84e4681c5b673f9fbfaa49e0e339"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b4edbf9595712e436768afa457abfcc"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a6b4edbf9595712e436768afa457abfcc">geoip_get_country_name</a> (<a class="el" href="or_8h.html#a1b74a0e9c6772fcfcc7facf26a11a213">country_t</a> num)</td></tr>
<tr class="separator:a6b4edbf9595712e436768afa457abfcc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f041613ef5d8f5a6eed566c548d5c83"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a0f041613ef5d8f5a6eed566c548d5c83">MOCK_IMPL</a> (int, geoip_is_loaded,(sa_family_t family))</td></tr>
<tr class="separator:a0f041613ef5d8f5a6eed566c548d5c83"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2facbb330d6f7714db2fd5293ed00477"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a2facbb330d6f7714db2fd5293ed00477">geoip_db_digest</a> (sa_family_t family)</td></tr>
<tr class="separator:a2facbb330d6f7714db2fd5293ed00477"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e7c29b1fb0be7f128aa35dc23f61cf3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a2e7c29b1fb0be7f128aa35dc23f61cf3">HT_PROTOTYPE</a> (HT_GENERATE2(clientmap, HT_GENERATE2(<a class="el" href="structclientmap__entry__t.html">clientmap_entry_t</a>, HT_GENERATE2(node, HT_GENERATE2(clientmap_entry_hash, HT_GENERATE2(clientmap_entries_eq)</td></tr>
<tr class="separator:a2e7c29b1fb0be7f128aa35dc23f61cf3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89c00fefaf2f19a1097e93e3116cd30f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a89c00fefaf2f19a1097e93e3116cd30f">geoip_note_client_seen</a> (<a class="el" href="or_8h.html#a583c7385547b5d02255fa8a8bd5d41dd">geoip_client_action_t</a> action, const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *addr, const char *transport_name, time_t now)</td></tr>
<tr class="separator:a89c00fefaf2f19a1097e93e3116cd30f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44567c1ed4bddb830f39ccdc3a48b45e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a44567c1ed4bddb830f39ccdc3a48b45e">geoip_remove_old_clients</a> (time_t cutoff)</td></tr>
<tr class="separator:a44567c1ed4bddb830f39ccdc3a48b45e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81694e23a1b491980710ce4fee696573"><td class="memItemLeft" align="right" valign="top"><a id="a81694e23a1b491980710ce4fee696573"></a>
<a class="el" href="structclientmap__entry__t.html">clientmap_entry_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>geoip_lookup_client</b> (const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *addr, const char *transport_name, <a class="el" href="or_8h.html#a583c7385547b5d02255fa8a8bd5d41dd">geoip_client_action_t</a> action)</td></tr>
<tr class="separator:a81694e23a1b491980710ce4fee696573"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add7c5cc110714231e1f34da7e95d9007"><td class="memItemLeft" align="right" valign="top"><a id="add7c5cc110714231e1f34da7e95d9007"></a>
size_t&#160;</td><td class="memItemRight" valign="bottom"><b>geoip_client_cache_handle_oom</b> (time_t now, size_t min_remove_bytes)</td></tr>
<tr class="separator:add7c5cc110714231e1f34da7e95d9007"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cbb6210291effe28c16054d7aaa3ae8"><td class="memItemLeft" align="right" valign="top"><a id="a3cbb6210291effe28c16054d7aaa3ae8"></a>
size_t&#160;</td><td class="memItemRight" valign="bottom"><b>geoip_client_cache_total_allocation</b> (void)</td></tr>
<tr class="separator:a3cbb6210291effe28c16054d7aaa3ae8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d6b5b368e2d9fd4f87a19161c17ea1d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a3d6b5b368e2d9fd4f87a19161c17ea1d">geoip_note_ns_response</a> (<a class="el" href="or_8h.html#afdb6254fb58e226a267558a966bc4749">geoip_ns_response_t</a> response)</td></tr>
<tr class="separator:a3d6b5b368e2d9fd4f87a19161c17ea1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a642404b6a23907878bdbd5459ec356df"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a642404b6a23907878bdbd5459ec356df">geoip_start_dirreq</a> (uint64_t dirreq_id, size_t response_size, <a class="el" href="or_8h.html#a118711f7f25509a02d10bba02f484333">dirreq_type_t</a> type)</td></tr>
<tr class="separator:a642404b6a23907878bdbd5459ec356df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a34cf4b056ecac0418dcc5927b03bb6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a2a34cf4b056ecac0418dcc5927b03bb6">geoip_change_dirreq_state</a> (uint64_t dirreq_id, <a class="el" href="or_8h.html#a118711f7f25509a02d10bba02f484333">dirreq_type_t</a> type, <a class="el" href="or_8h.html#a15ebe7a7ef485980df539b5632fd7f13">dirreq_state_t</a> new_state)</td></tr>
<tr class="separator:a2a34cf4b056ecac0418dcc5927b03bb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9680658d466013c2edcd9872397d7df4"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a9680658d466013c2edcd9872397d7df4">geoip_get_transport_history</a> (void)</td></tr>
<tr class="separator:a9680658d466013c2edcd9872397d7df4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e369d89e0ee84d0898bfa6ce1b90331"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a0e369d89e0ee84d0898bfa6ce1b90331">geoip_get_client_history</a> (<a class="el" href="or_8h.html#a583c7385547b5d02255fa8a8bd5d41dd">geoip_client_action_t</a> action, char **country_str, char **ipver_str)</td></tr>
<tr class="separator:a0e369d89e0ee84d0898bfa6ce1b90331"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2499466518ad5e26022a844ca05e5ed9"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a2499466518ad5e26022a844ca05e5ed9">geoip_get_request_history</a> (void)</td></tr>
<tr class="separator:a2499466518ad5e26022a844ca05e5ed9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d212344518dcf63b2fb63778f9fca4b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a1d212344518dcf63b2fb63778f9fca4b">geoip_dirreq_stats_init</a> (time_t now)</td></tr>
<tr class="separator:a1d212344518dcf63b2fb63778f9fca4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9776e0395b9b7397a1dd1b81130af81b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a9776e0395b9b7397a1dd1b81130af81b">geoip_reset_dirreq_stats</a> (time_t now)</td></tr>
<tr class="separator:a9776e0395b9b7397a1dd1b81130af81b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5728ac9307e2a055f2ca525473b32aee"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a5728ac9307e2a055f2ca525473b32aee">geoip_dirreq_stats_term</a> (void)</td></tr>
<tr class="separator:a5728ac9307e2a055f2ca525473b32aee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a1fa321acc074ffda98813bcf91ead4"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a5a1fa321acc074ffda98813bcf91ead4">geoip_format_dirreq_stats</a> (time_t now)</td></tr>
<tr class="separator:a5a1fa321acc074ffda98813bcf91ead4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1493d3d72b91af0a630a3ea7f88dacb5"><td class="memItemLeft" align="right" valign="top">time_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a1493d3d72b91af0a630a3ea7f88dacb5">geoip_dirreq_stats_write</a> (time_t now)</td></tr>
<tr class="separator:a1493d3d72b91af0a630a3ea7f88dacb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2135ad34b878a10f3063c8923d882315"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a2135ad34b878a10f3063c8923d882315">geoip_bridge_stats_init</a> (time_t now)</td></tr>
<tr class="separator:a2135ad34b878a10f3063c8923d882315"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4dd2b854ffac145221cfad211925dc90"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a4dd2b854ffac145221cfad211925dc90">geoip_bridge_stats_term</a> (void)</td></tr>
<tr class="separator:a4dd2b854ffac145221cfad211925dc90"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a106d5e279ceaf3dfd1585d87ac7c4bd4"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a106d5e279ceaf3dfd1585d87ac7c4bd4">geoip_format_bridge_stats</a> (time_t now)</td></tr>
<tr class="separator:a106d5e279ceaf3dfd1585d87ac7c4bd4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b5c99d168aba5cb0223650cd2989054"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a8b5c99d168aba5cb0223650cd2989054">format_client_stats_heartbeat</a> (time_t now)</td></tr>
<tr class="separator:a8b5c99d168aba5cb0223650cd2989054"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afaac00872c7f8e4d6f81aa3c32ad46a2"><td class="memItemLeft" align="right" valign="top">time_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#afaac00872c7f8e4d6f81aa3c32ad46a2">geoip_bridge_stats_write</a> (time_t now)</td></tr>
<tr class="separator:afaac00872c7f8e4d6f81aa3c32ad46a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b6387319fe2c4f08d9595d6522ad941"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a9b6387319fe2c4f08d9595d6522ad941">geoip_get_bridge_stats_extrainfo</a> (time_t now)</td></tr>
<tr class="separator:a9b6387319fe2c4f08d9595d6522ad941"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7eb9b1c4e3f8b4c9ffa04a55025b6d2"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#ab7eb9b1c4e3f8b4c9ffa04a55025b6d2">geoip_get_bridge_stats_controller</a> (time_t now)</td></tr>
<tr class="separator:ab7eb9b1c4e3f8b4c9ffa04a55025b6d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ed8ca121b3ea6b3ee4caf69724b826c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a4ed8ca121b3ea6b3ee4caf69724b826c">geoip_entry_stats_init</a> (time_t now)</td></tr>
<tr class="separator:a4ed8ca121b3ea6b3ee4caf69724b826c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e8ee9964ff62e5009f1b49231e52d1f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a0e8ee9964ff62e5009f1b49231e52d1f">geoip_reset_entry_stats</a> (time_t now)</td></tr>
<tr class="separator:a0e8ee9964ff62e5009f1b49231e52d1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4ca20951b3b9a4a251e8ae83ba0ec2f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#ad4ca20951b3b9a4a251e8ae83ba0ec2f">geoip_entry_stats_term</a> (void)</td></tr>
<tr class="separator:ad4ca20951b3b9a4a251e8ae83ba0ec2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa723566e12d91030bb8569a06efa947f"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#aa723566e12d91030bb8569a06efa947f">geoip_format_entry_stats</a> (time_t now)</td></tr>
<tr class="separator:aa723566e12d91030bb8569a06efa947f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03b8a3ff5c44a9e5a6b9e503187cc541"><td class="memItemLeft" align="right" valign="top">time_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a03b8a3ff5c44a9e5a6b9e503187cc541">geoip_entry_stats_write</a> (time_t now)</td></tr>
<tr class="separator:a03b8a3ff5c44a9e5a6b9e503187cc541"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a921840886e0a3d9ba57b014e6629cf1b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a921840886e0a3d9ba57b014e6629cf1b">getinfo_helper_geoip</a> (<a class="el" href="structcontrol__connection__t.html">control_connection_t</a> *control_conn, const char *question, char **answer, const char **errmsg)</td></tr>
<tr class="separator:a921840886e0a3d9ba57b014e6629cf1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad02b3c4fe369dfb564e9e2f84669e734"><td class="memItemLeft" align="right" valign="top">STATIC void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#ad02b3c4fe369dfb564e9e2f84669e734">clear_geoip_db</a> (void)</td></tr>
<tr class="separator:ad02b3c4fe369dfb564e9e2f84669e734"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a1572de278165ce157dc7e1c94db26e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="geoip_8c.html#a6a1572de278165ce157dc7e1c94db26e">geoip_free_all</a> (void)</td></tr>
<tr class="separator:a6a1572de278165ce157dc7e1c94db26e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Functions related to maintaining an IP-to-country database; to summarizing client connections by country to entry guards, bridges, and directory servers; and for statistics on answering network status requests. </p>
<p>There are two main kinds of functions in this module: geoip functions, which map groups of IPv4 and IPv6 addresses to country codes, and statistical functions, which collect statistics about different kinds of per-country usage.</p>
<p>The geoip lookup tables are implemented as sorted lists of disjoint address ranges, each mapping to a singleton <a class="el" href="structgeoip__country__t.html">geoip_country_t</a>. These country objects are also indexed by their names in a hashtable.</p>
<p>The tables are populated from disk at startup by the <a class="el" href="geoip_8c.html#a99613dd6eb7666bd2e5fe481f15ec301">geoip_load_file()</a> function. For more information on the file format they read, see that function. See the scripts and the README file in src/config for more information about how those files are generated.</p>
<p>Tor uses GeoIP information in order to implement user requests (such as ExcludeNodes {cc}), and to keep track of how much usage relays are getting for each country. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a0977c6b4766f2c4addf9b9e6d3c0d91a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0977c6b4766f2c4addf9b9e6d3c0d91a">&#9670;&nbsp;</a></span>DIRREQ_TIMEOUT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DIRREQ_TIMEOUT&#160;&#160;&#160;(10*60)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>When there are incomplete directory requests at the end of a 24-hour period, consider those requests running for longer than this timeout as failed, the others as still running. </p>

</div>
</div>
<a id="a562ce73ce3f55f278ebe7d77cf1b5e70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a562ce73ce3f55f278ebe7d77cf1b5e70">&#9670;&nbsp;</a></span>IP_GRANULARITY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IP_GRANULARITY&#160;&#160;&#160;8</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>When reporting geoip data about countries, round up to the nearest multiple of this value. </p>

</div>
</div>
<a id="af8c16fe272a372fd29067461f5bbbb6d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8c16fe272a372fd29067461f5bbbb6d">&#9670;&nbsp;</a></span>MAX_LAST_SEEN_IN_MINUTES</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_LAST_SEEN_IN_MINUTES&#160;&#160;&#160;0X3FFFFFFFu</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Largest allowable value for last_seen_in_minutes. (It's a 30-bit field, so it can hold up to (1u&lt;&lt;30)-1, or 0x3fffffffu. </p>

</div>
</div>
<a id="a9f421171343412953eca477bcbd13c96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f421171343412953eca477bcbd13c96">&#9670;&nbsp;</a></span>MIN_IPS_TO_NOTE_ANYTHING</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MIN_IPS_TO_NOTE_ANYTHING&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Do not report any geoip data at all if we have fewer than this number of IPs to report about. </p>

</div>
</div>
<a id="a328bfc24d8be5f4d53b58fce42e55ecb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a328bfc24d8be5f4d53b58fce42e55ecb">&#9670;&nbsp;</a></span>MIN_IPS_TO_NOTE_COUNTRY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MIN_IPS_TO_NOTE_COUNTRY&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Do not mention any country from which fewer than this number of IPs have connected. This conceivably avoids reporting information that could deanonymize users, though analysis is lacking. </p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a1075d9b1ad7d499095e2328332467e4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1075d9b1ad7d499095e2328332467e4b">&#9670;&nbsp;</a></span>c_hist_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structc__hist__t.html">c_hist_t</a>  <a class="el" href="structc__hist__t.html">c_hist_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Helper type: used to sort per-country totals by value. </p>

</div>
</div>
<a id="a92eed8cbb9f36383ef63d8b8b4313a62"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92eed8cbb9f36383ef63d8b8b4313a62">&#9670;&nbsp;</a></span>dirreq_map_entry_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structdirreq__map__entry__t.html">dirreq_map_entry_t</a>  <a class="el" href="structdirreq__map__entry__t.html">dirreq_map_entry_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Entry in a map from either chan-&gt;global_identifier for direct requests or a unique circuit identifier for tunneled requests to request time, response size, and completion time of a network status request. Used to measure download times of requests to derive average client bandwidths. </p>

</div>
</div>
<a id="a1eba31b5ae5f1ca268303cc8a592e427"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1eba31b5ae5f1ca268303cc8a592e427">&#9670;&nbsp;</a></span>geoip_country_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structgeoip__country__t.html">geoip_country_t</a>  <a class="el" href="structgeoip__country__t.html">geoip_country_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A per-country record for GeoIP request history. </p>

</div>
</div>
<a id="abbb63097cde0b016bbc5c411b8c0c51f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abbb63097cde0b016bbc5c411b8c0c51f">&#9670;&nbsp;</a></span>geoip_ipv4_entry_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structgeoip__ipv4__entry__t.html">geoip_ipv4_entry_t</a>  <a class="el" href="structgeoip__ipv4__entry__t.html">geoip_ipv4_entry_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>An entry from the GeoIP IPv4 file: maps an IPv4 range to a country. </p>

</div>
</div>
<a id="a3a42c91aece560626936b89b6dce2d4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a42c91aece560626936b89b6dce2d4b">&#9670;&nbsp;</a></span>geoip_ipv6_entry_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structgeoip__ipv6__entry__t.html">geoip_ipv6_entry_t</a>  <a class="el" href="structgeoip__ipv6__entry__t.html">geoip_ipv6_entry_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>An entry from the GeoIP IPv6 file: maps an IPv6 range to a country. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ad02b3c4fe369dfb564e9e2f84669e734"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad02b3c4fe369dfb564e9e2f84669e734">&#9670;&nbsp;</a></span>clear_geoip_db()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC void clear_geoip_db </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Release all storage held by the GeoIP databases and country list. </p>

</div>
</div>
<a id="a8b5c99d168aba5cb0223650cd2989054"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b5c99d168aba5cb0223650cd2989054">&#9670;&nbsp;</a></span>format_client_stats_heartbeat()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* format_client_stats_heartbeat </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a newly allocated string holding our bridge usage stats by country in a format suitable for inclusion in our heartbeat message. Return NULL on failure. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8c_a8b5c99d168aba5cb0223650cd2989054_cgraph.png" border="0" usemap="#geoip_8c_a8b5c99d168aba5cb0223650cd2989054_cgraph" alt=""/></div>
<map name="geoip_8c_a8b5c99d168aba5cb0223650cd2989054_cgraph" id="geoip_8c_a8b5c99d168aba5cb0223650cd2989054_cgraph">
<area shape="rect" id="node2" href="compat_8c.html#ade97970c1d8a691241adac739c4f9b12" title="tor_asprintf" alt="" coords="187,13,273,39"/>
<area shape="rect" id="node3" href="compat_8c.html#a5ef7a08e8b543c0d61f9ef1081d4c1ea" title="tor_vasprintf" alt="" coords="321,13,416,39"/>
</map>
</div>

</div>
</div>
<a id="a2135ad34b878a10f3063c8923d882315"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2135ad34b878a10f3063c8923d882315">&#9670;&nbsp;</a></span>geoip_bridge_stats_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_bridge_stats_init </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize bridge stats. </p>

</div>
</div>
<a id="a4dd2b854ffac145221cfad211925dc90"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4dd2b854ffac145221cfad211925dc90">&#9670;&nbsp;</a></span>geoip_bridge_stats_term()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_bridge_stats_term </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Stop collecting bridge stats in a way that we can re-start doing so in <a class="el" href="geoip_8c.html#a2135ad34b878a10f3063c8923d882315">geoip_bridge_stats_init()</a>. </p>

</div>
</div>
<a id="afaac00872c7f8e4d6f81aa3c32ad46a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afaac00872c7f8e4d6f81aa3c32ad46a2">&#9670;&nbsp;</a></span>geoip_bridge_stats_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">time_t geoip_bridge_stats_write </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write bridge statistics to $DATADIR/stats/bridge-stats and return when we should next try to write statistics. </p>

</div>
</div>
<a id="a2a34cf4b056ecac0418dcc5927b03bb6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a34cf4b056ecac0418dcc5927b03bb6">&#9670;&nbsp;</a></span>geoip_change_dirreq_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_change_dirreq_state </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>dirreq_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="or_8h.html#a118711f7f25509a02d10bba02f484333">dirreq_type_t</a>&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="or_8h.html#a15ebe7a7ef485980df539b5632fd7f13">dirreq_state_t</a>&#160;</td>
          <td class="paramname"><em>new_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Change the state of the either direct or tunneled (see <b>type</b>) directory request with <b>dirreq_id</b> to <b>new_state</b> and possibly mark it as completed. If no entry can be found for the given key parts (e.g., if this is a directory request that we are not measuring, or one that was started in the previous measurement period), or if the state cannot be advanced to <b>new_state</b>, do nothing. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8c_a2a34cf4b056ecac0418dcc5927b03bb6_icgraph.png" border="0" usemap="#geoip_8c_a2a34cf4b056ecac0418dcc5927b03bb6_icgraph" alt=""/></div>
<map name="geoip_8c_a2a34cf4b056ecac0418dcc5927b03bb6_icgraph" id="geoip_8c_a2a34cf4b056ecac0418dcc5927b03bb6_icgraph">
<area shape="rect" id="node2" href="channel_8c.html#abc5a904f9dc44b21911ceed8d18fd218" title="channel_notify_flushed" alt="" coords="197,5,351,32"/>
<area shape="rect" id="node3" href="directory_8h.html#a1bcf7851094badfe17ac6f027f70ce2f" title="connection_dir_finished\l_flushing" alt="" coords="195,57,353,98"/>
</map>
</div>

</div>
</div>
<a id="a2facbb330d6f7714db2fd5293ed00477"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2facbb330d6f7714db2fd5293ed00477">&#9670;&nbsp;</a></span>geoip_db_digest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* geoip_db_digest </td>
          <td>(</td>
          <td class="paramtype">sa_family_t&#160;</td>
          <td class="paramname"><em>family</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the hex-encoded SHA1 digest of the loaded GeoIP file. The result does not need to be deallocated, but will be overwritten by the next call of <a class="el" href="util_8c.html#a17effd59ed2f9bf4cfebb12e423ded7f">hex_str()</a>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8c_a2facbb330d6f7714db2fd5293ed00477_cgraph.png" border="0" usemap="#geoip_8c_a2facbb330d6f7714db2fd5293ed00477_cgraph" alt=""/></div>
<map name="geoip_8c_a2facbb330d6f7714db2fd5293ed00477_cgraph" id="geoip_8c_a2facbb330d6f7714db2fd5293ed00477_cgraph">
<area shape="rect" id="node2" href="util_8c.html#a17effd59ed2f9bf4cfebb12e423ded7f" title="hex_str" alt="" coords="169,5,235,32"/>
<area shape="rect" id="node3" href="util__format_8c.html#a8b8940b2ef607928eb3dca4850567ea5" title="base16_encode" alt="" coords="283,5,396,32"/>
</map>
</div>

</div>
</div>
<a id="a1d212344518dcf63b2fb63778f9fca4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d212344518dcf63b2fb63778f9fca4b">&#9670;&nbsp;</a></span>geoip_dirreq_stats_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_dirreq_stats_init </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize directory request stats. </p>

</div>
</div>
<a id="a5728ac9307e2a055f2ca525473b32aee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5728ac9307e2a055f2ca525473b32aee">&#9670;&nbsp;</a></span>geoip_dirreq_stats_term()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_dirreq_stats_term </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Stop collecting directory request stats in a way that we can re-start doing so in <a class="el" href="geoip_8c.html#a1d212344518dcf63b2fb63778f9fca4b">geoip_dirreq_stats_init()</a>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8c_a5728ac9307e2a055f2ca525473b32aee_cgraph.png" border="0" usemap="#geoip_8c_a5728ac9307e2a055f2ca525473b32aee_cgraph" alt=""/></div>
<map name="geoip_8c_a5728ac9307e2a055f2ca525473b32aee_cgraph" id="geoip_8c_a5728ac9307e2a055f2ca525473b32aee_cgraph">
<area shape="rect" id="node2" href="geoip_8c.html#a9776e0395b9b7397a1dd1b81130af81b" title="geoip_reset_dirreq\l_stats" alt="" coords="215,5,343,47"/>
</map>
</div>

</div>
</div>
<a id="a1493d3d72b91af0a630a3ea7f88dacb5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1493d3d72b91af0a630a3ea7f88dacb5">&#9670;&nbsp;</a></span>geoip_dirreq_stats_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">time_t geoip_dirreq_stats_write </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If 24 hours have passed since the beginning of the current dirreq stats period, write dirreq stats to $DATADIR/stats/dirreq-stats (possibly overwriting an existing file) and reset counters. Return when we would next want to write dirreq stats or 0 if we never want to write. </p>

</div>
</div>
<a id="a4ed8ca121b3ea6b3ee4caf69724b826c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ed8ca121b3ea6b3ee4caf69724b826c">&#9670;&nbsp;</a></span>geoip_entry_stats_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_entry_stats_init </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize entry stats. </p>

</div>
</div>
<a id="ad4ca20951b3b9a4a251e8ae83ba0ec2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4ca20951b3b9a4a251e8ae83ba0ec2f">&#9670;&nbsp;</a></span>geoip_entry_stats_term()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_entry_stats_term </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Stop collecting entry stats in a way that we can re-start doing so in <a class="el" href="geoip_8c.html#a4ed8ca121b3ea6b3ee4caf69724b826c">geoip_entry_stats_init()</a>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8c_ad4ca20951b3b9a4a251e8ae83ba0ec2f_cgraph.png" border="0" usemap="#geoip_8c_ad4ca20951b3b9a4a251e8ae83ba0ec2f_cgraph" alt=""/></div>
<map name="geoip_8c_ad4ca20951b3b9a4a251e8ae83ba0ec2f_cgraph" id="geoip_8c_ad4ca20951b3b9a4a251e8ae83ba0ec2f_cgraph">
<area shape="rect" id="node2" href="geoip_8c.html#a0e8ee9964ff62e5009f1b49231e52d1f" title="geoip_reset_entry_stats" alt="" coords="212,5,373,32"/>
</map>
</div>

</div>
</div>
<a id="a03b8a3ff5c44a9e5a6b9e503187cc541"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03b8a3ff5c44a9e5a6b9e503187cc541">&#9670;&nbsp;</a></span>geoip_entry_stats_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">time_t geoip_entry_stats_write </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If 24 hours have passed since the beginning of the current entry stats period, write entry stats to $DATADIR/stats/entry-stats (possibly overwriting an existing file) and reset counters. Return when we would next want to write entry stats or 0 if we never want to write. </p>

</div>
</div>
<a id="a106d5e279ceaf3dfd1585d87ac7c4bd4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a106d5e279ceaf3dfd1585d87ac7c4bd4">&#9670;&nbsp;</a></span>geoip_format_bridge_stats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* geoip_format_bridge_stats </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a newly allocated string holding our bridge usage stats by country in a format suitable for inclusion in an extrainfo document. Return NULL on failure. </p>

</div>
</div>
<a id="a5a1fa321acc074ffda98813bcf91ead4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a1fa321acc074ffda98813bcf91ead4">&#9670;&nbsp;</a></span>geoip_format_dirreq_stats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* geoip_format_dirreq_stats </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a newly allocated string containing the dirreq statistics until <b>now</b>, or NULL if we're not collecting dirreq stats. Caller must ensure start_of_dirreq_stats_interval is in the past. </p>

</div>
</div>
<a id="aa723566e12d91030bb8569a06efa947f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa723566e12d91030bb8569a06efa947f">&#9670;&nbsp;</a></span>geoip_format_entry_stats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* geoip_format_entry_stats </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a newly allocated string containing the entry statistics until <b>now</b>, or NULL if we're not collecting entry stats. Caller must ensure start_of_entry_stats_interval lies in the past. </p>

</div>
</div>
<a id="a6a1572de278165ce157dc7e1c94db26e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a1572de278165ce157dc7e1c94db26e">&#9670;&nbsp;</a></span>geoip_free_all()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_free_all </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Release all storage held in this file. </p>

</div>
</div>
<a id="ab7eb9b1c4e3f8b4c9ffa04a55025b6d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab7eb9b1c4e3f8b4c9ffa04a55025b6d2">&#9670;&nbsp;</a></span>geoip_get_bridge_stats_controller()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* geoip_get_bridge_stats_controller </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a new string containing the recent bridge statistics to be returned to controller clients, or NULL if we don't have any bridge statistics. </p>

</div>
</div>
<a id="a9b6387319fe2c4f08d9595d6522ad941"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b6387319fe2c4f08d9595d6522ad941">&#9670;&nbsp;</a></span>geoip_get_bridge_stats_extrainfo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* geoip_get_bridge_stats_extrainfo </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return most recent bridge statistics for inclusion in extra-info descriptors, or NULL if we don't have recent bridge statistics. </p>

</div>
</div>
<a id="a0e369d89e0ee84d0898bfa6ce1b90331"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e369d89e0ee84d0898bfa6ce1b90331">&#9670;&nbsp;</a></span>geoip_get_client_history()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int geoip_get_client_history </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="or_8h.html#a583c7385547b5d02255fa8a8bd5d41dd">geoip_client_action_t</a>&#160;</td>
          <td class="paramname"><em>action</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>country_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>ipver_str</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Store a newly allocated comma-separated string in *country_str containing entries for all the countries from which we've seen enough clients connect as a bridge, directory server, or entry guard. The entry format is cc=num where num is the number of IPs we've seen connecting from that country, and cc is a lowercased country code. *country_str is set to NULL if we're not ready to export per country data yet.</p>
<p>Store a newly allocated comma-separated string in ipver_str containing entries for clients connecting over IPv4 and IPv6. The format is family=num where num is the nubmer of IPs we've seen connecting over that protocol family, and family is 'v4' or 'v6'.</p>
<p>Return 0 on success and -1 if we're missing geoip data. </p>
<p>unresolved requests are stored at index 0. </p>

</div>
</div>
<a id="a8db18a0728871a50a20c43d1ebef6be0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8db18a0728871a50a20c43d1ebef6be0">&#9670;&nbsp;</a></span>geoip_get_country_by_ipv4()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC int geoip_get_country_by_ipv4 </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ipaddr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given an IP address in host order, return a number representing the country to which that address belongs, -1 for "No geoip information
available", or 0 for the 'unknown country'. The return value will always be less than geoip_get_n_countries(). To decode it, call <a class="el" href="geoip_8c.html#a6b4edbf9595712e436768afa457abfcc">geoip_get_country_name()</a>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8c_a8db18a0728871a50a20c43d1ebef6be0_cgraph.png" border="0" usemap="#geoip_8c_a8db18a0728871a50a20c43d1ebef6be0_cgraph" alt=""/></div>
<map name="geoip_8c_a8db18a0728871a50a20c43d1ebef6be0_cgraph" id="geoip_8c_a8db18a0728871a50a20c43d1ebef6be0_cgraph">
<area shape="rect" id="node2" href="container_8c.html#a6722b8c6ca501b524958b3cdac2bc70c" title="smartlist_bsearch" alt="" coords="233,5,359,32"/>
<area shape="rect" id="node3" href="container_8c.html#af0f195f396d7f97e7f2f2367453da119" title="smartlist_bsearch_idx" alt="" coords="407,5,556,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8c_a8db18a0728871a50a20c43d1ebef6be0_icgraph.png" border="0" usemap="#geoip_8c_a8db18a0728871a50a20c43d1ebef6be0_icgraph" alt=""/></div>
<map name="geoip_8c_a8db18a0728871a50a20c43d1ebef6be0_icgraph" id="geoip_8c_a8db18a0728871a50a20c43d1ebef6be0_icgraph">
<area shape="rect" id="node2" href="geoip_8h.html#a921840886e0a3d9ba57b014e6629cf1b" title="getinfo_helper_geoip" alt="" coords="233,5,375,32"/>
</map>
</div>

</div>
</div>
<a id="a002ed21d53f77e11e84879ff14650564"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a002ed21d53f77e11e84879ff14650564">&#9670;&nbsp;</a></span>geoip_get_country_by_ipv6()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC int geoip_get_country_by_ipv6 </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structin6__addr.html">in6_addr</a> *&#160;</td>
          <td class="paramname"><em>addr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given an IPv6 address, return a number representing the country to which that address belongs, -1 for "No geoip information available", or 0 for the 'unknown country'. The return value will always be less than geoip_get_n_countries(). To decode it, call <a class="el" href="geoip_8c.html#a6b4edbf9595712e436768afa457abfcc">geoip_get_country_name()</a>. </p>

</div>
</div>
<a id="a6b4edbf9595712e436768afa457abfcc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b4edbf9595712e436768afa457abfcc">&#9670;&nbsp;</a></span>geoip_get_country_name()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* geoip_get_country_name </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="or_8h.html#a1b74a0e9c6772fcfcc7facf26a11a213">country_t</a>&#160;</td>
          <td class="paramname"><em>num</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the two-letter country code associated with the number <b>num</b>, or "??" for an unknown value. </p>

</div>
</div>
<a id="a2499466518ad5e26022a844ca05e5ed9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2499466518ad5e26022a844ca05e5ed9">&#9670;&nbsp;</a></span>geoip_get_request_history()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* geoip_get_request_history </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a newly allocated string holding the per-country request history for v3 network statuses in a format suitable for an extra-info document, or NULL on failure. </p>

</div>
</div>
<a id="a9680658d466013c2edcd9872397d7df4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9680658d466013c2edcd9872397d7df4">&#9670;&nbsp;</a></span>geoip_get_transport_history()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* geoip_get_transport_history </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the bridge-ip-transports string that should be inserted in our extra-info descriptor. Return NULL if the bridge-ip-transports line should be empty. </p>
<p>String hash table (name of transport) -&gt; (number of users).</p>
<p>Smartlist that contains copies of the names of the transports that have been used.</p>
<p>We do the following steps to form the transport history string: a) Foreach client that uses a pluggable transport, we increase the times that transport was used by one. If the client did not use a transport, we increase the number of times someone connected without obfuscation. b) Foreach transport we observed, we write its transport history string and push it to string_chunks. So, for example, if we've seen 665 obfs2 clients, we write "obfs2=665". c) We concatenate string_chunks to form the final string.</p>

</div>
</div>
<a id="a99613dd6eb7666bd2e5fe481f15ec301"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99613dd6eb7666bd2e5fe481f15ec301">&#9670;&nbsp;</a></span>geoip_load_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int geoip_load_file </td>
          <td>(</td>
          <td class="paramtype">sa_family_t&#160;</td>
          <td class="paramname"><em>family</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>filename</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Clear appropriate GeoIP database, based on <b>family</b>, and reload it from the file <b>filename</b>. Return 0 on success, -1 on failure.</p>
<p>Recognized line formats for IPv4 are: INTIPLOW,INTIPHIGH,CC and "INTIPLOW","INTIPHIGH","CC","CC3","COUNTRY NAME" where INTIPLOW and INTIPHIGH are IPv4 addresses encoded as 4-byte unsigned integers, and CC is a country code.</p>
<p>Recognized line format for IPv6 is: IPV6LOW,IPV6HIGH,CC where IPV6LOW and IPV6HIGH are IPv6 addresses and CC is a country code.</p>
<p>It also recognizes, and skips over, blank lines and lines that start with '#' (comments). </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8c_a99613dd6eb7666bd2e5fe481f15ec301_cgraph.png" border="0" usemap="#geoip_8c_a99613dd6eb7666bd2e5fe481f15ec301_cgraph" alt=""/></div>
<map name="geoip_8c_a99613dd6eb7666bd2e5fe481f15ec301_cgraph" id="geoip_8c_a99613dd6eb7666bd2e5fe481f15ec301_cgraph">
<area shape="rect" id="node2" href="config_8c.html#ad09b1993fdca508d228a7585813efcac" title="options_need_geoip_info" alt="" coords="161,31,327,57"/>
<area shape="rect" id="node5" href="compat_8c.html#a99ee17f8317be48a2391c20e31e8a7b8" title="tor_fopen_cloexec" alt="" coords="180,81,308,108"/>
<area shape="rect" id="node3" href="geoip_8c.html#aecc961d6ac7cd75ec8593321d51d909a" title="should_record_bridge_info" alt="" coords="375,5,548,32"/>
<area shape="rect" id="node4" href="routerset_8c.html#a06782dad9f20dd3a3da80d9df1d4c3b3" title="routerset_needs_geoip" alt="" coords="385,56,538,83"/>
</map>
</div>

</div>
</div>
<a id="a89c00fefaf2f19a1097e93e3116cd30f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a89c00fefaf2f19a1097e93e3116cd30f">&#9670;&nbsp;</a></span>geoip_note_client_seen()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_note_client_seen </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="or_8h.html#a583c7385547b5d02255fa8a8bd5d41dd">geoip_client_action_t</a>&#160;</td>
          <td class="paramname"><em>action</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>transport_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Note that we've seen a client connect from the IP <b>addr</b> at time <b>now</b>. Ignored by all but bridges and directories if configured accordingly. </p>
<p>unresolved requests are stored at index 0. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8c_a89c00fefaf2f19a1097e93e3116cd30f_cgraph.png" border="0" usemap="#geoip_8c_a89c00fefaf2f19a1097e93e3116cd30f_cgraph" alt=""/></div>
<map name="geoip_8c_a89c00fefaf2f19a1097e93e3116cd30f_cgraph" id="geoip_8c_a89c00fefaf2f19a1097e93e3116cd30f_cgraph">
<area shape="rect" id="node2" href="geoip_8c.html#aecc961d6ac7cd75ec8593321d51d909a" title="should_record_bridge_info" alt="" coords="212,5,385,32"/>
</map>
</div>

</div>
</div>
<a id="a3d6b5b368e2d9fd4f87a19161c17ea1d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d6b5b368e2d9fd4f87a19161c17ea1d">&#9670;&nbsp;</a></span>geoip_note_ns_response()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_note_ns_response </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="or_8h.html#afdb6254fb58e226a267558a966bc4749">geoip_ns_response_t</a>&#160;</td>
          <td class="paramname"><em>response</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Note that we've rejected a client's request for a v3 network status for reason <b>reason</b> at time <b>now</b>. </p>

</div>
</div>
<a id="ab0f4c2f1c6dbbfd076007488f8d8aa99"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0f4c2f1c6dbbfd076007488f8d8aa99">&#9670;&nbsp;</a></span>geoip_parse_entry()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STATIC int geoip_parse_entry </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">sa_family_t&#160;</td>
          <td class="paramname"><em>family</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add an entry to the GeoIP table indicated by <b>family</b>, parsing it from <b>line</b>. The format is as for <a class="el" href="geoip_8c.html#a99613dd6eb7666bd2e5fe481f15ec301">geoip_load_file()</a>. </p>

</div>
</div>
<a id="a44567c1ed4bddb830f39ccdc3a48b45e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44567c1ed4bddb830f39ccdc3a48b45e">&#9670;&nbsp;</a></span>geoip_remove_old_clients()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_remove_old_clients </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>cutoff</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Forget about all clients that haven't connected since <b>cutoff</b>. </p>

</div>
</div>
<a id="a9776e0395b9b7397a1dd1b81130af81b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9776e0395b9b7397a1dd1b81130af81b">&#9670;&nbsp;</a></span>geoip_reset_dirreq_stats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_reset_dirreq_stats </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reset counters for dirreq stats. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8c_a9776e0395b9b7397a1dd1b81130af81b_icgraph.png" border="0" usemap="#geoip_8c_a9776e0395b9b7397a1dd1b81130af81b_icgraph" alt=""/></div>
<map name="geoip_8c_a9776e0395b9b7397a1dd1b81130af81b_icgraph" id="geoip_8c_a9776e0395b9b7397a1dd1b81130af81b_icgraph">
<area shape="rect" id="node2" href="geoip_8h.html#a5728ac9307e2a055f2ca525473b32aee" title="geoip_dirreq_stats_term" alt="" coords="181,13,343,39"/>
</map>
</div>

</div>
</div>
<a id="a0e8ee9964ff62e5009f1b49231e52d1f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e8ee9964ff62e5009f1b49231e52d1f">&#9670;&nbsp;</a></span>geoip_reset_entry_stats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_reset_entry_stats </td>
          <td>(</td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reset counters for entry stats. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8c_a0e8ee9964ff62e5009f1b49231e52d1f_icgraph.png" border="0" usemap="#geoip_8c_a0e8ee9964ff62e5009f1b49231e52d1f_icgraph" alt=""/></div>
<map name="geoip_8c_a0e8ee9964ff62e5009f1b49231e52d1f_icgraph" id="geoip_8c_a0e8ee9964ff62e5009f1b49231e52d1f_icgraph">
<area shape="rect" id="node2" href="geoip_8h.html#ad4ca20951b3b9a4a251e8ae83ba0ec2f" title="geoip_entry_stats_term" alt="" coords="215,5,373,32"/>
</map>
</div>

</div>
</div>
<a id="a642404b6a23907878bdbd5459ec356df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a642404b6a23907878bdbd5459ec356df">&#9670;&nbsp;</a></span>geoip_start_dirreq()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void geoip_start_dirreq </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>dirreq_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>response_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="or_8h.html#a118711f7f25509a02d10bba02f484333">dirreq_type_t</a>&#160;</td>
          <td class="paramname"><em>type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Note that an either direct or tunneled (see <b>type</b>) directory request for a v3 network status with unique ID <b>dirreq_id</b> of size <b>response_size</b> has started. </p>

</div>
</div>
<a id="a921840886e0a3d9ba57b014e6629cf1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a921840886e0a3d9ba57b014e6629cf1b">&#9670;&nbsp;</a></span>getinfo_helper_geoip()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int getinfo_helper_geoip </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structcontrol__connection__t.html">control_connection_t</a> *&#160;</td>
          <td class="paramname"><em>control_conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>question</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>answer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>errmsg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Helper used to implement GETINFO ip-to-country/... controller command. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8c_a921840886e0a3d9ba57b014e6629cf1b_cgraph.png" border="0" usemap="#geoip_8c_a921840886e0a3d9ba57b014e6629cf1b_cgraph" alt=""/></div>
<map name="geoip_8c_a921840886e0a3d9ba57b014e6629cf1b_cgraph" id="geoip_8c_a921840886e0a3d9ba57b014e6629cf1b_cgraph">
<area shape="rect" id="node2" href="util_8c.html#a245aaefd9d8715af06ce0f7b7355fd0d" title="strcmpstart" alt="" coords="241,5,329,32"/>
<area shape="rect" id="node3" href="compat_8c.html#ade97970c1d8a691241adac739c4f9b12" title="tor_asprintf" alt="" coords="241,56,328,83"/>
<area shape="rect" id="node5" href="address_8c.html#a3cd537bd8104a89a5996793ee3f1d0dc" title="tor_addr_parse" alt="" coords="231,107,339,133"/>
<area shape="rect" id="node6" href="geoip_8c.html#a8db18a0728871a50a20c43d1ebef6be0" title="geoip_get_country_by_ipv4" alt="" coords="195,157,375,184"/>
<area shape="rect" id="node4" href="compat_8c.html#a5ef7a08e8b543c0d61f9ef1081d4c1ea" title="tor_vasprintf" alt="" coords="438,56,533,83"/>
<area shape="rect" id="node7" href="container_8c.html#a6722b8c6ca501b524958b3cdac2bc70c" title="smartlist_bsearch" alt="" coords="423,157,548,184"/>
<area shape="rect" id="node8" href="container_8c.html#af0f195f396d7f97e7f2f2367453da119" title="smartlist_bsearch_idx" alt="" coords="596,157,745,184"/>
</map>
</div>

</div>
</div>
<a id="a2e7c29b1fb0be7f128aa35dc23f61cf3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e7c29b1fb0be7f128aa35dc23f61cf3">&#9670;&nbsp;</a></span>HT_PROTOTYPE()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HT_PROTOTYPE </td>
          <td>(</td>
          <td class="paramtype">HT_GENERATE2(&#160;</td>
          <td class="paramname"><em>clientmap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HT_GENERATE2(&#160;</td>
          <td class="paramname"><em>clientmap_entry_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HT_GENERATE2(&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HT_GENERATE2(&#160;</td>
          <td class="paramname"><em>clientmap_entry_hash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HT_GENERATE2(&#160;</td>
          <td class="paramname"><em>clientmap_entries_eq</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the size of a client map entry. </p>

</div>
</div>
<a id="a46be57db01b2507fb5efb601c903374f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46be57db01b2507fb5efb601c903374f">&#9670;&nbsp;</a></span>MOCK_IMPL() <span class="overload">[1/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MOCK_IMPL </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="or_8h.html#a1b74a0e9c6772fcfcc7facf26a11a213">country_t</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">geoip_get_country&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">(const char *country)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the index of the <b>country</b>'s entry in the GeoIP country list if it is a valid 2-letter country code, otherwise return -1. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8c_a46be57db01b2507fb5efb601c903374f_cgraph.png" border="0" usemap="#geoip_8c_a46be57db01b2507fb5efb601c903374f_cgraph" alt=""/></div>
<map name="geoip_8c_a46be57db01b2507fb5efb601c903374f_cgraph" id="geoip_8c_a46be57db01b2507fb5efb601c903374f_cgraph">
<area shape="rect" id="node2" href="container_8c.html#a1406b823cb6088df755f1b81153d137e" title="strmap_get_lc" alt="" coords="153,5,257,32"/>
</map>
</div>

</div>
</div>
<a id="a6652649f42dbfeae49682ce0d1c3fa26"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6652649f42dbfeae49682ce0d1c3fa26">&#9670;&nbsp;</a></span>MOCK_IMPL() <span class="overload">[2/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MOCK_IMPL </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">geoip_get_country_by_addr&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">(const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *addr)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given an IP address, return a number representing the country to which that address belongs, -1 for "No geoip information available", or 0 for the 'unknown country'. The return value will always be less than geoip_get_n_countries(). To decode it, call <a class="el" href="geoip_8c.html#a6b4edbf9595712e436768afa457abfcc">geoip_get_country_name()</a>. </p>

</div>
</div>
<a id="ab35c84e4681c5b673f9fbfaa49e0e339"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab35c84e4681c5b673f9fbfaa49e0e339">&#9670;&nbsp;</a></span>MOCK_IMPL() <span class="overload">[3/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MOCK_IMPL </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">geoip_get_n_countries&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">(void)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the number of countries recognized by the GeoIP country list. </p>

</div>
</div>
<a id="a0f041613ef5d8f5a6eed566c548d5c83"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f041613ef5d8f5a6eed566c548d5c83">&#9670;&nbsp;</a></span>MOCK_IMPL() <span class="overload">[4/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MOCK_IMPL </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">geoip_is_loaded&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">(sa_family_t family)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff we have loaded a GeoIP database. </p>

</div>
</div>
<a id="aecc961d6ac7cd75ec8593321d51d909a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aecc961d6ac7cd75ec8593321d51d909a">&#9670;&nbsp;</a></span>should_record_bridge_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int should_record_bridge_info </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__options__t.html">or_options_t</a> *&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if we should collect geoip stats on bridge users, and include them in our extrainfo descriptor. Else return 0. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="geoip_8c_aecc961d6ac7cd75ec8593321d51d909a_icgraph.png" border="0" usemap="#geoip_8c_aecc961d6ac7cd75ec8593321d51d909a_icgraph" alt=""/></div>
<map name="geoip_8c_aecc961d6ac7cd75ec8593321d51d909a_icgraph" id="geoip_8c_aecc961d6ac7cd75ec8593321d51d909a_icgraph">
<area shape="rect" id="node2" href="config_8h.html#ad09b1993fdca508d228a7585813efcac" title="options_need_geoip_info" alt="" coords="227,5,392,32"/>
<area shape="rect" id="node4" href="geoip_8h.html#a89c00fefaf2f19a1097e93e3116cd30f" title="geoip_note_client_seen" alt="" coords="230,56,389,83"/>
<area shape="rect" id="node3" href="geoip_8h.html#a99613dd6eb7666bd2e5fe481f15ec301" title="geoip_load_file" alt="" coords="440,5,548,32"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
