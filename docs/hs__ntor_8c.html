<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tor: /home/user/_my/code/bwauth-related/tor/src/or/hs_ntor.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tor
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_95039623eb1ebeaf46c028778b39de98.html">or</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">hs_ntor.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implements the ntor variant used in Tor hidden services.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="or_8h_source.html">or.h</a>&quot;</code><br />
<code>#include &quot;hs_ntor.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for hs_ntor.c:</div>
<div class="dyncontent">
<div class="center"><img src="hs__ntor_8c__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2hs__ntor_8c" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2hs__ntor_8c" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2hs__ntor_8c">
<area shape="rect" id="node2" href="or_8h.html" title="Master header file for Tor&#45;specific functionality. " alt="" coords="1591,184,1635,211"/>
<area shape="rect" id="node43" href="hs__ntor_8h_source.html" title="hs_ntor.h" alt="" coords="1614,109,1690,136"/>
<area shape="rect" id="node3" href="orconfig_8h_source.html" title="orconfig.h" alt="" coords="803,1020,882,1047"/>
<area shape="rect" id="node4" href="torint_8h.html" title="Header file to define uint32_t and friends. " alt="" coords="1883,945,1946,972"/>
<area shape="rect" id="node6" href="crypto_8h.html" title="Headers for crypto.c. " alt="" coords="1783,333,1852,360"/>
<area shape="rect" id="node20" href="container_8h_source.html" title="container.h" alt="" coords="1490,572,1577,599"/>
<area shape="rect" id="node22" href="torlog_8h.html" title="Headers for log.c. " alt="" coords="459,572,525,599"/>
<area shape="rect" id="node25" href="crypto__format_8h_source.html" title="crypto_format.h" alt="" coords="1278,259,1391,285"/>
<area shape="rect" id="node26" href="crypto__ed25519_8h_source.html" title="crypto_ed25519.h" alt="" coords="1300,333,1425,360"/>
<area shape="rect" id="node27" href="crypto__curve25519_8h_source.html" title="crypto_curve25519.h" alt="" coords="1307,415,1450,442"/>
<area shape="rect" id="node30" href="tortls_8h.html" title="Headers for tortls.c. " alt="" coords="1038,333,1101,360"/>
<area shape="rect" id="node33" href="compress_8h.html" title="Headers for compress.c. " alt="" coords="1568,259,1659,285"/>
<area shape="rect" id="node34" href="address_8h.html" title="Headers for address.h. " alt="" coords="1313,497,1391,524"/>
<area shape="rect" id="node35" href="compat__libevent_8h_source.html" title="compat_libevent.h" alt="" coords="600,871,728,897"/>
<area shape="rect" id="node36" href="ht_8h_source.html" title="ht.h" alt="" coords="1785,259,1829,285"/>
<area shape="rect" id="node37" href="confline_8h_source.html" title="confline.h" alt="" coords="1457,333,1535,360"/>
<area shape="rect" id="node38" href="replaycache_8h.html" title="Header file for replaycache.c. " alt="" coords="1905,259,2007,285"/>
<area shape="rect" id="node39" href="tor__queue_8h_source.html" title="tor_queue.h" alt="" coords="2032,259,2123,285"/>
<area shape="rect" id="node40" href="token__bucket_8h_source.html" title="token_bucket.h" alt="" coords="1690,871,1801,897"/>
<area shape="rect" id="node41" href="util__format_8h_source.html" title="util_format.h" alt="" coords="1571,871,1666,897"/>
<area shape="rect" id="node42" href="hs__circuitmap_8h.html" title="Header file for hs_circuitmap.c. " alt="" coords="2404,259,2519,285"/>
<area shape="rect" id="node8" href="testsupport_8h_source.html" title="testsupport.h" alt="" coords="488,945,587,972"/>
<area shape="rect" id="node9" href="compat_8h_source.html" title="compat.h" alt="" coords="1057,796,1133,823"/>
<area shape="rect" id="node14" href="util_8h.html" title="Headers for util.c. " alt="" coords="992,647,1043,673"/>
<area shape="rect" id="node18" href="crypto__rsa_8h.html" title="Headers for crypto_rsa.c. " alt="" coords="1107,415,1202,442"/>
<area shape="rect" id="node23" href="keccak-tiny_8h_source.html" title="keccak&#45;tiny/keccak\l&#45;tiny.h" alt="" coords="2126,408,2261,449"/>
<area shape="rect" id="node11" href="compat__time_8h.html" title="Functions and types for monotonic times. " alt="" coords="915,945,1023,972"/>
<area shape="rect" id="node13" href="compat__threads_8h_source.html" title="compat_threads.h" alt="" coords="1102,871,1229,897"/>
<area shape="rect" id="node15" href="di__ops_8h.html" title="Headers for di_ops.c. " alt="" coords="905,871,975,897"/>
<area shape="rect" id="node17" href="util__bug_8h.html" title="Macros to manage assertions, fatal and non&#45;fatal. " alt="" coords="750,721,829,748"/>
<area shape="rect" id="node19" href="crypto__digest_8h.html" title="Headers for crypto_digest.c. " alt="" coords="1415,497,1526,524"/>
<area shape="rect" id="node21" href="siphash_8h_source.html" title="siphash.h" alt="" coords="1499,647,1578,673"/>
<area shape="rect" id="node28" href="crypto__openssl__mgt_8h_source.html" title="crypto_openssl_mgt.h" alt="" coords="879,497,1030,524"/>
<area shape="rect" id="node31" href="compat__openssl_8h.html" title="compatibility definitions for working with different openssl forks " alt="" coords="891,415,1019,442"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aa53093cdcf7f0ef335c56e04e31ea842"><td class="memItemLeft" align="right" valign="top"><a id="aa53093cdcf7f0ef335c56e04e31ea842"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>PROTOID</b>&#160;&#160;&#160;&quot;tor-hs-ntor-curve25519-sha3-256-1&quot;</td></tr>
<tr class="separator:aa53093cdcf7f0ef335c56e04e31ea842"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee61e79a10433482b82f2f6d80fcad21"><td class="memItemLeft" align="right" valign="top"><a id="aee61e79a10433482b82f2f6d80fcad21"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>PROTOID_LEN</b>&#160;&#160;&#160;(sizeof(PROTOID) - 1)</td></tr>
<tr class="separator:aee61e79a10433482b82f2f6d80fcad21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad042e288bcd305a20ff70adc5c4b19fc"><td class="memItemLeft" align="right" valign="top"><a id="ad042e288bcd305a20ff70adc5c4b19fc"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SERVER_STR</b>&#160;&#160;&#160;&quot;Server&quot;</td></tr>
<tr class="separator:ad042e288bcd305a20ff70adc5c4b19fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62c951a2d9190f419342c359a097cdc4"><td class="memItemLeft" align="right" valign="top"><a id="a62c951a2d9190f419342c359a097cdc4"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SERVER_STR_LEN</b>&#160;&#160;&#160;(sizeof(SERVER_STR) - 1)</td></tr>
<tr class="separator:a62c951a2d9190f419342c359a097cdc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6bb9c860018c5bfd03775e5dfd2f4dcd"><td class="memItemLeft" align="right" valign="top"><a id="a6bb9c860018c5bfd03775e5dfd2f4dcd"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>T_HSENC</b>&#160;&#160;&#160;PROTOID &quot;:hs_key_extract&quot;</td></tr>
<tr class="separator:a6bb9c860018c5bfd03775e5dfd2f4dcd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd3cfabe1d9cc299540bf5b898b6b9b4"><td class="memItemLeft" align="right" valign="top"><a id="abd3cfabe1d9cc299540bf5b898b6b9b4"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>T_HSENC_LEN</b>&#160;&#160;&#160;(sizeof(T_HSENC) - 1)</td></tr>
<tr class="separator:abd3cfabe1d9cc299540bf5b898b6b9b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43280fdbd035399dc2d1fdbb8886eabc"><td class="memItemLeft" align="right" valign="top"><a id="a43280fdbd035399dc2d1fdbb8886eabc"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>T_HSVERIFY</b>&#160;&#160;&#160;PROTOID &quot;:hs_verify&quot;</td></tr>
<tr class="separator:a43280fdbd035399dc2d1fdbb8886eabc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc1ab9feb58eb95a292a743006bccc2a"><td class="memItemLeft" align="right" valign="top"><a id="acc1ab9feb58eb95a292a743006bccc2a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>T_HSMAC</b>&#160;&#160;&#160;PROTOID &quot;:hs_mac&quot;</td></tr>
<tr class="separator:acc1ab9feb58eb95a292a743006bccc2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ff643924a0eea2763c8fac0049c0bca"><td class="memItemLeft" align="right" valign="top"><a id="a4ff643924a0eea2763c8fac0049c0bca"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>M_HSEXPAND</b>&#160;&#160;&#160;PROTOID &quot;:hs_key_expand&quot;</td></tr>
<tr class="separator:a4ff643924a0eea2763c8fac0049c0bca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad10c0f3fa24a3e19a1d9b3bdba1c53e7"><td class="memItemLeft" align="right" valign="top"><a id="ad10c0f3fa24a3e19a1d9b3bdba1c53e7"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>M_HSEXPAND_LEN</b>&#160;&#160;&#160;(sizeof(M_HSEXPAND) - 1)</td></tr>
<tr class="separator:ad10c0f3fa24a3e19a1d9b3bdba1c53e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6dcccd39d834780bb0c2002630105827"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hs__ntor_8c.html#a6dcccd39d834780bb0c2002630105827">APPEND</a>(ptr,  inp,  len)</td></tr>
<tr class="separator:a6dcccd39d834780bb0c2002630105827"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4eef0a26897da1a42b1d7d454926c8d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>REND_SECRET_HS_INPUT_LEN</b></td></tr>
<tr class="separator:ab4eef0a26897da1a42b1d7d454926c8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae301d67022bb9b3a7a6f4836f2655d87"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>REND_AUTH_INPUT_LEN</b></td></tr>
<tr class="separator:ae301d67022bb9b3a7a6f4836f2655d87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a035815c9bc1e9257b9673ed5dba72e0b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hs__ntor_8c.html#a035815c9bc1e9257b9673ed5dba72e0b">INTRO_SECRET_HS_INPUT_LEN</a></td></tr>
<tr class="separator:a035815c9bc1e9257b9673ed5dba72e0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf9158c15abee7a6f924e5f4f5525d98"><td class="memItemLeft" align="right" valign="top"><a id="acf9158c15abee7a6f924e5f4f5525d98"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>INFO_BLOB_LEN</b>&#160;&#160;&#160;(M_HSEXPAND_LEN + <a class="el" href="crypto__digest_8h.html#a34e055abb21d9f47b5f3d821e4beb091">DIGEST256_LEN</a>)</td></tr>
<tr class="separator:acf9158c15abee7a6f924e5f4f5525d98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a030094aa8c6abedf6465364fb053da22"><td class="memItemLeft" align="right" valign="top"><a id="a030094aa8c6abedf6465364fb053da22"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>KDF_INPUT_LEN</b>&#160;&#160;&#160;(<a class="el" href="hs__ntor_8c.html#a035815c9bc1e9257b9673ed5dba72e0b">INTRO_SECRET_HS_INPUT_LEN</a> + T_HSENC_LEN + INFO_BLOB_LEN)</td></tr>
<tr class="separator:a030094aa8c6abedf6465364fb053da22"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8627cdf8264cda76a67d41ef57b9b76"><td class="memItemLeft" align="right" valign="top"><a id="ab8627cdf8264cda76a67d41ef57b9b76"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>NTOR_KEY_EXPANSION_KDF_INPUT_LEN</b>&#160;&#160;&#160;(<a class="el" href="crypto__digest_8h.html#a34e055abb21d9f47b5f3d821e4beb091">DIGEST256_LEN</a> + M_HSEXPAND_LEN)</td></tr>
<tr class="separator:ab8627cdf8264cda76a67d41ef57b9b76"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1420e0cb2a596ec80a763b0a4865abb0"><td class="memItemLeft" align="right" valign="top"><a id="a1420e0cb2a596ec80a763b0a4865abb0"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>hs_ntor_client_get_introduce1_keys</b> (const <a class="el" href="structed25519__public__key__t.html">ed25519_public_key_t</a> *intro_auth_pubkey, const <a class="el" href="structcurve25519__public__key__t.html">curve25519_public_key_t</a> *intro_enc_pubkey, const <a class="el" href="structcurve25519__keypair__t.html">curve25519_keypair_t</a> *client_ephemeral_enc_keypair, const uint8_t *subcredential, <a class="el" href="strucths__ntor__intro__cell__keys__t.html">hs_ntor_intro_cell_keys_t</a> *hs_ntor_intro_cell_keys_out)</td></tr>
<tr class="separator:a1420e0cb2a596ec80a763b0a4865abb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab26e82ede98c529ac82e78e3c2cf32ce"><td class="memItemLeft" align="right" valign="top"><a id="ab26e82ede98c529ac82e78e3c2cf32ce"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>hs_ntor_client_get_rendezvous1_keys</b> (const <a class="el" href="structed25519__public__key__t.html">ed25519_public_key_t</a> *intro_auth_pubkey, const <a class="el" href="structcurve25519__keypair__t.html">curve25519_keypair_t</a> *client_ephemeral_enc_keypair, const <a class="el" href="structcurve25519__public__key__t.html">curve25519_public_key_t</a> *intro_enc_pubkey, const <a class="el" href="structcurve25519__public__key__t.html">curve25519_public_key_t</a> *service_ephemeral_rend_pubkey, <a class="el" href="strucths__ntor__rend__cell__keys__t.html">hs_ntor_rend_cell_keys_t</a> *hs_ntor_rend_cell_keys_out)</td></tr>
<tr class="separator:ab26e82ede98c529ac82e78e3c2cf32ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a245097c78d73706839f78b50493fdf4e"><td class="memItemLeft" align="right" valign="top"><a id="a245097c78d73706839f78b50493fdf4e"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>hs_ntor_service_get_introduce1_keys</b> (const <a class="el" href="structed25519__public__key__t.html">ed25519_public_key_t</a> *intro_auth_pubkey, const <a class="el" href="structcurve25519__keypair__t.html">curve25519_keypair_t</a> *intro_enc_keypair, const <a class="el" href="structcurve25519__public__key__t.html">curve25519_public_key_t</a> *client_ephemeral_enc_pubkey, const uint8_t *subcredential, <a class="el" href="strucths__ntor__intro__cell__keys__t.html">hs_ntor_intro_cell_keys_t</a> *hs_ntor_intro_cell_keys_out)</td></tr>
<tr class="separator:a245097c78d73706839f78b50493fdf4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2bf49715b629b828222bc6d11379064a"><td class="memItemLeft" align="right" valign="top"><a id="a2bf49715b629b828222bc6d11379064a"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>hs_ntor_service_get_rendezvous1_keys</b> (const <a class="el" href="structed25519__public__key__t.html">ed25519_public_key_t</a> *intro_auth_pubkey, const <a class="el" href="structcurve25519__keypair__t.html">curve25519_keypair_t</a> *intro_enc_keypair, const <a class="el" href="structcurve25519__keypair__t.html">curve25519_keypair_t</a> *service_ephemeral_rend_keypair, const <a class="el" href="structcurve25519__public__key__t.html">curve25519_public_key_t</a> *client_ephemeral_enc_pubkey, <a class="el" href="strucths__ntor__rend__cell__keys__t.html">hs_ntor_rend_cell_keys_t</a> *hs_ntor_rend_cell_keys_out)</td></tr>
<tr class="separator:a2bf49715b629b828222bc6d11379064a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6a0255b785993ecaec092c2aedfc09a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hs__ntor_8c.html#ad6a0255b785993ecaec092c2aedfc09a">hs_ntor_client_rendezvous2_mac_is_good</a> (const <a class="el" href="strucths__ntor__rend__cell__keys__t.html">hs_ntor_rend_cell_keys_t</a> *hs_ntor_rend_cell_keys, const uint8_t *rcvd_mac)</td></tr>
<tr class="separator:ad6a0255b785993ecaec092c2aedfc09a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0263eda11c478051f35a396d5f8d1dc5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hs__ntor_8c.html#a0263eda11c478051f35a396d5f8d1dc5">hs_ntor_circuit_key_expansion</a> (const uint8_t *ntor_key_seed, size_t seed_len, uint8_t *keys_out, size_t keys_out_len)</td></tr>
<tr class="separator:a0263eda11c478051f35a396d5f8d1dc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implements the ntor variant used in Tor hidden services. </p>
<p>This module handles the variant of the ntor handshake that is documented in section [NTOR-WITH-EXTRA-DATA] of rend-spec-ng.txt .</p>
<p>The functions in this file provide an API that should be used when sending or receiving INTRODUCE1/RENDEZVOUS1 cells to generate the various key material required to create and handle those cells.</p>
<p>In the case of INTRODUCE1 it provides encryption and MAC keys to encode/decode the encrypted blob (see <a class="el" href="strucths__ntor__intro__cell__keys__t.html">hs_ntor_intro_cell_keys_t</a>). The relevant pub functions are hs_ntor_{client,service}_get_introduce1_keys().</p>
<p>In the case of RENDEZVOUS1 it calculates the MAC required to authenticate the cell, and also provides the key seed that is used to derive the crypto material for rendezvous encryption (see <a class="el" href="strucths__ntor__rend__cell__keys__t.html">hs_ntor_rend_cell_keys_t</a>). The relevant pub functions are hs_ntor_{client,service}_get_rendezvous1_keys(). It also provides a function (<a class="el" href="hs__ntor_8c.html#a0263eda11c478051f35a396d5f8d1dc5">hs_ntor_circuit_key_expansion()</a>) that does the rendezvous key expansion to setup end-to-end rend circuit keys. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a6dcccd39d834780bb0c2002630105827"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6dcccd39d834780bb0c2002630105827">&#9670;&nbsp;</a></span>APPEND</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APPEND</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">ptr, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">inp, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">len&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">STMT_BEGIN {                                  \</div><div class="line">    memcpy(ptr, (inp), (len));                  \</div><div class="line">    ptr += len;                                 \</div><div class="line">  } STMT_END</div></div><!-- fragment --><p>Helper macro: copy <b>len</b> bytes from <b>inp</b> to <b>ptr</b> and advance <b>ptr</b> by the number of bytes copied. Stolen from <a class="el" href="onion__ntor_8c.html" title="Implementation for the ntor handshake. ">onion_ntor.c</a> </p>

</div>
</div>
<a id="a035815c9bc1e9257b9673ed5dba72e0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a035815c9bc1e9257b9673ed5dba72e0b">&#9670;&nbsp;</a></span>INTRO_SECRET_HS_INPUT_LEN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INTRO_SECRET_HS_INPUT_LEN</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">(CURVE25519_OUTPUT_LEN +ED25519_PUBKEY_LEN +\</div><div class="line">  CURVE25519_PUBKEY_LEN + CURVE25519_PUBKEY_LEN + PROTOID_LEN)</div></div><!-- fragment --><p>Length of secret_input = EXP(B,x) | AUTH_KEY | X | B | PROTOID </p>

</div>
</div>
<a id="ae301d67022bb9b3a7a6f4836f2655d87"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae301d67022bb9b3a7a6f4836f2655d87">&#9670;&nbsp;</a></span>REND_AUTH_INPUT_LEN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define REND_AUTH_INPUT_LEN</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">(<a class="code" href="crypto__digest_8h.html#a34e055abb21d9f47b5f3d821e4beb091">DIGEST256_LEN</a> + ED25519_PUBKEY_LEN + \</div><div class="line">  CURVE25519_PUBKEY_LEN * 3 + PROTOID_LEN + SERVER_STR_LEN)</div><div class="ttc" id="crypto__digest_8h_html_a34e055abb21d9f47b5f3d821e4beb091"><div class="ttname"><a href="crypto__digest_8h.html#a34e055abb21d9f47b5f3d821e4beb091">DIGEST256_LEN</a></div><div class="ttdeci">#define DIGEST256_LEN</div><div class="ttdef"><b>Definition:</b> crypto_digest.h:25</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab4eef0a26897da1a42b1d7d454926c8d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab4eef0a26897da1a42b1d7d454926c8d">&#9670;&nbsp;</a></span>REND_SECRET_HS_INPUT_LEN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define REND_SECRET_HS_INPUT_LEN</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">(CURVE25519_OUTPUT_LEN * 2 + \</div><div class="line">  ED25519_PUBKEY_LEN + CURVE25519_PUBKEY_LEN * 3 + PROTOID_LEN)</div></div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a0263eda11c478051f35a396d5f8d1dc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0263eda11c478051f35a396d5f8d1dc5">&#9670;&nbsp;</a></span>hs_ntor_circuit_key_expansion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int hs_ntor_circuit_key_expansion </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>ntor_key_seed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>seed_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>keys_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>keys_out_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given the rendezvous key seed in <b>ntor_key_seed</b> (of size DIGEST256_LEN), do the circuit key expansion as specified by section '4.2.1. Key expansion' and place the keys in <b>keys_out</b> (which must be of size HS_NTOR_KEY_EXPANSION_KDF_OUT_LEN).</p>
<p>Return 0 if things went well, else return -1. </p>

</div>
</div>
<a id="ad6a0255b785993ecaec092c2aedfc09a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6a0255b785993ecaec092c2aedfc09a">&#9670;&nbsp;</a></span>hs_ntor_client_rendezvous2_mac_is_good()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int hs_ntor_client_rendezvous2_mac_is_good </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="strucths__ntor__rend__cell__keys__t.html">hs_ntor_rend_cell_keys_t</a> *&#160;</td>
          <td class="paramname"><em>hs_ntor_rend_cell_keys</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>rcvd_mac</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given a received RENDEZVOUS2 MAC in <b>mac</b> (of length DIGEST256_LEN), and the RENDEZVOUS1 key material in <b>hs_ntor_rend_cell_keys</b>, return 1 if the MAC is good, otherwise return 0. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
