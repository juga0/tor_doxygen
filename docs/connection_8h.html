<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tor: /home/user/_my/code/bwauth-related/tor/src/or/connection.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tor
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97b64286d42c5ef1697cb5f17129db19.html">tor</a></li><li class="navelem"><a class="el" href="dir_3cb0ba3f4b82dbe34a1a06276e96bc8d.html">src</a></li><li class="navelem"><a class="el" href="dir_386635fabd7f6c74e9d9c7a8604514a0.html">or</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">connection.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Header file for <a class="el" href="connection_8c.html" title="General high-level functions to handle reading and writing on connections. ">connection.c</a>.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="buffers_8h_source.html">buffers.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for connection.h:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2connection_8h" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2connection_8h" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2connection_8h">
<area shape="rect" id="node2" href="buffers_8h.html" title="Header file for buffers.c. " alt="" coords="43,109,116,136"/>
<area shape="rect" id="node3" href="testsupport_8h_source.html" title="testsupport.h" alt="" coords="30,184,129,211"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h__dep__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2connection_8hdep" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2connection_8hdep" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2connection_8hdep">
<area shape="rect" id="node2" href="channeltls_8c.html" title="A concrete subclass of channel_t using or_connection_t to transfer cells between Tor instances..." alt="" coords="5,109,153,165"/>
<area shape="rect" id="node3" href="circuitbuild_8c.html" title="Implements the details of building circuits (by chosing paths, constructing/sending create/extend cel..." alt="" coords="177,109,325,165"/>
<area shape="rect" id="node4" href="circuitlist_8c.html" title="Manage the global circuit list, and looking up circuits within it. " alt="" coords="349,109,497,165"/>
<area shape="rect" id="node5" href="circuituse_8c.html" title="Launch the right sort of circuits and attach streams to them. " alt="" coords="521,109,669,165"/>
<area shape="rect" id="node6" href="command_8c.html" title="Functions for processing incoming cells. " alt="" coords="693,109,841,165"/>
<area shape="rect" id="node7" href="config_8c.html" title="Code to parse and interpret configuration files. " alt="" coords="865,109,1013,165"/>
<area shape="rect" id="node8" href="connection_8c.html" title="General high&#45;level functions to handle reading and writing on connections. " alt="" coords="1037,109,1185,165"/>
<area shape="rect" id="node9" href="connection__edge_8c.html" title="Handle edge streams. " alt="" coords="1209,109,1381,165"/>
<area shape="rect" id="node10" href="connection__or_8c.html" title="Functions to handle OR connections, TLS handshaking, and cells on the network. " alt="" coords="1406,109,1561,165"/>
<area shape="rect" id="node11" href="control_8c.html" title="Implementation for Tor&#39;s control&#45;socket interface. " alt="" coords="1585,109,1733,165"/>
<area shape="rect" id="node12" href="directory_8c.html" title="Code to send and fetch directories and router descriptors via HTTP. Directories use dirserv..." alt="" coords="1757,109,1905,165"/>
<area shape="rect" id="node13" href="dirserv_8c.html" title="Directory server core implementation. Manages directory contents and generates directories. " alt="" coords="1929,109,2077,165"/>
<area shape="rect" id="node14" href="dns_8c.html" title="Implements a local cache for DNS results for Tor servers. This is implemented as a wrapper around Ada..." alt="" coords="2101,109,2249,165"/>
<area shape="rect" id="node15" href="dnsserv_8c.html" title="Implements client&#45;side DNS proxy server code. Note: this is the DNS Server code, not the Server DNS c..." alt="" coords="2273,109,2421,165"/>
<area shape="rect" id="node16" href="entrynodes_8c.html" title="Code to manage our fixed first nodes for various functions. " alt="" coords="2445,109,2593,165"/>
<area shape="rect" id="node17" href="ext__orport_8c.html" title="Code implementing the Extended ORPort. " alt="" coords="2617,109,2765,165"/>
<area shape="rect" id="node18" href="hibernate_8c.html" title="Functions to close listeners, stop allowing new circuits, etc in preparation for closing down or goin..." alt="" coords="2789,109,2937,165"/>
<area shape="rect" id="node19" href="main_8c.html" title="Toplevel module. Handles signals, multiplexes between connections, implements main loop..." alt="" coords="2961,109,3109,165"/>
<area shape="rect" id="node20" href="networkstatus_8c.html" title="Functions and structures for handling network status documents as a client or cache. " alt="" coords="3133,109,3289,165"/>
<area shape="rect" id="node21" href="relay_8c.html" title="Handle relay cell encryption/decryption, plus packaging and receiving from circuits, plus queuing on circuits. " alt="" coords="3313,109,3461,165"/>
<area shape="rect" id="node22" href="rendclient_8c.html" title="Client code to access location&#45;hidden services. " alt="" coords="3485,109,3633,165"/>
<area shape="rect" id="node23" href="router_8c.html" title="Miscellaneous relay functionality, including RSA key maintenance, generating and uploading server des..." alt="" coords="3657,109,3805,165"/>
<area shape="rect" id="node24" href="routerlist_8c.html" title="Code to maintain and access the global list of routerinfos for known servers. " alt="" coords="3829,109,3977,165"/>
<area shape="rect" id="node25" href="statefile_8c.html" title="Handles parsing and encoding the persistent &#39;state&#39; file that carries miscellaneous persistent state ..." alt="" coords="4001,109,4149,165"/>
</map>
</div>
</div>
<p><a href="connection_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ae716705b0d3e9f50df7f3c9280efbe93"><td class="memItemLeft" align="right" valign="top"><a id="ae716705b0d3e9f50df7f3c9280efbe93"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>connection_mark_for_close</b>(c)&#160;&#160;&#160;<a class="el" href="connection_8h.html#a2a15ddd62951cefd848ec070f1d9c912">connection_mark_for_close_</a>((c), __LINE__, SHORT_FILE__)</td></tr>
<tr class="separator:ae716705b0d3e9f50df7f3c9280efbe93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7af8d39065ac4afdf49730e8e602495"><td class="memItemLeft" align="right" valign="top"><a id="ac7af8d39065ac4afdf49730e8e602495"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>connection_mark_for_close_internal</b>(c)&#160;&#160;&#160;connection_mark_for_close_internal_((c), __LINE__, SHORT_FILE__)</td></tr>
<tr class="separator:ac7af8d39065ac4afdf49730e8e602495"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a54e93a28166250c3aebb899358da53"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a7a54e93a28166250c3aebb899358da53">connection_mark_and_flush_internal_</a>(c,  line,  file)</td></tr>
<tr class="separator:a7a54e93a28166250c3aebb899358da53"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaec25920982aaecb53c2c2f96744b7df"><td class="memItemLeft" align="right" valign="top"><a id="aaec25920982aaecb53c2c2f96744b7df"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>connection_mark_and_flush_internal</b>(c)&#160;&#160;&#160;<a class="el" href="connection_8h.html#a7a54e93a28166250c3aebb899358da53">connection_mark_and_flush_internal_</a>((c), __LINE__, SHORT_FILE__)</td></tr>
<tr class="separator:aaec25920982aaecb53c2c2f96744b7df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa896599b6344bce8e80b1312ca744cb2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#aa896599b6344bce8e80b1312ca744cb2">connection_mark_and_flush_</a>(c,  line,  file)</td></tr>
<tr class="separator:aa896599b6344bce8e80b1312ca744cb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35d3f88b09c72b05c058e0bd1cf94d44"><td class="memItemLeft" align="right" valign="top"><a id="a35d3f88b09c72b05c058e0bd1cf94d44"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>connection_mark_and_flush</b>(c)&#160;&#160;&#160;<a class="el" href="connection_8h.html#aa896599b6344bce8e80b1312ca744cb2">connection_mark_and_flush_</a>((c), __LINE__, SHORT_FILE__)</td></tr>
<tr class="separator:a35d3f88b09c72b05c058e0bd1cf94d44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab725bdde78b708db48e54ee16a78ea04"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#ab725bdde78b708db48e54ee16a78ea04">MAX_SOCKS5_AUTH_FIELD_SIZE</a>&#160;&#160;&#160;255</td></tr>
<tr class="separator:ab725bdde78b708db48e54ee16a78ea04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96c5bf0233ade2ac979ee67d207b3ec0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a96c5bf0233ade2ac979ee67d207b3ec0">MAX_SOCKS5_AUTH_SIZE_TOTAL</a>&#160;&#160;&#160;2*<a class="el" href="connection_8h.html#ab725bdde78b708db48e54ee16a78ea04">MAX_SOCKS5_AUTH_FIELD_SIZE</a></td></tr>
<tr class="separator:a96c5bf0233ade2ac979ee67d207b3ec0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90f8ad73eae855e1b8f9d50553efc075"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>CONN_LEN_AND_FREE_TEMPLATE</b>(sl)</td></tr>
<tr class="separator:a90f8ad73eae855e1b8f9d50553efc075"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43a4a413c48ba02dbe0bf49b666c124d"><td class="memItemLeft" align="right" valign="top"><a id="a43a4a413c48ba02dbe0bf49b666c124d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>connection_speaks_cells</b>(conn)&#160;&#160;&#160;(((conn)-&gt;type == <a class="el" href="or_8h.html#a1e908736ccab37a7ae72a8c1a3b9d539">CONN_TYPE_OR</a>) || 0)</td></tr>
<tr class="separator:a43a4a413c48ba02dbe0bf49b666c124d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa05a243a33eb2a242e48f1866ab2806a"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#aa05a243a33eb2a242e48f1866ab2806a">conn_type_to_string</a> (int type)</td></tr>
<tr class="separator:aa05a243a33eb2a242e48f1866ab2806a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f03ee7b48ac2f674af67ce1f0201d3c"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a0f03ee7b48ac2f674af67ce1f0201d3c">conn_state_to_string</a> (int type, int state)</td></tr>
<tr class="separator:a0f03ee7b48ac2f674af67ce1f0201d3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab30a9246a7ca639ec6d7d42e1fa979c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#aab30a9246a7ca639ec6d7d42e1fa979c">conn_listener_type_supports_af_unix</a> (int type)</td></tr>
<tr class="separator:aab30a9246a7ca639ec6d7d42e1fa979c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17c7be36733025b9c1384db24193776c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdir__connection__t.html">dir_connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a17c7be36733025b9c1384db24193776c">dir_connection_new</a> (int socket_family)</td></tr>
<tr class="separator:a17c7be36733025b9c1384db24193776c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0873faa8af99710bc36a3950b1bf68a6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structor__connection__t.html">or_connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a0873faa8af99710bc36a3950b1bf68a6">or_connection_new</a> (int type, int socket_family)</td></tr>
<tr class="separator:a0873faa8af99710bc36a3950b1bf68a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ec50dd3f5bb871bf4a7058e4a57a754"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structedge__connection__t.html">edge_connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a2ec50dd3f5bb871bf4a7058e4a57a754">edge_connection_new</a> (int type, int socket_family)</td></tr>
<tr class="separator:a2ec50dd3f5bb871bf4a7058e4a57a754"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf77e71582e9f5e3a07d50af731b0427"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structentry__connection__t.html">entry_connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#adf77e71582e9f5e3a07d50af731b0427">entry_connection_new</a> (int type, int socket_family)</td></tr>
<tr class="separator:adf77e71582e9f5e3a07d50af731b0427"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ab4242cd0fbf4bf874bcbb86ce1e7ba"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structcontrol__connection__t.html">control_connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a1ab4242cd0fbf4bf874bcbb86ce1e7ba">control_connection_new</a> (int socket_family)</td></tr>
<tr class="separator:a1ab4242cd0fbf4bf874bcbb86ce1e7ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b0571735fc8e34f09a8eb776f0f4d67"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlistener__connection__t.html">listener_connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a0b0571735fc8e34f09a8eb776f0f4d67">listener_connection_new</a> (int type, int socket_family)</td></tr>
<tr class="separator:a0b0571735fc8e34f09a8eb776f0f4d67"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4810086178d87cb306c2bb4b60145abe"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a4810086178d87cb306c2bb4b60145abe">connection_new</a> (int type, int socket_family)</td></tr>
<tr class="separator:a4810086178d87cb306c2bb4b60145abe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15be4ffce8c79930976b89d6c1d3c5a8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a15be4ffce8c79930976b89d6c1d3c5a8">connection_link_connections</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn_a, <a class="el" href="structconnection__t.html">connection_t</a> *conn_b)</td></tr>
<tr class="separator:a15be4ffce8c79930976b89d6c1d3c5a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae47192a963e96384d07f24ef592e1a53"><td class="memItemLeft" align="right" valign="top"><a id="ae47192a963e96384d07f24ef592e1a53"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>MOCK_DECL</b> (void, connection_free,(<a class="el" href="structconnection__t.html">connection_t</a> *conn))</td></tr>
<tr class="separator:ae47192a963e96384d07f24ef592e1a53"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac060666510d641a1a275af05d985a92"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#aac060666510d641a1a275af05d985a92">connection_free_all</a> (void)</td></tr>
<tr class="separator:aac060666510d641a1a275af05d985a92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade7f55aa182a3f727d25a510566351fd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#ade7f55aa182a3f727d25a510566351fd">connection_about_to_close_connection</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:ade7f55aa182a3f727d25a510566351fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a408567fdce15abf5e16163547d8223c1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a408567fdce15abf5e16163547d8223c1">connection_close_immediate</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:a408567fdce15abf5e16163547d8223c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a15ddd62951cefd848ec070f1d9c912"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a2a15ddd62951cefd848ec070f1d9c912">connection_mark_for_close_</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, int line, const char *file)</td></tr>
<tr class="separator:a2a15ddd62951cefd848ec070f1d9c912"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8751dd7aa4b9098ea127ebb5d3693a83"><td class="memItemLeft" align="right" valign="top"><a id="a8751dd7aa4b9098ea127ebb5d3693a83"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>MOCK_DECL</b> (void, connection_mark_for_close_internal_,(<a class="el" href="structconnection__t.html">connection_t</a> *conn, int line, const char *file))</td></tr>
<tr class="separator:a8751dd7aa4b9098ea127ebb5d3693a83"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afaaaf64de0fd3c6824a99950a50c822c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#afaaaf64de0fd3c6824a99950a50c822c">connection_expire_held_open</a> (void)</td></tr>
<tr class="separator:afaaaf64de0fd3c6824a99950a50c822c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8da7ea5e1894734eb989e42fde859b2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#af8da7ea5e1894734eb989e42fde859b2">connection_connect</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, const char *address, const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *addr, uint16_t port, int *socket_error)</td></tr>
<tr class="separator:af8da7ea5e1894734eb989e42fde859b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f7e49d562c42623a0bd1d8edeb2c269"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a2f7e49d562c42623a0bd1d8edeb2c269">connection_proxy_connect</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, int type)</td></tr>
<tr class="separator:a2f7e49d562c42623a0bd1d8edeb2c269"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a762af8c79046607b86c5be3a403c736b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a762af8c79046607b86c5be3a403c736b">connection_read_proxy_handshake</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:a762af8c79046607b86c5be3a403c736b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7f6042798d28314aa4553456bd5f9e5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#ad7f6042798d28314aa4553456bd5f9e5">log_failed_proxy_connection</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:ad7f6042798d28314aa4553456bd5f9e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe9e86e1e84ebe4b3a167c0c8f9314c3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#afe9e86e1e84ebe4b3a167c0c8f9314c3">get_proxy_addrport</a> (<a class="el" href="structtor__addr__t.html">tor_addr_t</a> *addr, uint16_t *port, int *proxy_type, const <a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:afe9e86e1e84ebe4b3a167c0c8f9314c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70eb2da60775cc0bda58682470a752b6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a70eb2da60775cc0bda58682470a752b6">retry_all_listeners</a> (<a class="el" href="structsmartlist__t.html">smartlist_t</a> *replaced_conns, <a class="el" href="structsmartlist__t.html">smartlist_t</a> *new_conns, int close_all_noncontrol)</td></tr>
<tr class="separator:a70eb2da60775cc0bda58682470a752b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01097d299ca112865a182ea93e1a936f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a01097d299ca112865a182ea93e1a936f">connection_mark_all_noncontrol_listeners</a> (void)</td></tr>
<tr class="separator:a01097d299ca112865a182ea93e1a936f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad57ab7f216b7f1565fb39ec2b00f8edd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#ad57ab7f216b7f1565fb39ec2b00f8edd">connection_mark_all_noncontrol_connections</a> (void)</td></tr>
<tr class="separator:ad57ab7f216b7f1565fb39ec2b00f8edd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c57c611567b6477ed9510bb633830ab"><td class="memItemLeft" align="right" valign="top">ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a7c57c611567b6477ed9510bb633830ab">connection_bucket_write_limit</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, time_t now)</td></tr>
<tr class="separator:a7c57c611567b6477ed9510bb633830ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af717f75714620d7187bcdaae2df1434e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#af717f75714620d7187bcdaae2df1434e">global_write_bucket_low</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, size_t attempt, int priority)</td></tr>
<tr class="separator:af717f75714620d7187bcdaae2df1434e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ff0267e6da4a42daaca672efb6a82b0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a4ff0267e6da4a42daaca672efb6a82b0">connection_bucket_init</a> (void)</td></tr>
<tr class="separator:a4ff0267e6da4a42daaca672efb6a82b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02f880cd186a894e9f728d7cfa2f0c98"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a02f880cd186a894e9f728d7cfa2f0c98">connection_bucket_refill</a> (int seconds_elapsed, time_t now)</td></tr>
<tr class="separator:a02f880cd186a894e9f728d7cfa2f0c98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31da07e56253f0ca1dc6e4a0620d469b"><td class="memItemLeft" align="right" valign="top"><a id="a31da07e56253f0ca1dc6e4a0620d469b"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>connection_handle_read</b> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:a31da07e56253f0ca1dc6e4a0620d469b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae60601e7b7dcca8ff9b8afbf86437f18"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#ae60601e7b7dcca8ff9b8afbf86437f18">connection_fetch_from_buf</a> (char *string, size_t len, <a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:ae60601e7b7dcca8ff9b8afbf86437f18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabfe46bcf87eebc470a965412b5fca8e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#aabfe46bcf87eebc470a965412b5fca8e">connection_fetch_from_buf_line</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, char *data, size_t *data_len)</td></tr>
<tr class="separator:aabfe46bcf87eebc470a965412b5fca8e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a173a993b4f9bcc7522f35c56e65b615f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a173a993b4f9bcc7522f35c56e65b615f">connection_fetch_from_buf_http</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, char **headers_out, size_t max_headerlen, char **body_out, size_t *body_used, size_t max_bodylen, int force_complete)</td></tr>
<tr class="separator:a173a993b4f9bcc7522f35c56e65b615f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2314f1a80fe9795a41202f9751d090a5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a2314f1a80fe9795a41202f9751d090a5">connection_wants_to_flush</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:a2314f1a80fe9795a41202f9751d090a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a6be46082e23668c2cb0f323c171ad2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a1a6be46082e23668c2cb0f323c171ad2">connection_outbuf_too_full</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:a1a6be46082e23668c2cb0f323c171ad2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e5a7a2ae63401fe8701b047e01fd2c4"><td class="memItemLeft" align="right" valign="top"><a id="a6e5a7a2ae63401fe8701b047e01fd2c4"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>connection_handle_write</b> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, int force)</td></tr>
<tr class="separator:a6e5a7a2ae63401fe8701b047e01fd2c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6fa2b1498c44f367a9bcf97986a31613"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a6fa2b1498c44f367a9bcf97986a31613">connection_flush</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:a6fa2b1498c44f367a9bcf97986a31613"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e5edf7f33246b9c68bb5a9569ee2568"><td class="memItemLeft" align="right" valign="top"><a id="a6e5edf7f33246b9c68bb5a9569ee2568"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>MOCK_DECL</b> (void, connection_write_to_buf_impl_,(const char *string, size_t len, <a class="el" href="structconnection__t.html">connection_t</a> *conn, int zlib))</td></tr>
<tr class="separator:a6e5edf7f33246b9c68bb5a9569ee2568"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8172634fb511668d4ee40ab954ea262a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a8172634fb511668d4ee40ab954ea262a">connection_get_by_global_id</a> (uint64_t id)</td></tr>
<tr class="separator:a8172634fb511668d4ee40ab954ea262a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32c388b39c89a0a0caa40b4a9398eec7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a32c388b39c89a0a0caa40b4a9398eec7">connection_get_by_type</a> (int type)</td></tr>
<tr class="separator:a32c388b39c89a0a0caa40b4a9398eec7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a250c145326a2bcdb179b411bb6452249"><td class="memItemLeft" align="right" valign="top"><a id="a250c145326a2bcdb179b411bb6452249"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>MOCK_DECL</b> (<a class="el" href="structconnection__t.html">connection_t</a> *, connection_get_by_type_addr_port_purpose,(int type, const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *addr, uint16_t port, int purpose))</td></tr>
<tr class="separator:a250c145326a2bcdb179b411bb6452249"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaba7b52de4c051e6f72b649287dbf0d0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#aaba7b52de4c051e6f72b649287dbf0d0">connection_get_by_type_state</a> (int type, int state)</td></tr>
<tr class="separator:aaba7b52de4c051e6f72b649287dbf0d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a834b51dc69efa955ab17e7cd20a3c1f2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a834b51dc69efa955ab17e7cd20a3c1f2">connection_get_by_type_state_rendquery</a> (int type, int state, const char *rendquery)</td></tr>
<tr class="separator:a834b51dc69efa955ab17e7cd20a3c1f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86d2c5314a90b6c62dae9c9fc82ed241"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a86d2c5314a90b6c62dae9c9fc82ed241">connection_dir_list_by_purpose_and_resource</a> (int purpose, const char *resource)</td></tr>
<tr class="separator:a86d2c5314a90b6c62dae9c9fc82ed241"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a147c7e687750c8a345c5febefe4a1409"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a147c7e687750c8a345c5febefe4a1409">connection_dir_list_by_purpose_resource_and_state</a> (int purpose, const char *resource, int state)</td></tr>
<tr class="separator:a147c7e687750c8a345c5febefe4a1409"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ea12080fcbf972d9dbd36392ab8335f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a9ea12080fcbf972d9dbd36392ab8335f">any_other_active_or_conns</a> (const <a class="el" href="structor__connection__t.html">or_connection_t</a> *this_conn)</td></tr>
<tr class="separator:a9ea12080fcbf972d9dbd36392ab8335f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c3a40d68e869567e1a01d0e577534b2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a1c3a40d68e869567e1a01d0e577534b2">connection_is_listener</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:a1c3a40d68e869567e1a01d0e577534b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8cdf763ad0a8fa79e7561c91b3f8ecca"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a8cdf763ad0a8fa79e7561c91b3f8ecca">connection_state_is_open</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:a8cdf763ad0a8fa79e7561c91b3f8ecca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef88441c4b3ee3a887d3ec0927c66675"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#aef88441c4b3ee3a887d3ec0927c66675">connection_state_is_connecting</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn)</td></tr>
<tr class="separator:aef88441c4b3ee3a887d3ec0927c66675"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aafb7ad80e97c7c4d92831785f5262853"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#aafb7ad80e97c7c4d92831785f5262853">alloc_http_authenticator</a> (const char *authenticator)</td></tr>
<tr class="separator:aafb7ad80e97c7c4d92831785f5262853"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a738d9e7ef0c4a101c2adbd4cade35475"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a738d9e7ef0c4a101c2adbd4cade35475">assert_connection_ok</a> (<a class="el" href="structconnection__t.html">connection_t</a> *conn, time_t now)</td></tr>
<tr class="separator:a738d9e7ef0c4a101c2adbd4cade35475"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9874fc9cd6f255b931cbbcfc534702b7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a9874fc9cd6f255b931cbbcfc534702b7">connection_or_nonopen_was_started_here</a> (<a class="el" href="structor__connection__t.html">or_connection_t</a> *conn)</td></tr>
<tr class="separator:a9874fc9cd6f255b931cbbcfc534702b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4da339a8cd53ba30262d8445ab62e8a3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a4da339a8cd53ba30262d8445ab62e8a3">connection_dump_buffer_mem_stats</a> (int severity)</td></tr>
<tr class="separator:a4da339a8cd53ba30262d8445ab62e8a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb2f366b0c29db44baa2477bebbae15d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#aeb2f366b0c29db44baa2477bebbae15d">remove_file_if_very_old</a> (const char *fname, time_t now)</td></tr>
<tr class="separator:aeb2f366b0c29db44baa2477bebbae15d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14be61f9dd31706f59ee48db802dbedc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#a14be61f9dd31706f59ee48db802dbedc">clock_skew_warning</a> (const <a class="el" href="structconnection__t.html">connection_t</a> *conn, long apparent_skew, int trusted, <a class="el" href="torlog_8h.html#a3ea3afb80db88b6ccec80d80ac98cea1">log_domain_mask_t</a> domain, const char *received, const char *source)</td></tr>
<tr class="separator:a14be61f9dd31706f59ee48db802dbedc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd3783a8e4fc9ee457e1e50cc638b169"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connection_8h.html#afd3783a8e4fc9ee457e1e50cc638b169">connection_check_oos</a> (int n_socks, int failed)</td></tr>
<tr class="separator:afd3783a8e4fc9ee457e1e50cc638b169"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Header file for <a class="el" href="connection_8c.html" title="General high-level functions to handle reading and writing on connections. ">connection.c</a>. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a90f8ad73eae855e1b8f9d50553efc075"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90f8ad73eae855e1b8f9d50553efc075">&#9670;&nbsp;</a></span>CONN_LEN_AND_FREE_TEMPLATE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CONN_LEN_AND_FREE_TEMPLATE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">sl</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">STMT_BEGIN                           \</div><div class="line">    int len = smartlist_len(sl);       \</div><div class="line">    smartlist_free(sl);                \</div><div class="line">    return len;                        \</div><div class="line">  STMT_END</div></div><!-- fragment -->
</div>
</div>
<a id="aa896599b6344bce8e80b1312ca744cb2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa896599b6344bce8e80b1312ca744cb2">&#9670;&nbsp;</a></span>connection_mark_and_flush_</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define connection_mark_and_flush_</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">c, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">line, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">file&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> {                                                                    \</div><div class="line">    connection_t *tmp_conn_ = (c);                                        \</div><div class="line">    if (tmp_conn_-&gt;type == <a class="code" href="or_8h.html#a1e908736ccab37a7ae72a8c1a3b9d539">CONN_TYPE_OR</a>) {                                \</div><div class="line">      log_warn(<a class="code" href="torlog_8h.html#a628523e930d9c457bba4b450ed5624c2">LD_CHANNEL</a> | <a class="code" href="torlog_8h.html#aaed5930f414b821f3533f34f839707c8">LD_BUG</a>,                                       \</div><div class="line">               <span class="stringliteral">&quot;Something tried to close (and flush) an or_connection_t&quot;</span>  \</div><div class="line">               <span class="stringliteral">&quot; without going through channels at %s:%d&quot;</span>,                \</div><div class="line">               file, line);                                               \</div><div class="line">      connection_or_close_for_error(TO_OR_CONN(tmp_conn_), 1);            \</div><div class="line">    } <span class="keywordflow">else</span> {                                                              \</div><div class="line">      connection_mark_and_flush_internal_(c, line, file);                 \</div><div class="line">    }                                                                     \</div><div class="line">  } <span class="keywordflow">while</span> (0)</div><div class="ttc" id="torlog_8h_html_a628523e930d9c457bba4b450ed5624c2"><div class="ttname"><a href="torlog_8h.html#a628523e930d9c457bba4b450ed5624c2">LD_CHANNEL</a></div><div class="ttdeci">#define LD_CHANNEL</div><div class="ttdef"><b>Definition:</b> torlog.h:99</div></div>
<div class="ttc" id="or_8h_html_a1e908736ccab37a7ae72a8c1a3b9d539"><div class="ttname"><a href="or_8h.html#a1e908736ccab37a7ae72a8c1a3b9d539">CONN_TYPE_OR</a></div><div class="ttdeci">#define CONN_TYPE_OR</div><div class="ttdef"><b>Definition:</b> or.h:175</div></div>
<div class="ttc" id="torlog_8h_html_aaed5930f414b821f3533f34f839707c8"><div class="ttname"><a href="torlog_8h.html#aaed5930f414b821f3533f34f839707c8">LD_BUG</a></div><div class="ttdeci">#define LD_BUG</div><div class="ttdef"><b>Definition:</b> torlog.h:80</div></div>
</div><!-- fragment --><p>Mark 'c' for close, but try to hold it open until all the data is written. </p>

</div>
</div>
<a id="a7a54e93a28166250c3aebb899358da53"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a54e93a28166250c3aebb899358da53">&#9670;&nbsp;</a></span>connection_mark_and_flush_internal_</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define connection_mark_and_flush_internal_</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">c, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">line, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">file&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> {                                                                  \</div><div class="line">    connection_t *tmp_conn__ = (c);                                     \</div><div class="line">    connection_mark_for_close_internal_(tmp_conn__, (line), (file));    \</div><div class="line">    tmp_conn__-&gt;hold_open_until_flushed = 1;                            \</div><div class="line">  } <span class="keywordflow">while</span> (0)</div></div><!-- fragment --><p>Mark 'c' for close, but try to hold it open until all the data is written. Use the _internal versions of connection_mark_for_close; this should be called when you either are sure that if this is an <a class="el" href="structor__connection__t.html">or_connection_t</a> the controlling channel has been notified (e.g. with <a class="el" href="connection__or_8c.html#a1782f56c8e2a13ef3db44eed29c83d28">connection_or_notify_error()</a>), or you actually are the connection_or_close_for_error() or connection_or_close_normally function. For all other cases, use connection_mark_and_flush() instead, which checks for <a class="el" href="structor__connection__t.html">or_connection_t</a> properly, instead. See below. </p>

</div>
</div>
<a id="ab725bdde78b708db48e54ee16a78ea04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab725bdde78b708db48e54ee16a78ea04">&#9670;&nbsp;</a></span>MAX_SOCKS5_AUTH_FIELD_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_SOCKS5_AUTH_FIELD_SIZE&#160;&#160;&#160;255</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Maximum size of information that we can fit into SOCKS5 username or password fields. </p>

</div>
</div>
<a id="a96c5bf0233ade2ac979ee67d207b3ec0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96c5bf0233ade2ac979ee67d207b3ec0">&#9670;&nbsp;</a></span>MAX_SOCKS5_AUTH_SIZE_TOTAL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_SOCKS5_AUTH_SIZE_TOTAL&#160;&#160;&#160;2*<a class="el" href="connection_8h.html#ab725bdde78b708db48e54ee16a78ea04">MAX_SOCKS5_AUTH_FIELD_SIZE</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Total maximum size of information that we can fit into SOCKS5 username and password fields. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="aafb7ad80e97c7c4d92831785f5262853"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aafb7ad80e97c7c4d92831785f5262853">&#9670;&nbsp;</a></span>alloc_http_authenticator()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* alloc_http_authenticator </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>authenticator</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocates a base64'ed authenticator for use in http or https auth, based on the input string <b>authenticator</b>. Returns it if success, else returns NULL. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_aafb7ad80e97c7c4d92831785f5262853_cgraph.png" border="0" usemap="#connection_8h_aafb7ad80e97c7c4d92831785f5262853_cgraph" alt=""/></div>
<map name="connection_8h_aafb7ad80e97c7c4d92831785f5262853_cgraph" id="connection_8h_aafb7ad80e97c7c4d92831785f5262853_cgraph">
<area shape="rect" id="node2" href="util__format_8c.html#a733f32f58c6056750ad6f64228af51b2" title="base64_encode_size" alt="" coords="213,5,357,32"/>
</map>
</div>

</div>
</div>
<a id="a9ea12080fcbf972d9dbd36392ab8335f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ea12080fcbf972d9dbd36392ab8335f">&#9670;&nbsp;</a></span>any_other_active_or_conns()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int any_other_active_or_conns </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structor__connection__t.html">or_connection_t</a> *&#160;</td>
          <td class="paramname"><em>this_conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if there are any active OR connections apart from <b>this_conn</b>.</p>
<p>We use this to guess if we should tell the controller that we didn't manage to connect to any of our bridges. </p>

</div>
</div>
<a id="a738d9e7ef0c4a101c2adbd4cade35475"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a738d9e7ef0c4a101c2adbd4cade35475">&#9670;&nbsp;</a></span>assert_connection_ok()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void assert_connection_ok </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Verify that connection <b>conn</b> has all of its invariants correct. Trigger an assert if anything is invalid. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_a738d9e7ef0c4a101c2adbd4cade35475_icgraph.png" border="0" usemap="#connection_8h_a738d9e7ef0c4a101c2adbd4cade35475_icgraph" alt=""/></div>
<map name="connection_8h_a738d9e7ef0c4a101c2adbd4cade35475_icgraph" id="connection_8h_a738d9e7ef0c4a101c2adbd4cade35475_icgraph">
<area shape="rect" id="node2" href="connection_8h.html#a408567fdce15abf5e16163547d8223c1" title="connection_close_immediate" alt="" coords="216,5,407,32"/>
<area shape="rect" id="node3" href="connection_8h.html#a2a15ddd62951cefd848ec070f1d9c912" title="connection_mark_for\l_close_" alt="" coords="240,57,383,98"/>
<area shape="rect" id="node5" href="connection_8c.html#a6e0262219d1afbc700eacae441599fb4" title="MOCK_IMPL" alt="" coords="261,123,361,149"/>
<area shape="rect" id="node6" href="connection__or_8h.html#a61f2d552138b0e015906710a045a6c55" title="connection_or_finished\l_flushing" alt="" coords="234,174,389,215"/>
<area shape="rect" id="node7" href="dns_8h.html#abab9ee4ae98eafd0454adef2477f1a76" title="assert_all_pending\l_dns_resolves_ok" alt="" coords="246,239,377,281"/>
<area shape="rect" id="node8" href="main_8h.html#a5a32ff7bb266432116efdc333987a0e4" title="add_connection_to_closeable_list" alt="" coords="203,305,420,332"/>
<area shape="rect" id="node4" href="connection__edge_8c.html#a5922c995ab015f688168d02a6b954050" title="MOCK_IMPL" alt="" coords="468,64,568,91"/>
</map>
</div>

</div>
</div>
<a id="a14be61f9dd31706f59ee48db802dbedc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14be61f9dd31706f59ee48db802dbedc">&#9670;&nbsp;</a></span>clock_skew_warning()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void clock_skew_warning </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>apparent_skew</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>trusted</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="torlog_8h.html#a3ea3afb80db88b6ccec80d80ac98cea1">log_domain_mask_t</a>&#160;</td>
          <td class="paramname"><em>domain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>received</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>source</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Log a warning, and possibly emit a control event, that <b>received</b> came at a skewed time. <b>trusted</b> indicates that the <b>source</b> was one that we had more faith in and therefore the warning level should have higher severity. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_a14be61f9dd31706f59ee48db802dbedc_cgraph.png" border="0" usemap="#connection_8h_a14be61f9dd31706f59ee48db802dbedc_cgraph" alt=""/></div>
<map name="connection_8h_a14be61f9dd31706f59ee48db802dbedc_cgraph" id="connection_8h_a14be61f9dd31706f59ee48db802dbedc_cgraph">
<area shape="rect" id="node2" href="util_8c.html#a9a88be72c2d4775622cedbda5d76f833" title="format_time_interval" alt="" coords="196,5,336,32"/>
<area shape="rect" id="node5" href="compat_8c.html#ade97970c1d8a691241adac739c4f9b12" title="tor_asprintf" alt="" coords="223,56,309,83"/>
<area shape="rect" id="node3" href="compat_8c.html#af032ac661214ae28b4f205781a515290" title="tor_snprintf" alt="" coords="388,5,475,32"/>
<area shape="rect" id="node4" href="compat_8c.html#a1df7873b16ae8936d25dfedb706f4ea6" title="tor_vsnprintf" alt="" coords="527,5,621,32"/>
<area shape="rect" id="node6" href="compat_8c.html#a5ef7a08e8b543c0d61f9ef1081d4c1ea" title="tor_vasprintf" alt="" coords="384,56,479,83"/>
</map>
</div>

</div>
</div>
<a id="aab30a9246a7ca639ec6d7d42e1fa979c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab30a9246a7ca639ec6d7d42e1fa979c">&#9670;&nbsp;</a></span>conn_listener_type_supports_af_unix()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int conn_listener_type_supports_af_unix </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return true iff the provided connection listener type supports AF_UNIX sockets. </p>

</div>
</div>
<a id="a0f03ee7b48ac2f674af67ce1f0201d3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f03ee7b48ac2f674af67ce1f0201d3c">&#9670;&nbsp;</a></span>conn_state_to_string()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* conn_state_to_string </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the human-readable name for the connection state <b>state</b> for the connection type <b>type</b> </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_a0f03ee7b48ac2f674af67ce1f0201d3c_icgraph.png" border="0" usemap="#connection_8h_a0f03ee7b48ac2f674af67ce1f0201d3c_icgraph" alt=""/></div>
<map name="connection_8h_a0f03ee7b48ac2f674af67ce1f0201d3c_icgraph" id="connection_8h_a0f03ee7b48ac2f674af67ce1f0201d3c_icgraph">
<area shape="rect" id="node2" href="connection_8h.html#afaaaf64de0fd3c6824a99950a50c822c" title="connection_expire_held_open" alt="" coords="196,5,389,32"/>
</map>
</div>

</div>
</div>
<a id="aa05a243a33eb2a242e48f1866ab2806a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa05a243a33eb2a242e48f1866ab2806a">&#9670;&nbsp;</a></span>conn_type_to_string()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* conn_type_to_string </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the human-readable name for the connection type <b>type</b> </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_aa05a243a33eb2a242e48f1866ab2806a_icgraph.png" border="0" usemap="#connection_8h_aa05a243a33eb2a242e48f1866ab2806a_icgraph" alt=""/></div>
<map name="connection_8h_aa05a243a33eb2a242e48f1866ab2806a_icgraph" id="connection_8h_aa05a243a33eb2a242e48f1866ab2806a_icgraph">
<area shape="rect" id="node2" href="connection_8h.html#afaaaf64de0fd3c6824a99950a50c822c" title="connection_expire_held_open" alt="" coords="192,5,385,32"/>
</map>
</div>

</div>
</div>
<a id="ade7f55aa182a3f727d25a510566351fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade7f55aa182a3f727d25a510566351fd">&#9670;&nbsp;</a></span>connection_about_to_close_connection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_about_to_close_connection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Called when we're about to finally unlink and free a connection: perform necessary accounting and cleanup</p><ul>
<li>Directory conns that failed to fetch a rendezvous descriptor need to inform pending rendezvous streams.</li>
<li>OR conns need to call rep_hist_note_*() to record status.</li>
<li>AP conns need to send a socks reject if necessary.</li>
<li>Exit conns need to call <a class="el" href="dns_8c.html#a6a761da0f544b95dc87b5522f49d9866">connection_dns_remove()</a> if necessary.</li>
<li>AP and Exit conns need to send an end cell if they can.</li>
<li>DNS conns need to fail any resolves that are pending on them.</li>
<li>OR and edge connections need to be unlinked from circuits. </li>
</ul>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_ade7f55aa182a3f727d25a510566351fd_cgraph.png" border="0" usemap="#connection_8h_ade7f55aa182a3f727d25a510566351fd_cgraph" alt=""/></div>
<map name="connection_8h_ade7f55aa182a3f727d25a510566351fd_cgraph" id="connection_8h_ade7f55aa182a3f727d25a510566351fd_cgraph">
<area shape="rect" id="node2" href="directory_8c.html#ae225c64a35559d7a6e7b06d8fd5c121c" title="connection_dir_about\l_to_close" alt="" coords="196,5,341,47"/>
</map>
</div>

</div>
</div>
<a id="a4ff0267e6da4a42daaca672efb6a82b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ff0267e6da4a42daaca672efb6a82b0">&#9670;&nbsp;</a></span>connection_bucket_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_bucket_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize the global read bucket to options-&gt;BandwidthBurst. </p>

</div>
</div>
<a id="a02f880cd186a894e9f728d7cfa2f0c98"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02f880cd186a894e9f728d7cfa2f0c98">&#9670;&nbsp;</a></span>connection_bucket_refill()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_bucket_refill </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>milliseconds_elapsed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Time has passed; increment buckets appropriately. </p>

</div>
</div>
<a id="a7c57c611567b6477ed9510bb633830ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c57c611567b6477ed9510bb633830ab">&#9670;&nbsp;</a></span>connection_bucket_write_limit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t connection_bucket_write_limit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>How many bytes at most can we write onto this connection? </p>

</div>
</div>
<a id="afd3783a8e4fc9ee457e1e50cc638b169"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd3783a8e4fc9ee457e1e50cc638b169">&#9670;&nbsp;</a></span>connection_check_oos()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_check_oos </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n_socks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>failed</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Out-of-Sockets handler; n_socks is the current number of open sockets, and failed is non-zero if a socket exhaustion related error immediately preceded this call. This is where to do circuit-killing heuristics as needed. </p>

</div>
</div>
<a id="a408567fdce15abf5e16163547d8223c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a408567fdce15abf5e16163547d8223c1">&#9670;&nbsp;</a></span>connection_close_immediate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_close_immediate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Close the underlying socket for <b>conn</b>, so we don't try to flush it. Must be used in conjunction with (right before) connection_mark_for_close(). </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_a408567fdce15abf5e16163547d8223c1_cgraph.png" border="0" usemap="#connection_8h_a408567fdce15abf5e16163547d8223c1_cgraph" alt=""/></div>
<map name="connection_8h_a408567fdce15abf5e16163547d8223c1_cgraph" id="connection_8h_a408567fdce15abf5e16163547d8223c1_cgraph">
<area shape="rect" id="node2" href="connection_8c.html#a738d9e7ef0c4a101c2adbd4cade35475" title="assert_connection_ok" alt="" coords="244,5,393,32"/>
</map>
</div>

</div>
</div>
<a id="af8da7ea5e1894734eb989e42fde859b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8da7ea5e1894734eb989e42fde859b2">&#9670;&nbsp;</a></span>connection_connect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_connect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structtor__addr__t.html">tor_addr_t</a> *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>socket_error</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Take conn, make a nonblocking socket; try to connect to addr:port (port arrives in <em>host order</em>). If fail, return -1 and if applicable put your best guess about errno into *<b>socket_error</b>. Else assign s to conn-&gt;s: if connected return 1, if EAGAIN return 0.</p>
<p>addr:port can be different to conn-&gt;addr:conn-&gt;port if connecting through a proxy.</p>
<p>address is used to make the logs useful.</p>
<p>On success, add conn to the list of polled connections. </p>

</div>
</div>
<a id="a86d2c5314a90b6c62dae9c9fc82ed241"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86d2c5314a90b6c62dae9c9fc82ed241">&#9670;&nbsp;</a></span>connection_dir_list_by_purpose_and_resource()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structsmartlist__t.html">smartlist_t</a>* connection_dir_list_by_purpose_and_resource </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>purpose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>resource</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a list of directory connections that are fetching the item described by <b>purpose</b>/<b>resource</b>. If there are none, return an empty list. This list must be freed using smartlist_free, but the pointers in it must not be freed. Note that this list should not be cached, as the pointers in it can be freed if their connections close. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_a86d2c5314a90b6c62dae9c9fc82ed241_cgraph.png" border="0" usemap="#connection_8h_a86d2c5314a90b6c62dae9c9fc82ed241_cgraph" alt=""/></div>
<map name="connection_8h_a86d2c5314a90b6c62dae9c9fc82ed241_cgraph" id="connection_8h_a86d2c5314a90b6c62dae9c9fc82ed241_cgraph">
<area shape="rect" id="node2" href="util_8c.html#a66dfc160abb620a3fccaf54d563e5725" title="strcmp_opt" alt="" coords="235,13,321,39"/>
</map>
</div>

</div>
</div>
<a id="a147c7e687750c8a345c5febefe4a1409"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a147c7e687750c8a345c5febefe4a1409">&#9670;&nbsp;</a></span>connection_dir_list_by_purpose_resource_and_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structsmartlist__t.html">smartlist_t</a>* connection_dir_list_by_purpose_resource_and_state </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>purpose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>resource</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a list of directory connections that are fetching the item described by <b>purpose</b>/<b>resource</b>/<b>state</b>. If there are none, return an empty list. This list must be freed using smartlist_free, but the pointers in it must not be freed. Note that this list should not be cached, as the pointers in it can be freed if their connections close. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_a147c7e687750c8a345c5febefe4a1409_cgraph.png" border="0" usemap="#connection_8h_a147c7e687750c8a345c5febefe4a1409_cgraph" alt=""/></div>
<map name="connection_8h_a147c7e687750c8a345c5febefe4a1409_cgraph" id="connection_8h_a147c7e687750c8a345c5febefe4a1409_cgraph">
<area shape="rect" id="node2" href="util_8c.html#a66dfc160abb620a3fccaf54d563e5725" title="strcmp_opt" alt="" coords="207,20,293,47"/>
</map>
</div>

</div>
</div>
<a id="a4da339a8cd53ba30262d8445ab62e8a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4da339a8cd53ba30262d8445ab62e8a3">&#9670;&nbsp;</a></span>connection_dump_buffer_mem_stats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_dump_buffer_mem_stats </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>severity</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Log how many bytes are used by buffers of different kinds and sizes. </p>

</div>
</div>
<a id="afaaaf64de0fd3c6824a99950a50c822c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afaaaf64de0fd3c6824a99950a50c822c">&#9670;&nbsp;</a></span>connection_expire_held_open()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_expire_held_open </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Find each connection that has hold_open_until_flushed set to 1 but hasn't written in the past 15 seconds, and set hold_open_until_flushed to 0. This means it will get cleaned up in the next loop through close_if_marked() in <a class="el" href="main_8c.html" title="Toplevel module. Handles signals, multiplexes between connections, implements main loop...">main.c</a>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_afaaaf64de0fd3c6824a99950a50c822c_cgraph.png" border="0" usemap="#connection_8h_afaaaf64de0fd3c6824a99950a50c822c_cgraph" alt=""/></div>
<map name="connection_8h_afaaaf64de0fd3c6824a99950a50c822c_cgraph" id="connection_8h_afaaaf64de0fd3c6824a99950a50c822c_cgraph">
<area shape="rect" id="node2" href="connection_8c.html#aa05a243a33eb2a242e48f1866ab2806a" title="conn_type_to_string" alt="" coords="249,5,387,32"/>
<area shape="rect" id="node3" href="connection_8c.html#a0f03ee7b48ac2f674af67ce1f0201d3c" title="conn_state_to_string" alt="" coords="247,56,389,83"/>
</map>
</div>

</div>
</div>
<a id="ae60601e7b7dcca8ff9b8afbf86437f18"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae60601e7b7dcca8ff9b8afbf86437f18">&#9670;&nbsp;</a></span>connection_fetch_from_buf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_fetch_from_buf </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A pass-through to fetch_from_buf. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_ae60601e7b7dcca8ff9b8afbf86437f18_cgraph.png" border="0" usemap="#connection_8h_ae60601e7b7dcca8ff9b8afbf86437f18_cgraph" alt=""/></div>
<map name="connection_8h_ae60601e7b7dcca8ff9b8afbf86437f18_cgraph" id="connection_8h_ae60601e7b7dcca8ff9b8afbf86437f18_cgraph">
<area shape="rect" id="node2" href="buffers_8c.html#ac0eaa6d554d8f3806529be908761c0b6" title="fetch_from_buf" alt="" coords="232,5,341,32"/>
</map>
</div>

</div>
</div>
<a id="a173a993b4f9bcc7522f35c56e65b615f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a173a993b4f9bcc7522f35c56e65b615f">&#9670;&nbsp;</a></span>connection_fetch_from_buf_http()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_fetch_from_buf_http </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>headers_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>max_headerlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>body_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>body_used</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>max_bodylen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>force_complete</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>As fetch_from_buf_http, but fetches from a connection's input buffer_t as appropriate. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_a173a993b4f9bcc7522f35c56e65b615f_cgraph.png" border="0" usemap="#connection_8h_a173a993b4f9bcc7522f35c56e65b615f_cgraph" alt=""/></div>
<map name="connection_8h_a173a993b4f9bcc7522f35c56e65b615f_cgraph" id="connection_8h_a173a993b4f9bcc7522f35c56e65b615f_cgraph">
<area shape="rect" id="node2" href="buffers_8c.html#a1c180fbc5977d558988ab676dd87c1de" title="fetch_from_buf_http" alt="" coords="208,13,347,39"/>
</map>
</div>

</div>
</div>
<a id="aabfe46bcf87eebc470a965412b5fca8e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aabfe46bcf87eebc470a965412b5fca8e">&#9670;&nbsp;</a></span>connection_fetch_from_buf_line()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_fetch_from_buf_line </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>data_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>As <a class="el" href="buffers_8c.html#adc6d40f0e53e9bf0b10107d58c168072">fetch_from_buf_line()</a>, but read from a connection's input buffer. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_aabfe46bcf87eebc470a965412b5fca8e_cgraph.png" border="0" usemap="#connection_8h_aabfe46bcf87eebc470a965412b5fca8e_cgraph" alt=""/></div>
<map name="connection_8h_aabfe46bcf87eebc470a965412b5fca8e_cgraph" id="connection_8h_aabfe46bcf87eebc470a965412b5fca8e_cgraph">
<area shape="rect" id="node2" href="buffers_8c.html#adc6d40f0e53e9bf0b10107d58c168072" title="fetch_from_buf_line" alt="" coords="208,13,344,39"/>
</map>
</div>

</div>
</div>
<a id="a6fa2b1498c44f367a9bcf97986a31613"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6fa2b1498c44f367a9bcf97986a31613">&#9670;&nbsp;</a></span>connection_flush()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_flush </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Try to flush data that's waiting for a write on <b>conn</b>. Return -1 on failure, 0 on success.</p>
<p>Don't use this function for regular writing; the buffers system should be good enough at scheduling writes there. Instead, this function is for cases when we're about to exit or something and we want to report it right away. </p>

</div>
</div>
<a id="aac060666510d641a1a275af05d985a92"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac060666510d641a1a275af05d985a92">&#9670;&nbsp;</a></span>connection_free_all()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_free_all </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Call <a class="el" href="connection_8c.html#a8fa49c72715c39ab0f3f1dde57aa7d72">connection_free_()</a> on every connection in our array, and release all storage held by <a class="el" href="connection_8c.html" title="General high-level functions to handle reading and writing on connections. ">connection.c</a>.</p>
<p>Don't do the checks in connection_free(), because they will fail. </p>

</div>
</div>
<a id="a8172634fb511668d4ee40ab954ea262a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8172634fb511668d4ee40ab954ea262a">&#9670;&nbsp;</a></span>connection_get_by_global_id()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structconnection__t.html">connection_t</a>* connection_get_by_global_id </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the stream with id <b>id</b> if it is not already marked for close. </p>

</div>
</div>
<a id="a32c388b39c89a0a0caa40b4a9398eec7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32c388b39c89a0a0caa40b4a9398eec7">&#9670;&nbsp;</a></span>connection_get_by_type()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structconnection__t.html">connection_t</a>* connection_get_by_type </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a connection of type <b>type</b> that is not marked for close. </p>

</div>
</div>
<a id="aaba7b52de4c051e6f72b649287dbf0d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaba7b52de4c051e6f72b649287dbf0d0">&#9670;&nbsp;</a></span>connection_get_by_type_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structconnection__t.html">connection_t</a>* connection_get_by_type_state </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a connection of type <b>type</b> that is in state <b>state</b>, and that is not marked for close. </p>

</div>
</div>
<a id="a834b51dc69efa955ab17e7cd20a3c1f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a834b51dc69efa955ab17e7cd20a3c1f2">&#9670;&nbsp;</a></span>connection_get_by_type_state_rendquery()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structconnection__t.html">connection_t</a>* connection_get_by_type_state_rendquery </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>rendquery</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return a connection of type <b>type</b> that has rendquery equal to <b>rendquery</b>, and that is not marked for close. If state is non-zero, conn must be of that state too. </p>

</div>
</div>
<a id="a1c3a40d68e869567e1a01d0e577534b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c3a40d68e869567e1a01d0e577534b2">&#9670;&nbsp;</a></span>connection_is_listener()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_is_listener </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if <b>conn</b> is a listener conn, else return 0. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_a1c3a40d68e869567e1a01d0e577534b2_icgraph.png" border="0" usemap="#connection_8h_a1c3a40d68e869567e1a01d0e577534b2_icgraph" alt=""/></div>
<map name="connection_8h_a1c3a40d68e869567e1a01d0e577534b2_icgraph" id="connection_8h_a1c3a40d68e869567e1a01d0e577534b2_icgraph">
<area shape="rect" id="node2" href="connection_8h.html#a70eb2da60775cc0bda58682470a752b6" title="retry_all_listeners" alt="" coords="215,5,339,32"/>
<area shape="rect" id="node3" href="connection_8h.html#a01097d299ca112865a182ea93e1a936f" title="connection_mark_all\l_noncontrol_listeners" alt="" coords="204,57,349,98"/>
</map>
</div>

</div>
</div>
<a id="a15be4ffce8c79930976b89d6c1d3c5a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15be4ffce8c79930976b89d6c1d3c5a8">&#9670;&nbsp;</a></span>connection_link_connections()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_link_connections </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn_a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn_b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create a link between <b>conn_a</b> and <b>conn_b</b>. </p>

</div>
</div>
<a id="ad57ab7f216b7f1565fb39ec2b00f8edd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad57ab7f216b7f1565fb39ec2b00f8edd">&#9670;&nbsp;</a></span>connection_mark_all_noncontrol_connections()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_mark_all_noncontrol_connections </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Mark every external connection not used for controllers for close. </p>

</div>
</div>
<a id="a01097d299ca112865a182ea93e1a936f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01097d299ca112865a182ea93e1a936f">&#9670;&nbsp;</a></span>connection_mark_all_noncontrol_listeners()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_mark_all_noncontrol_listeners </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Mark every listener of type other than CONTROL_LISTENER to be closed. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_a01097d299ca112865a182ea93e1a936f_cgraph.png" border="0" usemap="#connection_8h_a01097d299ca112865a182ea93e1a936f_cgraph" alt=""/></div>
<map name="connection_8h_a01097d299ca112865a182ea93e1a936f_cgraph" id="connection_8h_a01097d299ca112865a182ea93e1a936f_cgraph">
<area shape="rect" id="node2" href="connection_8c.html#a1c3a40d68e869567e1a01d0e577534b2" title="connection_is_listener" alt="" coords="199,13,349,39"/>
</map>
</div>

</div>
</div>
<a id="a2a15ddd62951cefd848ec070f1d9c912"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a15ddd62951cefd848ec070f1d9c912">&#9670;&nbsp;</a></span>connection_mark_for_close_()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connection_mark_for_close_ </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Mark <b>conn</b> to be closed next time we loop through conn_close_if_marked() in <a class="el" href="main_8c.html" title="Toplevel module. Handles signals, multiplexes between connections, implements main loop...">main.c</a>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_a2a15ddd62951cefd848ec070f1d9c912_cgraph.png" border="0" usemap="#connection_8h_a2a15ddd62951cefd848ec070f1d9c912_cgraph" alt=""/></div>
<map name="connection_8h_a2a15ddd62951cefd848ec070f1d9c912_cgraph" id="connection_8h_a2a15ddd62951cefd848ec070f1d9c912_cgraph">
<area shape="rect" id="node2" href="connection_8c.html#a738d9e7ef0c4a101c2adbd4cade35475" title="assert_connection_ok" alt="" coords="196,13,345,39"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_a2a15ddd62951cefd848ec070f1d9c912_icgraph.png" border="0" usemap="#connection_8h_a2a15ddd62951cefd848ec070f1d9c912_icgraph" alt=""/></div>
<map name="connection_8h_a2a15ddd62951cefd848ec070f1d9c912_icgraph" id="connection_8h_a2a15ddd62951cefd848ec070f1d9c912_icgraph">
<area shape="rect" id="node2" href="connection__edge_8c.html#a5922c995ab015f688168d02a6b954050" title="MOCK_IMPL" alt="" coords="196,13,296,39"/>
</map>
</div>

</div>
</div>
<a id="a4810086178d87cb306c2bb4b60145abe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4810086178d87cb306c2bb4b60145abe">&#9670;&nbsp;</a></span>connection_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structconnection__t.html">connection_t</a>* connection_new </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>socket_family</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate, initialize, and return a new <a class="el" href="structconnection__t.html">connection_t</a> subtype of <b>type</b> to make or receive connections of address family <b>socket_family</b>. The type should be one of the CONN_TYPE_* constants. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_a4810086178d87cb306c2bb4b60145abe_cgraph.png" border="0" usemap="#connection_8h_a4810086178d87cb306c2bb4b60145abe_cgraph" alt=""/></div>
<map name="connection_8h_a4810086178d87cb306c2bb4b60145abe_cgraph" id="connection_8h_a4810086178d87cb306c2bb4b60145abe_cgraph">
<area shape="rect" id="node2" href="connection_8c.html#a0873faa8af99710bc36a3950b1bf68a6" title="or_connection_new" alt="" coords="183,5,318,32"/>
<area shape="rect" id="node3" href="connection_8c.html#a2ec50dd3f5bb871bf4a7058e4a57a754" title="edge_connection_new" alt="" coords="175,56,326,83"/>
<area shape="rect" id="node4" href="connection_8c.html#adf77e71582e9f5e3a07d50af731b0427" title="entry_connection_new" alt="" coords="175,107,327,133"/>
<area shape="rect" id="node5" href="connection_8c.html#a17c7be36733025b9c1384db24193776c" title="dir_connection_new" alt="" coords="182,157,319,184"/>
<area shape="rect" id="node6" href="connection_8c.html#a1ab4242cd0fbf4bf874bcbb86ce1e7ba" title="control_connection_new" alt="" coords="169,208,332,235"/>
</map>
</div>

</div>
</div>
<a id="a9874fc9cd6f255b931cbbcfc534702b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9874fc9cd6f255b931cbbcfc534702b7">&#9670;&nbsp;</a></span>connection_or_nonopen_was_started_here()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_or_nonopen_was_started_here </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structor__connection__t.html">or_connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if we initiated this connection, or 0 if it started out as an incoming connection. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_a9874fc9cd6f255b931cbbcfc534702b7_cgraph.png" border="0" usemap="#connection_8h_a9874fc9cd6f255b931cbbcfc534702b7_cgraph" alt=""/></div>
<map name="connection_8h_a9874fc9cd6f255b931cbbcfc534702b7_cgraph" id="connection_8h_a9874fc9cd6f255b931cbbcfc534702b7_cgraph">
<area shape="rect" id="node2" href="tortls_8c.html#a89dbecf04240626af4b070b1b83c9f56" title="tor_tls_is_server" alt="" coords="212,13,331,39"/>
</map>
</div>

</div>
</div>
<a id="a1a6be46082e23668c2cb0f323c171ad2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a6be46082e23668c2cb0f323c171ad2">&#9670;&nbsp;</a></span>connection_outbuf_too_full()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_outbuf_too_full </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Are there too many bytes on edge connection <b>conn</b>'s outbuf to send back a relay-level sendme yet? Return 1 if so, 0 if not. Used by <a class="el" href="relay_8c.html#a4e70e8fbfc6c89fa97102836a87a99c4">connection_edge_consider_sending_sendme()</a>. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_a1a6be46082e23668c2cb0f323c171ad2_icgraph.png" border="0" usemap="#connection_8h_a1a6be46082e23668c2cb0f323c171ad2_icgraph" alt=""/></div>
<map name="connection_8h_a1a6be46082e23668c2cb0f323c171ad2_icgraph" id="connection_8h_a1a6be46082e23668c2cb0f323c171ad2_icgraph">
<area shape="rect" id="node2" href="relay_8h.html#a4e70e8fbfc6c89fa97102836a87a99c4" title="connection_edge_consider\l_sending_sendme" alt="" coords="231,27,407,69"/>
<area shape="rect" id="node3" href="connection__edge_8h.html#a98855be3866a7e56063cefe658788fcd" title="connection_edge_flushed_some" alt="" coords="455,5,663,32"/>
<area shape="rect" id="node4" href="connection__edge_8h.html#a84d464ff322df919a496d6fdfba9dade" title="connection_edge_finished\l_flushing" alt="" coords="473,57,645,98"/>
</map>
</div>

</div>
</div>
<a id="a2f7e49d562c42623a0bd1d8edeb2c269"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f7e49d562c42623a0bd1d8edeb2c269">&#9670;&nbsp;</a></span>connection_proxy_connect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_proxy_connect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write a proxy request of <b>type</b> (socks4, socks5, https) to conn for conn-&gt;addr:conn-&gt;port, authenticating with the auth details given in the configuration (if available). SOCKS 5 and HTTP CONNECT proxies support authentication.</p>
<p>Returns -1 if conn-&gt;addr is incompatible with the proxy protocol, and 0 otherwise.</p>
<p>Use <a class="el" href="connection_8c.html#a762af8c79046607b86c5be3a403c736b">connection_read_proxy_handshake()</a> to complete the handshake. </p>

</div>
</div>
<a id="a762af8c79046607b86c5be3a403c736b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a762af8c79046607b86c5be3a403c736b">&#9670;&nbsp;</a></span>connection_read_proxy_handshake()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_read_proxy_handshake </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Call this from connection_*_process_inbuf() to advance the proxy handshake.</p>
<p>No matter what proxy protocol is used, if this function returns 1, the handshake is complete, and the data remaining on inbuf may contain the start of the communication with the requested server.</p>
<p>Returns 0 if the current buffer contains an incomplete response, and -1 on error. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_a762af8c79046607b86c5be3a403c736b_icgraph.png" border="0" usemap="#connection_8h_a762af8c79046607b86c5be3a403c736b_icgraph" alt=""/></div>
<map name="connection_8h_a762af8c79046607b86c5be3a403c736b_icgraph" id="connection_8h_a762af8c79046607b86c5be3a403c736b_icgraph">
<area shape="rect" id="node2" href="connection__or_8h.html#a1c9c08479c7f8118438c42edb7046d32" title="connection_or_process\l_inbuf" alt="" coords="209,5,365,47"/>
</map>
</div>

</div>
</div>
<a id="aef88441c4b3ee3a887d3ec0927c66675"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef88441c4b3ee3a887d3ec0927c66675">&#9670;&nbsp;</a></span>connection_state_is_connecting()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_state_is_connecting </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if conn is in 'connecting' state, else return 0. </p>

</div>
</div>
<a id="a8cdf763ad0a8fa79e7561c91b3f8ecca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8cdf763ad0a8fa79e7561c91b3f8ecca">&#9670;&nbsp;</a></span>connection_state_is_open()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_state_is_open </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if <b>conn</b> is in state "open" and is not marked for close, else return 0. </p>

</div>
</div>
<a id="a2314f1a80fe9795a41202f9751d090a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2314f1a80fe9795a41202f9751d090a5">&#9670;&nbsp;</a></span>connection_wants_to_flush()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int connection_wants_to_flush </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return conn-&gt;outbuf_flushlen: how many bytes conn wants to flush from its outbuf. </p>

</div>
</div>
<a id="a1ab4242cd0fbf4bf874bcbb86ce1e7ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ab4242cd0fbf4bf874bcbb86ce1e7ba">&#9670;&nbsp;</a></span>control_connection_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structcontrol__connection__t.html">control_connection_t</a>* control_connection_new </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>socket_family</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate and return a new <a class="el" href="structcontrol__connection__t.html">control_connection_t</a>, initialized as by connection_init(). </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_a1ab4242cd0fbf4bf874bcbb86ce1e7ba_icgraph.png" border="0" usemap="#connection_8h_a1ab4242cd0fbf4bf874bcbb86ce1e7ba_icgraph" alt=""/></div>
<map name="connection_8h_a1ab4242cd0fbf4bf874bcbb86ce1e7ba_icgraph" id="connection_8h_a1ab4242cd0fbf4bf874bcbb86ce1e7ba_icgraph">
<area shape="rect" id="node2" href="connection_8h.html#a4810086178d87cb306c2bb4b60145abe" title="connection_new" alt="" coords="216,5,332,32"/>
</map>
</div>

</div>
</div>
<a id="a17c7be36733025b9c1384db24193776c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17c7be36733025b9c1384db24193776c">&#9670;&nbsp;</a></span>dir_connection_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdir__connection__t.html">dir_connection_t</a>* dir_connection_new </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>socket_family</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate and return a new <a class="el" href="structdir__connection__t.html">dir_connection_t</a>, initialized as by connection_init(). </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_a17c7be36733025b9c1384db24193776c_icgraph.png" border="0" usemap="#connection_8h_a17c7be36733025b9c1384db24193776c_icgraph" alt=""/></div>
<map name="connection_8h_a17c7be36733025b9c1384db24193776c_icgraph" id="connection_8h_a17c7be36733025b9c1384db24193776c_icgraph">
<area shape="rect" id="node2" href="connection_8h.html#a4810086178d87cb306c2bb4b60145abe" title="connection_new" alt="" coords="191,5,307,32"/>
</map>
</div>

</div>
</div>
<a id="a2ec50dd3f5bb871bf4a7058e4a57a754"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ec50dd3f5bb871bf4a7058e4a57a754">&#9670;&nbsp;</a></span>edge_connection_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structedge__connection__t.html">edge_connection_t</a>* edge_connection_new </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>socket_family</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate and return a new <a class="el" href="structedge__connection__t.html">edge_connection_t</a>, initialized as by connection_init(). </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_a2ec50dd3f5bb871bf4a7058e4a57a754_icgraph.png" border="0" usemap="#connection_8h_a2ec50dd3f5bb871bf4a7058e4a57a754_icgraph" alt=""/></div>
<map name="connection_8h_a2ec50dd3f5bb871bf4a7058e4a57a754_icgraph" id="connection_8h_a2ec50dd3f5bb871bf4a7058e4a57a754_icgraph">
<area shape="rect" id="node2" href="connection_8h.html#a4810086178d87cb306c2bb4b60145abe" title="connection_new" alt="" coords="221,5,337,32"/>
<area shape="rect" id="node3" href="connection__edge_8h.html#a8805ef6708301581c9339e83f41e76e0" title="connection_exit_begin\l_resolve" alt="" coords="204,57,355,98"/>
</map>
</div>

</div>
</div>
<a id="adf77e71582e9f5e3a07d50af731b0427"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf77e71582e9f5e3a07d50af731b0427">&#9670;&nbsp;</a></span>entry_connection_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structentry__connection__t.html">entry_connection_t</a>* entry_connection_new </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>socket_family</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate and return a new <a class="el" href="structentry__connection__t.html">entry_connection_t</a>, initialized as by connection_init().</p>
<p>Allocate space to store the socks_request. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_adf77e71582e9f5e3a07d50af731b0427_icgraph.png" border="0" usemap="#connection_8h_adf77e71582e9f5e3a07d50af731b0427_icgraph" alt=""/></div>
<map name="connection_8h_adf77e71582e9f5e3a07d50af731b0427_icgraph" id="connection_8h_adf77e71582e9f5e3a07d50af731b0427_icgraph">
<area shape="rect" id="node2" href="connection_8h.html#a4810086178d87cb306c2bb4b60145abe" title="connection_new" alt="" coords="205,5,321,32"/>
</map>
</div>

</div>
</div>
<a id="afe9e86e1e84ebe4b3a167c0c8f9314c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe9e86e1e84ebe4b3a167c0c8f9314c3">&#9670;&nbsp;</a></span>get_proxy_addrport()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int get_proxy_addrport </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structtor__addr__t.html">tor_addr_t</a> *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>proxy_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Fills <b>addr</b> and <b>port</b> with the details of the global proxy server we are using. <b>conn</b> contains the connection we are using the proxy for.</p>
<p>Return 0 on success, -1 on failure. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_afe9e86e1e84ebe4b3a167c0c8f9314c3_cgraph.png" border="0" usemap="#connection_8h_afe9e86e1e84ebe4b3a167c0c8f9314c3_cgraph" alt=""/></div>
<map name="connection_8h_afe9e86e1e84ebe4b3a167c0c8f9314c3_cgraph" id="connection_8h_afe9e86e1e84ebe4b3a167c0c8f9314c3_cgraph">
<area shape="rect" id="node2" href="entrynodes_8c.html#ac470a19b5347828069e8678db5a87779" title="get_transport_by_bridge\l_addrport" alt="" coords="187,5,348,47"/>
<area shape="rect" id="node3" href="address_8c.html#a139ff425c957e4eed3a766cb48f55f93" title="tor_addr_copy" alt="" coords="215,71,319,98"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_afe9e86e1e84ebe4b3a167c0c8f9314c3_icgraph.png" border="0" usemap="#connection_8h_afe9e86e1e84ebe4b3a167c0c8f9314c3_icgraph" alt=""/></div>
<map name="connection_8h_afe9e86e1e84ebe4b3a167c0c8f9314c3_icgraph" id="connection_8h_afe9e86e1e84ebe4b3a167c0c8f9314c3_icgraph">
<area shape="rect" id="node2" href="connection_8h.html#ad7f6042798d28314aa4553456bd5f9e5" title="log_failed_proxy_connection" alt="" coords="187,5,373,32"/>
</map>
</div>

</div>
</div>
<a id="af717f75714620d7187bcdaae2df1434e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af717f75714620d7187bcdaae2df1434e">&#9670;&nbsp;</a></span>global_write_bucket_low()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int global_write_bucket_low </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>attempt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>priority</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return 1 if the global write buckets are low enough that we shouldn't send <b>attempt</b> bytes of low-priority directory stuff out to <b>conn</b>. Else return 0.</p>
<p>Priority was 1 for v1 requests (directories and running-routers), and 2 for v2 requests and later (statuses and descriptors).</p>
<p>There are a lot of parameters we could use here:</p><ul>
<li>global_relayed_write_bucket. Low is bad.</li>
<li>global_write_bucket. Low is bad.</li>
<li>bandwidthrate. Low is bad.</li>
<li>bandwidthburst. Not a big factor?</li>
<li>attempt. High is bad.</li>
<li>total bytes queued on outbufs. High is bad. But I'm wary of using this, since a few slow-flushing queues will pump up the number without meaning what we meant to mean. What we really mean is "total directory bytes added to outbufs recently", but that's harder to quantify and harder to keep track of. </li>
</ul>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_af717f75714620d7187bcdaae2df1434e_cgraph.png" border="0" usemap="#connection_8h_af717f75714620d7187bcdaae2df1434e_cgraph" alt=""/></div>
<map name="connection_8h_af717f75714620d7187bcdaae2df1434e_cgraph" id="connection_8h_af717f75714620d7187bcdaae2df1434e_cgraph">
<area shape="rect" id="node2" href="router_8c.html#a2d62b1eeaa990670a04de8dfbb42ab8f" title="authdir_mode" alt="" coords="217,5,317,32"/>
</map>
</div>

</div>
</div>
<a id="a0b0571735fc8e34f09a8eb776f0f4d67"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b0571735fc8e34f09a8eb776f0f4d67">&#9670;&nbsp;</a></span>listener_connection_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlistener__connection__t.html">listener_connection_t</a>* listener_connection_new </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>socket_family</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate and return a new <a class="el" href="structlistener__connection__t.html">listener_connection_t</a>, initialized as by connection_init(). </p>

</div>
</div>
<a id="ad7f6042798d28314aa4553456bd5f9e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7f6042798d28314aa4553456bd5f9e5">&#9670;&nbsp;</a></span>log_failed_proxy_connection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void log_failed_proxy_connection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structconnection__t.html">connection_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Log a failed connection to a proxy server. <b>conn</b> is the connection we use the proxy server for. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_ad7f6042798d28314aa4553456bd5f9e5_cgraph.png" border="0" usemap="#connection_8h_ad7f6042798d28314aa4553456bd5f9e5_cgraph" alt=""/></div>
<map name="connection_8h_ad7f6042798d28314aa4553456bd5f9e5_cgraph" id="connection_8h_ad7f6042798d28314aa4553456bd5f9e5_cgraph">
<area shape="rect" id="node2" href="connection_8c.html#afe9e86e1e84ebe4b3a167c0c8f9314c3" title="get_proxy_addrport" alt="" coords="240,42,373,69"/>
<area shape="rect" id="node3" href="entrynodes_8c.html#ac470a19b5347828069e8678db5a87779" title="get_transport_by_bridge\l_addrport" alt="" coords="421,5,583,47"/>
<area shape="rect" id="node4" href="address_8c.html#a139ff425c957e4eed3a766cb48f55f93" title="tor_addr_copy" alt="" coords="450,71,554,98"/>
</map>
</div>

</div>
</div>
<a id="a0873faa8af99710bc36a3950b1bf68a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0873faa8af99710bc36a3950b1bf68a6">&#9670;&nbsp;</a></span>or_connection_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structor__connection__t.html">or_connection_t</a>* or_connection_new </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>socket_family</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate and return a new <a class="el" href="structor__connection__t.html">or_connection_t</a>, initialized as by connection_init().</p>
<p>Initialize active_circuit_pqueue.</p>
<p>Set active_circuit_pqueue_last_recalibrated to current cell_ewma tick. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_a0873faa8af99710bc36a3950b1bf68a6_icgraph.png" border="0" usemap="#connection_8h_a0873faa8af99710bc36a3950b1bf68a6_icgraph" alt=""/></div>
<map name="connection_8h_a0873faa8af99710bc36a3950b1bf68a6_icgraph" id="connection_8h_a0873faa8af99710bc36a3950b1bf68a6_icgraph">
<area shape="rect" id="node2" href="connection_8h.html#a4810086178d87cb306c2bb4b60145abe" title="connection_new" alt="" coords="188,5,304,32"/>
</map>
</div>

</div>
</div>
<a id="aeb2f366b0c29db44baa2477bebbae15d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb2f366b0c29db44baa2477bebbae15d">&#9670;&nbsp;</a></span>remove_file_if_very_old()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void remove_file_if_very_old </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given a file name check to see whether the file exists but has not been modified for a very long time. If so, remove it. </p>

</div>
</div>
<a id="a70eb2da60775cc0bda58682470a752b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70eb2da60775cc0bda58682470a752b6">&#9670;&nbsp;</a></span>retry_all_listeners()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int retry_all_listeners </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>replaced_conns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsmartlist__t.html">smartlist_t</a> *&#160;</td>
          <td class="paramname"><em>new_conns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>close_all_noncontrol</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Launch listeners for each port you should have open. Only launch listeners who are not already open, and only close listeners we no longer want.</p>
<p>Add all old conns that should be closed to <b>replaced_conns</b>. Add all new connections to <b>new_conns</b>.</p>
<p>If <b>close_all_noncontrol</b> is true, then we only open control listeners, and we close all other listeners. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="connection_8h_a70eb2da60775cc0bda58682470a752b6_cgraph.png" border="0" usemap="#connection_8h_a70eb2da60775cc0bda58682470a752b6_cgraph" alt=""/></div>
<map name="connection_8h_a70eb2da60775cc0bda58682470a752b6_cgraph" id="connection_8h_a70eb2da60775cc0bda58682470a752b6_cgraph">
<area shape="rect" id="node2" href="router_8c.html#a74a228ad9efff13643397a5c02d7bec7" title="router_get_advertised\l_or_port" alt="" coords="179,9,326,51"/>
<area shape="rect" id="node3" href="router_8c.html#a19b606096c7f385bb3db639b1a1c15fe" title="router_get_advertised\l_or_port_by_af" alt="" coords="376,39,523,80"/>
<area shape="rect" id="node6" href="router_8c.html#afc00fda5b227142768e650d169b3dd26" title="router_get_advertised\l_dir_port" alt="" coords="179,127,326,168"/>
<area shape="rect" id="node7" href="connection_8c.html#a1c3a40d68e869567e1a01d0e577534b2" title="connection_is_listener" alt="" coords="177,193,328,219"/>
<area shape="rect" id="node8" href="container_8c.html#accf59a8b7d39a4286ff99653b6878006" title="smartlist_add" alt="" coords="203,243,303,270"/>
<area shape="rect" id="node4" href="config_8c.html#a8b79c094d201fd02944aa463dcc6433c" title="get_first_advertised\l_port_by_type_af" alt="" coords="588,5,724,47"/>
<area shape="rect" id="node5" href="router_8c.html#a8bfae58f61a3329fd20f43c378bff0bb" title="router_get_active_listener\l_port_by_type_af" alt="" coords="571,71,741,112"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
