<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tor: /home/user/_my/code/bwauth-related/tor/src/or/onion_fast.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tor
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97b64286d42c5ef1697cb5f17129db19.html">tor</a></li><li class="navelem"><a class="el" href="dir_3cb0ba3f4b82dbe34a1a06276e96bc8d.html">src</a></li><li class="navelem"><a class="el" href="dir_386635fabd7f6c74e9d9c7a8604514a0.html">or</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">onion_fast.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Header file for <a class="el" href="onion__fast_8c.html" title="Functions implement the CREATE_FAST circuit handshake. ">onion_fast.c</a>.  
<a href="#details">More...</a></p>
<div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="onion__fast_8h__dep__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2onion__fast_8hdep" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2onion__fast_8hdep" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2onion__fast_8hdep">
<area shape="rect" id="node2" href="circuitbuild_8c.html" title="Implements the details of building circuits (by chosing paths, constructing/sending create/extend cel..." alt="" coords="5,109,153,165"/>
<area shape="rect" id="node3" href="circuitlist_8c.html" title="Manage the global circuit list, and looking up circuits within it. " alt="" coords="177,109,325,165"/>
<area shape="rect" id="node4" href="onion_8c.html" title="Functions to queue create cells, wrap the various onionskin types, and parse and create the CREATE ce..." alt="" coords="349,109,497,165"/>
<area shape="rect" id="node5" href="onion__fast_8c.html" title="Functions implement the CREATE_FAST circuit handshake. " alt="" coords="521,109,669,165"/>
</map>
</div>
</div>
<p><a href="onion__fast_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfast__handshake__state__t.html">fast_handshake_state_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a5a1f3e71bfae02bb87b351b4acb1fa97"><td class="memItemLeft" align="right" valign="top"><a id="a5a1f3e71bfae02bb87b351b4acb1fa97"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CREATE_FAST_LEN</b>&#160;&#160;&#160;<a class="el" href="crypto_8h.html#a14aa0c95ad1775ec290dc69b1ada1f6b">DIGEST_LEN</a></td></tr>
<tr class="separator:a5a1f3e71bfae02bb87b351b4acb1fa97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a898359389cf49e707cd0de8544e0dc13"><td class="memItemLeft" align="right" valign="top"><a id="a898359389cf49e707cd0de8544e0dc13"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CREATED_FAST_LEN</b>&#160;&#160;&#160;(<a class="el" href="crypto_8h.html#a14aa0c95ad1775ec290dc69b1ada1f6b">DIGEST_LEN</a>*2)</td></tr>
<tr class="separator:a898359389cf49e707cd0de8544e0dc13"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ad4d31e28c28ac4b0ec01737eb7ee3944"><td class="memItemLeft" align="right" valign="top"><a id="ad4d31e28c28ac4b0ec01737eb7ee3944"></a>
typedef struct <a class="el" href="structfast__handshake__state__t.html">fast_handshake_state_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>fast_handshake_state_t</b></td></tr>
<tr class="separator:ad4d31e28c28ac4b0ec01737eb7ee3944"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a089b172dc0c92e8f369b07d6860ba3bf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="onion__fast_8h.html#a089b172dc0c92e8f369b07d6860ba3bf">fast_handshake_state_free</a> (<a class="el" href="structfast__handshake__state__t.html">fast_handshake_state_t</a> *victim)</td></tr>
<tr class="separator:a089b172dc0c92e8f369b07d6860ba3bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1f356217f5a81498c68010fa8cb0a6f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="onion__fast_8h.html#af1f356217f5a81498c68010fa8cb0a6f">fast_onionskin_create</a> (<a class="el" href="structfast__handshake__state__t.html">fast_handshake_state_t</a> **handshake_state_out, uint8_t *handshake_out)</td></tr>
<tr class="separator:af1f356217f5a81498c68010fa8cb0a6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91ff6f246d69ce67880591240fd5658b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="onion__fast_8h.html#a91ff6f246d69ce67880591240fd5658b">fast_server_handshake</a> (const uint8_t *message_in, uint8_t *handshake_reply_out, uint8_t *key_out, size_t key_out_len)</td></tr>
<tr class="separator:a91ff6f246d69ce67880591240fd5658b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ba1cfee4a2c8340f584c14b03042bb0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="onion__fast_8h.html#a9ba1cfee4a2c8340f584c14b03042bb0">fast_client_handshake</a> (const <a class="el" href="structfast__handshake__state__t.html">fast_handshake_state_t</a> *handshake_state, const uint8_t *handshake_reply_out, uint8_t *key_out, size_t key_out_len, const char **msg_out)</td></tr>
<tr class="separator:a9ba1cfee4a2c8340f584c14b03042bb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Header file for <a class="el" href="onion__fast_8c.html" title="Functions implement the CREATE_FAST circuit handshake. ">onion_fast.c</a>. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a9ba1cfee4a2c8340f584c14b03042bb0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ba1cfee4a2c8340f584c14b03042bb0">&#9670;&nbsp;</a></span>fast_client_handshake()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fast_client_handshake </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structfast__handshake__state__t.html">fast_handshake_state_t</a> *&#160;</td>
          <td class="paramname"><em>handshake_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>handshake_reply_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>key_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>key_out_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>msg_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Implement the second half of the client side of the CREATE_FAST handshake. We sent the server <b>handshake_state</b> ("x") already, and the server told us <b>handshake_reply_out</b> (y|H(x|y)). Make sure that the hash is correct, and generate key material in <b>key_out</b>. Return 0 on success, true on failure.</p>
<p>NOTE: The "CREATE_FAST" handshake path is distinguishable from regular "onionskin" handshakes, and is not secure if an adversary can see or modify the messages. Therefore, it should only be used by clients, and only as the first hop of a circuit (since the first hop is already authenticated and protected by TLS). </p>

</div>
</div>
<a id="a089b172dc0c92e8f369b07d6860ba3bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a089b172dc0c92e8f369b07d6860ba3bf">&#9670;&nbsp;</a></span>fast_handshake_state_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fast_handshake_state_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfast__handshake__state__t.html">fast_handshake_state_t</a> *&#160;</td>
          <td class="paramname"><em>victim</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Release all state held in <b>victim</b>. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="onion__fast_8h_a089b172dc0c92e8f369b07d6860ba3bf_cgraph.png" border="0" usemap="#onion__fast_8h_a089b172dc0c92e8f369b07d6860ba3bf_cgraph" alt=""/></div>
<map name="onion__fast_8h_a089b172dc0c92e8f369b07d6860ba3bf_cgraph" id="onion__fast_8h_a089b172dc0c92e8f369b07d6860ba3bf_cgraph">
<area shape="rect" id="node2" href="crypto_8c.html#a955f8d276e5213dd68600bf6dee0b9ae" title="memwipe" alt="" coords="232,5,311,32"/>
</map>
</div>

</div>
</div>
<a id="af1f356217f5a81498c68010fa8cb0a6f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1f356217f5a81498c68010fa8cb0a6f">&#9670;&nbsp;</a></span>fast_onionskin_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fast_onionskin_create </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfast__handshake__state__t.html">fast_handshake_state_t</a> **&#160;</td>
          <td class="paramname"><em>handshake_state_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>handshake_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create the state needed to perform a CREATE_FAST handshake. Return 0 on success, -1 on failure. </p>

</div>
</div>
<a id="a91ff6f246d69ce67880591240fd5658b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91ff6f246d69ce67880591240fd5658b">&#9670;&nbsp;</a></span>fast_server_handshake()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fast_server_handshake </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>key_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>handshake_reply_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>key_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>key_out_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Implement the server side of the CREATE_FAST abbreviated handshake. The client has provided DIGEST_LEN key bytes in <b>key_in</b> ("x"). We generate a reply of DIGEST_LEN*2 bytes in <b>key_out</b>, consisting of a new random "y", followed by H(x|y) to check for correctness. We set <b>key_out_len</b> bytes of key material in <b>key_out</b>. Return 0 on success, &lt;0 on failure. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
