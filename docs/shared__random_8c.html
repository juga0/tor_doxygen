<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tor: /home/user/_my/code/bwauth-related/tor/src/or/shared_random.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tor
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97b64286d42c5ef1697cb5f17129db19.html">tor</a></li><li class="navelem"><a class="el" href="dir_3cb0ba3f4b82dbe34a1a06276e96bc8d.html">src</a></li><li class="navelem"><a class="el" href="dir_386635fabd7f6c74e9d9c7a8604514a0.html">or</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">shared_random.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Functions and data structure needed to accomplish the shared random protocol as defined in proposal #250.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="or_8h_source.html">or.h</a>&quot;</code><br />
<code>#include &quot;shared_random.h&quot;</code><br />
<code>#include &quot;<a class="el" href="config_8h_source.html">config.h</a>&quot;</code><br />
<code>#include &quot;confparse.h&quot;</code><br />
<code>#include &quot;<a class="el" href="dirvote_8h_source.html">dirvote.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="networkstatus_8h_source.html">networkstatus.h</a>&quot;</code><br />
<code>#include &quot;routerkeys.h&quot;</code><br />
<code>#include &quot;<a class="el" href="router_8h_source.html">router.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="routerlist_8h_source.html">routerlist.h</a>&quot;</code><br />
<code>#include &quot;shared_random_state.h&quot;</code><br />
<code>#include &quot;<a class="el" href="util_8h_source.html">util.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for shared_random.c:</div>
<div class="dyncontent">
<div class="center"><img src="shared__random_8c__incl.png" border="0" usemap="#_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2shared__random_8c" alt=""/></div>
<map name="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2shared__random_8c" id="_2home_2user_2__my_2code_2bwauth-related_2tor_2src_2or_2shared__random_8c">
<area shape="rect" id="node2" href="or_8h.html" title="Master header file for Tor&#45;specific functionality. " alt="" coords="1234,259,1278,285"/>
<area shape="rect" id="node21" href="util_8h.html" title="Headers for util.c. " alt="" coords="1095,483,1146,509"/>
<area shape="rect" id="node34" href="shared__random_8h_source.html" title="shared_random.h" alt="" coords="711,184,834,211"/>
<area shape="rect" id="node35" href="config_8h.html" title="Header file for config.c. " alt="" coords="194,259,262,285"/>
<area shape="rect" id="node36" href="confparse_8h_source.html" title="confparse.h" alt="" coords="978,109,1068,136"/>
<area shape="rect" id="node37" href="dirvote_8h.html" title="Header file for dirvote.c. " alt="" coords="264,408,336,435"/>
<area shape="rect" id="node38" href="networkstatus_8h.html" title="Header file for networkstatus.c. " alt="" coords="347,184,462,211"/>
<area shape="rect" id="node39" href="routerkeys_8h_source.html" title="routerkeys.h" alt="" coords="1534,184,1629,211"/>
<area shape="rect" id="node40" href="router_8h.html" title="Header file for router.c. " alt="" coords="446,259,512,285"/>
<area shape="rect" id="node41" href="routerlist_8h.html" title="Header file for routerlist.c. " alt="" coords="512,408,595,435"/>
<area shape="rect" id="node42" href="shared__random__state_8h_source.html" title="shared_random_state.h" alt="" coords="693,109,852,136"/>
<area shape="rect" id="node3" href="orconfig_8h_source.html" title="orconfig.h" alt="" coords="1310,856,1389,883"/>
<area shape="rect" id="node4" href="torint_8h.html" title="Header file to define uint32_t and friends. " alt="" coords="1722,781,1785,808"/>
<area shape="rect" id="node5" href="crypto_8h.html" title="Headers for crypto.c. " alt="" coords="766,557,835,584"/>
<area shape="rect" id="node13" href="crypto__format_8h_source.html" title="crypto_format.h" alt="" coords="1542,557,1656,584"/>
<area shape="rect" id="node14" href="crypto__ed25519_8h_source.html" title="crypto_ed25519.h" alt="" coords="1632,632,1758,659"/>
<area shape="rect" id="node15" href="crypto__curve25519_8h_source.html" title="crypto_curve25519.h" alt="" coords="1737,707,1880,733"/>
<area shape="rect" id="node16" href="tortls_8h.html" title="Headers for tortls.c. " alt="" coords="682,483,745,509"/>
<area shape="rect" id="node19" href="torlog_8h.html" title="Headers for log.c. " alt="" coords="1262,557,1328,584"/>
<area shape="rect" id="node20" href="container_8h_source.html" title="container.h" alt="" coords="1336,408,1422,435"/>
<area shape="rect" id="node26" href="torgzip_8h.html" title="Headers for torgzip.h. " alt="" coords="878,333,950,360"/>
<area shape="rect" id="node27" href="address_8h.html" title="Headers for address.h. " alt="" coords="1732,333,1810,360"/>
<area shape="rect" id="node28" href="compat__libevent_8h_source.html" title="compat_libevent.h" alt="" coords="6,707,134,733"/>
<area shape="rect" id="node30" href="ht_8h_source.html" title="ht.h" alt="" coords="974,333,1018,360"/>
<area shape="rect" id="node31" href="replaycache_8h.html" title="Header file for replaycache.c. " alt="" coords="1042,333,1145,360"/>
<area shape="rect" id="node32" href="tor__queue_8h_source.html" title="tor_queue.h" alt="" coords="1170,333,1260,360"/>
<area shape="rect" id="node33" href="util__format_8h_source.html" title="util_format.h" alt="" coords="2057,707,2152,733"/>
<area shape="rect" id="node7" href="testsupport_8h_source.html" title="testsupport.h" alt="" coords="628,781,727,808"/>
<area shape="rect" id="node8" href="compat_8h_source.html" title="compat.h" alt="" coords="1033,632,1109,659"/>
<area shape="rect" id="node10" href="compat__time_8h.html" title="Functions and types for monotonic times. " alt="" coords="1033,781,1141,808"/>
<area shape="rect" id="node12" href="compat__threads_8h_source.html" title="compat_threads.h" alt="" coords="1286,707,1413,733"/>
<area shape="rect" id="node17" href="compat__openssl_8h.html" title="compatability definitions for working with different openssl forks " alt="" coords="614,557,742,584"/>
<area shape="rect" id="node25" href="siphash_8h_source.html" title="siphash.h" alt="" coords="1337,483,1416,509"/>
<area shape="rect" id="node22" href="di__ops_8h.html" title="Headers for di_ops.c. " alt="" coords="1540,707,1610,733"/>
<area shape="rect" id="node24" href="util__bug_8h.html" title="util_bug.h" alt="" coords="969,557,1048,584"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a9739c6f210be7c5f785b98f7e9dfbd5a"><td class="memItemLeft" align="right" valign="top"><a id="a9739c6f210be7c5f785b98f7e9dfbd5a"></a>
STATIC <a class="el" href="structsr__srv__t.html">sr_srv_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>srv_dup</b> (const <a class="el" href="structsr__srv__t.html">sr_srv_t</a> *orig)</td></tr>
<tr class="separator:a9739c6f210be7c5f785b98f7e9dfbd5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5c51e358894f482e2670fe8141c733c"><td class="memItemLeft" align="right" valign="top"><a id="ac5c51e358894f482e2670fe8141c733c"></a>
STATIC int&#160;</td><td class="memItemRight" valign="bottom"><b>verify_commit_and_reveal</b> (const <a class="el" href="structsr__commit__t.html">sr_commit_t</a> *commit)</td></tr>
<tr class="separator:ac5c51e358894f482e2670fe8141c733c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91b60dd253bc3780de35abec8fa6570a"><td class="memItemLeft" align="right" valign="top"><a id="a91b60dd253bc3780de35abec8fa6570a"></a>
STATIC int&#160;</td><td class="memItemRight" valign="bottom"><b>commit_has_reveal_value</b> (const <a class="el" href="structsr__commit__t.html">sr_commit_t</a> *commit)</td></tr>
<tr class="separator:a91b60dd253bc3780de35abec8fa6570a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb5a2a0ef2283a0bb67a779a35d8f65e"><td class="memItemLeft" align="right" valign="top"><a id="adb5a2a0ef2283a0bb67a779a35d8f65e"></a>
STATIC int&#160;</td><td class="memItemRight" valign="bottom"><b>commit_decode</b> (const char *encoded, <a class="el" href="structsr__commit__t.html">sr_commit_t</a> *commit)</td></tr>
<tr class="separator:adb5a2a0ef2283a0bb67a779a35d8f65e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f106a2dc0a292f6e8bd01e037d12736"><td class="memItemLeft" align="right" valign="top"><a id="a9f106a2dc0a292f6e8bd01e037d12736"></a>
STATIC int&#160;</td><td class="memItemRight" valign="bottom"><b>reveal_decode</b> (const char *encoded, <a class="el" href="structsr__commit__t.html">sr_commit_t</a> *commit)</td></tr>
<tr class="separator:a9f106a2dc0a292f6e8bd01e037d12736"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3591abc7f9bd5cb5eb099e892f206a54"><td class="memItemLeft" align="right" valign="top"><a id="a3591abc7f9bd5cb5eb099e892f206a54"></a>
STATIC int&#160;</td><td class="memItemRight" valign="bottom"><b>reveal_encode</b> (const <a class="el" href="structsr__commit__t.html">sr_commit_t</a> *commit, char *dst, size_t len)</td></tr>
<tr class="separator:a3591abc7f9bd5cb5eb099e892f206a54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab986d2ea32388b7a06f8c0575abbfc8a"><td class="memItemLeft" align="right" valign="top"><a id="ab986d2ea32388b7a06f8c0575abbfc8a"></a>
STATIC int&#160;</td><td class="memItemRight" valign="bottom"><b>commit_encode</b> (const <a class="el" href="structsr__commit__t.html">sr_commit_t</a> *commit, char *dst, size_t len)</td></tr>
<tr class="separator:ab986d2ea32388b7a06f8c0575abbfc8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe225a831c84e755048cca67ce8a0c58"><td class="memItemLeft" align="right" valign="top"><a id="abe225a831c84e755048cca67ce8a0c58"></a>
STATIC int&#160;</td><td class="memItemRight" valign="bottom"><b>commitments_are_the_same</b> (const <a class="el" href="structsr__commit__t.html">sr_commit_t</a> *commit_one, const <a class="el" href="structsr__commit__t.html">sr_commit_t</a> *commit_two)</td></tr>
<tr class="separator:abe225a831c84e755048cca67ce8a0c58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ecfc4d5b4477a15fa30b0cd589b9b15"><td class="memItemLeft" align="right" valign="top"><a id="a4ecfc4d5b4477a15fa30b0cd589b9b15"></a>
STATIC int&#160;</td><td class="memItemRight" valign="bottom"><b>commit_is_authoritative</b> (const <a class="el" href="structsr__commit__t.html">sr_commit_t</a> *commit, const char *voter_key)</td></tr>
<tr class="separator:a4ecfc4d5b4477a15fa30b0cd589b9b15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c9109f7b1e6a7470e15b895e65c7b18"><td class="memItemLeft" align="right" valign="top"><a id="a4c9109f7b1e6a7470e15b895e65c7b18"></a>
STATIC int&#160;</td><td class="memItemRight" valign="bottom"><b>should_keep_commit</b> (const <a class="el" href="structsr__commit__t.html">sr_commit_t</a> *commit, const char *voter_key, sr_phase_t phase)</td></tr>
<tr class="separator:a4c9109f7b1e6a7470e15b895e65c7b18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d4927e176f186c21c938a8fbf293405"><td class="memItemLeft" align="right" valign="top"><a id="a1d4927e176f186c21c938a8fbf293405"></a>
STATIC void&#160;</td><td class="memItemRight" valign="bottom"><b>save_commit_during_reveal_phase</b> (const <a class="el" href="structsr__commit__t.html">sr_commit_t</a> *commit)</td></tr>
<tr class="separator:a1d4927e176f186c21c938a8fbf293405"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81060221f6fe9e5b10c69bd985809e7d"><td class="memItemLeft" align="right" valign="top"><a id="a81060221f6fe9e5b10c69bd985809e7d"></a>
STATIC void&#160;</td><td class="memItemRight" valign="bottom"><b>save_commit_to_state</b> (<a class="el" href="structsr__commit__t.html">sr_commit_t</a> *commit)</td></tr>
<tr class="separator:a81060221f6fe9e5b10c69bd985809e7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adda9b26cde87561265ec50339d746cb9"><td class="memItemLeft" align="right" valign="top"><a id="adda9b26cde87561265ec50339d746cb9"></a>
STATIC <a class="el" href="structsr__srv__t.html">sr_srv_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>get_majority_srv_from_votes</b> (const <a class="el" href="structsmartlist__t.html">smartlist_t</a> *votes, int current)</td></tr>
<tr class="separator:adda9b26cde87561265ec50339d746cb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8772b0a81139b8105fe276e6aab2b2ae"><td class="memItemLeft" align="right" valign="top"><a id="a8772b0a81139b8105fe276e6aab2b2ae"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>sr_srv_encode</b> (char *dst, size_t dst_len, const <a class="el" href="structsr__srv__t.html">sr_srv_t</a> *srv)</td></tr>
<tr class="separator:a8772b0a81139b8105fe276e6aab2b2ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84ac4ae0251dc8b92c327ecff6c229cc"><td class="memItemLeft" align="right" valign="top"><a id="a84ac4ae0251dc8b92c327ecff6c229cc"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>sr_commit_free</b> (<a class="el" href="structsr__commit__t.html">sr_commit_t</a> *commit)</td></tr>
<tr class="separator:a84ac4ae0251dc8b92c327ecff6c229cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a132736a325c9fb84a06db87f8860ff2b"><td class="memItemLeft" align="right" valign="top"><a id="a132736a325c9fb84a06db87f8860ff2b"></a>
<a class="el" href="structsr__commit__t.html">sr_commit_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>sr_generate_our_commit</b> (time_t timestamp, const <a class="el" href="structauthority__cert__t.html">authority_cert_t</a> *my_rsa_cert)</td></tr>
<tr class="separator:a132736a325c9fb84a06db87f8860ff2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3668524cdcd2fcc1e4f6014b82f679f"><td class="memItemLeft" align="right" valign="top"><a id="ad3668524cdcd2fcc1e4f6014b82f679f"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>sr_compute_srv</b> (void)</td></tr>
<tr class="separator:ad3668524cdcd2fcc1e4f6014b82f679f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3753c9baa3add61828cda85d3b54348e"><td class="memItemLeft" align="right" valign="top"><a id="a3753c9baa3add61828cda85d3b54348e"></a>
<a class="el" href="structsr__srv__t.html">sr_srv_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>sr_parse_srv</b> (const <a class="el" href="structsmartlist__t.html">smartlist_t</a> *args)</td></tr>
<tr class="separator:a3753c9baa3add61828cda85d3b54348e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ff82c23af81cdbad0621dfd698699a9"><td class="memItemLeft" align="right" valign="top"><a id="a1ff82c23af81cdbad0621dfd698699a9"></a>
<a class="el" href="structsr__commit__t.html">sr_commit_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>sr_parse_commit</b> (const <a class="el" href="structsmartlist__t.html">smartlist_t</a> *args)</td></tr>
<tr class="separator:a1ff82c23af81cdbad0621dfd698699a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90c7bce0300eb770a753b96b1c713bb4"><td class="memItemLeft" align="right" valign="top"><a id="a90c7bce0300eb770a753b96b1c713bb4"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>sr_handle_received_commits</b> (<a class="el" href="structsmartlist__t.html">smartlist_t</a> *commits, <a class="el" href="structcrypto__pk__t.html">crypto_pk_t</a> *voter_key)</td></tr>
<tr class="separator:a90c7bce0300eb770a753b96b1c713bb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaec3ef5d1928eb3ca4d0a68b2c016e4e"><td class="memItemLeft" align="right" valign="top"><a id="aaec3ef5d1928eb3ca4d0a68b2c016e4e"></a>
char *&#160;</td><td class="memItemRight" valign="bottom"><b>sr_get_string_for_vote</b> (void)</td></tr>
<tr class="separator:aaec3ef5d1928eb3ca4d0a68b2c016e4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a051f995843f126cc86e555df2fb5c6d4"><td class="memItemLeft" align="right" valign="top"><a id="a051f995843f126cc86e555df2fb5c6d4"></a>
char *&#160;</td><td class="memItemRight" valign="bottom"><b>sr_get_string_for_consensus</b> (const <a class="el" href="structsmartlist__t.html">smartlist_t</a> *votes, int32_t num_srv_agreements)</td></tr>
<tr class="separator:a051f995843f126cc86e555df2fb5c6d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76f692018d4c515651afa3ca4a68eaca"><td class="memItemLeft" align="right" valign="top"><a id="a76f692018d4c515651afa3ca4a68eaca"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>sr_act_post_consensus</b> (const <a class="el" href="structnetworkstatus__t.html">networkstatus_t</a> *consensus)</td></tr>
<tr class="separator:a76f692018d4c515651afa3ca4a68eaca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d25a0b2aa75c5f4d157d4811a8e0377"><td class="memItemLeft" align="right" valign="top"><a id="a4d25a0b2aa75c5f4d157d4811a8e0377"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>sr_init</b> (int save_to_disk)</td></tr>
<tr class="separator:a4d25a0b2aa75c5f4d157d4811a8e0377"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cfdc49dcb19792e0354e5fb80ef0b02"><td class="memItemLeft" align="right" valign="top"><a id="a3cfdc49dcb19792e0354e5fb80ef0b02"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>sr_save_and_cleanup</b> (void)</td></tr>
<tr class="separator:a3cfdc49dcb19792e0354e5fb80ef0b02"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Functions and data structure needed to accomplish the shared random protocol as defined in proposal #250. </p>
<p>This file implements the dirauth-only commit-and-reveal protocol specified by proposal #250. The protocol has two phases (sr_phase_t): the commitment phase and the reveal phase (see get_sr_protocol_phase()).</p>
<p>During the protocol, directory authorities keep state in memory (using <a class="el" href="structsr__state__t.html">sr_state_t</a>) and in disk (using <a class="el" href="structsr__disk__state__t.html">sr_disk_state_t</a>). The synchronization between these two data structures happens in disk_state_update() and disk_state_parse().</p>
<p>Here is a rough protocol outline: </p><pre class="fragment"> 1) In the beginning of the commitment phase, dirauths generate a
    commitment/reveal value for the current protocol run (see
    new_protocol_run() and sr_generate_our_commit()).

 2) During voting, dirauths publish their commits in their votes
    depending on the current phase.  Dirauths also include the two
    latest shared random values (SRV) in their votes.
    (see sr_get_string_for_vote())

 3) Upon receiving a commit from a vote, authorities parse it, verify
    it, and attempt to save any new commitment or reveal information in
    their state file (see extract_shared_random_commits() and
    sr_handle_received_commits()).  They also parse SRVs from votes to
    decide which SRV should be included in the final consensus (see
    extract_shared_random_srvs()).

 3) After voting is done, we count the SRVs we extracted from the votes,
    to find the one voted by the majority of dirauths which should be
    included in the final consensus (see get_majority_srv_from_votes()).
    If an appropriate SRV is found, it is embedded in the consensus (see
    sr_get_string_for_consensus()).

 4) At the end of the reveal phase, dirauths compute a fresh SRV for the
    day using the active commits (see sr_compute_srv()).  This new SRV
    is embedded in the votes as described above.
</pre><p>Some more notes:</p>
<ul>
<li>To support rebooting authorities and to avoid double voting, each dirauth saves the current state of the protocol on disk so that it can resume normally in case of reboot. The disk state (<a class="el" href="structsr__disk__state__t.html">sr_disk_state_t</a>) is managed by <a class="el" href="shared__random__state_8c.html" title="Functions and data structures for the state of the random protocol as defined in proposal #250...">shared_random_state.c</a>:state_query() and we go to extra lengths to ensure that the state is flushed on disk everytime we receive any useful information like commits or SRVs.</li>
<li>When we receive a commit from a vote, we examine it to see if it's useful to us and whether it's appropriate to receive it according to the current phase of the protocol (see should_keep_commit()). If the commit is useful to us, we save it in our disk state using save_commit_to_state(). When we receive the reveal information corresponding to a commitment, we verify that they indeed match using verify_commit_and_reveal().</li>
<li>We treat consensuses as the ground truth, so everytime we generate a new consensus we update our SR state accordingly even if our local view was different (see sr_act_post_consensus()).</li>
<li>After a consensus has been composed, the SR protocol state gets prepared for the next voting session using sr_state_update(). That function takes care of housekeeping and also rotates the SRVs and commits in case a new protocol run is coming up. We also call sr_state_update() on bootup (in sr_state_init()), to prepare the state for the very first voting session.</li>
</ul>
<p>Terminology:</p>
<ul>
<li>"Commitment" is the commitment value of the commit-and-reveal protocol.</li>
<li>"Reveal" is the reveal value of the commit-and-reveal protocol.</li>
<li>"Commit" is a struct (<a class="el" href="structsr__commit__t.html">sr_commit_t</a>) that contains a commitment value and optionally also a corresponding reveal value.</li>
<li>"SRV" is the Shared Random Value that gets generated as the result of the commit-and-reveal protocol. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
